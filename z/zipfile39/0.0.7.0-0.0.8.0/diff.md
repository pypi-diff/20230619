# Comparing `tmp/zipfile39-0.0.7.0.tar.gz` & `tmp/zipfile39-0.0.8.0.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "dist/zipfile39-0.0.7.0.tar", last modified: Sat Jan  7 06:47:41 2023, max compression
+gzip compressed data, was "dist/zipfile39-0.0.8.0.tar", last modified: Mon Jun 19 03:45:34 2023, max compression
```

## Comparing `zipfile39-0.0.7.0.tar` & `zipfile39-0.0.8.0.tar`

### file list

```diff
@@ -1,28 +1,28 @@
-drwxr-xr-x   0 mujin     (1000) mujin     (1000)        0 2023-01-07 06:47:41.000000 zipfile39-0.0.7.0/
--rw-r--r--   0 mujin     (1000) mujin     (1000)       38 2023-01-07 06:47:41.000000 zipfile39-0.0.7.0/setup.cfg
-drwxr-xr-x   0 mujin     (1000) mujin     (1000)        0 2023-01-07 06:47:41.000000 zipfile39-0.0.7.0/zipfile39.egg-info/
--rw-r--r--   0 mujin     (1000) mujin     (1000)        1 2021-10-12 03:39:43.000000 zipfile39-0.0.7.0/zipfile39.egg-info/not-zip-safe
--rw-r--r--   0 mujin     (1000) mujin     (1000)        1 2023-01-07 06:47:41.000000 zipfile39-0.0.7.0/zipfile39.egg-info/dependency_links.txt
--rw-r--r--   0 mujin     (1000) mujin     (1000)       10 2023-01-07 06:47:41.000000 zipfile39-0.0.7.0/zipfile39.egg-info/top_level.txt
--rw-r--r--   0 mujin     (1000) mujin     (1000)      203 2023-01-07 06:47:41.000000 zipfile39-0.0.7.0/zipfile39.egg-info/requires.txt
--rw-r--r--   0 mujin     (1000) mujin     (1000)     4614 2023-01-07 06:47:41.000000 zipfile39-0.0.7.0/zipfile39.egg-info/PKG-INFO
--rw-r--r--   0 mujin     (1000) mujin     (1000)      444 2023-01-07 06:47:41.000000 zipfile39-0.0.7.0/zipfile39.egg-info/SOURCES.txt
-drwxr-xr-x   0 mujin     (1000) mujin     (1000)        0 2023-01-07 06:47:41.000000 zipfile39-0.0.7.0/zipfile39/
--rw-r--r--   0 mujin     (1000) mujin     (1000)       24 2023-01-07 06:31:34.000000 zipfile39-0.0.7.0/zipfile39/version.py
--rw-r--r--   0 mujin     (1000) mujin     (1000)       67 2023-01-07 06:35:46.000000 zipfile39-0.0.7.0/zipfile39/__main__.py
--rwxr-xr-x   0 mujin     (1000) mujin     (1000)    99371 2022-11-25 09:02:47.000000 zipfile39-0.0.7.0/zipfile39/zipfile39.py
--rw-r--r--   0 mujin     (1000) mujin     (1000)       58 2023-01-07 06:34:10.000000 zipfile39-0.0.7.0/zipfile39/__init__.py
-drwxr-xr-x   0 mujin     (1000) mujin     (1000)        0 2023-01-07 06:47:41.000000 zipfile39-0.0.7.0/test/
--rw-r--r--   0 mujin     (1000) mujin     (1000)     6151 2023-01-07 06:40:43.000000 zipfile39-0.0.7.0/test/test_zipfile.py
-drwxr-xr-x   0 mujin     (1000) mujin     (1000)        0 2023-01-07 06:47:41.000000 zipfile39-0.0.7.0/test/data/
--rw-r--r--   0 mujin     (1000) mujin     (1000)  1247263 2021-08-19 03:30:48.000000 zipfile39-0.0.7.0/test/data/10000SalesRecords.csv
--rw-r--r--   0 mujin     (1000) mujin     (1000)      616 2022-08-03 06:41:56.000000 zipfile39-0.0.7.0/LICENSE2
--rw-r--r--   0 mujin     (1000) mujin     (1000)     1037 2022-08-03 06:42:35.000000 zipfile39-0.0.7.0/CHANGELOG.md
--rw-r--r--   0 mujin     (1000) mujin     (1000)     3091 2022-08-03 06:41:56.000000 zipfile39-0.0.7.0/README.md
-drwxr-xr-x   0 mujin     (1000) mujin     (1000)        0 2023-01-07 06:47:41.000000 zipfile39-0.0.7.0/.github/
-drwxr-xr-x   0 mujin     (1000) mujin     (1000)        0 2023-01-07 06:47:41.000000 zipfile39-0.0.7.0/.github/workflows/
--rw-r--r--   0 mujin     (1000) mujin     (1000)     1055 2023-01-07 06:37:52.000000 zipfile39-0.0.7.0/.github/workflows/altmodule.yaml
--rw-r--r--   0 mujin     (1000) mujin     (1000)     7248 2023-01-07 06:37:11.000000 zipfile39-0.0.7.0/.github/workflows/ci.yaml
--rw-r--r--   0 mujin     (1000) mujin     (1000)     2478 2021-08-01 23:56:04.000000 zipfile39-0.0.7.0/LICENSE
--rw-r--r--   0 mujin     (1000) mujin     (1000)     4614 2023-01-07 06:47:41.000000 zipfile39-0.0.7.0/PKG-INFO
--rw-r--r--   0 mujin     (1000) mujin     (1000)     1910 2023-01-07 06:32:09.000000 zipfile39-0.0.7.0/setup.py
+drwxr-xr-x   0 mujin     (1000) mujin     (1000)        0 2023-06-19 03:45:34.000000 zipfile39-0.0.8.0/
+-rw-r--r--   0 mujin     (1000) mujin     (1000)       38 2023-06-19 03:45:34.000000 zipfile39-0.0.8.0/setup.cfg
+drwxr-xr-x   0 mujin     (1000) mujin     (1000)        0 2023-06-19 03:45:34.000000 zipfile39-0.0.8.0/zipfile39.egg-info/
+-rw-r--r--   0 mujin     (1000) mujin     (1000)        1 2021-10-12 03:39:43.000000 zipfile39-0.0.8.0/zipfile39.egg-info/not-zip-safe
+-rw-r--r--   0 mujin     (1000) mujin     (1000)        1 2023-06-19 03:45:34.000000 zipfile39-0.0.8.0/zipfile39.egg-info/dependency_links.txt
+-rw-r--r--   0 mujin     (1000) mujin     (1000)       10 2023-06-19 03:45:34.000000 zipfile39-0.0.8.0/zipfile39.egg-info/top_level.txt
+-rw-r--r--   0 mujin     (1000) mujin     (1000)      203 2023-06-19 03:45:34.000000 zipfile39-0.0.8.0/zipfile39.egg-info/requires.txt
+-rw-r--r--   0 mujin     (1000) mujin     (1000)     4614 2023-06-19 03:45:34.000000 zipfile39-0.0.8.0/zipfile39.egg-info/PKG-INFO
+-rw-r--r--   0 mujin     (1000) mujin     (1000)      444 2023-06-19 03:45:34.000000 zipfile39-0.0.8.0/zipfile39.egg-info/SOURCES.txt
+drwxr-xr-x   0 mujin     (1000) mujin     (1000)        0 2023-06-19 03:45:34.000000 zipfile39-0.0.8.0/zipfile39/
+-rw-r--r--   0 mujin     (1000) mujin     (1000)       24 2023-06-19 03:45:10.000000 zipfile39-0.0.8.0/zipfile39/version.py
+-rw-r--r--   0 mujin     (1000) mujin     (1000)       67 2023-01-07 06:35:46.000000 zipfile39-0.0.8.0/zipfile39/__main__.py
+-rwxr-xr-x   0 mujin     (1000) mujin     (1000)    99647 2023-06-19 03:45:10.000000 zipfile39-0.0.8.0/zipfile39/zipfile39.py
+-rw-r--r--   0 mujin     (1000) mujin     (1000)       58 2023-01-07 06:34:10.000000 zipfile39-0.0.8.0/zipfile39/__init__.py
+drwxr-xr-x   0 mujin     (1000) mujin     (1000)        0 2023-06-19 03:45:34.000000 zipfile39-0.0.8.0/test/
+-rw-r--r--   0 mujin     (1000) mujin     (1000)     7555 2023-06-19 03:45:10.000000 zipfile39-0.0.8.0/test/test_zipfile.py
+drwxr-xr-x   0 mujin     (1000) mujin     (1000)        0 2023-06-19 03:45:34.000000 zipfile39-0.0.8.0/test/data/
+-rw-r--r--   0 mujin     (1000) mujin     (1000)  1247263 2021-08-19 03:30:48.000000 zipfile39-0.0.8.0/test/data/10000SalesRecords.csv
+-rw-r--r--   0 mujin     (1000) mujin     (1000)      616 2022-08-03 06:41:56.000000 zipfile39-0.0.8.0/LICENSE2
+-rw-r--r--   0 mujin     (1000) mujin     (1000)     1127 2023-06-19 03:45:10.000000 zipfile39-0.0.8.0/CHANGELOG.md
+-rw-r--r--   0 mujin     (1000) mujin     (1000)     3091 2022-08-03 06:41:56.000000 zipfile39-0.0.8.0/README.md
+drwxr-xr-x   0 mujin     (1000) mujin     (1000)        0 2023-06-19 03:45:34.000000 zipfile39-0.0.8.0/.github/
+drwxr-xr-x   0 mujin     (1000) mujin     (1000)        0 2023-06-19 03:45:34.000000 zipfile39-0.0.8.0/.github/workflows/
+-rw-r--r--   0 mujin     (1000) mujin     (1000)     1055 2023-06-19 03:45:10.000000 zipfile39-0.0.8.0/.github/workflows/altmodule.yaml
+-rw-r--r--   0 mujin     (1000) mujin     (1000)     7420 2023-06-19 03:45:10.000000 zipfile39-0.0.8.0/.github/workflows/ci.yaml
+-rw-r--r--   0 mujin     (1000) mujin     (1000)     2478 2021-08-01 23:56:04.000000 zipfile39-0.0.8.0/LICENSE
+-rw-r--r--   0 mujin     (1000) mujin     (1000)     4614 2023-06-19 03:45:34.000000 zipfile39-0.0.8.0/PKG-INFO
+-rw-r--r--   0 mujin     (1000) mujin     (1000)     1910 2023-01-07 06:32:09.000000 zipfile39-0.0.8.0/setup.py
```

### Comparing `zipfile39-0.0.7.0/zipfile39.egg-info/PKG-INFO` & `zipfile39-0.0.8.0/zipfile39.egg-info/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: zipfile39
-Version: 0.0.7.0
+Version: 0.0.8.0
 Summary: Backport of zipfile Python 3.9 to Python 2.7 with some enhancements
 Home-page: https://github.com/cielavenir/zipfile39
 Author: cielavenir
 Author-email: cielartisan@gmail.com
 License: PSF
 Description: [![PyPI](https://img.shields.io/pypi/v/zipfile39)](https://pypi.org/project/zipfile39/)
```

### Comparing `zipfile39-0.0.7.0/zipfile39/zipfile39.py` & `zipfile39-0.0.8.0/zipfile39/zipfile39.py`

 * *Files 1% similar despite different names*

```diff
@@ -20,6192 +20,6209 @@
 00000130: 706f 7274 206f 730a 696d 706f 7274 2070  port os.import p
 00000140: 6f73 6978 7061 7468 0a69 6d70 6f72 7420  osixpath.import 
 00000150: 7368 7574 696c 0a69 6d70 6f72 7420 7374  shutil.import st
 00000160: 6174 0a69 6d70 6f72 7420 7374 7275 6374  at.import struct
 00000170: 0a69 6d70 6f72 7420 7379 730a 696d 706f  .import sys.impo
 00000180: 7274 2074 6872 6561 6469 6e67 0a69 6d70  rt threading.imp
 00000190: 6f72 7420 7469 6d65 0a69 6d70 6f72 7420  ort time.import 
-000001a0: 6572 726e 6f0a 0a74 7279 3a0a 2020 2020  errno..try:.    
-000001b0: 6672 6f6d 2070 6174 686c 6962 2069 6d70  from pathlib imp
-000001c0: 6f72 7420 5061 7468 0a65 7863 6570 7420  ort Path.except 
-000001d0: 496d 706f 7274 4572 726f 723a 0a20 2020  ImportError:.   
-000001e0: 2066 726f 6d20 7061 7468 6c69 6232 2069   from pathlib2 i
-000001f0: 6d70 6f72 7420 5061 7468 0a0a 7472 793a  mport Path..try:
-00000200: 0a20 2020 2066 726f 6d20 636f 6e74 6578  .    from contex
-00000210: 746c 6962 2069 6d70 6f72 7420 7375 7070  tlib import supp
-00000220: 7265 7373 0a65 7863 6570 7420 496d 706f  ress.except Impo
-00000230: 7274 4572 726f 723a 0a20 2020 2066 726f  rtError:.    fro
-00000240: 6d20 636f 6e74 6578 746c 6962 3220 696d  m contextlib2 im
-00000250: 706f 7274 2073 7570 7072 6573 730a 0a63  port suppress..c
-00000260: 7263 3332 203d 2062 696e 6173 6369 692e  rc32 = binascii.
-00000270: 6372 6333 320a 0a74 7279 3a0a 2020 2020  crc32..try:.    
-00000280: 696d 706f 7274 207a 6c69 6220 2320 5765  import zlib # We
-00000290: 206d 6179 206e 6565 6420 6974 7320 636f   may need its co
-000002a0: 6d70 7265 7373 696f 6e20 6d65 7468 6f64  mpression method
-000002b0: 0a20 2020 2063 7263 3332 203d 207a 6c69  .    crc32 = zli
-000002c0: 622e 6372 6333 320a 6578 6365 7074 2049  b.crc32.except I
-000002d0: 6d70 6f72 7445 7272 6f72 3a0a 2020 2020  mportError:.    
-000002e0: 7a6c 6962 203d 204e 6f6e 650a 0a74 7279  zlib = None..try
-000002f0: 3a0a 2020 2020 6672 6f6d 2069 7361 6c20  :.    from isal 
-00000300: 696d 706f 7274 2069 7361 6c5f 7a6c 6962  import isal_zlib
-00000310: 0a20 2020 2063 7263 3332 203d 2069 7361  .    crc32 = isa
-00000320: 6c5f 7a6c 6962 2e63 7263 3332 0a65 7863  l_zlib.crc32.exc
-00000330: 6570 7420 496d 706f 7274 4572 726f 723a  ept ImportError:
-00000340: 0a20 2020 2069 7361 6c5f 7a6c 6962 203d  .    isal_zlib =
-00000350: 204e 6f6e 650a 0a74 7279 3a0a 2020 2020   None..try:.    
-00000360: 696d 706f 7274 2073 6c7a 0a65 7863 6570  import slz.excep
-00000370: 7420 496d 706f 7274 4572 726f 723a 0a20  t ImportError:. 
-00000380: 2020 2073 6c7a 203d 204e 6f6e 650a 0a74     slz = None..t
-00000390: 7279 3a0a 2020 2020 696d 706f 7274 2062  ry:.    import b
-000003a0: 7a32 2023 2057 6520 6d61 7920 6e65 6564  z2 # We may need
-000003b0: 2069 7473 2063 6f6d 7072 6573 7369 6f6e   its compression
-000003c0: 206d 6574 686f 640a 6578 6365 7074 2049   method.except I
-000003d0: 6d70 6f72 7445 7272 6f72 3a0a 2020 2020  mportError:.    
-000003e0: 627a 3220 3d20 4e6f 6e65 0a0a 7472 793a  bz2 = None..try:
-000003f0: 0a20 2020 2069 6d70 6f72 7420 6c7a 6d61  .    import lzma
-00000400: 2023 2057 6520 6d61 7920 6e65 6564 2069   # We may need i
-00000410: 7473 2063 6f6d 7072 6573 7369 6f6e 206d  ts compression m
-00000420: 6574 686f 640a 6578 6365 7074 2049 6d70  ethod.except Imp
-00000430: 6f72 7445 7272 6f72 3a0a 2020 2020 7472  ortError:.    tr
-00000440: 793a 0a20 2020 2020 2020 2066 726f 6d20  y:.        from 
-00000450: 6261 636b 706f 7274 7320 696d 706f 7274  backports import
-00000460: 206c 7a6d 610a 2020 2020 6578 6365 7074   lzma.    except
-00000470: 2049 6d70 6f72 7445 7272 6f72 3a0a 2020   ImportError:.  
-00000480: 2020 2020 2020 6c7a 6d61 203d 204e 6f6e        lzma = Non
-00000490: 650a 0a74 7279 3a0a 2020 2020 696d 706f  e..try:.    impo
-000004a0: 7274 207a 7374 616e 6461 7264 2023 2057  rt zstandard # W
-000004b0: 6520 6d61 7920 6e65 6564 2069 7473 2063  e may need its c
-000004c0: 6f6d 7072 6573 7369 6f6e 206d 6574 686f  ompression metho
-000004d0: 640a 6578 6365 7074 2049 6d70 6f72 7445  d.except ImportE
-000004e0: 7272 6f72 3a0a 2020 2020 7a73 7461 6e64  rror:.    zstand
-000004f0: 6172 6420 3d20 4e6f 6e65 0a0a 7472 793a  ard = None..try:
-00000500: 0a20 2020 2069 6d70 6f72 7420 7079 7a73  .    import pyzs
-00000510: 7464 2023 2057 6520 6d61 7920 6e65 6564  td # We may need
-00000520: 2069 7473 2063 6f6d 7072 6573 7369 6f6e   its compression
-00000530: 206d 6574 686f 640a 6578 6365 7074 2049   method.except I
-00000540: 6d70 6f72 7445 7272 6f72 3a0a 2020 2020  mportError:.    
-00000550: 7079 7a73 7464 203d 204e 6f6e 650a 0a74  pyzstd = None..t
-00000560: 7279 3a0a 2020 2020 6672 6f6d 207a 6970  ry:.    from zip
-00000570: 6669 6c65 5f64 6566 6c61 7465 3634 2069  file_deflate64 i
-00000580: 6d70 6f72 7420 6465 666c 6174 6536 3420  mport deflate64 
-00000590: 2320 5765 206d 6179 206e 6565 6420 6974  # We may need it
-000005a0: 7320 636f 6d70 7265 7373 696f 6e20 6d65  s compression me
-000005b0: 7468 6f64 0a65 7863 6570 7420 496d 706f  thod.except Impo
-000005c0: 7274 4572 726f 723a 0a20 2020 2064 6566  rtError:.    def
-000005d0: 6c61 7465 3634 203d 204e 6f6e 650a 0a74  late64 = None..t
-000005e0: 7279 3a0a 2020 2020 696d 706f 7274 2069  ry:.    import i
-000005f0: 6e66 6c61 7465 3634 2023 2057 6520 6d61  nflate64 # We ma
-00000600: 7920 6e65 6564 2069 7473 2063 6f6d 7072  y need its compr
-00000610: 6573 7369 6f6e 206d 6574 686f 640a 6578  ession method.ex
-00000620: 6365 7074 2049 6d70 6f72 7445 7272 6f72  cept ImportError
-00000630: 3a0a 2020 2020 696e 666c 6174 6536 3420  :.    inflate64 
-00000640: 3d20 4e6f 6e65 0a0a 7472 793a 0a20 2020  = None..try:.   
-00000650: 2069 6d70 6f72 7420 7079 7070 6d64 2023   import pyppmd #
-00000660: 2057 6520 6d61 7920 6e65 6564 2069 7473   We may need its
-00000670: 2063 6f6d 7072 6573 7369 6f6e 206d 6574   compression met
-00000680: 686f 640a 6578 6365 7074 2049 6d70 6f72  hod.except Impor
-00000690: 7445 7272 6f72 3a0a 2020 2020 7079 7070  tError:.    pypp
-000006a0: 6d64 203d 204e 6f6e 650a 0a74 7279 3a0a  md = None..try:.
-000006b0: 2020 2020 696d 706f 7274 2064 636c 696d      import dclim
-000006c0: 706c 6f64 6520 2320 5765 206d 6179 206e  plode # We may n
-000006d0: 6565 6420 6974 7320 636f 6d70 7265 7373  eed its compress
-000006e0: 696f 6e20 6d65 7468 6f64 0a65 7863 6570  ion method.excep
-000006f0: 7420 496d 706f 7274 4572 726f 723a 0a20  t ImportError:. 
-00000700: 2020 2064 636c 696d 706c 6f64 6520 3d20     dclimplode = 
-00000710: 4e6f 6e65 0a0a 7472 793a 0a20 2020 2069  None..try:.    i
-00000720: 6d70 6f72 7420 636f 6465 6373 377a 2023  mport codecs7z #
-00000730: 2057 6520 6d61 7920 6e65 6564 2069 7473   We may need its
-00000740: 2063 6f6d 7072 6573 7369 6f6e 206d 6574   compression met
-00000750: 686f 640a 6578 6365 7074 2049 6d70 6f72  hod.except Impor
-00000760: 7445 7272 6f72 3a0a 2020 2020 636f 6465  tError:.    code
-00000770: 6373 377a 203d 204e 6f6e 650a 0a64 6566  cs7z = None..def
-00000780: 2066 696c 7465 7266 616c 7365 2870 7265   filterfalse(pre
-00000790: 6469 6361 7465 2c20 6974 6572 6162 6c65  dicate, iterable
-000007a0: 293a 0a20 2020 2023 2066 696c 7465 7266  ):.    # filterf
-000007b0: 616c 7365 286c 616d 6264 6120 783a 2078  alse(lambda x: x
-000007c0: 2532 2c20 7261 6e67 6528 3130 2929 202d  %2, range(10)) -
-000007d0: 2d3e 2030 2032 2034 2036 2038 0a20 2020  -> 0 2 4 6 8.   
-000007e0: 2069 6620 7072 6564 6963 6174 6520 6973   if predicate is
-000007f0: 204e 6f6e 653a 0a20 2020 2020 2020 2070   None:.        p
-00000800: 7265 6469 6361 7465 203d 2062 6f6f 6c0a  redicate = bool.
-00000810: 2020 2020 666f 7220 7820 696e 2069 7465      for x in ite
-00000820: 7261 626c 653a 0a20 2020 2020 2020 2069  rable:.        i
-00000830: 6620 6e6f 7420 7072 6564 6963 6174 6528  f not predicate(
-00000840: 7829 3a0a 2020 2020 2020 2020 2020 2020  x):.            
-00000850: 7969 656c 6420 780a 0a69 6620 6e6f 7420  yield x..if not 
-00000860: 6861 7361 7474 7228 6974 6572 746f 6f6c  hasattr(itertool
-00000870: 732c 2027 6669 6c74 6572 6661 6c73 6527  s, 'filterfalse'
-00000880: 293a 0a20 2020 2069 7465 7274 6f6f 6c73  ):.    itertools
-00000890: 2e66 696c 7465 7266 616c 7365 203d 2066  .filterfalse = f
-000008a0: 696c 7465 7266 616c 7365 0a0a 6966 2073  ilterfalse..if s
-000008b0: 7973 2e76 6572 7369 6f6e 5f69 6e66 6f5b  ys.version_info[
-000008c0: 305d 3e3d 333a 0a20 2020 2062 6173 6573  0]>=3:.    bases
-000008d0: 7472 696e 6720 3d20 7374 720a 0a5f 5f61  tring = str..__a
-000008e0: 6c6c 5f5f 203d 205b 2242 6164 5a69 7046  ll__ = ["BadZipF
-000008f0: 696c 6522 2c20 2242 6164 5a69 7066 696c  ile", "BadZipfil
-00000900: 6522 2c20 2265 7272 6f72 222c 0a20 2020  e", "error",.   
-00000910: 2020 2020 2020 2020 225a 4950 5f53 544f          "ZIP_STO
-00000920: 5245 4422 2c20 225a 4950 5f44 4546 4c41  RED", "ZIP_DEFLA
-00000930: 5445 4422 2c20 225a 4950 5f44 4546 4c41  TED", "ZIP_DEFLA
-00000940: 5445 4436 3422 2c20 225a 4950 5f44 434c  TED64", "ZIP_DCL
-00000950: 494d 504c 4f44 4544 222c 2022 5a49 505f  IMPLODED", "ZIP_
-00000960: 504b 494d 504c 4f44 4544 222c 0a20 2020  PKIMPLODED",.   
-00000970: 2020 2020 2020 2020 225a 4950 5f42 5a49          "ZIP_BZI
-00000980: 5032 222c 2022 5a49 505f 4c5a 4d41 222c  P2", "ZIP_LZMA",
-00000990: 0a20 2020 2020 2020 2020 2020 225a 4950  .           "ZIP
-000009a0: 5f5a 5354 414e 4441 5244 222c 2022 5a49  _ZSTANDARD", "ZI
-000009b0: 505f 585a 222c 2022 5a49 505f 5050 4d44  P_XZ", "ZIP_PPMD
-000009c0: 222c 0a20 2020 2020 2020 2020 2020 2269  ",.           "i
-000009d0: 735f 7a69 7066 696c 6522 2c20 225a 6970  s_zipfile", "Zip
-000009e0: 496e 666f 222c 2022 5a69 7046 696c 6522  Info", "ZipFile"
-000009f0: 2c20 2250 795a 6970 4669 6c65 222c 2022  , "PyZipFile", "
-00000a00: 4c61 7267 655a 6970 4669 6c65 222c 0a20  LargeZipFile",. 
-00000a10: 2020 2020 2020 2020 2020 2250 6174 6822            "Path"
-00000a20: 5d0a 0a63 6c61 7373 2042 6164 5a69 7046  ]..class BadZipF
-00000a30: 696c 6528 4578 6365 7074 696f 6e29 3a0a  ile(Exception):.
-00000a40: 2020 2020 7061 7373 0a0a 636c 6173 7320      pass..class 
-00000a50: 4c61 7267 655a 6970 4669 6c65 2845 7863  LargeZipFile(Exc
-00000a60: 6570 7469 6f6e 293a 0a20 2020 2022 2222  eption):.    """
-00000a70: 0a20 2020 2052 6169 7365 6420 7768 656e  .    Raised when
-00000a80: 2077 7269 7469 6e67 2061 207a 6970 6669   writing a zipfi
-00000a90: 6c65 2c20 7468 6520 7a69 7066 696c 6520  le, the zipfile 
-00000aa0: 7265 7175 6972 6573 205a 4950 3634 2065  requires ZIP64 e
-00000ab0: 7874 656e 7369 6f6e 730a 2020 2020 616e  xtensions.    an
-00000ac0: 6420 7468 6f73 6520 6578 7465 6e73 696f  d those extensio
-00000ad0: 6e73 2061 7265 2064 6973 6162 6c65 642e  ns are disabled.
-00000ae0: 0a20 2020 2022 2222 0a0a 6572 726f 7220  .    """..error 
-00000af0: 3d20 4261 645a 6970 6669 6c65 203d 2042  = BadZipfile = B
-00000b00: 6164 5a69 7046 696c 6520 2020 2020 2023  adZipFile      #
-00000b10: 2050 7265 2d33 2e32 2063 6f6d 7061 7469   Pre-3.2 compati
-00000b20: 6269 6c69 7479 206e 616d 6573 0a0a 0a5a  bility names...Z
-00000b30: 4950 3634 5f4c 494d 4954 203d 2028 3120  IP64_LIMIT = (1 
-00000b40: 3c3c 2033 3129 202d 2031 0a5a 4950 5f46  << 31) - 1.ZIP_F
-00000b50: 494c 4543 4f55 4e54 5f4c 494d 4954 203d  ILECOUNT_LIMIT =
-00000b60: 2028 3120 3c3c 2031 3629 202d 2031 0a5a   (1 << 16) - 1.Z
-00000b70: 4950 5f4d 4158 5f43 4f4d 4d45 4e54 203d  IP_MAX_COMMENT =
-00000b80: 2028 3120 3c3c 2031 3629 202d 2031 0a0a   (1 << 16) - 1..
-00000b90: 2320 636f 6e73 7461 6e74 7320 666f 7220  # constants for 
-00000ba0: 5a69 7020 6669 6c65 2063 6f6d 7072 6573  Zip file compres
-00000bb0: 7369 6f6e 206d 6574 686f 6473 0a5a 4950  sion methods.ZIP
-00000bc0: 5f53 544f 5245 4420 3d20 300a 5a49 505f  _STORED = 0.ZIP_
-00000bd0: 4445 464c 4154 4544 203d 2038 0a5a 4950  DEFLATED = 8.ZIP
-00000be0: 5f44 4546 4c41 5445 4436 3420 3d20 390a  _DEFLATED64 = 9.
-00000bf0: 5a49 505f 4443 4c49 4d50 4c4f 4445 4420  ZIP_DCLIMPLODED 
-00000c00: 3d20 3130 0a5a 4950 5f50 4b49 4d50 4c4f  = 10.ZIP_PKIMPLO
-00000c10: 4445 4420 3d20 3130 0a5a 4950 5f42 5a49  DED = 10.ZIP_BZI
-00000c20: 5032 203d 2031 320a 5a49 505f 4c5a 4d41  P2 = 12.ZIP_LZMA
-00000c30: 203d 2031 340a 5a49 505f 5a53 5441 4e44   = 14.ZIP_ZSTAND
-00000c40: 4152 4420 3d20 3933 0a5a 4950 5f58 5a20  ARD = 93.ZIP_XZ 
-00000c50: 3d20 3935 0a5a 4950 5f50 504d 4420 3d20  = 95.ZIP_PPMD = 
-00000c60: 3938 0a23 204f 7468 6572 205a 4950 2063  98.# Other ZIP c
-00000c70: 6f6d 7072 6573 7369 6f6e 206d 6574 686f  ompression metho
-00000c80: 6473 206e 6f74 2073 7570 706f 7274 6564  ds not supported
-00000c90: 0a0a 4445 4641 554c 545f 5645 5253 494f  ..DEFAULT_VERSIO
-00000ca0: 4e20 3d20 3230 0a5a 4950 3634 5f56 4552  N = 20.ZIP64_VER
-00000cb0: 5349 4f4e 203d 2034 350a 4445 464c 4154  SION = 45.DEFLAT
-00000cc0: 4544 3634 5f56 4552 5349 4f4e 203d 2032  ED64_VERSION = 2
-00000cd0: 310a 4443 4c49 4d50 4c4f 4445 445f 5645  1.DCLIMPLODED_VE
-00000ce0: 5253 494f 4e20 3d20 3235 0a42 5a49 5032  RSION = 25.BZIP2
-00000cf0: 5f56 4552 5349 4f4e 203d 2034 360a 4c5a  _VERSION = 46.LZ
-00000d00: 4d41 5f56 4552 5349 4f4e 203d 2036 330a  MA_VERSION = 63.
-00000d10: 5a53 5441 4e44 4152 445f 5645 5253 494f  ZSTANDARD_VERSIO
-00000d20: 4e20 3d20 3633 0a58 5a5f 5645 5253 494f  N = 63.XZ_VERSIO
-00000d30: 4e20 3d20 3633 0a50 504d 445f 5645 5253  N = 63.PPMD_VERS
-00000d40: 494f 4e20 3d20 3633 0a23 2077 6520 7265  ION = 63.# we re
-00000d50: 636f 676e 697a 6520 2862 7574 206e 6f74  cognize (but not
-00000d60: 206e 6563 6573 7361 7269 6c79 2073 7570   necessarily sup
-00000d70: 706f 7274 2920 616c 6c20 6665 6174 7572  port) all featur
-00000d80: 6573 2075 7020 746f 2074 6861 7420 7665  es up to that ve
-00000d90: 7273 696f 6e0a 4d41 585f 4558 5452 4143  rsion.MAX_EXTRAC
-00000da0: 545f 5645 5253 494f 4e20 3d20 3633 0a0a  T_VERSION = 63..
-00000db0: 2320 4265 6c6f 7720 6172 6520 736f 6d65  # Below are some
-00000dc0: 2066 6f72 6d61 7473 2061 6e64 2061 7373   formats and ass
-00000dd0: 6f63 6961 7465 6420 6461 7461 2066 6f72  ociated data for
-00000de0: 2072 6561 6469 6e67 2f77 7269 7469 6e67   reading/writing
-00000df0: 2068 6561 6465 7273 2075 7369 6e67 0a23   headers using.#
-00000e00: 2074 6865 2073 7472 7563 7420 6d6f 6475   the struct modu
-00000e10: 6c65 2e20 2054 6865 206e 616d 6573 2061  le.  The names a
-00000e20: 6e64 2073 7472 7563 7475 7265 7320 6f66  nd structures of
-00000e30: 2068 6561 6465 7273 2f72 6563 6f72 6473   headers/records
-00000e40: 2061 7265 2074 686f 7365 2075 7365 640a   are those used.
-00000e50: 2320 696e 2074 6865 2050 4b57 4152 4520  # in the PKWARE 
-00000e60: 6465 7363 7269 7074 696f 6e20 6f66 2074  description of t
-00000e70: 6865 205a 4950 2066 696c 6520 666f 726d  he ZIP file form
-00000e80: 6174 3a0a 2320 2020 2020 6874 7470 3a2f  at:.#     http:/
-00000e90: 2f77 7777 2e70 6b77 6172 652e 636f 6d2f  /www.pkware.com/
-00000ea0: 646f 6375 6d65 6e74 732f 6361 7365 7374  documents/casest
-00000eb0: 7564 6965 732f 4150 504e 4f54 452e 5458  udies/APPNOTE.TX
-00000ec0: 540a 2320 2855 524c 2076 616c 6964 2061  T.# (URL valid a
-00000ed0: 7320 6f66 204a 616e 7561 7279 2032 3030  s of January 200
-00000ee0: 3829 0a0a 2320 5468 6520 2265 6e64 206f  8)..# The "end o
-00000ef0: 6620 6365 6e74 7261 6c20 6469 7265 6374  f central direct
-00000f00: 6f72 7922 2073 7472 7563 7475 7265 2c20  ory" structure, 
-00000f10: 6d61 6769 6320 6e75 6d62 6572 2c20 7369  magic number, si
-00000f20: 7a65 2c20 616e 6420 696e 6469 6365 730a  ze, and indices.
-00000f30: 2320 2873 6563 7469 6f6e 2056 2e49 2069  # (section V.I i
-00000f40: 6e20 7468 6520 666f 726d 6174 2064 6f63  n the format doc
-00000f50: 756d 656e 7429 0a73 7472 7563 7445 6e64  ument).structEnd
-00000f60: 4172 6368 6976 6520 3d20 6222 3c34 7334  Archive = b"<4s4
-00000f70: 4832 4c48 220a 7374 7269 6e67 456e 6441  H2LH".stringEndA
-00000f80: 7263 6869 7665 203d 2062 2250 4b5c 3030  rchive = b"PK\00
-00000f90: 355c 3030 3622 0a73 697a 6545 6e64 4365  5\006".sizeEndCe
-00000fa0: 6e74 4469 7220 3d20 7374 7275 6374 2e63  ntDir = struct.c
-00000fb0: 616c 6373 697a 6528 7374 7275 6374 456e  alcsize(structEn
-00000fc0: 6441 7263 6869 7665 290a 0a5f 4543 445f  dArchive).._ECD_
-00000fd0: 5349 474e 4154 5552 4520 3d20 300a 5f45  SIGNATURE = 0._E
-00000fe0: 4344 5f44 4953 4b5f 4e55 4d42 4552 203d  CD_DISK_NUMBER =
-00000ff0: 2031 0a5f 4543 445f 4449 534b 5f53 5441   1._ECD_DISK_STA
-00001000: 5254 203d 2032 0a5f 4543 445f 454e 5452  RT = 2._ECD_ENTR
-00001010: 4945 535f 5448 4953 5f44 4953 4b20 3d20  IES_THIS_DISK = 
-00001020: 330a 5f45 4344 5f45 4e54 5249 4553 5f54  3._ECD_ENTRIES_T
-00001030: 4f54 414c 203d 2034 0a5f 4543 445f 5349  OTAL = 4._ECD_SI
-00001040: 5a45 203d 2035 0a5f 4543 445f 4f46 4653  ZE = 5._ECD_OFFS
-00001050: 4554 203d 2036 0a5f 4543 445f 434f 4d4d  ET = 6._ECD_COMM
-00001060: 454e 545f 5349 5a45 203d 2037 0a23 2054  ENT_SIZE = 7.# T
-00001070: 6865 7365 206c 6173 7420 7477 6f20 696e  hese last two in
-00001080: 6469 6365 7320 6172 6520 6e6f 7420 7061  dices are not pa
-00001090: 7274 206f 6620 7468 6520 7374 7275 6374  rt of the struct
-000010a0: 7572 6520 6173 2064 6566 696e 6564 2069  ure as defined i
-000010b0: 6e20 7468 650a 2320 7370 6563 2c20 6275  n the.# spec, bu
-000010c0: 7420 7468 6579 2061 7265 2075 7365 6420  t they are used 
-000010d0: 696e 7465 726e 616c 6c79 2062 7920 7468  internally by th
-000010e0: 6973 206d 6f64 756c 6520 6173 2061 2063  is module as a c
-000010f0: 6f6e 7665 6e69 656e 6365 0a5f 4543 445f  onvenience._ECD_
-00001100: 434f 4d4d 454e 5420 3d20 380a 5f45 4344  COMMENT = 8._ECD
-00001110: 5f4c 4f43 4154 494f 4e20 3d20 390a 0a23  _LOCATION = 9..#
-00001120: 2054 6865 2022 6365 6e74 7261 6c20 6469   The "central di
-00001130: 7265 6374 6f72 7922 2073 7472 7563 7475  rectory" structu
-00001140: 7265 2c20 6d61 6769 6320 6e75 6d62 6572  re, magic number
-00001150: 2c20 7369 7a65 2c20 616e 6420 696e 6469  , size, and indi
-00001160: 6365 730a 2320 6f66 2065 6e74 7269 6573  ces.# of entries
-00001170: 2069 6e20 7468 6520 7374 7275 6374 7572   in the structur
-00001180: 6520 2873 6563 7469 6f6e 2056 2e46 2069  e (section V.F i
-00001190: 6e20 7468 6520 666f 726d 6174 2064 6f63  n the format doc
-000011a0: 756d 656e 7429 0a73 7472 7563 7443 656e  ument).structCen
-000011b0: 7472 616c 4469 7220 3d20 223c 3473 3442  tralDir = "<4s4B
-000011c0: 3448 4c32 4c35 4832 4c22 0a73 7472 696e  4HL2L5H2L".strin
-000011d0: 6743 656e 7472 616c 4469 7220 3d20 6222  gCentralDir = b"
-000011e0: 504b 5c30 3031 5c30 3032 220a 7369 7a65  PK\001\002".size
-000011f0: 4365 6e74 7261 6c44 6972 203d 2073 7472  CentralDir = str
-00001200: 7563 742e 6361 6c63 7369 7a65 2873 7472  uct.calcsize(str
-00001210: 7563 7443 656e 7472 616c 4469 7229 0a0a  uctCentralDir)..
-00001220: 2320 696e 6465 7865 7320 6f66 2065 6e74  # indexes of ent
-00001230: 7269 6573 2069 6e20 7468 6520 6365 6e74  ries in the cent
-00001240: 7261 6c20 6469 7265 6374 6f72 7920 7374  ral directory st
-00001250: 7275 6374 7572 650a 5f43 445f 5349 474e  ructure._CD_SIGN
-00001260: 4154 5552 4520 3d20 300a 5f43 445f 4352  ATURE = 0._CD_CR
-00001270: 4541 5445 5f56 4552 5349 4f4e 203d 2031  EATE_VERSION = 1
-00001280: 0a5f 4344 5f43 5245 4154 455f 5359 5354  ._CD_CREATE_SYST
-00001290: 454d 203d 2032 0a5f 4344 5f45 5854 5241  EM = 2._CD_EXTRA
-000012a0: 4354 5f56 4552 5349 4f4e 203d 2033 0a5f  CT_VERSION = 3._
-000012b0: 4344 5f45 5854 5241 4354 5f53 5953 5445  CD_EXTRACT_SYSTE
-000012c0: 4d20 3d20 340a 5f43 445f 464c 4147 5f42  M = 4._CD_FLAG_B
-000012d0: 4954 5320 3d20 350a 5f43 445f 434f 4d50  ITS = 5._CD_COMP
-000012e0: 5245 5353 5f54 5950 4520 3d20 360a 5f43  RESS_TYPE = 6._C
-000012f0: 445f 5449 4d45 203d 2037 0a5f 4344 5f44  D_TIME = 7._CD_D
-00001300: 4154 4520 3d20 380a 5f43 445f 4352 4320  ATE = 8._CD_CRC 
-00001310: 3d20 390a 5f43 445f 434f 4d50 5245 5353  = 9._CD_COMPRESS
-00001320: 4544 5f53 495a 4520 3d20 3130 0a5f 4344  ED_SIZE = 10._CD
-00001330: 5f55 4e43 4f4d 5052 4553 5345 445f 5349  _UNCOMPRESSED_SI
-00001340: 5a45 203d 2031 310a 5f43 445f 4649 4c45  ZE = 11._CD_FILE
-00001350: 4e41 4d45 5f4c 454e 4754 4820 3d20 3132  NAME_LENGTH = 12
-00001360: 0a5f 4344 5f45 5854 5241 5f46 4945 4c44  ._CD_EXTRA_FIELD
-00001370: 5f4c 454e 4754 4820 3d20 3133 0a5f 4344  _LENGTH = 13._CD
-00001380: 5f43 4f4d 4d45 4e54 5f4c 454e 4754 4820  _COMMENT_LENGTH 
-00001390: 3d20 3134 0a5f 4344 5f44 4953 4b5f 4e55  = 14._CD_DISK_NU
-000013a0: 4d42 4552 5f53 5441 5254 203d 2031 350a  MBER_START = 15.
-000013b0: 5f43 445f 494e 5445 524e 414c 5f46 494c  _CD_INTERNAL_FIL
-000013c0: 455f 4154 5452 4942 5554 4553 203d 2031  E_ATTRIBUTES = 1
-000013d0: 360a 5f43 445f 4558 5445 524e 414c 5f46  6._CD_EXTERNAL_F
-000013e0: 494c 455f 4154 5452 4942 5554 4553 203d  ILE_ATTRIBUTES =
-000013f0: 2031 370a 5f43 445f 4c4f 4341 4c5f 4845   17._CD_LOCAL_HE
-00001400: 4144 4552 5f4f 4646 5345 5420 3d20 3138  ADER_OFFSET = 18
-00001410: 0a0a 2320 5468 6520 226c 6f63 616c 2066  ..# The "local f
-00001420: 696c 6520 6865 6164 6572 2220 7374 7275  ile header" stru
-00001430: 6374 7572 652c 206d 6167 6963 206e 756d  cture, magic num
-00001440: 6265 722c 2073 697a 652c 2061 6e64 2069  ber, size, and i
-00001450: 6e64 6963 6573 0a23 2028 7365 6374 696f  ndices.# (sectio
-00001460: 6e20 562e 4120 696e 2074 6865 2066 6f72  n V.A in the for
-00001470: 6d61 7420 646f 6375 6d65 6e74 290a 7374  mat document).st
-00001480: 7275 6374 4669 6c65 4865 6164 6572 203d  ructFileHeader =
-00001490: 2022 3c34 7332 4234 484c 324c 3248 220a   "<4s2B4HL2L2H".
-000014a0: 7374 7269 6e67 4669 6c65 4865 6164 6572  stringFileHeader
-000014b0: 203d 2062 2250 4b5c 3030 335c 3030 3422   = b"PK\003\004"
-000014c0: 0a73 697a 6546 696c 6548 6561 6465 7220  .sizeFileHeader 
-000014d0: 3d20 7374 7275 6374 2e63 616c 6373 697a  = struct.calcsiz
-000014e0: 6528 7374 7275 6374 4669 6c65 4865 6164  e(structFileHead
-000014f0: 6572 290a 0a5f 4648 5f53 4947 4e41 5455  er).._FH_SIGNATU
-00001500: 5245 203d 2030 0a5f 4648 5f45 5854 5241  RE = 0._FH_EXTRA
-00001510: 4354 5f56 4552 5349 4f4e 203d 2031 0a5f  CT_VERSION = 1._
-00001520: 4648 5f45 5854 5241 4354 5f53 5953 5445  FH_EXTRACT_SYSTE
-00001530: 4d20 3d20 320a 5f46 485f 4745 4e45 5241  M = 2._FH_GENERA
-00001540: 4c5f 5055 5250 4f53 455f 464c 4147 5f42  L_PURPOSE_FLAG_B
-00001550: 4954 5320 3d20 330a 5f46 485f 434f 4d50  ITS = 3._FH_COMP
-00001560: 5245 5353 494f 4e5f 4d45 5448 4f44 203d  RESSION_METHOD =
-00001570: 2034 0a5f 4648 5f4c 4153 545f 4d4f 445f   4._FH_LAST_MOD_
-00001580: 5449 4d45 203d 2035 0a5f 4648 5f4c 4153  TIME = 5._FH_LAS
-00001590: 545f 4d4f 445f 4441 5445 203d 2036 0a5f  T_MOD_DATE = 6._
-000015a0: 4648 5f43 5243 203d 2037 0a5f 4648 5f43  FH_CRC = 7._FH_C
-000015b0: 4f4d 5052 4553 5345 445f 5349 5a45 203d  OMPRESSED_SIZE =
-000015c0: 2038 0a5f 4648 5f55 4e43 4f4d 5052 4553   8._FH_UNCOMPRES
-000015d0: 5345 445f 5349 5a45 203d 2039 0a5f 4648  SED_SIZE = 9._FH
-000015e0: 5f46 494c 454e 414d 455f 4c45 4e47 5448  _FILENAME_LENGTH
-000015f0: 203d 2031 300a 5f46 485f 4558 5452 415f   = 10._FH_EXTRA_
-00001600: 4649 454c 445f 4c45 4e47 5448 203d 2031  FIELD_LENGTH = 1
-00001610: 310a 0a23 2054 6865 2022 5a69 7036 3420  1..# The "Zip64 
-00001620: 656e 6420 6f66 2063 656e 7472 616c 2064  end of central d
-00001630: 6972 6563 746f 7279 206c 6f63 6174 6f72  irectory locator
-00001640: 2220 7374 7275 6374 7572 652c 206d 6167  " structure, mag
-00001650: 6963 206e 756d 6265 722c 2061 6e64 2073  ic number, and s
-00001660: 697a 650a 7374 7275 6374 456e 6441 7263  ize.structEndArc
-00001670: 6869 7665 3634 4c6f 6361 746f 7220 3d20  hive64Locator = 
-00001680: 223c 3473 4c51 4c22 0a73 7472 696e 6745  "<4sLQL".stringE
-00001690: 6e64 4172 6368 6976 6536 344c 6f63 6174  ndArchive64Locat
-000016a0: 6f72 203d 2062 2250 4b5c 7830 365c 7830  or = b"PK\x06\x0
-000016b0: 3722 0a73 697a 6545 6e64 4365 6e74 4469  7".sizeEndCentDi
-000016c0: 7236 344c 6f63 6174 6f72 203d 2073 7472  r64Locator = str
-000016d0: 7563 742e 6361 6c63 7369 7a65 2873 7472  uct.calcsize(str
-000016e0: 7563 7445 6e64 4172 6368 6976 6536 344c  uctEndArchive64L
-000016f0: 6f63 6174 6f72 290a 0a23 2054 6865 2022  ocator)..# The "
-00001700: 5a69 7036 3420 656e 6420 6f66 2063 656e  Zip64 end of cen
-00001710: 7472 616c 2064 6972 6563 746f 7279 2220  tral directory" 
-00001720: 7265 636f 7264 2c20 6d61 6769 6320 6e75  record, magic nu
-00001730: 6d62 6572 2c20 7369 7a65 2c20 616e 6420  mber, size, and 
-00001740: 696e 6469 6365 730a 2320 2873 6563 7469  indices.# (secti
-00001750: 6f6e 2056 2e47 2069 6e20 7468 6520 666f  on V.G in the fo
-00001760: 726d 6174 2064 6f63 756d 656e 7429 0a73  rmat document).s
-00001770: 7472 7563 7445 6e64 4172 6368 6976 6536  tructEndArchive6
-00001780: 3420 3d20 223c 3473 5132 4832 4c34 5122  4 = "<4sQ2H2L4Q"
-00001790: 0a73 7472 696e 6745 6e64 4172 6368 6976  .stringEndArchiv
-000017a0: 6536 3420 3d20 6222 504b 5c78 3036 5c78  e64 = b"PK\x06\x
-000017b0: 3036 220a 7369 7a65 456e 6443 656e 7444  06".sizeEndCentD
-000017c0: 6972 3634 203d 2073 7472 7563 742e 6361  ir64 = struct.ca
-000017d0: 6c63 7369 7a65 2873 7472 7563 7445 6e64  lcsize(structEnd
-000017e0: 4172 6368 6976 6536 3429 0a0a 5f43 4436  Archive64).._CD6
-000017f0: 345f 5349 474e 4154 5552 4520 3d20 300a  4_SIGNATURE = 0.
-00001800: 5f43 4436 345f 4449 5245 4354 4f52 595f  _CD64_DIRECTORY_
-00001810: 5245 4353 495a 4520 3d20 310a 5f43 4436  RECSIZE = 1._CD6
-00001820: 345f 4352 4541 5445 5f56 4552 5349 4f4e  4_CREATE_VERSION
-00001830: 203d 2032 0a5f 4344 3634 5f45 5854 5241   = 2._CD64_EXTRA
-00001840: 4354 5f56 4552 5349 4f4e 203d 2033 0a5f  CT_VERSION = 3._
-00001850: 4344 3634 5f44 4953 4b5f 4e55 4d42 4552  CD64_DISK_NUMBER
-00001860: 203d 2034 0a5f 4344 3634 5f44 4953 4b5f   = 4._CD64_DISK_
-00001870: 4e55 4d42 4552 5f53 5441 5254 203d 2035  NUMBER_START = 5
-00001880: 0a5f 4344 3634 5f4e 554d 4245 525f 454e  ._CD64_NUMBER_EN
-00001890: 5452 4945 535f 5448 4953 5f44 4953 4b20  TRIES_THIS_DISK 
-000018a0: 3d20 360a 5f43 4436 345f 4e55 4d42 4552  = 6._CD64_NUMBER
-000018b0: 5f45 4e54 5249 4553 5f54 4f54 414c 203d  _ENTRIES_TOTAL =
-000018c0: 2037 0a5f 4344 3634 5f44 4952 4543 544f   7._CD64_DIRECTO
-000018d0: 5259 5f53 495a 4520 3d20 380a 5f43 4436  RY_SIZE = 8._CD6
-000018e0: 345f 4f46 4653 4554 5f53 5441 5254 5f43  4_OFFSET_START_C
-000018f0: 454e 5444 4952 203d 2039 0a0a 5f44 445f  ENTDIR = 9.._DD_
-00001900: 5349 474e 4154 5552 4520 3d20 3078 3038  SIGNATURE = 0x08
-00001910: 3037 3462 3530 0a0a 5f45 5854 5241 5f46  074b50.._EXTRA_F
-00001920: 4945 4c44 5f53 5452 5543 5420 3d20 7374  IELD_STRUCT = st
-00001930: 7275 6374 2e53 7472 7563 7428 273c 4848  ruct.Struct('<HH
-00001940: 2729 0a0a 6465 6620 5f73 7472 6970 5f65  ')..def _strip_e
-00001950: 7874 7261 2865 7874 7261 2c20 7869 6473  xtra(extra, xids
-00001960: 293a 0a20 2020 2023 2052 656d 6f76 6520  ):.    # Remove 
-00001970: 4578 7472 6120 4669 656c 6473 2077 6974  Extra Fields wit
-00001980: 6820 7370 6563 6966 6965 6420 4944 732e  h specified IDs.
-00001990: 0a20 2020 2075 6e70 6163 6b20 3d20 5f45  .    unpack = _E
-000019a0: 5854 5241 5f46 4945 4c44 5f53 5452 5543  XTRA_FIELD_STRUC
-000019b0: 542e 756e 7061 636b 0a20 2020 206d 6f64  T.unpack.    mod
-000019c0: 6966 6965 6420 3d20 4661 6c73 650a 2020  ified = False.  
-000019d0: 2020 6275 6666 6572 203d 205b 5d0a 2020    buffer = [].  
-000019e0: 2020 7374 6172 7420 3d20 6920 3d20 300a    start = i = 0.
-000019f0: 2020 2020 7768 696c 6520 6920 2b20 3420      while i + 4 
-00001a00: 3c3d 206c 656e 2865 7874 7261 293a 0a20  <= len(extra):. 
-00001a10: 2020 2020 2020 2078 6964 2c20 786c 656e         xid, xlen
-00001a20: 203d 2075 6e70 6163 6b28 6578 7472 615b   = unpack(extra[
-00001a30: 6920 3a20 6920 2b20 345d 290a 2020 2020  i : i + 4]).    
-00001a40: 2020 2020 6a20 3d20 6920 2b20 3420 2b20      j = i + 4 + 
-00001a50: 786c 656e 0a20 2020 2020 2020 2069 6620  xlen.        if 
-00001a60: 7869 6420 696e 2078 6964 733a 0a20 2020  xid in xids:.   
-00001a70: 2020 2020 2020 2020 2069 6620 6920 213d           if i !=
-00001a80: 2073 7461 7274 3a0a 2020 2020 2020 2020   start:.        
-00001a90: 2020 2020 2020 2020 6275 6666 6572 2e61          buffer.a
-00001aa0: 7070 656e 6428 6578 7472 615b 7374 6172  ppend(extra[star
-00001ab0: 7420 3a20 695d 290a 2020 2020 2020 2020  t : i]).        
-00001ac0: 2020 2020 7374 6172 7420 3d20 6a0a 2020      start = j.  
-00001ad0: 2020 2020 2020 2020 2020 6d6f 6469 6669            modifi
-00001ae0: 6564 203d 2054 7275 650a 2020 2020 2020  ed = True.      
-00001af0: 2020 6920 3d20 6a0a 2020 2020 6966 206e    i = j.    if n
-00001b00: 6f74 206d 6f64 6966 6965 643a 0a20 2020  ot modified:.   
-00001b10: 2020 2020 2072 6574 7572 6e20 6578 7472       return extr
-00001b20: 610a 2020 2020 7265 7475 726e 2062 2727  a.    return b''
-00001b30: 2e6a 6f69 6e28 6275 6666 6572 290a 0a64  .join(buffer)..d
-00001b40: 6566 205f 6368 6563 6b5f 7a69 7066 696c  ef _check_zipfil
-00001b50: 6528 6670 293a 0a20 2020 2074 7279 3a0a  e(fp):.    try:.
-00001b60: 2020 2020 2020 2020 6966 205f 456e 6452          if _EndR
-00001b70: 6563 4461 7461 2866 7029 3a0a 2020 2020  ecData(fp):.    
-00001b80: 2020 2020 2020 2020 7265 7475 726e 2054          return T
-00001b90: 7275 6520 2020 2020 2020 2020 2320 6669  rue         # fi
-00001ba0: 6c65 2068 6173 2063 6f72 7265 6374 206d  le has correct m
-00001bb0: 6167 6963 206e 756d 6265 720a 2020 2020  agic number.    
-00001bc0: 6578 6365 7074 204f 5345 7272 6f72 3a0a  except OSError:.
-00001bd0: 2020 2020 2020 2020 7061 7373 0a20 2020          pass.   
-00001be0: 2072 6574 7572 6e20 4661 6c73 650a 0a64   return False..d
-00001bf0: 6566 2069 735f 7a69 7066 696c 6528 6669  ef is_zipfile(fi
-00001c00: 6c65 6e61 6d65 293a 0a20 2020 2022 2222  lename):.    """
-00001c10: 5175 6963 6b6c 7920 7365 6520 6966 2061  Quickly see if a
-00001c20: 2066 696c 6520 6973 2061 205a 4950 2066   file is a ZIP f
-00001c30: 696c 6520 6279 2063 6865 636b 696e 6720  ile by checking 
-00001c40: 7468 6520 6d61 6769 6320 6e75 6d62 6572  the magic number
-00001c50: 2e0a 0a20 2020 2054 6865 2066 696c 656e  ...    The filen
-00001c60: 616d 6520 6172 6775 6d65 6e74 206d 6179  ame argument may
-00001c70: 2062 6520 6120 6669 6c65 206f 7220 6669   be a file or fi
-00001c80: 6c65 2d6c 696b 6520 6f62 6a65 6374 2074  le-like object t
-00001c90: 6f6f 2e0a 2020 2020 2222 220a 2020 2020  oo..    """.    
-00001ca0: 7265 7375 6c74 203d 2046 616c 7365 0a20  result = False. 
-00001cb0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00001cc0: 6966 2068 6173 6174 7472 2866 696c 656e  if hasattr(filen
-00001cd0: 616d 652c 2022 7265 6164 2229 3a0a 2020  ame, "read"):.  
-00001ce0: 2020 2020 2020 2020 2020 7265 7375 6c74            result
-00001cf0: 203d 205f 6368 6563 6b5f 7a69 7066 696c   = _check_zipfil
-00001d00: 6528 6670 3d66 696c 656e 616d 6529 0a20  e(fp=filename). 
-00001d10: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00001d20: 2020 2020 2020 2020 2077 6974 6820 6f70           with op
-00001d30: 656e 2866 696c 656e 616d 652c 2022 7262  en(filename, "rb
-00001d40: 2229 2061 7320 6670 3a0a 2020 2020 2020  ") as fp:.      
-00001d50: 2020 2020 2020 2020 2020 7265 7375 6c74            result
-00001d60: 203d 205f 6368 6563 6b5f 7a69 7066 696c   = _check_zipfil
-00001d70: 6528 6670 290a 2020 2020 6578 6365 7074  e(fp).    except
-00001d80: 204f 5345 7272 6f72 3a0a 2020 2020 2020   OSError:.      
-00001d90: 2020 7061 7373 0a20 2020 2072 6574 7572    pass.    retur
-00001da0: 6e20 7265 7375 6c74 0a0a 6465 6620 5f45  n result..def _E
-00001db0: 6e64 5265 6344 6174 6136 3428 6670 696e  ndRecData64(fpin
-00001dc0: 2c20 6f66 6673 6574 2c20 656e 6472 6563  , offset, endrec
-00001dd0: 293a 0a20 2020 2022 2222 0a20 2020 2052  ):.    """.    R
-00001de0: 6561 6420 7468 6520 5a49 5036 3420 656e  ead the ZIP64 en
-00001df0: 642d 6f66 2d61 7263 6869 7665 2072 6563  d-of-archive rec
-00001e00: 6f72 6473 2061 6e64 2075 7365 2074 6861  ords and use tha
-00001e10: 7420 746f 2075 7064 6174 6520 656e 6472  t to update endr
-00001e20: 6563 0a20 2020 2022 2222 0a20 2020 2074  ec.    """.    t
-00001e30: 7279 3a0a 2020 2020 2020 2020 6670 696e  ry:.        fpin
-00001e40: 2e73 6565 6b28 6f66 6673 6574 202d 2073  .seek(offset - s
-00001e50: 697a 6545 6e64 4365 6e74 4469 7236 344c  izeEndCentDir64L
-00001e60: 6f63 6174 6f72 2c20 3229 0a20 2020 2065  ocator, 2).    e
-00001e70: 7863 6570 7420 4f53 4572 726f 723a 0a20  xcept OSError:. 
-00001e80: 2020 2020 2020 2023 2049 6620 7468 6520         # If the 
-00001e90: 7365 656b 2066 6169 6c73 2c20 7468 6520  seek fails, the 
-00001ea0: 6669 6c65 2069 7320 6e6f 7420 6c61 7267  file is not larg
-00001eb0: 6520 656e 6f75 6768 2074 6f20 636f 6e74  e enough to cont
-00001ec0: 6169 6e20 6120 5a49 5036 340a 2020 2020  ain a ZIP64.    
-00001ed0: 2020 2020 2320 656e 642d 6f66 2d61 7263      # end-of-arc
-00001ee0: 6869 7665 2072 6563 6f72 642c 2073 6f20  hive record, so 
-00001ef0: 6a75 7374 2072 6574 7572 6e20 7468 6520  just return the 
-00001f00: 656e 6420 7265 636f 7264 2077 6520 7765  end record we we
-00001f10: 7265 2067 6976 656e 2e0a 2020 2020 2020  re given..      
-00001f20: 2020 7265 7475 726e 2065 6e64 7265 630a    return endrec.
-00001f30: 0a20 2020 2064 6174 6120 3d20 6670 696e  .    data = fpin
-00001f40: 2e72 6561 6428 7369 7a65 456e 6443 656e  .read(sizeEndCen
-00001f50: 7444 6972 3634 4c6f 6361 746f 7229 0a20  tDir64Locator). 
-00001f60: 2020 2069 6620 6c65 6e28 6461 7461 2920     if len(data) 
-00001f70: 213d 2073 697a 6545 6e64 4365 6e74 4469  != sizeEndCentDi
-00001f80: 7236 344c 6f63 6174 6f72 3a0a 2020 2020  r64Locator:.    
-00001f90: 2020 2020 7265 7475 726e 2065 6e64 7265      return endre
-00001fa0: 630a 2020 2020 7369 672c 2064 6973 6b6e  c.    sig, diskn
-00001fb0: 6f2c 2072 656c 6f66 662c 2064 6973 6b73  o, reloff, disks
-00001fc0: 203d 2073 7472 7563 742e 756e 7061 636b   = struct.unpack
-00001fd0: 2873 7472 7563 7445 6e64 4172 6368 6976  (structEndArchiv
-00001fe0: 6536 344c 6f63 6174 6f72 2c20 6461 7461  e64Locator, data
-00001ff0: 290a 2020 2020 6966 2073 6967 2021 3d20  ).    if sig != 
-00002000: 7374 7269 6e67 456e 6441 7263 6869 7665  stringEndArchive
-00002010: 3634 4c6f 6361 746f 723a 0a20 2020 2020  64Locator:.     
-00002020: 2020 2072 6574 7572 6e20 656e 6472 6563     return endrec
-00002030: 0a0a 2020 2020 6966 2064 6973 6b6e 6f20  ..    if diskno 
-00002040: 213d 2030 206f 7220 6469 736b 7320 3e20  != 0 or disks > 
-00002050: 313a 0a20 2020 2020 2020 2072 6169 7365  1:.        raise
-00002060: 2042 6164 5a69 7046 696c 6528 227a 6970   BadZipFile("zip
-00002070: 6669 6c65 7320 7468 6174 2073 7061 6e20  files that span 
-00002080: 6d75 6c74 6970 6c65 2064 6973 6b73 2061  multiple disks a
-00002090: 7265 206e 6f74 2073 7570 706f 7274 6564  re not supported
-000020a0: 2229 0a0a 2020 2020 2320 4173 7375 6d65  ")..    # Assume
-000020b0: 206e 6f20 277a 6970 3634 2065 7874 656e   no 'zip64 exten
-000020c0: 7369 626c 6520 6461 7461 270a 2020 2020  sible data'.    
-000020d0: 6670 696e 2e73 6565 6b28 6f66 6673 6574  fpin.seek(offset
-000020e0: 202d 2073 697a 6545 6e64 4365 6e74 4469   - sizeEndCentDi
-000020f0: 7236 344c 6f63 6174 6f72 202d 2073 697a  r64Locator - siz
-00002100: 6545 6e64 4365 6e74 4469 7236 342c 2032  eEndCentDir64, 2
-00002110: 290a 2020 2020 6461 7461 203d 2066 7069  ).    data = fpi
-00002120: 6e2e 7265 6164 2873 697a 6545 6e64 4365  n.read(sizeEndCe
-00002130: 6e74 4469 7236 3429 0a20 2020 2069 6620  ntDir64).    if 
-00002140: 6c65 6e28 6461 7461 2920 213d 2073 697a  len(data) != siz
-00002150: 6545 6e64 4365 6e74 4469 7236 343a 0a20  eEndCentDir64:. 
-00002160: 2020 2020 2020 2072 6574 7572 6e20 656e         return en
-00002170: 6472 6563 0a20 2020 2073 6967 2c20 737a  drec.    sig, sz
-00002180: 2c20 6372 6561 7465 5f76 6572 7369 6f6e  , create_version
-00002190: 2c20 7265 6164 5f76 6572 7369 6f6e 2c20  , read_version, 
-000021a0: 6469 736b 5f6e 756d 2c20 6469 736b 5f64  disk_num, disk_d
-000021b0: 6972 2c20 5c0a 2020 2020 2020 2020 6469  ir, \.        di
-000021c0: 7263 6f75 6e74 2c20 6469 7263 6f75 6e74  rcount, dircount
-000021d0: 322c 2064 6972 7369 7a65 2c20 6469 726f  2, dirsize, diro
-000021e0: 6666 7365 7420 3d20 5c0a 2020 2020 2020  ffset = \.      
-000021f0: 2020 7374 7275 6374 2e75 6e70 6163 6b28    struct.unpack(
-00002200: 7374 7275 6374 456e 6441 7263 6869 7665  structEndArchive
-00002210: 3634 2c20 6461 7461 290a 2020 2020 6966  64, data).    if
-00002220: 2073 6967 2021 3d20 7374 7269 6e67 456e   sig != stringEn
-00002230: 6441 7263 6869 7665 3634 3a0a 2020 2020  dArchive64:.    
-00002240: 2020 2020 7265 7475 726e 2065 6e64 7265      return endre
-00002250: 630a 0a20 2020 2023 2055 7064 6174 6520  c..    # Update 
-00002260: 7468 6520 6f72 6967 696e 616c 2065 6e64  the original end
-00002270: 7265 6320 7573 696e 6720 6461 7461 2066  rec using data f
-00002280: 726f 6d20 7468 6520 5a49 5036 3420 7265  rom the ZIP64 re
-00002290: 636f 7264 0a20 2020 2065 6e64 7265 635b  cord.    endrec[
-000022a0: 5f45 4344 5f53 4947 4e41 5455 5245 5d20  _ECD_SIGNATURE] 
-000022b0: 3d20 7369 670a 2020 2020 656e 6472 6563  = sig.    endrec
-000022c0: 5b5f 4543 445f 4449 534b 5f4e 554d 4245  [_ECD_DISK_NUMBE
-000022d0: 525d 203d 2064 6973 6b5f 6e75 6d0a 2020  R] = disk_num.  
-000022e0: 2020 656e 6472 6563 5b5f 4543 445f 4449    endrec[_ECD_DI
-000022f0: 534b 5f53 5441 5254 5d20 3d20 6469 736b  SK_START] = disk
-00002300: 5f64 6972 0a20 2020 2065 6e64 7265 635b  _dir.    endrec[
-00002310: 5f45 4344 5f45 4e54 5249 4553 5f54 4849  _ECD_ENTRIES_THI
-00002320: 535f 4449 534b 5d20 3d20 6469 7263 6f75  S_DISK] = dircou
-00002330: 6e74 0a20 2020 2065 6e64 7265 635b 5f45  nt.    endrec[_E
-00002340: 4344 5f45 4e54 5249 4553 5f54 4f54 414c  CD_ENTRIES_TOTAL
-00002350: 5d20 3d20 6469 7263 6f75 6e74 320a 2020  ] = dircount2.  
-00002360: 2020 656e 6472 6563 5b5f 4543 445f 5349    endrec[_ECD_SI
-00002370: 5a45 5d20 3d20 6469 7273 697a 650a 2020  ZE] = dirsize.  
-00002380: 2020 656e 6472 6563 5b5f 4543 445f 4f46    endrec[_ECD_OF
-00002390: 4653 4554 5d20 3d20 6469 726f 6666 7365  FSET] = diroffse
-000023a0: 740a 2020 2020 7265 7475 726e 2065 6e64  t.    return end
-000023b0: 7265 630a 0a0a 6465 6620 5f45 6e64 5265  rec...def _EndRe
-000023c0: 6344 6174 6128 6670 696e 293a 0a20 2020  cData(fpin):.   
-000023d0: 2022 2222 5265 7475 726e 2064 6174 6120   """Return data 
-000023e0: 6672 6f6d 2074 6865 2022 456e 6420 6f66  from the "End of
-000023f0: 2043 656e 7472 616c 2044 6972 6563 746f   Central Directo
-00002400: 7279 2220 7265 636f 7264 2c20 6f72 204e  ry" record, or N
-00002410: 6f6e 652e 0a0a 2020 2020 5468 6520 6461  one...    The da
-00002420: 7461 2069 7320 6120 6c69 7374 206f 6620  ta is a list of 
-00002430: 7468 6520 6e69 6e65 2069 7465 6d73 2069  the nine items i
-00002440: 6e20 7468 6520 5a49 5020 2245 6e64 206f  n the ZIP "End o
-00002450: 6620 6365 6e74 7261 6c20 6469 7222 0a20  f central dir". 
-00002460: 2020 2072 6563 6f72 6420 666f 6c6c 6f77     record follow
-00002470: 6564 2062 7920 6120 7465 6e74 6820 6974  ed by a tenth it
-00002480: 656d 2c20 7468 6520 6669 6c65 2073 6565  em, the file see
-00002490: 6b20 6f66 6673 6574 206f 6620 7468 6973  k offset of this
-000024a0: 2072 6563 6f72 642e 2222 220a 0a20 2020   record."""..   
-000024b0: 2023 2044 6574 6572 6d69 6e65 2066 696c   # Determine fil
-000024c0: 6520 7369 7a65 0a20 2020 2066 7069 6e2e  e size.    fpin.
-000024d0: 7365 656b 2830 2c20 3229 0a20 2020 2066  seek(0, 2).    f
-000024e0: 696c 6573 697a 6520 3d20 6670 696e 2e74  ilesize = fpin.t
-000024f0: 656c 6c28 290a 0a20 2020 2023 2043 6865  ell()..    # Che
-00002500: 636b 2074 6f20 7365 6520 6966 2074 6869  ck to see if thi
-00002510: 7320 6973 205a 4950 2066 696c 6520 7769  s is ZIP file wi
-00002520: 7468 206e 6f20 6172 6368 6976 6520 636f  th no archive co
-00002530: 6d6d 656e 7420 2874 6865 0a20 2020 2023  mment (the.    #
-00002540: 2022 656e 6420 6f66 2063 656e 7472 616c   "end of central
-00002550: 2064 6972 6563 746f 7279 2220 7374 7275   directory" stru
-00002560: 6374 7572 6520 7368 6f75 6c64 2062 6520  cture should be 
-00002570: 7468 6520 6c61 7374 2069 7465 6d20 696e  the last item in
-00002580: 2074 6865 0a20 2020 2023 2066 696c 6520   the.    # file 
-00002590: 6966 2074 6869 7320 6973 2074 6865 2063  if this is the c
-000025a0: 6173 6529 2e0a 2020 2020 7472 793a 0a20  ase)..    try:. 
-000025b0: 2020 2020 2020 2066 7069 6e2e 7365 656b         fpin.seek
-000025c0: 282d 7369 7a65 456e 6443 656e 7444 6972  (-sizeEndCentDir
-000025d0: 2c20 3229 0a20 2020 2065 7863 6570 7420  , 2).    except 
-000025e0: 4f53 4572 726f 723a 0a20 2020 2020 2020  OSError:.       
-000025f0: 2072 6574 7572 6e20 4e6f 6e65 0a20 2020   return None.   
-00002600: 2064 6174 6120 3d20 6670 696e 2e72 6561   data = fpin.rea
-00002610: 6428 290a 2020 2020 6966 2028 6c65 6e28  d().    if (len(
-00002620: 6461 7461 2920 3d3d 2073 697a 6545 6e64  data) == sizeEnd
-00002630: 4365 6e74 4469 7220 616e 640a 2020 2020  CentDir and.    
-00002640: 2020 2020 6461 7461 5b30 3a34 5d20 3d3d      data[0:4] ==
-00002650: 2073 7472 696e 6745 6e64 4172 6368 6976   stringEndArchiv
-00002660: 6520 616e 640a 2020 2020 2020 2020 6461  e and.        da
-00002670: 7461 5b2d 323a 5d20 3d3d 2062 225c 3030  ta[-2:] == b"\00
-00002680: 305c 3030 3022 293a 0a20 2020 2020 2020  0\000"):.       
-00002690: 2023 2074 6865 2073 6967 6e61 7475 7265   # the signature
-000026a0: 2069 7320 636f 7272 6563 7420 616e 6420   is correct and 
-000026b0: 7468 6572 6527 7320 6e6f 2063 6f6d 6d65  there's no comme
-000026c0: 6e74 2c20 756e 7061 636b 2073 7472 7563  nt, unpack struc
-000026d0: 7475 7265 0a20 2020 2020 2020 2065 6e64  ture.        end
-000026e0: 7265 6320 3d20 7374 7275 6374 2e75 6e70  rec = struct.unp
-000026f0: 6163 6b28 7374 7275 6374 456e 6441 7263  ack(structEndArc
-00002700: 6869 7665 2c20 6461 7461 290a 2020 2020  hive, data).    
-00002710: 2020 2020 656e 6472 6563 3d6c 6973 7428      endrec=list(
-00002720: 656e 6472 6563 290a 0a20 2020 2020 2020  endrec)..       
-00002730: 2023 2041 7070 656e 6420 6120 626c 616e   # Append a blan
-00002740: 6b20 636f 6d6d 656e 7420 616e 6420 7265  k comment and re
-00002750: 636f 7264 2073 7461 7274 206f 6666 7365  cord start offse
-00002760: 740a 2020 2020 2020 2020 656e 6472 6563  t.        endrec
-00002770: 2e61 7070 656e 6428 6222 2229 0a20 2020  .append(b"").   
-00002780: 2020 2020 2065 6e64 7265 632e 6170 7065       endrec.appe
-00002790: 6e64 2866 696c 6573 697a 6520 2d20 7369  nd(filesize - si
-000027a0: 7a65 456e 6443 656e 7444 6972 290a 0a20  zeEndCentDir).. 
-000027b0: 2020 2020 2020 2023 2054 7279 2074 6f20         # Try to 
-000027c0: 7265 6164 2074 6865 2022 5a69 7036 3420  read the "Zip64 
-000027d0: 656e 6420 6f66 2063 656e 7472 616c 2064  end of central d
-000027e0: 6972 6563 746f 7279 2220 7374 7275 6374  irectory" struct
-000027f0: 7572 650a 2020 2020 2020 2020 7265 7475  ure.        retu
-00002800: 726e 205f 456e 6452 6563 4461 7461 3634  rn _EndRecData64
-00002810: 2866 7069 6e2c 202d 7369 7a65 456e 6443  (fpin, -sizeEndC
-00002820: 656e 7444 6972 2c20 656e 6472 6563 290a  entDir, endrec).
-00002830: 0a20 2020 2023 2045 6974 6865 7220 7468  .    # Either th
-00002840: 6973 2069 7320 6e6f 7420 6120 5a49 5020  is is not a ZIP 
-00002850: 6669 6c65 2c20 6f72 2069 7420 6973 2061  file, or it is a
-00002860: 205a 4950 2066 696c 6520 7769 7468 2061   ZIP file with a
-00002870: 6e20 6172 6368 6976 650a 2020 2020 2320  n archive.    # 
-00002880: 636f 6d6d 656e 742e 2020 5365 6172 6368  comment.  Search
-00002890: 2074 6865 2065 6e64 206f 6620 7468 6520   the end of the 
-000028a0: 6669 6c65 2066 6f72 2074 6865 2022 656e  file for the "en
-000028b0: 6420 6f66 2063 656e 7472 616c 2064 6972  d of central dir
-000028c0: 6563 746f 7279 220a 2020 2020 2320 7265  ectory".    # re
-000028d0: 636f 7264 2073 6967 6e61 7475 7265 2e20  cord signature. 
-000028e0: 5468 6520 636f 6d6d 656e 7420 6973 2074  The comment is t
-000028f0: 6865 206c 6173 7420 6974 656d 2069 6e20  he last item in 
-00002900: 7468 6520 5a49 5020 6669 6c65 2061 6e64  the ZIP file and
-00002910: 206d 6179 2062 650a 2020 2020 2320 7570   may be.    # up
-00002920: 2074 6f20 3634 4b20 6c6f 6e67 2e20 2049   to 64K long.  I
-00002930: 7420 6973 2061 7373 756d 6564 2074 6861  t is assumed tha
-00002940: 7420 7468 6520 2265 6e64 206f 6620 6365  t the "end of ce
-00002950: 6e74 7261 6c20 6469 7265 6374 6f72 7922  ntral directory"
-00002960: 206d 6167 6963 0a20 2020 2023 206e 756d   magic.    # num
-00002970: 6265 7220 646f 6573 206e 6f74 2061 7070  ber does not app
-00002980: 6561 7220 696e 2074 6865 2063 6f6d 6d65  ear in the comme
-00002990: 6e74 2e0a 2020 2020 6d61 7843 6f6d 6d65  nt..    maxComme
-000029a0: 6e74 5374 6172 7420 3d20 6d61 7828 6669  ntStart = max(fi
-000029b0: 6c65 7369 7a65 202d 2028 3120 3c3c 2031  lesize - (1 << 1
-000029c0: 3629 202d 2073 697a 6545 6e64 4365 6e74  6) - sizeEndCent
-000029d0: 4469 722c 2030 290a 2020 2020 6670 696e  Dir, 0).    fpin
-000029e0: 2e73 6565 6b28 6d61 7843 6f6d 6d65 6e74  .seek(maxComment
-000029f0: 5374 6172 742c 2030 290a 2020 2020 6461  Start, 0).    da
-00002a00: 7461 203d 2066 7069 6e2e 7265 6164 2829  ta = fpin.read()
-00002a10: 0a20 2020 2073 7461 7274 203d 2064 6174  .    start = dat
-00002a20: 612e 7266 696e 6428 7374 7269 6e67 456e  a.rfind(stringEn
-00002a30: 6441 7263 6869 7665 290a 2020 2020 6966  dArchive).    if
-00002a40: 2073 7461 7274 203e 3d20 303a 0a20 2020   start >= 0:.   
-00002a50: 2020 2020 2023 2066 6f75 6e64 2074 6865       # found the
-00002a60: 206d 6167 6963 206e 756d 6265 723b 2061   magic number; a
-00002a70: 7474 656d 7074 2074 6f20 756e 7061 636b  ttempt to unpack
-00002a80: 2061 6e64 2069 6e74 6572 7072 6574 0a20   and interpret. 
-00002a90: 2020 2020 2020 2072 6563 4461 7461 203d         recData =
-00002aa0: 2064 6174 615b 7374 6172 743a 7374 6172   data[start:star
-00002ab0: 742b 7369 7a65 456e 6443 656e 7444 6972  t+sizeEndCentDir
-00002ac0: 5d0a 2020 2020 2020 2020 6966 206c 656e  ].        if len
-00002ad0: 2872 6563 4461 7461 2920 213d 2073 697a  (recData) != siz
-00002ae0: 6545 6e64 4365 6e74 4469 723a 0a20 2020  eEndCentDir:.   
-00002af0: 2020 2020 2020 2020 2023 205a 6970 2066           # Zip f
-00002b00: 696c 6520 6973 2063 6f72 7275 7074 6564  ile is corrupted
-00002b10: 2e0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-00002b20: 7475 726e 204e 6f6e 650a 2020 2020 2020  turn None.      
-00002b30: 2020 656e 6472 6563 203d 206c 6973 7428    endrec = list(
-00002b40: 7374 7275 6374 2e75 6e70 6163 6b28 7374  struct.unpack(st
-00002b50: 7275 6374 456e 6441 7263 6869 7665 2c20  ructEndArchive, 
-00002b60: 7265 6344 6174 6129 290a 2020 2020 2020  recData)).      
-00002b70: 2020 636f 6d6d 656e 7453 697a 6520 3d20    commentSize = 
-00002b80: 656e 6472 6563 5b5f 4543 445f 434f 4d4d  endrec[_ECD_COMM
-00002b90: 454e 545f 5349 5a45 5d20 2361 7320 636c  ENT_SIZE] #as cl
-00002ba0: 6169 6d65 6420 6279 2074 6865 207a 6970  aimed by the zip
-00002bb0: 2066 696c 650a 2020 2020 2020 2020 636f   file.        co
-00002bc0: 6d6d 656e 7420 3d20 6461 7461 5b73 7461  mment = data[sta
-00002bd0: 7274 2b73 697a 6545 6e64 4365 6e74 4469  rt+sizeEndCentDi
-00002be0: 723a 7374 6172 742b 7369 7a65 456e 6443  r:start+sizeEndC
-00002bf0: 656e 7444 6972 2b63 6f6d 6d65 6e74 5369  entDir+commentSi
-00002c00: 7a65 5d0a 2020 2020 2020 2020 656e 6472  ze].        endr
-00002c10: 6563 2e61 7070 656e 6428 636f 6d6d 656e  ec.append(commen
-00002c20: 7429 0a20 2020 2020 2020 2065 6e64 7265  t).        endre
-00002c30: 632e 6170 7065 6e64 286d 6178 436f 6d6d  c.append(maxComm
-00002c40: 656e 7453 7461 7274 202b 2073 7461 7274  entStart + start
-00002c50: 290a 0a20 2020 2020 2020 2023 2054 7279  )..        # Try
-00002c60: 2074 6f20 7265 6164 2074 6865 2022 5a69   to read the "Zi
-00002c70: 7036 3420 656e 6420 6f66 2063 656e 7472  p64 end of centr
-00002c80: 616c 2064 6972 6563 746f 7279 2220 7374  al directory" st
-00002c90: 7275 6374 7572 650a 2020 2020 2020 2020  ructure.        
-00002ca0: 7265 7475 726e 205f 456e 6452 6563 4461  return _EndRecDa
-00002cb0: 7461 3634 2866 7069 6e2c 206d 6178 436f  ta64(fpin, maxCo
-00002cc0: 6d6d 656e 7453 7461 7274 202b 2073 7461  mmentStart + sta
-00002cd0: 7274 202d 2066 696c 6573 697a 652c 0a20  rt - filesize,. 
-00002ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002cf0: 2020 2020 2020 2020 2020 2020 656e 6472              endr
-00002d00: 6563 290a 0a20 2020 2023 2055 6e61 626c  ec)..    # Unabl
-00002d10: 6520 746f 2066 696e 6420 6120 7661 6c69  e to find a vali
-00002d20: 6420 656e 6420 6f66 2063 656e 7472 616c  d end of central
-00002d30: 2064 6972 6563 746f 7279 2073 7472 7563   directory struc
-00002d40: 7475 7265 0a20 2020 2072 6574 7572 6e20  ture.    return 
-00002d50: 4e6f 6e65 0a0a 0a63 6c61 7373 205a 6970  None...class Zip
-00002d60: 496e 666f 2028 6f62 6a65 6374 293a 0a20  Info (object):. 
-00002d70: 2020 2022 2222 436c 6173 7320 7769 7468     """Class with
-00002d80: 2061 7474 7269 6275 7465 7320 6465 7363   attributes desc
-00002d90: 7269 6269 6e67 2065 6163 6820 6669 6c65  ribing each file
-00002da0: 2069 6e20 7468 6520 5a49 5020 6172 6368   in the ZIP arch
-00002db0: 6976 652e 2222 220a 0a20 2020 205f 5f73  ive."""..    __s
-00002dc0: 6c6f 7473 5f5f 203d 2028 0a20 2020 2020  lots__ = (.     
-00002dd0: 2020 2027 6f72 6967 5f66 696c 656e 616d     'orig_filenam
-00002de0: 6527 2c0a 2020 2020 2020 2020 2766 696c  e',.        'fil
-00002df0: 656e 616d 6527 2c0a 2020 2020 2020 2020  ename',.        
-00002e00: 2764 6174 655f 7469 6d65 272c 0a20 2020  'date_time',.   
-00002e10: 2020 2020 2027 636f 6d70 7265 7373 5f74       'compress_t
-00002e20: 7970 6527 2c0a 2020 2020 2020 2020 275f  ype',.        '_
-00002e30: 636f 6d70 7265 7373 6c65 7665 6c27 2c0a  compresslevel',.
-00002e40: 2020 2020 2020 2020 2763 6f6d 6d65 6e74          'comment
-00002e50: 272c 0a20 2020 2020 2020 2027 6578 7472  ',.        'extr
-00002e60: 6127 2c0a 2020 2020 2020 2020 2763 7265  a',.        'cre
-00002e70: 6174 655f 7379 7374 656d 272c 0a20 2020  ate_system',.   
-00002e80: 2020 2020 2027 6372 6561 7465 5f76 6572       'create_ver
-00002e90: 7369 6f6e 272c 0a20 2020 2020 2020 2027  sion',.        '
-00002ea0: 6578 7472 6163 745f 7665 7273 696f 6e27  extract_version'
-00002eb0: 2c0a 2020 2020 2020 2020 2772 6573 6572  ,.        'reser
-00002ec0: 7665 6427 2c0a 2020 2020 2020 2020 2766  ved',.        'f
-00002ed0: 6c61 675f 6269 7473 272c 0a20 2020 2020  lag_bits',.     
-00002ee0: 2020 2027 766f 6c75 6d65 272c 0a20 2020     'volume',.   
-00002ef0: 2020 2020 2027 696e 7465 726e 616c 5f61       'internal_a
-00002f00: 7474 7227 2c0a 2020 2020 2020 2020 2765  ttr',.        'e
-00002f10: 7874 6572 6e61 6c5f 6174 7472 272c 0a20  xternal_attr',. 
-00002f20: 2020 2020 2020 2027 6865 6164 6572 5f6f         'header_o
-00002f30: 6666 7365 7427 2c0a 2020 2020 2020 2020  ffset',.        
-00002f40: 2743 5243 272c 0a20 2020 2020 2020 2027  'CRC',.        '
-00002f50: 636f 6d70 7265 7373 5f73 697a 6527 2c0a  compress_size',.
-00002f60: 2020 2020 2020 2020 2766 696c 655f 7369          'file_si
-00002f70: 7a65 272c 0a20 2020 2020 2020 2027 5f72  ze',.        '_r
-00002f80: 6177 5f74 696d 6527 2c0a 2020 2020 290a  aw_time',.    ).
-00002f90: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
-00002fa0: 5f28 7365 6c66 2c20 6669 6c65 6e61 6d65  _(self, filename
-00002fb0: 3d22 4e6f 4e61 6d65 222c 2064 6174 655f  ="NoName", date_
-00002fc0: 7469 6d65 3d28 3139 3830 2c31 2c31 2c30  time=(1980,1,1,0
-00002fd0: 2c30 2c30 2929 3a0a 2020 2020 2020 2020  ,0,0)):.        
-00002fe0: 7365 6c66 2e6f 7269 675f 6669 6c65 6e61  self.orig_filena
-00002ff0: 6d65 203d 2066 696c 656e 616d 6520 2020  me = filename   
-00003000: 2320 4f72 6967 696e 616c 2066 696c 6520  # Original file 
-00003010: 6e61 6d65 2069 6e20 6172 6368 6976 650a  name in archive.
-00003020: 0a20 2020 2020 2020 2023 2054 6572 6d69  .        # Termi
-00003030: 6e61 7465 2074 6865 2066 696c 6520 6e61  nate the file na
-00003040: 6d65 2061 7420 7468 6520 6669 7273 7420  me at the first 
-00003050: 6e75 6c6c 2062 7974 652e 2020 4e75 6c6c  null byte.  Null
-00003060: 2062 7974 6573 2069 6e20 6669 6c65 0a20   bytes in file. 
-00003070: 2020 2020 2020 2023 206e 616d 6573 2061         # names a
-00003080: 7265 2075 7365 6420 6173 2074 7269 636b  re used as trick
-00003090: 7320 6279 2076 6972 7573 6573 2069 6e20  s by viruses in 
-000030a0: 6172 6368 6976 6573 2e0a 2020 2020 2020  archives..      
-000030b0: 2020 6e75 6c6c 5f62 7974 6520 3d20 6669    null_byte = fi
-000030c0: 6c65 6e61 6d65 2e66 696e 6428 6368 7228  lename.find(chr(
-000030d0: 3029 290a 2020 2020 2020 2020 6966 206e  0)).        if n
-000030e0: 756c 6c5f 6279 7465 203e 3d20 303a 0a20  ull_byte >= 0:. 
-000030f0: 2020 2020 2020 2020 2020 2066 696c 656e             filen
-00003100: 616d 6520 3d20 6669 6c65 6e61 6d65 5b30  ame = filename[0
-00003110: 3a6e 756c 6c5f 6279 7465 5d0a 2020 2020  :null_byte].    
-00003120: 2020 2020 2320 5468 6973 2069 7320 7573      # This is us
-00003130: 6564 2074 6f20 656e 7375 7265 2070 6174  ed to ensure pat
-00003140: 6873 2069 6e20 6765 6e65 7261 7465 6420  hs in generated 
-00003150: 5a49 5020 6669 6c65 7320 616c 7761 7973  ZIP files always
-00003160: 2075 7365 0a20 2020 2020 2020 2023 2066   use.        # f
-00003170: 6f72 7761 7264 2073 6c61 7368 6573 2061  orward slashes a
-00003180: 7320 7468 6520 6469 7265 6374 6f72 7920  s the directory 
-00003190: 7365 7061 7261 746f 722c 2061 7320 7265  separator, as re
-000031a0: 7175 6972 6564 2062 7920 7468 650a 2020  quired by the.  
-000031b0: 2020 2020 2020 2320 5a49 5020 666f 726d        # ZIP form
-000031c0: 6174 2073 7065 6369 6669 6361 7469 6f6e  at specification
-000031d0: 2e0a 2020 2020 2020 2020 6966 206f 732e  ..        if os.
-000031e0: 7365 7020 213d 2022 2f22 2061 6e64 206f  sep != "/" and o
-000031f0: 732e 7365 7020 696e 2066 696c 656e 616d  s.sep in filenam
-00003200: 653a 0a20 2020 2020 2020 2020 2020 2066  e:.            f
-00003210: 696c 656e 616d 6520 3d20 6669 6c65 6e61  ilename = filena
-00003220: 6d65 2e72 6570 6c61 6365 286f 732e 7365  me.replace(os.se
-00003230: 702c 2022 2f22 290a 0a20 2020 2020 2020  p, "/")..       
-00003240: 2073 656c 662e 6669 6c65 6e61 6d65 203d   self.filename =
-00003250: 2066 696c 656e 616d 6520 2020 2020 2020   filename       
-00003260: 2023 204e 6f72 6d61 6c69 7a65 6420 6669   # Normalized fi
-00003270: 6c65 206e 616d 650a 2020 2020 2020 2020  le name.        
-00003280: 7365 6c66 2e64 6174 655f 7469 6d65 203d  self.date_time =
-00003290: 2064 6174 655f 7469 6d65 2020 2020 2020   date_time      
-000032a0: 2320 7965 6172 2c20 6d6f 6e74 682c 2064  # year, month, d
-000032b0: 6179 2c20 686f 7572 2c20 6d69 6e2c 2073  ay, hour, min, s
-000032c0: 6563 0a0a 2020 2020 2020 2020 6966 2064  ec..        if d
-000032d0: 6174 655f 7469 6d65 5b30 5d20 3c20 3139  ate_time[0] < 19
-000032e0: 3830 3a0a 2020 2020 2020 2020 2020 2020  80:.            
-000032f0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-00003300: 2827 5a49 5020 646f 6573 206e 6f74 2073  ('ZIP does not s
-00003310: 7570 706f 7274 2074 696d 6573 7461 6d70  upport timestamp
-00003320: 7320 6265 666f 7265 2031 3938 3027 290a  s before 1980').
-00003330: 0a20 2020 2020 2020 2023 2053 7461 6e64  .        # Stand
-00003340: 6172 6420 7661 6c75 6573 3a0a 2020 2020  ard values:.    
-00003350: 2020 2020 7365 6c66 2e63 6f6d 7072 6573      self.compres
-00003360: 735f 7479 7065 203d 205a 4950 5f53 544f  s_type = ZIP_STO
-00003370: 5245 4420 2320 5479 7065 206f 6620 636f  RED # Type of co
-00003380: 6d70 7265 7373 696f 6e20 666f 7220 7468  mpression for th
-00003390: 6520 6669 6c65 0a20 2020 2020 2020 2073  e file.        s
-000033a0: 656c 662e 5f63 6f6d 7072 6573 736c 6576  elf._compresslev
-000033b0: 656c 203d 204e 6f6e 6520 2020 2020 2023  el = None      #
-000033c0: 204c 6576 656c 2066 6f72 2074 6865 2063   Level for the c
-000033d0: 6f6d 7072 6573 736f 720a 2020 2020 2020  ompressor.      
-000033e0: 2020 7365 6c66 2e63 6f6d 6d65 6e74 203d    self.comment =
-000033f0: 2062 2222 2020 2020 2020 2020 2020 2020   b""            
-00003400: 2020 2320 436f 6d6d 656e 7420 666f 7220    # Comment for 
-00003410: 6561 6368 2066 696c 650a 2020 2020 2020  each file.      
-00003420: 2020 7365 6c66 2e65 7874 7261 203d 2062    self.extra = b
-00003430: 2222 2020 2020 2020 2020 2020 2020 2020  ""              
-00003440: 2020 2320 5a49 5020 6578 7472 6120 6461    # ZIP extra da
-00003450: 7461 0a20 2020 2020 2020 2069 6620 7379  ta.        if sy
-00003460: 732e 706c 6174 666f 726d 203d 3d20 2777  s.platform == 'w
-00003470: 696e 3332 273a 0a20 2020 2020 2020 2020  in32':.         
-00003480: 2020 2073 656c 662e 6372 6561 7465 5f73     self.create_s
-00003490: 7973 7465 6d20 3d20 3020 2020 2020 2020  ystem = 0       
-000034a0: 2020 2023 2053 7973 7465 6d20 7768 6963     # System whic
-000034b0: 6820 6372 6561 7465 6420 5a49 5020 6172  h created ZIP ar
-000034c0: 6368 6976 650a 2020 2020 2020 2020 656c  chive.        el
-000034d0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-000034e0: 2320 4173 7375 6d65 2065 7665 7279 7468  # Assume everyth
-000034f0: 696e 6720 656c 7365 2069 7320 756e 6978  ing else is unix
-00003500: 2d79 0a20 2020 2020 2020 2020 2020 2073  -y.            s
-00003510: 656c 662e 6372 6561 7465 5f73 7973 7465  elf.create_syste
-00003520: 6d20 3d20 3320 2020 2020 2020 2020 2023  m = 3          #
-00003530: 2053 7973 7465 6d20 7768 6963 6820 6372   System which cr
-00003540: 6561 7465 6420 5a49 5020 6172 6368 6976  eated ZIP archiv
-00003550: 650a 2020 2020 2020 2020 7365 6c66 2e63  e.        self.c
-00003560: 7265 6174 655f 7665 7273 696f 6e20 3d20  reate_version = 
-00003570: 4445 4641 554c 545f 5645 5253 494f 4e20  DEFAULT_VERSION 
-00003580: 2023 2056 6572 7369 6f6e 2077 6869 6368   # Version which
-00003590: 2063 7265 6174 6564 205a 4950 2061 7263   created ZIP arc
-000035a0: 6869 7665 0a20 2020 2020 2020 2073 656c  hive.        sel
-000035b0: 662e 6578 7472 6163 745f 7665 7273 696f  f.extract_versio
-000035c0: 6e20 3d20 4445 4641 554c 545f 5645 5253  n = DEFAULT_VERS
-000035d0: 494f 4e20 2320 5665 7273 696f 6e20 6e65  ION # Version ne
-000035e0: 6564 6564 2074 6f20 6578 7472 6163 7420  eded to extract 
-000035f0: 6172 6368 6976 650a 2020 2020 2020 2020  archive.        
-00003600: 7365 6c66 2e72 6573 6572 7665 6420 3d20  self.reserved = 
-00003610: 3020 2020 2020 2020 2020 2020 2020 2020  0               
-00003620: 2320 4d75 7374 2062 6520 7a65 726f 0a20  # Must be zero. 
-00003630: 2020 2020 2020 2073 656c 662e 666c 6167         self.flag
-00003640: 5f62 6974 7320 3d20 3020 2020 2020 2020  _bits = 0       
-00003650: 2020 2020 2020 2023 205a 4950 2066 6c61         # ZIP fla
-00003660: 6720 6269 7473 0a20 2020 2020 2020 2073  g bits.        s
-00003670: 656c 662e 766f 6c75 6d65 203d 2030 2020  elf.volume = 0  
-00003680: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00003690: 2056 6f6c 756d 6520 6e75 6d62 6572 206f   Volume number o
-000036a0: 6620 6669 6c65 2068 6561 6465 720a 2020  f file header.  
-000036b0: 2020 2020 2020 7365 6c66 2e69 6e74 6572        self.inter
-000036c0: 6e61 6c5f 6174 7472 203d 2030 2020 2020  nal_attr = 0    
-000036d0: 2020 2020 2020 2320 496e 7465 726e 616c        # Internal
-000036e0: 2061 7474 7269 6275 7465 730a 2020 2020   attributes.    
-000036f0: 2020 2020 7365 6c66 2e65 7874 6572 6e61      self.externa
-00003700: 6c5f 6174 7472 203d 2030 2020 2020 2020  l_attr = 0      
-00003710: 2020 2020 2320 4578 7465 726e 616c 2066      # External f
-00003720: 696c 6520 6174 7472 6962 7574 6573 0a20  ile attributes. 
-00003730: 2020 2020 2020 2073 656c 662e 636f 6d70         self.comp
-00003740: 7265 7373 5f73 697a 6520 3d20 3020 2020  ress_size = 0   
-00003750: 2020 2020 2020 2023 2053 697a 6520 6f66         # Size of
-00003760: 2074 6865 2063 6f6d 7072 6573 7365 6420   the compressed 
-00003770: 6669 6c65 0a20 2020 2020 2020 2073 656c  file.        sel
-00003780: 662e 6669 6c65 5f73 697a 6520 3d20 3020  f.file_size = 0 
-00003790: 2020 2020 2020 2020 2020 2020 2023 2053               # S
-000037a0: 697a 6520 6f66 2074 6865 2075 6e63 6f6d  ize of the uncom
-000037b0: 7072 6573 7365 6420 6669 6c65 0a20 2020  pressed file.   
-000037c0: 2020 2020 2023 204f 7468 6572 2061 7474       # Other att
-000037d0: 7269 6275 7465 7320 6172 6520 7365 7420  ributes are set 
-000037e0: 6279 2063 6c61 7373 205a 6970 4669 6c65  by class ZipFile
-000037f0: 3a0a 2020 2020 2020 2020 2320 6865 6164  :.        # head
-00003800: 6572 5f6f 6666 7365 7420 2020 2020 2020  er_offset       
-00003810: 2020 4279 7465 206f 6666 7365 7420 746f    Byte offset to
-00003820: 2074 6865 2066 696c 6520 6865 6164 6572   the file header
-00003830: 0a20 2020 2020 2020 2023 2043 5243 2020  .        # CRC  
-00003840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003850: 2043 5243 2d33 3220 6f66 2074 6865 2075   CRC-32 of the u
-00003860: 6e63 6f6d 7072 6573 7365 6420 6669 6c65  ncompressed file
-00003870: 0a0a 2020 2020 6465 6620 5f5f 7265 7072  ..    def __repr
-00003880: 5f5f 2873 656c 6629 3a0a 2020 2020 2020  __(self):.      
-00003890: 2020 7265 7375 6c74 203d 205b 273c 2573    result = ['<%s
-000038a0: 2066 696c 656e 616d 653d 2572 2720 2520   filename=%r' % 
-000038b0: 2873 656c 662e 5f5f 636c 6173 735f 5f2e  (self.__class__.
-000038c0: 5f5f 6e61 6d65 5f5f 2c20 7365 6c66 2e66  __name__, self.f
-000038d0: 696c 656e 616d 6529 5d0a 2020 2020 2020  ilename)].      
-000038e0: 2020 6966 2073 656c 662e 636f 6d70 7265    if self.compre
-000038f0: 7373 5f74 7970 6520 213d 205a 4950 5f53  ss_type != ZIP_S
-00003900: 544f 5245 443a 0a20 2020 2020 2020 2020  TORED:.         
-00003910: 2020 2072 6573 756c 742e 6170 7065 6e64     result.append
-00003920: 2827 2063 6f6d 7072 6573 735f 7479 7065  (' compress_type
-00003930: 3d25 7327 2025 0a20 2020 2020 2020 2020  =%s' %.         
-00003940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003950: 2063 6f6d 7072 6573 736f 725f 6e61 6d65   compressor_name
-00003960: 732e 6765 7428 7365 6c66 2e63 6f6d 7072  s.get(self.compr
-00003970: 6573 735f 7479 7065 2c0a 2020 2020 2020  ess_type,.      
-00003980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000039a0: 2020 2020 2020 2020 2073 656c 662e 636f           self.co
-000039b0: 6d70 7265 7373 5f74 7970 6529 290a 2020  mpress_type)).  
-000039c0: 2020 2020 2020 6869 203d 2073 656c 662e        hi = self.
-000039d0: 6578 7465 726e 616c 5f61 7474 7220 3e3e  external_attr >>
-000039e0: 2031 360a 2020 2020 2020 2020 6c6f 203d   16.        lo =
-000039f0: 2073 656c 662e 6578 7465 726e 616c 5f61   self.external_a
-00003a00: 7474 7220 2620 3078 4646 4646 0a20 2020  ttr & 0xFFFF.   
-00003a10: 2020 2020 2069 6620 6869 3a0a 2020 2020       if hi:.    
-00003a20: 2020 2020 2020 2020 7265 7375 6c74 2e61          result.a
-00003a30: 7070 656e 6428 2720 6669 6c65 6d6f 6465  ppend(' filemode
-00003a40: 3d25 7227 2025 2073 7461 742e 6669 6c65  =%r' % stat.file
-00003a50: 6d6f 6465 2868 6929 290a 2020 2020 2020  mode(hi)).      
-00003a60: 2020 6966 206c 6f3a 0a20 2020 2020 2020    if lo:.       
-00003a70: 2020 2020 2072 6573 756c 742e 6170 7065       result.appe
-00003a80: 6e64 2827 2065 7874 6572 6e61 6c5f 6174  nd(' external_at
-00003a90: 7472 3d25 2378 2720 2520 6c6f 290a 2020  tr=%#x' % lo).  
-00003aa0: 2020 2020 2020 6973 6469 7220 3d20 7365        isdir = se
-00003ab0: 6c66 2e69 735f 6469 7228 290a 2020 2020  lf.is_dir().    
-00003ac0: 2020 2020 6966 206e 6f74 2069 7364 6972      if not isdir
-00003ad0: 206f 7220 7365 6c66 2e66 696c 655f 7369   or self.file_si
-00003ae0: 7a65 3a0a 2020 2020 2020 2020 2020 2020  ze:.            
-00003af0: 7265 7375 6c74 2e61 7070 656e 6428 2720  result.append(' 
-00003b00: 6669 6c65 5f73 697a 653d 2572 2720 2520  file_size=%r' % 
-00003b10: 7365 6c66 2e66 696c 655f 7369 7a65 290a  self.file_size).
-00003b20: 2020 2020 2020 2020 6966 2028 286e 6f74          if ((not
-00003b30: 2069 7364 6972 206f 7220 7365 6c66 2e63   isdir or self.c
-00003b40: 6f6d 7072 6573 735f 7369 7a65 2920 616e  ompress_size) an
-00003b50: 640a 2020 2020 2020 2020 2020 2020 2873  d.            (s
-00003b60: 656c 662e 636f 6d70 7265 7373 5f74 7970  elf.compress_typ
-00003b70: 6520 213d 205a 4950 5f53 544f 5245 4420  e != ZIP_STORED 
-00003b80: 6f72 0a20 2020 2020 2020 2020 2020 2020  or.             
-00003b90: 7365 6c66 2e66 696c 655f 7369 7a65 2021  self.file_size !
-00003ba0: 3d20 7365 6c66 2e63 6f6d 7072 6573 735f  = self.compress_
-00003bb0: 7369 7a65 2929 3a0a 2020 2020 2020 2020  size)):.        
-00003bc0: 2020 2020 7265 7375 6c74 2e61 7070 656e      result.appen
-00003bd0: 6428 2720 636f 6d70 7265 7373 5f73 697a  d(' compress_siz
-00003be0: 653d 2572 2720 2520 7365 6c66 2e63 6f6d  e=%r' % self.com
-00003bf0: 7072 6573 735f 7369 7a65 290a 2020 2020  press_size).    
-00003c00: 2020 2020 7265 7375 6c74 2e61 7070 656e      result.appen
-00003c10: 6428 273e 2729 0a20 2020 2020 2020 2072  d('>').        r
-00003c20: 6574 7572 6e20 2727 2e6a 6f69 6e28 7265  eturn ''.join(re
-00003c30: 7375 6c74 290a 0a20 2020 2064 6566 2046  sult)..    def F
-00003c40: 696c 6548 6561 6465 7228 7365 6c66 2c20  ileHeader(self, 
-00003c50: 7a69 7036 343d 4e6f 6e65 293a 0a20 2020  zip64=None):.   
-00003c60: 2020 2020 2022 2222 5265 7475 726e 2074       """Return t
-00003c70: 6865 2070 6572 2d66 696c 6520 6865 6164  he per-file head
-00003c80: 6572 2061 7320 6120 6279 7465 7320 6f62  er as a bytes ob
-00003c90: 6a65 6374 2e22 2222 0a20 2020 2020 2020  ject.""".       
-00003ca0: 2064 7420 3d20 7365 6c66 2e64 6174 655f   dt = self.date_
-00003cb0: 7469 6d65 0a20 2020 2020 2020 2064 6f73  time.        dos
-00003cc0: 6461 7465 203d 2028 6474 5b30 5d20 2d20  date = (dt[0] - 
-00003cd0: 3139 3830 2920 3c3c 2039 207c 2064 745b  1980) << 9 | dt[
-00003ce0: 315d 203c 3c20 3520 7c20 6474 5b32 5d0a  1] << 5 | dt[2].
-00003cf0: 2020 2020 2020 2020 646f 7374 696d 6520          dostime 
-00003d00: 3d20 6474 5b33 5d20 3c3c 2031 3120 7c20  = dt[3] << 11 | 
-00003d10: 6474 5b34 5d20 3c3c 2035 207c 2028 6474  dt[4] << 5 | (dt
-00003d20: 5b35 5d20 2f2f 2032 290a 2020 2020 2020  [5] // 2).      
-00003d30: 2020 6966 2073 656c 662e 666c 6167 5f62    if self.flag_b
-00003d40: 6974 7320 2620 3078 3038 3a0a 2020 2020  its & 0x08:.    
-00003d50: 2020 2020 2020 2020 2320 5365 7420 7468          # Set th
-00003d60: 6573 6520 746f 207a 6572 6f20 6265 6361  ese to zero beca
-00003d70: 7573 6520 7765 2077 7269 7465 2074 6865  use we write the
-00003d80: 6d20 6166 7465 7220 7468 6520 6669 6c65  m after the file
-00003d90: 2064 6174 610a 2020 2020 2020 2020 2020   data.          
-00003da0: 2020 4352 4320 3d20 636f 6d70 7265 7373    CRC = compress
-00003db0: 5f73 697a 6520 3d20 6669 6c65 5f73 697a  _size = file_siz
-00003dc0: 6520 3d20 300a 2020 2020 2020 2020 656c  e = 0.        el
-00003dd0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00003de0: 4352 4320 3d20 7365 6c66 2e43 5243 0a20  CRC = self.CRC. 
-00003df0: 2020 2020 2020 2020 2020 2063 6f6d 7072             compr
-00003e00: 6573 735f 7369 7a65 203d 2073 656c 662e  ess_size = self.
-00003e10: 636f 6d70 7265 7373 5f73 697a 650a 2020  compress_size.  
-00003e20: 2020 2020 2020 2020 2020 6669 6c65 5f73            file_s
-00003e30: 697a 6520 3d20 7365 6c66 2e66 696c 655f  ize = self.file_
-00003e40: 7369 7a65 0a0a 2020 2020 2020 2020 6578  size..        ex
-00003e50: 7472 6120 3d20 7365 6c66 2e65 7874 7261  tra = self.extra
-00003e60: 0a0a 2020 2020 2020 2020 6d69 6e5f 7665  ..        min_ve
-00003e70: 7273 696f 6e20 3d20 300a 2020 2020 2020  rsion = 0.      
-00003e80: 2020 6966 207a 6970 3634 2069 7320 4e6f    if zip64 is No
-00003e90: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00003ea0: 7a69 7036 3420 3d20 6669 6c65 5f73 697a  zip64 = file_siz
-00003eb0: 6520 3e20 5a49 5036 345f 4c49 4d49 5420  e > ZIP64_LIMIT 
-00003ec0: 6f72 2063 6f6d 7072 6573 735f 7369 7a65  or compress_size
-00003ed0: 203e 205a 4950 3634 5f4c 494d 4954 0a20   > ZIP64_LIMIT. 
-00003ee0: 2020 2020 2020 2069 6620 7a69 7036 343a         if zip64:
-00003ef0: 0a20 2020 2020 2020 2020 2020 2066 6d74  .            fmt
-00003f00: 203d 2027 3c48 4851 5127 0a20 2020 2020   = '<HHQQ'.     
-00003f10: 2020 2020 2020 2065 7874 7261 203d 2065         extra = e
-00003f20: 7874 7261 202b 2073 7472 7563 742e 7061  xtra + struct.pa
-00003f30: 636b 2866 6d74 2c0a 2020 2020 2020 2020  ck(fmt,.        
-00003f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003f60: 312c 2073 7472 7563 742e 6361 6c63 7369  1, struct.calcsi
-00003f70: 7a65 2866 6d74 292d 342c 2066 696c 655f  ze(fmt)-4, file_
-00003f80: 7369 7a65 2c20 636f 6d70 7265 7373 5f73  size, compress_s
-00003f90: 697a 6529 0a20 2020 2020 2020 2069 6620  ize).        if 
-00003fa0: 6669 6c65 5f73 697a 6520 3e20 5a49 5036  file_size > ZIP6
-00003fb0: 345f 4c49 4d49 5420 6f72 2063 6f6d 7072  4_LIMIT or compr
-00003fc0: 6573 735f 7369 7a65 203e 205a 4950 3634  ess_size > ZIP64
-00003fd0: 5f4c 494d 4954 3a0a 2020 2020 2020 2020  _LIMIT:.        
-00003fe0: 2020 2020 6966 206e 6f74 207a 6970 3634      if not zip64
-00003ff0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00004000: 2020 7261 6973 6520 4c61 7267 655a 6970    raise LargeZip
-00004010: 4669 6c65 2822 4669 6c65 7369 7a65 2077  File("Filesize w
-00004020: 6f75 6c64 2072 6571 7569 7265 205a 4950  ould require ZIP
-00004030: 3634 2065 7874 656e 7369 6f6e 7322 290a  64 extensions").
-00004040: 2020 2020 2020 2020 2020 2020 2320 4669              # Fi
-00004050: 6c65 2069 7320 6c61 7267 6572 2074 6861  le is larger tha
-00004060: 6e20 7768 6174 2066 6974 7320 696e 746f  n what fits into
-00004070: 2061 2034 2062 7974 6520 696e 7465 6765   a 4 byte intege
-00004080: 722c 0a20 2020 2020 2020 2020 2020 2023  r,.            #
-00004090: 2066 616c 6c20 6261 636b 2074 6f20 7468   fall back to th
-000040a0: 6520 5a49 5036 3420 6578 7465 6e73 696f  e ZIP64 extensio
-000040b0: 6e0a 2020 2020 2020 2020 2020 2020 6669  n.            fi
-000040c0: 6c65 5f73 697a 6520 3d20 3078 6666 6666  le_size = 0xffff
-000040d0: 6666 6666 0a20 2020 2020 2020 2020 2020  ffff.           
-000040e0: 2063 6f6d 7072 6573 735f 7369 7a65 203d   compress_size =
-000040f0: 2030 7866 6666 6666 6666 660a 2020 2020   0xffffffff.    
-00004100: 2020 2020 2020 2020 6d69 6e5f 7665 7273          min_vers
-00004110: 696f 6e20 3d20 5a49 5036 345f 5645 5253  ion = ZIP64_VERS
-00004120: 494f 4e0a 0a20 2020 2020 2020 2069 6620  ION..        if 
-00004130: 7365 6c66 2e63 6f6d 7072 6573 735f 7479  self.compress_ty
-00004140: 7065 203d 3d20 5a49 505f 4443 4c49 4d50  pe == ZIP_DCLIMP
-00004150: 4c4f 4445 443a 0a20 2020 2020 2020 2020  LODED:.         
-00004160: 2020 206d 696e 5f76 6572 7369 6f6e 203d     min_version =
-00004170: 206d 6178 2844 434c 494d 504c 4f44 4544   max(DCLIMPLODED
-00004180: 5f56 4552 5349 4f4e 2c20 6d69 6e5f 7665  _VERSION, min_ve
-00004190: 7273 696f 6e29 0a20 2020 2020 2020 2069  rsion).        i
-000041a0: 6620 7365 6c66 2e63 6f6d 7072 6573 735f  f self.compress_
-000041b0: 7479 7065 203d 3d20 5a49 505f 4445 464c  type == ZIP_DEFL
-000041c0: 4154 4544 3634 3a0a 2020 2020 2020 2020  ATED64:.        
-000041d0: 2020 2020 6d69 6e5f 7665 7273 696f 6e20      min_version 
-000041e0: 3d20 6d61 7828 4445 464c 4154 4544 3634  = max(DEFLATED64
-000041f0: 5f56 4552 5349 4f4e 2c20 6d69 6e5f 7665  _VERSION, min_ve
-00004200: 7273 696f 6e29 0a20 2020 2020 2020 2065  rsion).        e
-00004210: 6c69 6620 7365 6c66 2e63 6f6d 7072 6573  lif self.compres
-00004220: 735f 7479 7065 203d 3d20 5a49 505f 425a  s_type == ZIP_BZ
-00004230: 4950 323a 0a20 2020 2020 2020 2020 2020  IP2:.           
-00004240: 206d 696e 5f76 6572 7369 6f6e 203d 206d   min_version = m
-00004250: 6178 2842 5a49 5032 5f56 4552 5349 4f4e  ax(BZIP2_VERSION
-00004260: 2c20 6d69 6e5f 7665 7273 696f 6e29 0a20  , min_version). 
-00004270: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
-00004280: 2e63 6f6d 7072 6573 735f 7479 7065 203d  .compress_type =
-00004290: 3d20 5a49 505f 4c5a 4d41 3a0a 2020 2020  = ZIP_LZMA:.    
-000042a0: 2020 2020 2020 2020 6d69 6e5f 7665 7273          min_vers
-000042b0: 696f 6e20 3d20 6d61 7828 4c5a 4d41 5f56  ion = max(LZMA_V
-000042c0: 4552 5349 4f4e 2c20 6d69 6e5f 7665 7273  ERSION, min_vers
-000042d0: 696f 6e29 0a20 2020 2020 2020 2065 6c69  ion).        eli
-000042e0: 6620 7365 6c66 2e63 6f6d 7072 6573 735f  f self.compress_
-000042f0: 7479 7065 203d 3d20 5a49 505f 585a 3a0a  type == ZIP_XZ:.
-00004300: 2020 2020 2020 2020 2020 2020 6d69 6e5f              min_
-00004310: 7665 7273 696f 6e20 3d20 6d61 7828 585a  version = max(XZ
-00004320: 5f56 4552 5349 4f4e 2c20 6d69 6e5f 7665  _VERSION, min_ve
-00004330: 7273 696f 6e29 0a20 2020 2020 2020 2065  rsion).        e
-00004340: 6c69 6620 7365 6c66 2e63 6f6d 7072 6573  lif self.compres
-00004350: 735f 7479 7065 203d 3d20 5a49 505f 5a53  s_type == ZIP_ZS
-00004360: 5441 4e44 4152 443a 0a20 2020 2020 2020  TANDARD:.       
-00004370: 2020 2020 206d 696e 5f76 6572 7369 6f6e       min_version
-00004380: 203d 206d 6178 285a 5354 414e 4441 5244   = max(ZSTANDARD
-00004390: 5f56 4552 5349 4f4e 2c20 6d69 6e5f 7665  _VERSION, min_ve
-000043a0: 7273 696f 6e29 0a20 2020 2020 2020 2065  rsion).        e
-000043b0: 6c69 6620 7365 6c66 2e63 6f6d 7072 6573  lif self.compres
-000043c0: 735f 7479 7065 203d 3d20 5a49 505f 5050  s_type == ZIP_PP
-000043d0: 4d44 3a0a 2020 2020 2020 2020 2020 2020  MD:.            
-000043e0: 6d69 6e5f 7665 7273 696f 6e20 3d20 6d61  min_version = ma
-000043f0: 7828 5050 4d44 5f56 4552 5349 4f4e 2c20  x(PPMD_VERSION, 
-00004400: 6d69 6e5f 7665 7273 696f 6e29 0a0a 2020  min_version)..  
-00004410: 2020 2020 2020 7365 6c66 2e65 7874 7261        self.extra
-00004420: 6374 5f76 6572 7369 6f6e 203d 206d 6178  ct_version = max
-00004430: 286d 696e 5f76 6572 7369 6f6e 2c20 7365  (min_version, se
-00004440: 6c66 2e65 7874 7261 6374 5f76 6572 7369  lf.extract_versi
-00004450: 6f6e 290a 2020 2020 2020 2020 7365 6c66  on).        self
-00004460: 2e63 7265 6174 655f 7665 7273 696f 6e20  .create_version 
-00004470: 3d20 6d61 7828 6d69 6e5f 7665 7273 696f  = max(min_versio
-00004480: 6e2c 2073 656c 662e 6372 6561 7465 5f76  n, self.create_v
-00004490: 6572 7369 6f6e 290a 2020 2020 2020 2020  ersion).        
-000044a0: 6669 6c65 6e61 6d65 2c20 666c 6167 5f62  filename, flag_b
-000044b0: 6974 7320 3d20 7365 6c66 2e5f 656e 636f  its = self._enco
-000044c0: 6465 4669 6c65 6e61 6d65 466c 6167 7328  deFilenameFlags(
-000044d0: 290a 2020 2020 2020 2020 6865 6164 6572  ).        header
-000044e0: 203d 2073 7472 7563 742e 7061 636b 2873   = struct.pack(s
-000044f0: 7472 7563 7446 696c 6548 6561 6465 722c  tructFileHeader,
-00004500: 2073 7472 696e 6746 696c 6548 6561 6465   stringFileHeade
-00004510: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
-00004520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000001a0: 6572 726e 6f0a 696d 706f 7274 206c 6f63  errno.import loc
+000001b0: 616c 650a 0a74 7279 3a0a 2020 2020 6672  ale..try:.    fr
+000001c0: 6f6d 2070 6174 686c 6962 2069 6d70 6f72  om pathlib impor
+000001d0: 7420 5061 7468 0a65 7863 6570 7420 496d  t Path.except Im
+000001e0: 706f 7274 4572 726f 723a 0a20 2020 2066  portError:.    f
+000001f0: 726f 6d20 7061 7468 6c69 6232 2069 6d70  rom pathlib2 imp
+00000200: 6f72 7420 5061 7468 0a0a 7472 793a 0a20  ort Path..try:. 
+00000210: 2020 2066 726f 6d20 636f 6e74 6578 746c     from contextl
+00000220: 6962 2069 6d70 6f72 7420 7375 7070 7265  ib import suppre
+00000230: 7373 0a65 7863 6570 7420 496d 706f 7274  ss.except Import
+00000240: 4572 726f 723a 0a20 2020 2066 726f 6d20  Error:.    from 
+00000250: 636f 6e74 6578 746c 6962 3220 696d 706f  contextlib2 impo
+00000260: 7274 2073 7570 7072 6573 730a 0a63 7263  rt suppress..crc
+00000270: 3332 203d 2062 696e 6173 6369 692e 6372  32 = binascii.cr
+00000280: 6333 320a 0a74 7279 3a0a 2020 2020 696d  c32..try:.    im
+00000290: 706f 7274 207a 6c69 6220 2320 5765 206d  port zlib # We m
+000002a0: 6179 206e 6565 6420 6974 7320 636f 6d70  ay need its comp
+000002b0: 7265 7373 696f 6e20 6d65 7468 6f64 0a20  ression method. 
+000002c0: 2020 2063 7263 3332 203d 207a 6c69 622e     crc32 = zlib.
+000002d0: 6372 6333 320a 6578 6365 7074 2049 6d70  crc32.except Imp
+000002e0: 6f72 7445 7272 6f72 3a0a 2020 2020 7a6c  ortError:.    zl
+000002f0: 6962 203d 204e 6f6e 650a 0a74 7279 3a0a  ib = None..try:.
+00000300: 2020 2020 6672 6f6d 2069 7361 6c20 696d      from isal im
+00000310: 706f 7274 2069 7361 6c5f 7a6c 6962 0a20  port isal_zlib. 
+00000320: 2020 2063 7263 3332 203d 2069 7361 6c5f     crc32 = isal_
+00000330: 7a6c 6962 2e63 7263 3332 0a65 7863 6570  zlib.crc32.excep
+00000340: 7420 496d 706f 7274 4572 726f 723a 0a20  t ImportError:. 
+00000350: 2020 2069 7361 6c5f 7a6c 6962 203d 204e     isal_zlib = N
+00000360: 6f6e 650a 0a74 7279 3a0a 2020 2020 696d  one..try:.    im
+00000370: 706f 7274 2073 6c7a 0a65 7863 6570 7420  port slz.except 
+00000380: 496d 706f 7274 4572 726f 723a 0a20 2020  ImportError:.   
+00000390: 2073 6c7a 203d 204e 6f6e 650a 0a74 7279   slz = None..try
+000003a0: 3a0a 2020 2020 696d 706f 7274 2062 7a32  :.    import bz2
+000003b0: 2023 2057 6520 6d61 7920 6e65 6564 2069   # We may need i
+000003c0: 7473 2063 6f6d 7072 6573 7369 6f6e 206d  ts compression m
+000003d0: 6574 686f 640a 6578 6365 7074 2049 6d70  ethod.except Imp
+000003e0: 6f72 7445 7272 6f72 3a0a 2020 2020 627a  ortError:.    bz
+000003f0: 3220 3d20 4e6f 6e65 0a0a 7472 793a 0a20  2 = None..try:. 
+00000400: 2020 2069 6d70 6f72 7420 6c7a 6d61 2023     import lzma #
+00000410: 2057 6520 6d61 7920 6e65 6564 2069 7473   We may need its
+00000420: 2063 6f6d 7072 6573 7369 6f6e 206d 6574   compression met
+00000430: 686f 640a 6578 6365 7074 2049 6d70 6f72  hod.except Impor
+00000440: 7445 7272 6f72 3a0a 2020 2020 7472 793a  tError:.    try:
+00000450: 0a20 2020 2020 2020 2066 726f 6d20 6261  .        from ba
+00000460: 636b 706f 7274 7320 696d 706f 7274 206c  ckports import l
+00000470: 7a6d 610a 2020 2020 6578 6365 7074 2049  zma.    except I
+00000480: 6d70 6f72 7445 7272 6f72 3a0a 2020 2020  mportError:.    
+00000490: 2020 2020 6c7a 6d61 203d 204e 6f6e 650a      lzma = None.
+000004a0: 0a74 7279 3a0a 2020 2020 696d 706f 7274  .try:.    import
+000004b0: 207a 7374 616e 6461 7264 2023 2057 6520   zstandard # We 
+000004c0: 6d61 7920 6e65 6564 2069 7473 2063 6f6d  may need its com
+000004d0: 7072 6573 7369 6f6e 206d 6574 686f 640a  pression method.
+000004e0: 6578 6365 7074 2049 6d70 6f72 7445 7272  except ImportErr
+000004f0: 6f72 3a0a 2020 2020 7a73 7461 6e64 6172  or:.    zstandar
+00000500: 6420 3d20 4e6f 6e65 0a0a 7472 793a 0a20  d = None..try:. 
+00000510: 2020 2069 6d70 6f72 7420 7079 7a73 7464     import pyzstd
+00000520: 2023 2057 6520 6d61 7920 6e65 6564 2069   # We may need i
+00000530: 7473 2063 6f6d 7072 6573 7369 6f6e 206d  ts compression m
+00000540: 6574 686f 640a 6578 6365 7074 2049 6d70  ethod.except Imp
+00000550: 6f72 7445 7272 6f72 3a0a 2020 2020 7079  ortError:.    py
+00000560: 7a73 7464 203d 204e 6f6e 650a 0a74 7279  zstd = None..try
+00000570: 3a0a 2020 2020 6672 6f6d 207a 6970 6669  :.    from zipfi
+00000580: 6c65 5f64 6566 6c61 7465 3634 2069 6d70  le_deflate64 imp
+00000590: 6f72 7420 6465 666c 6174 6536 3420 2320  ort deflate64 # 
+000005a0: 5765 206d 6179 206e 6565 6420 6974 7320  We may need its 
+000005b0: 636f 6d70 7265 7373 696f 6e20 6d65 7468  compression meth
+000005c0: 6f64 0a65 7863 6570 7420 496d 706f 7274  od.except Import
+000005d0: 4572 726f 723a 0a20 2020 2064 6566 6c61  Error:.    defla
+000005e0: 7465 3634 203d 204e 6f6e 650a 0a74 7279  te64 = None..try
+000005f0: 3a0a 2020 2020 696d 706f 7274 2069 6e66  :.    import inf
+00000600: 6c61 7465 3634 2023 2057 6520 6d61 7920  late64 # We may 
+00000610: 6e65 6564 2069 7473 2063 6f6d 7072 6573  need its compres
+00000620: 7369 6f6e 206d 6574 686f 640a 6578 6365  sion method.exce
+00000630: 7074 2049 6d70 6f72 7445 7272 6f72 3a0a  pt ImportError:.
+00000640: 2020 2020 696e 666c 6174 6536 3420 3d20      inflate64 = 
+00000650: 4e6f 6e65 0a0a 7472 793a 0a20 2020 2069  None..try:.    i
+00000660: 6d70 6f72 7420 7079 7070 6d64 2023 2057  mport pyppmd # W
+00000670: 6520 6d61 7920 6e65 6564 2069 7473 2063  e may need its c
+00000680: 6f6d 7072 6573 7369 6f6e 206d 6574 686f  ompression metho
+00000690: 640a 6578 6365 7074 2049 6d70 6f72 7445  d.except ImportE
+000006a0: 7272 6f72 3a0a 2020 2020 7079 7070 6d64  rror:.    pyppmd
+000006b0: 203d 204e 6f6e 650a 0a74 7279 3a0a 2020   = None..try:.  
+000006c0: 2020 696d 706f 7274 2064 636c 696d 706c    import dclimpl
+000006d0: 6f64 6520 2320 5765 206d 6179 206e 6565  ode # We may nee
+000006e0: 6420 6974 7320 636f 6d70 7265 7373 696f  d its compressio
+000006f0: 6e20 6d65 7468 6f64 0a65 7863 6570 7420  n method.except 
+00000700: 496d 706f 7274 4572 726f 723a 0a20 2020  ImportError:.   
+00000710: 2064 636c 696d 706c 6f64 6520 3d20 4e6f   dclimplode = No
+00000720: 6e65 0a0a 7472 793a 0a20 2020 2069 6d70  ne..try:.    imp
+00000730: 6f72 7420 636f 6465 6373 377a 2023 2057  ort codecs7z # W
+00000740: 6520 6d61 7920 6e65 6564 2069 7473 2063  e may need its c
+00000750: 6f6d 7072 6573 7369 6f6e 206d 6574 686f  ompression metho
+00000760: 640a 6578 6365 7074 2049 6d70 6f72 7445  d.except ImportE
+00000770: 7272 6f72 3a0a 2020 2020 636f 6465 6373  rror:.    codecs
+00000780: 377a 203d 204e 6f6e 650a 0a64 6566 2066  7z = None..def f
+00000790: 696c 7465 7266 616c 7365 2870 7265 6469  ilterfalse(predi
+000007a0: 6361 7465 2c20 6974 6572 6162 6c65 293a  cate, iterable):
+000007b0: 0a20 2020 2023 2066 696c 7465 7266 616c  .    # filterfal
+000007c0: 7365 286c 616d 6264 6120 783a 2078 2532  se(lambda x: x%2
+000007d0: 2c20 7261 6e67 6528 3130 2929 202d 2d3e  , range(10)) -->
+000007e0: 2030 2032 2034 2036 2038 0a20 2020 2069   0 2 4 6 8.    i
+000007f0: 6620 7072 6564 6963 6174 6520 6973 204e  f predicate is N
+00000800: 6f6e 653a 0a20 2020 2020 2020 2070 7265  one:.        pre
+00000810: 6469 6361 7465 203d 2062 6f6f 6c0a 2020  dicate = bool.  
+00000820: 2020 666f 7220 7820 696e 2069 7465 7261    for x in itera
+00000830: 626c 653a 0a20 2020 2020 2020 2069 6620  ble:.        if 
+00000840: 6e6f 7420 7072 6564 6963 6174 6528 7829  not predicate(x)
+00000850: 3a0a 2020 2020 2020 2020 2020 2020 7969  :.            yi
+00000860: 656c 6420 780a 0a69 6620 6e6f 7420 6861  eld x..if not ha
+00000870: 7361 7474 7228 6974 6572 746f 6f6c 732c  sattr(itertools,
+00000880: 2027 6669 6c74 6572 6661 6c73 6527 293a   'filterfalse'):
+00000890: 0a20 2020 2069 7465 7274 6f6f 6c73 2e66  .    itertools.f
+000008a0: 696c 7465 7266 616c 7365 203d 2066 696c  ilterfalse = fil
+000008b0: 7465 7266 616c 7365 0a0a 6966 2073 7973  terfalse..if sys
+000008c0: 2e76 6572 7369 6f6e 5f69 6e66 6f5b 305d  .version_info[0]
+000008d0: 3e3d 333a 0a20 2020 2062 6173 6573 7472  >=3:.    basestr
+000008e0: 696e 6720 3d20 7374 720a 0a64 6566 2074  ing = str..def t
+000008f0: 6578 745f 656e 636f 6469 6e67 2865 6e63  ext_encoding(enc
+00000900: 6f64 696e 673d 4e6f 6e65 293a 0a20 2020  oding=None):.   
+00000910: 2069 6620 6861 7361 7474 7228 696f 2c20   if hasattr(io, 
+00000920: 2774 6578 745f 656e 636f 6469 6e67 2729  'text_encoding')
+00000930: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+00000940: 2069 6f2e 7465 7874 5f65 6e63 6f64 696e   io.text_encodin
+00000950: 6728 656e 636f 6469 6e67 290a 2020 2020  g(encoding).    
+00000960: 6966 2065 6e63 6f64 696e 6720 6973 206e  if encoding is n
+00000970: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00000980: 2072 6574 7572 6e20 656e 636f 6469 6e67   return encoding
+00000990: 0a20 2020 2072 6574 7572 6e20 2775 7466  .    return 'utf
+000009a0: 2d38 2720 6966 2067 6574 6174 7472 2873  -8' if getattr(s
+000009b0: 7973 2e66 6c61 6773 2c20 2775 7466 385f  ys.flags, 'utf8_
+000009c0: 6d6f 6465 272c 2046 616c 7365 2920 656c  mode', False) el
+000009d0: 7365 206c 6f63 616c 652e 6765 7470 7265  se locale.getpre
+000009e0: 6665 7272 6564 656e 636f 6469 6e67 2846  ferredencoding(F
+000009f0: 616c 7365 290a 0a5f 5f61 6c6c 5f5f 203d  alse)..__all__ =
+00000a00: 205b 2242 6164 5a69 7046 696c 6522 2c20   ["BadZipFile", 
+00000a10: 2242 6164 5a69 7066 696c 6522 2c20 2265  "BadZipfile", "e
+00000a20: 7272 6f72 222c 0a20 2020 2020 2020 2020  rror",.         
+00000a30: 2020 225a 4950 5f53 544f 5245 4422 2c20    "ZIP_STORED", 
+00000a40: 225a 4950 5f44 4546 4c41 5445 4422 2c20  "ZIP_DEFLATED", 
+00000a50: 225a 4950 5f44 4546 4c41 5445 4436 3422  "ZIP_DEFLATED64"
+00000a60: 2c20 225a 4950 5f44 434c 494d 504c 4f44  , "ZIP_DCLIMPLOD
+00000a70: 4544 222c 2022 5a49 505f 504b 494d 504c  ED", "ZIP_PKIMPL
+00000a80: 4f44 4544 222c 0a20 2020 2020 2020 2020  ODED",.         
+00000a90: 2020 225a 4950 5f42 5a49 5032 222c 2022    "ZIP_BZIP2", "
+00000aa0: 5a49 505f 4c5a 4d41 222c 0a20 2020 2020  ZIP_LZMA",.     
+00000ab0: 2020 2020 2020 225a 4950 5f5a 5354 414e        "ZIP_ZSTAN
+00000ac0: 4441 5244 222c 2022 5a49 505f 585a 222c  DARD", "ZIP_XZ",
+00000ad0: 2022 5a49 505f 5050 4d44 222c 0a20 2020   "ZIP_PPMD",.   
+00000ae0: 2020 2020 2020 2020 2269 735f 7a69 7066          "is_zipf
+00000af0: 696c 6522 2c20 225a 6970 496e 666f 222c  ile", "ZipInfo",
+00000b00: 2022 5a69 7046 696c 6522 2c20 2250 795a   "ZipFile", "PyZ
+00000b10: 6970 4669 6c65 222c 2022 4c61 7267 655a  ipFile", "LargeZ
+00000b20: 6970 4669 6c65 222c 0a20 2020 2020 2020  ipFile",.       
+00000b30: 2020 2020 2250 6174 6822 5d0a 0a63 6c61      "Path"]..cla
+00000b40: 7373 2042 6164 5a69 7046 696c 6528 4578  ss BadZipFile(Ex
+00000b50: 6365 7074 696f 6e29 3a0a 2020 2020 7061  ception):.    pa
+00000b60: 7373 0a0a 636c 6173 7320 4c61 7267 655a  ss..class LargeZ
+00000b70: 6970 4669 6c65 2845 7863 6570 7469 6f6e  ipFile(Exception
+00000b80: 293a 0a20 2020 2022 2222 0a20 2020 2052  ):.    """.    R
+00000b90: 6169 7365 6420 7768 656e 2077 7269 7469  aised when writi
+00000ba0: 6e67 2061 207a 6970 6669 6c65 2c20 7468  ng a zipfile, th
+00000bb0: 6520 7a69 7066 696c 6520 7265 7175 6972  e zipfile requir
+00000bc0: 6573 205a 4950 3634 2065 7874 656e 7369  es ZIP64 extensi
+00000bd0: 6f6e 730a 2020 2020 616e 6420 7468 6f73  ons.    and thos
+00000be0: 6520 6578 7465 6e73 696f 6e73 2061 7265  e extensions are
+00000bf0: 2064 6973 6162 6c65 642e 0a20 2020 2022   disabled..    "
+00000c00: 2222 0a0a 6572 726f 7220 3d20 4261 645a  ""..error = BadZ
+00000c10: 6970 6669 6c65 203d 2042 6164 5a69 7046  ipfile = BadZipF
+00000c20: 696c 6520 2020 2020 2023 2050 7265 2d33  ile      # Pre-3
+00000c30: 2e32 2063 6f6d 7061 7469 6269 6c69 7479  .2 compatibility
+00000c40: 206e 616d 6573 0a0a 0a5a 4950 3634 5f4c   names...ZIP64_L
+00000c50: 494d 4954 203d 2028 3120 3c3c 2033 3129  IMIT = (1 << 31)
+00000c60: 202d 2031 0a5a 4950 5f46 494c 4543 4f55   - 1.ZIP_FILECOU
+00000c70: 4e54 5f4c 494d 4954 203d 2028 3120 3c3c  NT_LIMIT = (1 <<
+00000c80: 2031 3629 202d 2031 0a5a 4950 5f4d 4158   16) - 1.ZIP_MAX
+00000c90: 5f43 4f4d 4d45 4e54 203d 2028 3120 3c3c  _COMMENT = (1 <<
+00000ca0: 2031 3629 202d 2031 0a0a 2320 636f 6e73   16) - 1..# cons
+00000cb0: 7461 6e74 7320 666f 7220 5a69 7020 6669  tants for Zip fi
+00000cc0: 6c65 2063 6f6d 7072 6573 7369 6f6e 206d  le compression m
+00000cd0: 6574 686f 6473 0a5a 4950 5f53 544f 5245  ethods.ZIP_STORE
+00000ce0: 4420 3d20 300a 5a49 505f 4445 464c 4154  D = 0.ZIP_DEFLAT
+00000cf0: 4544 203d 2038 0a5a 4950 5f44 4546 4c41  ED = 8.ZIP_DEFLA
+00000d00: 5445 4436 3420 3d20 390a 5a49 505f 4443  TED64 = 9.ZIP_DC
+00000d10: 4c49 4d50 4c4f 4445 4420 3d20 3130 0a5a  LIMPLODED = 10.Z
+00000d20: 4950 5f50 4b49 4d50 4c4f 4445 4420 3d20  IP_PKIMPLODED = 
+00000d30: 3130 0a5a 4950 5f42 5a49 5032 203d 2031  10.ZIP_BZIP2 = 1
+00000d40: 320a 5a49 505f 4c5a 4d41 203d 2031 340a  2.ZIP_LZMA = 14.
+00000d50: 5a49 505f 5a53 5441 4e44 4152 4420 3d20  ZIP_ZSTANDARD = 
+00000d60: 3933 0a5a 4950 5f58 5a20 3d20 3935 0a5a  93.ZIP_XZ = 95.Z
+00000d70: 4950 5f50 504d 4420 3d20 3938 0a23 204f  IP_PPMD = 98.# O
+00000d80: 7468 6572 205a 4950 2063 6f6d 7072 6573  ther ZIP compres
+00000d90: 7369 6f6e 206d 6574 686f 6473 206e 6f74  sion methods not
+00000da0: 2073 7570 706f 7274 6564 0a0a 4445 4641   supported..DEFA
+00000db0: 554c 545f 5645 5253 494f 4e20 3d20 3230  ULT_VERSION = 20
+00000dc0: 0a5a 4950 3634 5f56 4552 5349 4f4e 203d  .ZIP64_VERSION =
+00000dd0: 2034 350a 4445 464c 4154 4544 3634 5f56   45.DEFLATED64_V
+00000de0: 4552 5349 4f4e 203d 2032 310a 4443 4c49  ERSION = 21.DCLI
+00000df0: 4d50 4c4f 4445 445f 5645 5253 494f 4e20  MPLODED_VERSION 
+00000e00: 3d20 3235 0a42 5a49 5032 5f56 4552 5349  = 25.BZIP2_VERSI
+00000e10: 4f4e 203d 2034 360a 4c5a 4d41 5f56 4552  ON = 46.LZMA_VER
+00000e20: 5349 4f4e 203d 2036 330a 5a53 5441 4e44  SION = 63.ZSTAND
+00000e30: 4152 445f 5645 5253 494f 4e20 3d20 3633  ARD_VERSION = 63
+00000e40: 0a58 5a5f 5645 5253 494f 4e20 3d20 3633  .XZ_VERSION = 63
+00000e50: 0a50 504d 445f 5645 5253 494f 4e20 3d20  .PPMD_VERSION = 
+00000e60: 3633 0a23 2077 6520 7265 636f 676e 697a  63.# we recogniz
+00000e70: 6520 2862 7574 206e 6f74 206e 6563 6573  e (but not neces
+00000e80: 7361 7269 6c79 2073 7570 706f 7274 2920  sarily support) 
+00000e90: 616c 6c20 6665 6174 7572 6573 2075 7020  all features up 
+00000ea0: 746f 2074 6861 7420 7665 7273 696f 6e0a  to that version.
+00000eb0: 4d41 585f 4558 5452 4143 545f 5645 5253  MAX_EXTRACT_VERS
+00000ec0: 494f 4e20 3d20 3633 0a0a 2320 4265 6c6f  ION = 63..# Belo
+00000ed0: 7720 6172 6520 736f 6d65 2066 6f72 6d61  w are some forma
+00000ee0: 7473 2061 6e64 2061 7373 6f63 6961 7465  ts and associate
+00000ef0: 6420 6461 7461 2066 6f72 2072 6561 6469  d data for readi
+00000f00: 6e67 2f77 7269 7469 6e67 2068 6561 6465  ng/writing heade
+00000f10: 7273 2075 7369 6e67 0a23 2074 6865 2073  rs using.# the s
+00000f20: 7472 7563 7420 6d6f 6475 6c65 2e20 2054  truct module.  T
+00000f30: 6865 206e 616d 6573 2061 6e64 2073 7472  he names and str
+00000f40: 7563 7475 7265 7320 6f66 2068 6561 6465  uctures of heade
+00000f50: 7273 2f72 6563 6f72 6473 2061 7265 2074  rs/records are t
+00000f60: 686f 7365 2075 7365 640a 2320 696e 2074  hose used.# in t
+00000f70: 6865 2050 4b57 4152 4520 6465 7363 7269  he PKWARE descri
+00000f80: 7074 696f 6e20 6f66 2074 6865 205a 4950  ption of the ZIP
+00000f90: 2066 696c 6520 666f 726d 6174 3a0a 2320   file format:.# 
+00000fa0: 2020 2020 6874 7470 3a2f 2f77 7777 2e70      http://www.p
+00000fb0: 6b77 6172 652e 636f 6d2f 646f 6375 6d65  kware.com/docume
+00000fc0: 6e74 732f 6361 7365 7374 7564 6965 732f  nts/casestudies/
+00000fd0: 4150 504e 4f54 452e 5458 540a 2320 2855  APPNOTE.TXT.# (U
+00000fe0: 524c 2076 616c 6964 2061 7320 6f66 204a  RL valid as of J
+00000ff0: 616e 7561 7279 2032 3030 3829 0a0a 2320  anuary 2008)..# 
+00001000: 5468 6520 2265 6e64 206f 6620 6365 6e74  The "end of cent
+00001010: 7261 6c20 6469 7265 6374 6f72 7922 2073  ral directory" s
+00001020: 7472 7563 7475 7265 2c20 6d61 6769 6320  tructure, magic 
+00001030: 6e75 6d62 6572 2c20 7369 7a65 2c20 616e  number, size, an
+00001040: 6420 696e 6469 6365 730a 2320 2873 6563  d indices.# (sec
+00001050: 7469 6f6e 2056 2e49 2069 6e20 7468 6520  tion V.I in the 
+00001060: 666f 726d 6174 2064 6f63 756d 656e 7429  format document)
+00001070: 0a73 7472 7563 7445 6e64 4172 6368 6976  .structEndArchiv
+00001080: 6520 3d20 6222 3c34 7334 4832 4c48 220a  e = b"<4s4H2LH".
+00001090: 7374 7269 6e67 456e 6441 7263 6869 7665  stringEndArchive
+000010a0: 203d 2062 2250 4b5c 3030 355c 3030 3622   = b"PK\005\006"
+000010b0: 0a73 697a 6545 6e64 4365 6e74 4469 7220  .sizeEndCentDir 
+000010c0: 3d20 7374 7275 6374 2e63 616c 6373 697a  = struct.calcsiz
+000010d0: 6528 7374 7275 6374 456e 6441 7263 6869  e(structEndArchi
+000010e0: 7665 290a 0a5f 4543 445f 5349 474e 4154  ve).._ECD_SIGNAT
+000010f0: 5552 4520 3d20 300a 5f45 4344 5f44 4953  URE = 0._ECD_DIS
+00001100: 4b5f 4e55 4d42 4552 203d 2031 0a5f 4543  K_NUMBER = 1._EC
+00001110: 445f 4449 534b 5f53 5441 5254 203d 2032  D_DISK_START = 2
+00001120: 0a5f 4543 445f 454e 5452 4945 535f 5448  ._ECD_ENTRIES_TH
+00001130: 4953 5f44 4953 4b20 3d20 330a 5f45 4344  IS_DISK = 3._ECD
+00001140: 5f45 4e54 5249 4553 5f54 4f54 414c 203d  _ENTRIES_TOTAL =
+00001150: 2034 0a5f 4543 445f 5349 5a45 203d 2035   4._ECD_SIZE = 5
+00001160: 0a5f 4543 445f 4f46 4653 4554 203d 2036  ._ECD_OFFSET = 6
+00001170: 0a5f 4543 445f 434f 4d4d 454e 545f 5349  ._ECD_COMMENT_SI
+00001180: 5a45 203d 2037 0a23 2054 6865 7365 206c  ZE = 7.# These l
+00001190: 6173 7420 7477 6f20 696e 6469 6365 7320  ast two indices 
+000011a0: 6172 6520 6e6f 7420 7061 7274 206f 6620  are not part of 
+000011b0: 7468 6520 7374 7275 6374 7572 6520 6173  the structure as
+000011c0: 2064 6566 696e 6564 2069 6e20 7468 650a   defined in the.
+000011d0: 2320 7370 6563 2c20 6275 7420 7468 6579  # spec, but they
+000011e0: 2061 7265 2075 7365 6420 696e 7465 726e   are used intern
+000011f0: 616c 6c79 2062 7920 7468 6973 206d 6f64  ally by this mod
+00001200: 756c 6520 6173 2061 2063 6f6e 7665 6e69  ule as a conveni
+00001210: 656e 6365 0a5f 4543 445f 434f 4d4d 454e  ence._ECD_COMMEN
+00001220: 5420 3d20 380a 5f45 4344 5f4c 4f43 4154  T = 8._ECD_LOCAT
+00001230: 494f 4e20 3d20 390a 0a23 2054 6865 2022  ION = 9..# The "
+00001240: 6365 6e74 7261 6c20 6469 7265 6374 6f72  central director
+00001250: 7922 2073 7472 7563 7475 7265 2c20 6d61  y" structure, ma
+00001260: 6769 6320 6e75 6d62 6572 2c20 7369 7a65  gic number, size
+00001270: 2c20 616e 6420 696e 6469 6365 730a 2320  , and indices.# 
+00001280: 6f66 2065 6e74 7269 6573 2069 6e20 7468  of entries in th
+00001290: 6520 7374 7275 6374 7572 6520 2873 6563  e structure (sec
+000012a0: 7469 6f6e 2056 2e46 2069 6e20 7468 6520  tion V.F in the 
+000012b0: 666f 726d 6174 2064 6f63 756d 656e 7429  format document)
+000012c0: 0a73 7472 7563 7443 656e 7472 616c 4469  .structCentralDi
+000012d0: 7220 3d20 223c 3473 3442 3448 4c32 4c35  r = "<4s4B4HL2L5
+000012e0: 4832 4c22 0a73 7472 696e 6743 656e 7472  H2L".stringCentr
+000012f0: 616c 4469 7220 3d20 6222 504b 5c30 3031  alDir = b"PK\001
+00001300: 5c30 3032 220a 7369 7a65 4365 6e74 7261  \002".sizeCentra
+00001310: 6c44 6972 203d 2073 7472 7563 742e 6361  lDir = struct.ca
+00001320: 6c63 7369 7a65 2873 7472 7563 7443 656e  lcsize(structCen
+00001330: 7472 616c 4469 7229 0a0a 2320 696e 6465  tralDir)..# inde
+00001340: 7865 7320 6f66 2065 6e74 7269 6573 2069  xes of entries i
+00001350: 6e20 7468 6520 6365 6e74 7261 6c20 6469  n the central di
+00001360: 7265 6374 6f72 7920 7374 7275 6374 7572  rectory structur
+00001370: 650a 5f43 445f 5349 474e 4154 5552 4520  e._CD_SIGNATURE 
+00001380: 3d20 300a 5f43 445f 4352 4541 5445 5f56  = 0._CD_CREATE_V
+00001390: 4552 5349 4f4e 203d 2031 0a5f 4344 5f43  ERSION = 1._CD_C
+000013a0: 5245 4154 455f 5359 5354 454d 203d 2032  REATE_SYSTEM = 2
+000013b0: 0a5f 4344 5f45 5854 5241 4354 5f56 4552  ._CD_EXTRACT_VER
+000013c0: 5349 4f4e 203d 2033 0a5f 4344 5f45 5854  SION = 3._CD_EXT
+000013d0: 5241 4354 5f53 5953 5445 4d20 3d20 340a  RACT_SYSTEM = 4.
+000013e0: 5f43 445f 464c 4147 5f42 4954 5320 3d20  _CD_FLAG_BITS = 
+000013f0: 350a 5f43 445f 434f 4d50 5245 5353 5f54  5._CD_COMPRESS_T
+00001400: 5950 4520 3d20 360a 5f43 445f 5449 4d45  YPE = 6._CD_TIME
+00001410: 203d 2037 0a5f 4344 5f44 4154 4520 3d20   = 7._CD_DATE = 
+00001420: 380a 5f43 445f 4352 4320 3d20 390a 5f43  8._CD_CRC = 9._C
+00001430: 445f 434f 4d50 5245 5353 4544 5f53 495a  D_COMPRESSED_SIZ
+00001440: 4520 3d20 3130 0a5f 4344 5f55 4e43 4f4d  E = 10._CD_UNCOM
+00001450: 5052 4553 5345 445f 5349 5a45 203d 2031  PRESSED_SIZE = 1
+00001460: 310a 5f43 445f 4649 4c45 4e41 4d45 5f4c  1._CD_FILENAME_L
+00001470: 454e 4754 4820 3d20 3132 0a5f 4344 5f45  ENGTH = 12._CD_E
+00001480: 5854 5241 5f46 4945 4c44 5f4c 454e 4754  XTRA_FIELD_LENGT
+00001490: 4820 3d20 3133 0a5f 4344 5f43 4f4d 4d45  H = 13._CD_COMME
+000014a0: 4e54 5f4c 454e 4754 4820 3d20 3134 0a5f  NT_LENGTH = 14._
+000014b0: 4344 5f44 4953 4b5f 4e55 4d42 4552 5f53  CD_DISK_NUMBER_S
+000014c0: 5441 5254 203d 2031 350a 5f43 445f 494e  TART = 15._CD_IN
+000014d0: 5445 524e 414c 5f46 494c 455f 4154 5452  TERNAL_FILE_ATTR
+000014e0: 4942 5554 4553 203d 2031 360a 5f43 445f  IBUTES = 16._CD_
+000014f0: 4558 5445 524e 414c 5f46 494c 455f 4154  EXTERNAL_FILE_AT
+00001500: 5452 4942 5554 4553 203d 2031 370a 5f43  TRIBUTES = 17._C
+00001510: 445f 4c4f 4341 4c5f 4845 4144 4552 5f4f  D_LOCAL_HEADER_O
+00001520: 4646 5345 5420 3d20 3138 0a0a 2320 5468  FFSET = 18..# Th
+00001530: 6520 226c 6f63 616c 2066 696c 6520 6865  e "local file he
+00001540: 6164 6572 2220 7374 7275 6374 7572 652c  ader" structure,
+00001550: 206d 6167 6963 206e 756d 6265 722c 2073   magic number, s
+00001560: 697a 652c 2061 6e64 2069 6e64 6963 6573  ize, and indices
+00001570: 0a23 2028 7365 6374 696f 6e20 562e 4120  .# (section V.A 
+00001580: 696e 2074 6865 2066 6f72 6d61 7420 646f  in the format do
+00001590: 6375 6d65 6e74 290a 7374 7275 6374 4669  cument).structFi
+000015a0: 6c65 4865 6164 6572 203d 2022 3c34 7332  leHeader = "<4s2
+000015b0: 4234 484c 324c 3248 220a 7374 7269 6e67  B4HL2L2H".string
+000015c0: 4669 6c65 4865 6164 6572 203d 2062 2250  FileHeader = b"P
+000015d0: 4b5c 3030 335c 3030 3422 0a73 697a 6546  K\003\004".sizeF
+000015e0: 696c 6548 6561 6465 7220 3d20 7374 7275  ileHeader = stru
+000015f0: 6374 2e63 616c 6373 697a 6528 7374 7275  ct.calcsize(stru
+00001600: 6374 4669 6c65 4865 6164 6572 290a 0a5f  ctFileHeader).._
+00001610: 4648 5f53 4947 4e41 5455 5245 203d 2030  FH_SIGNATURE = 0
+00001620: 0a5f 4648 5f45 5854 5241 4354 5f56 4552  ._FH_EXTRACT_VER
+00001630: 5349 4f4e 203d 2031 0a5f 4648 5f45 5854  SION = 1._FH_EXT
+00001640: 5241 4354 5f53 5953 5445 4d20 3d20 320a  RACT_SYSTEM = 2.
+00001650: 5f46 485f 4745 4e45 5241 4c5f 5055 5250  _FH_GENERAL_PURP
+00001660: 4f53 455f 464c 4147 5f42 4954 5320 3d20  OSE_FLAG_BITS = 
+00001670: 330a 5f46 485f 434f 4d50 5245 5353 494f  3._FH_COMPRESSIO
+00001680: 4e5f 4d45 5448 4f44 203d 2034 0a5f 4648  N_METHOD = 4._FH
+00001690: 5f4c 4153 545f 4d4f 445f 5449 4d45 203d  _LAST_MOD_TIME =
+000016a0: 2035 0a5f 4648 5f4c 4153 545f 4d4f 445f   5._FH_LAST_MOD_
+000016b0: 4441 5445 203d 2036 0a5f 4648 5f43 5243  DATE = 6._FH_CRC
+000016c0: 203d 2037 0a5f 4648 5f43 4f4d 5052 4553   = 7._FH_COMPRES
+000016d0: 5345 445f 5349 5a45 203d 2038 0a5f 4648  SED_SIZE = 8._FH
+000016e0: 5f55 4e43 4f4d 5052 4553 5345 445f 5349  _UNCOMPRESSED_SI
+000016f0: 5a45 203d 2039 0a5f 4648 5f46 494c 454e  ZE = 9._FH_FILEN
+00001700: 414d 455f 4c45 4e47 5448 203d 2031 300a  AME_LENGTH = 10.
+00001710: 5f46 485f 4558 5452 415f 4649 454c 445f  _FH_EXTRA_FIELD_
+00001720: 4c45 4e47 5448 203d 2031 310a 0a23 2054  LENGTH = 11..# T
+00001730: 6865 2022 5a69 7036 3420 656e 6420 6f66  he "Zip64 end of
+00001740: 2063 656e 7472 616c 2064 6972 6563 746f   central directo
+00001750: 7279 206c 6f63 6174 6f72 2220 7374 7275  ry locator" stru
+00001760: 6374 7572 652c 206d 6167 6963 206e 756d  cture, magic num
+00001770: 6265 722c 2061 6e64 2073 697a 650a 7374  ber, and size.st
+00001780: 7275 6374 456e 6441 7263 6869 7665 3634  ructEndArchive64
+00001790: 4c6f 6361 746f 7220 3d20 223c 3473 4c51  Locator = "<4sLQ
+000017a0: 4c22 0a73 7472 696e 6745 6e64 4172 6368  L".stringEndArch
+000017b0: 6976 6536 344c 6f63 6174 6f72 203d 2062  ive64Locator = b
+000017c0: 2250 4b5c 7830 365c 7830 3722 0a73 697a  "PK\x06\x07".siz
+000017d0: 6545 6e64 4365 6e74 4469 7236 344c 6f63  eEndCentDir64Loc
+000017e0: 6174 6f72 203d 2073 7472 7563 742e 6361  ator = struct.ca
+000017f0: 6c63 7369 7a65 2873 7472 7563 7445 6e64  lcsize(structEnd
+00001800: 4172 6368 6976 6536 344c 6f63 6174 6f72  Archive64Locator
+00001810: 290a 0a23 2054 6865 2022 5a69 7036 3420  )..# The "Zip64 
+00001820: 656e 6420 6f66 2063 656e 7472 616c 2064  end of central d
+00001830: 6972 6563 746f 7279 2220 7265 636f 7264  irectory" record
+00001840: 2c20 6d61 6769 6320 6e75 6d62 6572 2c20  , magic number, 
+00001850: 7369 7a65 2c20 616e 6420 696e 6469 6365  size, and indice
+00001860: 730a 2320 2873 6563 7469 6f6e 2056 2e47  s.# (section V.G
+00001870: 2069 6e20 7468 6520 666f 726d 6174 2064   in the format d
+00001880: 6f63 756d 656e 7429 0a73 7472 7563 7445  ocument).structE
+00001890: 6e64 4172 6368 6976 6536 3420 3d20 223c  ndArchive64 = "<
+000018a0: 3473 5132 4832 4c34 5122 0a73 7472 696e  4sQ2H2L4Q".strin
+000018b0: 6745 6e64 4172 6368 6976 6536 3420 3d20  gEndArchive64 = 
+000018c0: 6222 504b 5c78 3036 5c78 3036 220a 7369  b"PK\x06\x06".si
+000018d0: 7a65 456e 6443 656e 7444 6972 3634 203d  zeEndCentDir64 =
+000018e0: 2073 7472 7563 742e 6361 6c63 7369 7a65   struct.calcsize
+000018f0: 2873 7472 7563 7445 6e64 4172 6368 6976  (structEndArchiv
+00001900: 6536 3429 0a0a 5f43 4436 345f 5349 474e  e64).._CD64_SIGN
+00001910: 4154 5552 4520 3d20 300a 5f43 4436 345f  ATURE = 0._CD64_
+00001920: 4449 5245 4354 4f52 595f 5245 4353 495a  DIRECTORY_RECSIZ
+00001930: 4520 3d20 310a 5f43 4436 345f 4352 4541  E = 1._CD64_CREA
+00001940: 5445 5f56 4552 5349 4f4e 203d 2032 0a5f  TE_VERSION = 2._
+00001950: 4344 3634 5f45 5854 5241 4354 5f56 4552  CD64_EXTRACT_VER
+00001960: 5349 4f4e 203d 2033 0a5f 4344 3634 5f44  SION = 3._CD64_D
+00001970: 4953 4b5f 4e55 4d42 4552 203d 2034 0a5f  ISK_NUMBER = 4._
+00001980: 4344 3634 5f44 4953 4b5f 4e55 4d42 4552  CD64_DISK_NUMBER
+00001990: 5f53 5441 5254 203d 2035 0a5f 4344 3634  _START = 5._CD64
+000019a0: 5f4e 554d 4245 525f 454e 5452 4945 535f  _NUMBER_ENTRIES_
+000019b0: 5448 4953 5f44 4953 4b20 3d20 360a 5f43  THIS_DISK = 6._C
+000019c0: 4436 345f 4e55 4d42 4552 5f45 4e54 5249  D64_NUMBER_ENTRI
+000019d0: 4553 5f54 4f54 414c 203d 2037 0a5f 4344  ES_TOTAL = 7._CD
+000019e0: 3634 5f44 4952 4543 544f 5259 5f53 495a  64_DIRECTORY_SIZ
+000019f0: 4520 3d20 380a 5f43 4436 345f 4f46 4653  E = 8._CD64_OFFS
+00001a00: 4554 5f53 5441 5254 5f43 454e 5444 4952  ET_START_CENTDIR
+00001a10: 203d 2039 0a0a 5f44 445f 5349 474e 4154   = 9.._DD_SIGNAT
+00001a20: 5552 4520 3d20 3078 3038 3037 3462 3530  URE = 0x08074b50
+00001a30: 0a0a 5f45 5854 5241 5f46 4945 4c44 5f53  .._EXTRA_FIELD_S
+00001a40: 5452 5543 5420 3d20 7374 7275 6374 2e53  TRUCT = struct.S
+00001a50: 7472 7563 7428 273c 4848 2729 0a0a 6465  truct('<HH')..de
+00001a60: 6620 5f73 7472 6970 5f65 7874 7261 2865  f _strip_extra(e
+00001a70: 7874 7261 2c20 7869 6473 293a 0a20 2020  xtra, xids):.   
+00001a80: 2023 2052 656d 6f76 6520 4578 7472 6120   # Remove Extra 
+00001a90: 4669 656c 6473 2077 6974 6820 7370 6563  Fields with spec
+00001aa0: 6966 6965 6420 4944 732e 0a20 2020 2075  ified IDs..    u
+00001ab0: 6e70 6163 6b20 3d20 5f45 5854 5241 5f46  npack = _EXTRA_F
+00001ac0: 4945 4c44 5f53 5452 5543 542e 756e 7061  IELD_STRUCT.unpa
+00001ad0: 636b 0a20 2020 206d 6f64 6966 6965 6420  ck.    modified 
+00001ae0: 3d20 4661 6c73 650a 2020 2020 6275 6666  = False.    buff
+00001af0: 6572 203d 205b 5d0a 2020 2020 7374 6172  er = [].    star
+00001b00: 7420 3d20 6920 3d20 300a 2020 2020 7768  t = i = 0.    wh
+00001b10: 696c 6520 6920 2b20 3420 3c3d 206c 656e  ile i + 4 <= len
+00001b20: 2865 7874 7261 293a 0a20 2020 2020 2020  (extra):.       
+00001b30: 2078 6964 2c20 786c 656e 203d 2075 6e70   xid, xlen = unp
+00001b40: 6163 6b28 6578 7472 615b 6920 3a20 6920  ack(extra[i : i 
+00001b50: 2b20 345d 290a 2020 2020 2020 2020 6a20  + 4]).        j 
+00001b60: 3d20 6920 2b20 3420 2b20 786c 656e 0a20  = i + 4 + xlen. 
+00001b70: 2020 2020 2020 2069 6620 7869 6420 696e         if xid in
+00001b80: 2078 6964 733a 0a20 2020 2020 2020 2020   xids:.         
+00001b90: 2020 2069 6620 6920 213d 2073 7461 7274     if i != start
+00001ba0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00001bb0: 2020 6275 6666 6572 2e61 7070 656e 6428    buffer.append(
+00001bc0: 6578 7472 615b 7374 6172 7420 3a20 695d  extra[start : i]
+00001bd0: 290a 2020 2020 2020 2020 2020 2020 7374  ).            st
+00001be0: 6172 7420 3d20 6a0a 2020 2020 2020 2020  art = j.        
+00001bf0: 2020 2020 6d6f 6469 6669 6564 203d 2054      modified = T
+00001c00: 7275 650a 2020 2020 2020 2020 6920 3d20  rue.        i = 
+00001c10: 6a0a 2020 2020 6966 206e 6f74 206d 6f64  j.    if not mod
+00001c20: 6966 6965 643a 0a20 2020 2020 2020 2072  ified:.        r
+00001c30: 6574 7572 6e20 6578 7472 610a 2020 2020  eturn extra.    
+00001c40: 7265 7475 726e 2062 2727 2e6a 6f69 6e28  return b''.join(
+00001c50: 6275 6666 6572 290a 0a64 6566 205f 6368  buffer)..def _ch
+00001c60: 6563 6b5f 7a69 7066 696c 6528 6670 293a  eck_zipfile(fp):
+00001c70: 0a20 2020 2074 7279 3a0a 2020 2020 2020  .    try:.      
+00001c80: 2020 6966 205f 456e 6452 6563 4461 7461    if _EndRecData
+00001c90: 2866 7029 3a0a 2020 2020 2020 2020 2020  (fp):.          
+00001ca0: 2020 7265 7475 726e 2054 7275 6520 2020    return True   
+00001cb0: 2020 2020 2020 2320 6669 6c65 2068 6173        # file has
+00001cc0: 2063 6f72 7265 6374 206d 6167 6963 206e   correct magic n
+00001cd0: 756d 6265 720a 2020 2020 6578 6365 7074  umber.    except
+00001ce0: 204f 5345 7272 6f72 3a0a 2020 2020 2020   OSError:.      
+00001cf0: 2020 7061 7373 0a20 2020 2072 6574 7572    pass.    retur
+00001d00: 6e20 4661 6c73 650a 0a64 6566 2069 735f  n False..def is_
+00001d10: 7a69 7066 696c 6528 6669 6c65 6e61 6d65  zipfile(filename
+00001d20: 293a 0a20 2020 2022 2222 5175 6963 6b6c  ):.    """Quickl
+00001d30: 7920 7365 6520 6966 2061 2066 696c 6520  y see if a file 
+00001d40: 6973 2061 205a 4950 2066 696c 6520 6279  is a ZIP file by
+00001d50: 2063 6865 636b 696e 6720 7468 6520 6d61   checking the ma
+00001d60: 6769 6320 6e75 6d62 6572 2e0a 0a20 2020  gic number...   
+00001d70: 2054 6865 2066 696c 656e 616d 6520 6172   The filename ar
+00001d80: 6775 6d65 6e74 206d 6179 2062 6520 6120  gument may be a 
+00001d90: 6669 6c65 206f 7220 6669 6c65 2d6c 696b  file or file-lik
+00001da0: 6520 6f62 6a65 6374 2074 6f6f 2e0a 2020  e object too..  
+00001db0: 2020 2222 220a 2020 2020 7265 7375 6c74    """.    result
+00001dc0: 203d 2046 616c 7365 0a20 2020 2074 7279   = False.    try
+00001dd0: 3a0a 2020 2020 2020 2020 6966 2068 6173  :.        if has
+00001de0: 6174 7472 2866 696c 656e 616d 652c 2022  attr(filename, "
+00001df0: 7265 6164 2229 3a0a 2020 2020 2020 2020  read"):.        
+00001e00: 2020 2020 7265 7375 6c74 203d 205f 6368      result = _ch
+00001e10: 6563 6b5f 7a69 7066 696c 6528 6670 3d66  eck_zipfile(fp=f
+00001e20: 696c 656e 616d 6529 0a20 2020 2020 2020  ilename).       
+00001e30: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00001e40: 2020 2077 6974 6820 6f70 656e 2866 696c     with open(fil
+00001e50: 656e 616d 652c 2022 7262 2229 2061 7320  ename, "rb") as 
+00001e60: 6670 3a0a 2020 2020 2020 2020 2020 2020  fp:.            
+00001e70: 2020 2020 7265 7375 6c74 203d 205f 6368      result = _ch
+00001e80: 6563 6b5f 7a69 7066 696c 6528 6670 290a  eck_zipfile(fp).
+00001e90: 2020 2020 6578 6365 7074 204f 5345 7272      except OSErr
+00001ea0: 6f72 3a0a 2020 2020 2020 2020 7061 7373  or:.        pass
+00001eb0: 0a20 2020 2072 6574 7572 6e20 7265 7375  .    return resu
+00001ec0: 6c74 0a0a 6465 6620 5f45 6e64 5265 6344  lt..def _EndRecD
+00001ed0: 6174 6136 3428 6670 696e 2c20 6f66 6673  ata64(fpin, offs
+00001ee0: 6574 2c20 656e 6472 6563 293a 0a20 2020  et, endrec):.   
+00001ef0: 2022 2222 0a20 2020 2052 6561 6420 7468   """.    Read th
+00001f00: 6520 5a49 5036 3420 656e 642d 6f66 2d61  e ZIP64 end-of-a
+00001f10: 7263 6869 7665 2072 6563 6f72 6473 2061  rchive records a
+00001f20: 6e64 2075 7365 2074 6861 7420 746f 2075  nd use that to u
+00001f30: 7064 6174 6520 656e 6472 6563 0a20 2020  pdate endrec.   
+00001f40: 2022 2222 0a20 2020 2074 7279 3a0a 2020   """.    try:.  
+00001f50: 2020 2020 2020 6670 696e 2e73 6565 6b28        fpin.seek(
+00001f60: 6f66 6673 6574 202d 2073 697a 6545 6e64  offset - sizeEnd
+00001f70: 4365 6e74 4469 7236 344c 6f63 6174 6f72  CentDir64Locator
+00001f80: 2c20 3229 0a20 2020 2065 7863 6570 7420  , 2).    except 
+00001f90: 4f53 4572 726f 723a 0a20 2020 2020 2020  OSError:.       
+00001fa0: 2023 2049 6620 7468 6520 7365 656b 2066   # If the seek f
+00001fb0: 6169 6c73 2c20 7468 6520 6669 6c65 2069  ails, the file i
+00001fc0: 7320 6e6f 7420 6c61 7267 6520 656e 6f75  s not large enou
+00001fd0: 6768 2074 6f20 636f 6e74 6169 6e20 6120  gh to contain a 
+00001fe0: 5a49 5036 340a 2020 2020 2020 2020 2320  ZIP64.        # 
+00001ff0: 656e 642d 6f66 2d61 7263 6869 7665 2072  end-of-archive r
+00002000: 6563 6f72 642c 2073 6f20 6a75 7374 2072  ecord, so just r
+00002010: 6574 7572 6e20 7468 6520 656e 6420 7265  eturn the end re
+00002020: 636f 7264 2077 6520 7765 7265 2067 6976  cord we were giv
+00002030: 656e 2e0a 2020 2020 2020 2020 7265 7475  en..        retu
+00002040: 726e 2065 6e64 7265 630a 0a20 2020 2064  rn endrec..    d
+00002050: 6174 6120 3d20 6670 696e 2e72 6561 6428  ata = fpin.read(
+00002060: 7369 7a65 456e 6443 656e 7444 6972 3634  sizeEndCentDir64
+00002070: 4c6f 6361 746f 7229 0a20 2020 2069 6620  Locator).    if 
+00002080: 6c65 6e28 6461 7461 2920 213d 2073 697a  len(data) != siz
+00002090: 6545 6e64 4365 6e74 4469 7236 344c 6f63  eEndCentDir64Loc
+000020a0: 6174 6f72 3a0a 2020 2020 2020 2020 7265  ator:.        re
+000020b0: 7475 726e 2065 6e64 7265 630a 2020 2020  turn endrec.    
+000020c0: 7369 672c 2064 6973 6b6e 6f2c 2072 656c  sig, diskno, rel
+000020d0: 6f66 662c 2064 6973 6b73 203d 2073 7472  off, disks = str
+000020e0: 7563 742e 756e 7061 636b 2873 7472 7563  uct.unpack(struc
+000020f0: 7445 6e64 4172 6368 6976 6536 344c 6f63  tEndArchive64Loc
+00002100: 6174 6f72 2c20 6461 7461 290a 2020 2020  ator, data).    
+00002110: 6966 2073 6967 2021 3d20 7374 7269 6e67  if sig != string
+00002120: 456e 6441 7263 6869 7665 3634 4c6f 6361  EndArchive64Loca
+00002130: 746f 723a 0a20 2020 2020 2020 2072 6574  tor:.        ret
+00002140: 7572 6e20 656e 6472 6563 0a0a 2020 2020  urn endrec..    
+00002150: 6966 2064 6973 6b6e 6f20 213d 2030 206f  if diskno != 0 o
+00002160: 7220 6469 736b 7320 3e20 313a 0a20 2020  r disks > 1:.   
+00002170: 2020 2020 2072 6169 7365 2042 6164 5a69       raise BadZi
+00002180: 7046 696c 6528 227a 6970 6669 6c65 7320  pFile("zipfiles 
+00002190: 7468 6174 2073 7061 6e20 6d75 6c74 6970  that span multip
+000021a0: 6c65 2064 6973 6b73 2061 7265 206e 6f74  le disks are not
+000021b0: 2073 7570 706f 7274 6564 2229 0a0a 2020   supported")..  
+000021c0: 2020 2320 4173 7375 6d65 206e 6f20 277a    # Assume no 'z
+000021d0: 6970 3634 2065 7874 656e 7369 626c 6520  ip64 extensible 
+000021e0: 6461 7461 270a 2020 2020 6670 696e 2e73  data'.    fpin.s
+000021f0: 6565 6b28 6f66 6673 6574 202d 2073 697a  eek(offset - siz
+00002200: 6545 6e64 4365 6e74 4469 7236 344c 6f63  eEndCentDir64Loc
+00002210: 6174 6f72 202d 2073 697a 6545 6e64 4365  ator - sizeEndCe
+00002220: 6e74 4469 7236 342c 2032 290a 2020 2020  ntDir64, 2).    
+00002230: 6461 7461 203d 2066 7069 6e2e 7265 6164  data = fpin.read
+00002240: 2873 697a 6545 6e64 4365 6e74 4469 7236  (sizeEndCentDir6
+00002250: 3429 0a20 2020 2069 6620 6c65 6e28 6461  4).    if len(da
+00002260: 7461 2920 213d 2073 697a 6545 6e64 4365  ta) != sizeEndCe
+00002270: 6e74 4469 7236 343a 0a20 2020 2020 2020  ntDir64:.       
+00002280: 2072 6574 7572 6e20 656e 6472 6563 0a20   return endrec. 
+00002290: 2020 2073 6967 2c20 737a 2c20 6372 6561     sig, sz, crea
+000022a0: 7465 5f76 6572 7369 6f6e 2c20 7265 6164  te_version, read
+000022b0: 5f76 6572 7369 6f6e 2c20 6469 736b 5f6e  _version, disk_n
+000022c0: 756d 2c20 6469 736b 5f64 6972 2c20 5c0a  um, disk_dir, \.
+000022d0: 2020 2020 2020 2020 6469 7263 6f75 6e74          dircount
+000022e0: 2c20 6469 7263 6f75 6e74 322c 2064 6972  , dircount2, dir
+000022f0: 7369 7a65 2c20 6469 726f 6666 7365 7420  size, diroffset 
+00002300: 3d20 5c0a 2020 2020 2020 2020 7374 7275  = \.        stru
+00002310: 6374 2e75 6e70 6163 6b28 7374 7275 6374  ct.unpack(struct
+00002320: 456e 6441 7263 6869 7665 3634 2c20 6461  EndArchive64, da
+00002330: 7461 290a 2020 2020 6966 2073 6967 2021  ta).    if sig !
+00002340: 3d20 7374 7269 6e67 456e 6441 7263 6869  = stringEndArchi
+00002350: 7665 3634 3a0a 2020 2020 2020 2020 7265  ve64:.        re
+00002360: 7475 726e 2065 6e64 7265 630a 0a20 2020  turn endrec..   
+00002370: 2023 2055 7064 6174 6520 7468 6520 6f72   # Update the or
+00002380: 6967 696e 616c 2065 6e64 7265 6320 7573  iginal endrec us
+00002390: 696e 6720 6461 7461 2066 726f 6d20 7468  ing data from th
+000023a0: 6520 5a49 5036 3420 7265 636f 7264 0a20  e ZIP64 record. 
+000023b0: 2020 2065 6e64 7265 635b 5f45 4344 5f53     endrec[_ECD_S
+000023c0: 4947 4e41 5455 5245 5d20 3d20 7369 670a  IGNATURE] = sig.
+000023d0: 2020 2020 656e 6472 6563 5b5f 4543 445f      endrec[_ECD_
+000023e0: 4449 534b 5f4e 554d 4245 525d 203d 2064  DISK_NUMBER] = d
+000023f0: 6973 6b5f 6e75 6d0a 2020 2020 656e 6472  isk_num.    endr
+00002400: 6563 5b5f 4543 445f 4449 534b 5f53 5441  ec[_ECD_DISK_STA
+00002410: 5254 5d20 3d20 6469 736b 5f64 6972 0a20  RT] = disk_dir. 
+00002420: 2020 2065 6e64 7265 635b 5f45 4344 5f45     endrec[_ECD_E
+00002430: 4e54 5249 4553 5f54 4849 535f 4449 534b  NTRIES_THIS_DISK
+00002440: 5d20 3d20 6469 7263 6f75 6e74 0a20 2020  ] = dircount.   
+00002450: 2065 6e64 7265 635b 5f45 4344 5f45 4e54   endrec[_ECD_ENT
+00002460: 5249 4553 5f54 4f54 414c 5d20 3d20 6469  RIES_TOTAL] = di
+00002470: 7263 6f75 6e74 320a 2020 2020 656e 6472  rcount2.    endr
+00002480: 6563 5b5f 4543 445f 5349 5a45 5d20 3d20  ec[_ECD_SIZE] = 
+00002490: 6469 7273 697a 650a 2020 2020 656e 6472  dirsize.    endr
+000024a0: 6563 5b5f 4543 445f 4f46 4653 4554 5d20  ec[_ECD_OFFSET] 
+000024b0: 3d20 6469 726f 6666 7365 740a 2020 2020  = diroffset.    
+000024c0: 7265 7475 726e 2065 6e64 7265 630a 0a0a  return endrec...
+000024d0: 6465 6620 5f45 6e64 5265 6344 6174 6128  def _EndRecData(
+000024e0: 6670 696e 293a 0a20 2020 2022 2222 5265  fpin):.    """Re
+000024f0: 7475 726e 2064 6174 6120 6672 6f6d 2074  turn data from t
+00002500: 6865 2022 456e 6420 6f66 2043 656e 7472  he "End of Centr
+00002510: 616c 2044 6972 6563 746f 7279 2220 7265  al Directory" re
+00002520: 636f 7264 2c20 6f72 204e 6f6e 652e 0a0a  cord, or None...
+00002530: 2020 2020 5468 6520 6461 7461 2069 7320      The data is 
+00002540: 6120 6c69 7374 206f 6620 7468 6520 6e69  a list of the ni
+00002550: 6e65 2069 7465 6d73 2069 6e20 7468 6520  ne items in the 
+00002560: 5a49 5020 2245 6e64 206f 6620 6365 6e74  ZIP "End of cent
+00002570: 7261 6c20 6469 7222 0a20 2020 2072 6563  ral dir".    rec
+00002580: 6f72 6420 666f 6c6c 6f77 6564 2062 7920  ord followed by 
+00002590: 6120 7465 6e74 6820 6974 656d 2c20 7468  a tenth item, th
+000025a0: 6520 6669 6c65 2073 6565 6b20 6f66 6673  e file seek offs
+000025b0: 6574 206f 6620 7468 6973 2072 6563 6f72  et of this recor
+000025c0: 642e 2222 220a 0a20 2020 2023 2044 6574  d."""..    # Det
+000025d0: 6572 6d69 6e65 2066 696c 6520 7369 7a65  ermine file size
+000025e0: 0a20 2020 2066 7069 6e2e 7365 656b 2830  .    fpin.seek(0
+000025f0: 2c20 3229 0a20 2020 2066 696c 6573 697a  , 2).    filesiz
+00002600: 6520 3d20 6670 696e 2e74 656c 6c28 290a  e = fpin.tell().
+00002610: 0a20 2020 2023 2043 6865 636b 2074 6f20  .    # Check to 
+00002620: 7365 6520 6966 2074 6869 7320 6973 205a  see if this is Z
+00002630: 4950 2066 696c 6520 7769 7468 206e 6f20  IP file with no 
+00002640: 6172 6368 6976 6520 636f 6d6d 656e 7420  archive comment 
+00002650: 2874 6865 0a20 2020 2023 2022 656e 6420  (the.    # "end 
+00002660: 6f66 2063 656e 7472 616c 2064 6972 6563  of central direc
+00002670: 746f 7279 2220 7374 7275 6374 7572 6520  tory" structure 
+00002680: 7368 6f75 6c64 2062 6520 7468 6520 6c61  should be the la
+00002690: 7374 2069 7465 6d20 696e 2074 6865 0a20  st item in the. 
+000026a0: 2020 2023 2066 696c 6520 6966 2074 6869     # file if thi
+000026b0: 7320 6973 2074 6865 2063 6173 6529 2e0a  s is the case)..
+000026c0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+000026d0: 2066 7069 6e2e 7365 656b 282d 7369 7a65   fpin.seek(-size
+000026e0: 456e 6443 656e 7444 6972 2c20 3229 0a20  EndCentDir, 2). 
+000026f0: 2020 2065 7863 6570 7420 4f53 4572 726f     except OSErro
+00002700: 723a 0a20 2020 2020 2020 2072 6574 7572  r:.        retur
+00002710: 6e20 4e6f 6e65 0a20 2020 2064 6174 6120  n None.    data 
+00002720: 3d20 6670 696e 2e72 6561 6428 290a 2020  = fpin.read().  
+00002730: 2020 6966 2028 6c65 6e28 6461 7461 2920    if (len(data) 
+00002740: 3d3d 2073 697a 6545 6e64 4365 6e74 4469  == sizeEndCentDi
+00002750: 7220 616e 640a 2020 2020 2020 2020 6461  r and.        da
+00002760: 7461 5b30 3a34 5d20 3d3d 2073 7472 696e  ta[0:4] == strin
+00002770: 6745 6e64 4172 6368 6976 6520 616e 640a  gEndArchive and.
+00002780: 2020 2020 2020 2020 6461 7461 5b2d 323a          data[-2:
+00002790: 5d20 3d3d 2062 225c 3030 305c 3030 3022  ] == b"\000\000"
+000027a0: 293a 0a20 2020 2020 2020 2023 2074 6865  ):.        # the
+000027b0: 2073 6967 6e61 7475 7265 2069 7320 636f   signature is co
+000027c0: 7272 6563 7420 616e 6420 7468 6572 6527  rrect and there'
+000027d0: 7320 6e6f 2063 6f6d 6d65 6e74 2c20 756e  s no comment, un
+000027e0: 7061 636b 2073 7472 7563 7475 7265 0a20  pack structure. 
+000027f0: 2020 2020 2020 2065 6e64 7265 6320 3d20         endrec = 
+00002800: 7374 7275 6374 2e75 6e70 6163 6b28 7374  struct.unpack(st
+00002810: 7275 6374 456e 6441 7263 6869 7665 2c20  ructEndArchive, 
+00002820: 6461 7461 290a 2020 2020 2020 2020 656e  data).        en
+00002830: 6472 6563 3d6c 6973 7428 656e 6472 6563  drec=list(endrec
+00002840: 290a 0a20 2020 2020 2020 2023 2041 7070  )..        # App
+00002850: 656e 6420 6120 626c 616e 6b20 636f 6d6d  end a blank comm
+00002860: 656e 7420 616e 6420 7265 636f 7264 2073  ent and record s
+00002870: 7461 7274 206f 6666 7365 740a 2020 2020  tart offset.    
+00002880: 2020 2020 656e 6472 6563 2e61 7070 656e      endrec.appen
+00002890: 6428 6222 2229 0a20 2020 2020 2020 2065  d(b"").        e
+000028a0: 6e64 7265 632e 6170 7065 6e64 2866 696c  ndrec.append(fil
+000028b0: 6573 697a 6520 2d20 7369 7a65 456e 6443  esize - sizeEndC
+000028c0: 656e 7444 6972 290a 0a20 2020 2020 2020  entDir)..       
+000028d0: 2023 2054 7279 2074 6f20 7265 6164 2074   # Try to read t
+000028e0: 6865 2022 5a69 7036 3420 656e 6420 6f66  he "Zip64 end of
+000028f0: 2063 656e 7472 616c 2064 6972 6563 746f   central directo
+00002900: 7279 2220 7374 7275 6374 7572 650a 2020  ry" structure.  
+00002910: 2020 2020 2020 7265 7475 726e 205f 456e        return _En
+00002920: 6452 6563 4461 7461 3634 2866 7069 6e2c  dRecData64(fpin,
+00002930: 202d 7369 7a65 456e 6443 656e 7444 6972   -sizeEndCentDir
+00002940: 2c20 656e 6472 6563 290a 0a20 2020 2023  , endrec)..    #
+00002950: 2045 6974 6865 7220 7468 6973 2069 7320   Either this is 
+00002960: 6e6f 7420 6120 5a49 5020 6669 6c65 2c20  not a ZIP file, 
+00002970: 6f72 2069 7420 6973 2061 205a 4950 2066  or it is a ZIP f
+00002980: 696c 6520 7769 7468 2061 6e20 6172 6368  ile with an arch
+00002990: 6976 650a 2020 2020 2320 636f 6d6d 656e  ive.    # commen
+000029a0: 742e 2020 5365 6172 6368 2074 6865 2065  t.  Search the e
+000029b0: 6e64 206f 6620 7468 6520 6669 6c65 2066  nd of the file f
+000029c0: 6f72 2074 6865 2022 656e 6420 6f66 2063  or the "end of c
+000029d0: 656e 7472 616c 2064 6972 6563 746f 7279  entral directory
+000029e0: 220a 2020 2020 2320 7265 636f 7264 2073  ".    # record s
+000029f0: 6967 6e61 7475 7265 2e20 5468 6520 636f  ignature. The co
+00002a00: 6d6d 656e 7420 6973 2074 6865 206c 6173  mment is the las
+00002a10: 7420 6974 656d 2069 6e20 7468 6520 5a49  t item in the ZI
+00002a20: 5020 6669 6c65 2061 6e64 206d 6179 2062  P file and may b
+00002a30: 650a 2020 2020 2320 7570 2074 6f20 3634  e.    # up to 64
+00002a40: 4b20 6c6f 6e67 2e20 2049 7420 6973 2061  K long.  It is a
+00002a50: 7373 756d 6564 2074 6861 7420 7468 6520  ssumed that the 
+00002a60: 2265 6e64 206f 6620 6365 6e74 7261 6c20  "end of central 
+00002a70: 6469 7265 6374 6f72 7922 206d 6167 6963  directory" magic
+00002a80: 0a20 2020 2023 206e 756d 6265 7220 646f  .    # number do
+00002a90: 6573 206e 6f74 2061 7070 6561 7220 696e  es not appear in
+00002aa0: 2074 6865 2063 6f6d 6d65 6e74 2e0a 2020   the comment..  
+00002ab0: 2020 6d61 7843 6f6d 6d65 6e74 5374 6172    maxCommentStar
+00002ac0: 7420 3d20 6d61 7828 6669 6c65 7369 7a65  t = max(filesize
+00002ad0: 202d 2028 3120 3c3c 2031 3629 202d 2073   - (1 << 16) - s
+00002ae0: 697a 6545 6e64 4365 6e74 4469 722c 2030  izeEndCentDir, 0
+00002af0: 290a 2020 2020 6670 696e 2e73 6565 6b28  ).    fpin.seek(
+00002b00: 6d61 7843 6f6d 6d65 6e74 5374 6172 742c  maxCommentStart,
+00002b10: 2030 290a 2020 2020 6461 7461 203d 2066   0).    data = f
+00002b20: 7069 6e2e 7265 6164 2829 0a20 2020 2073  pin.read().    s
+00002b30: 7461 7274 203d 2064 6174 612e 7266 696e  tart = data.rfin
+00002b40: 6428 7374 7269 6e67 456e 6441 7263 6869  d(stringEndArchi
+00002b50: 7665 290a 2020 2020 6966 2073 7461 7274  ve).    if start
+00002b60: 203e 3d20 303a 0a20 2020 2020 2020 2023   >= 0:.        #
+00002b70: 2066 6f75 6e64 2074 6865 206d 6167 6963   found the magic
+00002b80: 206e 756d 6265 723b 2061 7474 656d 7074   number; attempt
+00002b90: 2074 6f20 756e 7061 636b 2061 6e64 2069   to unpack and i
+00002ba0: 6e74 6572 7072 6574 0a20 2020 2020 2020  nterpret.       
+00002bb0: 2072 6563 4461 7461 203d 2064 6174 615b   recData = data[
+00002bc0: 7374 6172 743a 7374 6172 742b 7369 7a65  start:start+size
+00002bd0: 456e 6443 656e 7444 6972 5d0a 2020 2020  EndCentDir].    
+00002be0: 2020 2020 6966 206c 656e 2872 6563 4461      if len(recDa
+00002bf0: 7461 2920 213d 2073 697a 6545 6e64 4365  ta) != sizeEndCe
+00002c00: 6e74 4469 723a 0a20 2020 2020 2020 2020  ntDir:.         
+00002c10: 2020 2023 205a 6970 2066 696c 6520 6973     # Zip file is
+00002c20: 2063 6f72 7275 7074 6564 2e0a 2020 2020   corrupted..    
+00002c30: 2020 2020 2020 2020 7265 7475 726e 204e          return N
+00002c40: 6f6e 650a 2020 2020 2020 2020 656e 6472  one.        endr
+00002c50: 6563 203d 206c 6973 7428 7374 7275 6374  ec = list(struct
+00002c60: 2e75 6e70 6163 6b28 7374 7275 6374 456e  .unpack(structEn
+00002c70: 6441 7263 6869 7665 2c20 7265 6344 6174  dArchive, recDat
+00002c80: 6129 290a 2020 2020 2020 2020 636f 6d6d  a)).        comm
+00002c90: 656e 7453 697a 6520 3d20 656e 6472 6563  entSize = endrec
+00002ca0: 5b5f 4543 445f 434f 4d4d 454e 545f 5349  [_ECD_COMMENT_SI
+00002cb0: 5a45 5d20 2361 7320 636c 6169 6d65 6420  ZE] #as claimed 
+00002cc0: 6279 2074 6865 207a 6970 2066 696c 650a  by the zip file.
+00002cd0: 2020 2020 2020 2020 636f 6d6d 656e 7420          comment 
+00002ce0: 3d20 6461 7461 5b73 7461 7274 2b73 697a  = data[start+siz
+00002cf0: 6545 6e64 4365 6e74 4469 723a 7374 6172  eEndCentDir:star
+00002d00: 742b 7369 7a65 456e 6443 656e 7444 6972  t+sizeEndCentDir
+00002d10: 2b63 6f6d 6d65 6e74 5369 7a65 5d0a 2020  +commentSize].  
+00002d20: 2020 2020 2020 656e 6472 6563 2e61 7070        endrec.app
+00002d30: 656e 6428 636f 6d6d 656e 7429 0a20 2020  end(comment).   
+00002d40: 2020 2020 2065 6e64 7265 632e 6170 7065       endrec.appe
+00002d50: 6e64 286d 6178 436f 6d6d 656e 7453 7461  nd(maxCommentSta
+00002d60: 7274 202b 2073 7461 7274 290a 0a20 2020  rt + start)..   
+00002d70: 2020 2020 2023 2054 7279 2074 6f20 7265       # Try to re
+00002d80: 6164 2074 6865 2022 5a69 7036 3420 656e  ad the "Zip64 en
+00002d90: 6420 6f66 2063 656e 7472 616c 2064 6972  d of central dir
+00002da0: 6563 746f 7279 2220 7374 7275 6374 7572  ectory" structur
+00002db0: 650a 2020 2020 2020 2020 7265 7475 726e  e.        return
+00002dc0: 205f 456e 6452 6563 4461 7461 3634 2866   _EndRecData64(f
+00002dd0: 7069 6e2c 206d 6178 436f 6d6d 656e 7453  pin, maxCommentS
+00002de0: 7461 7274 202b 2073 7461 7274 202d 2066  tart + start - f
+00002df0: 696c 6573 697a 652c 0a20 2020 2020 2020  ilesize,.       
+00002e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002e10: 2020 2020 2020 656e 6472 6563 290a 0a20        endrec).. 
+00002e20: 2020 2023 2055 6e61 626c 6520 746f 2066     # Unable to f
+00002e30: 696e 6420 6120 7661 6c69 6420 656e 6420  ind a valid end 
+00002e40: 6f66 2063 656e 7472 616c 2064 6972 6563  of central direc
+00002e50: 746f 7279 2073 7472 7563 7475 7265 0a20  tory structure. 
+00002e60: 2020 2072 6574 7572 6e20 4e6f 6e65 0a0a     return None..
+00002e70: 0a63 6c61 7373 205a 6970 496e 666f 2028  .class ZipInfo (
+00002e80: 6f62 6a65 6374 293a 0a20 2020 2022 2222  object):.    """
+00002e90: 436c 6173 7320 7769 7468 2061 7474 7269  Class with attri
+00002ea0: 6275 7465 7320 6465 7363 7269 6269 6e67  butes describing
+00002eb0: 2065 6163 6820 6669 6c65 2069 6e20 7468   each file in th
+00002ec0: 6520 5a49 5020 6172 6368 6976 652e 2222  e ZIP archive.""
+00002ed0: 220a 0a20 2020 205f 5f73 6c6f 7473 5f5f  "..    __slots__
+00002ee0: 203d 2028 0a20 2020 2020 2020 2027 6f72   = (.        'or
+00002ef0: 6967 5f66 696c 656e 616d 6527 2c0a 2020  ig_filename',.  
+00002f00: 2020 2020 2020 2766 696c 656e 616d 6527        'filename'
+00002f10: 2c0a 2020 2020 2020 2020 2764 6174 655f  ,.        'date_
+00002f20: 7469 6d65 272c 0a20 2020 2020 2020 2027  time',.        '
+00002f30: 636f 6d70 7265 7373 5f74 7970 6527 2c0a  compress_type',.
+00002f40: 2020 2020 2020 2020 275f 636f 6d70 7265          '_compre
+00002f50: 7373 6c65 7665 6c27 2c0a 2020 2020 2020  sslevel',.      
+00002f60: 2020 2763 6f6d 6d65 6e74 272c 0a20 2020    'comment',.   
+00002f70: 2020 2020 2027 6578 7472 6127 2c0a 2020       'extra',.  
+00002f80: 2020 2020 2020 2763 7265 6174 655f 7379        'create_sy
+00002f90: 7374 656d 272c 0a20 2020 2020 2020 2027  stem',.        '
+00002fa0: 6372 6561 7465 5f76 6572 7369 6f6e 272c  create_version',
+00002fb0: 0a20 2020 2020 2020 2027 6578 7472 6163  .        'extrac
+00002fc0: 745f 7665 7273 696f 6e27 2c0a 2020 2020  t_version',.    
+00002fd0: 2020 2020 2772 6573 6572 7665 6427 2c0a      'reserved',.
+00002fe0: 2020 2020 2020 2020 2766 6c61 675f 6269          'flag_bi
+00002ff0: 7473 272c 0a20 2020 2020 2020 2027 766f  ts',.        'vo
+00003000: 6c75 6d65 272c 0a20 2020 2020 2020 2027  lume',.        '
+00003010: 696e 7465 726e 616c 5f61 7474 7227 2c0a  internal_attr',.
+00003020: 2020 2020 2020 2020 2765 7874 6572 6e61          'externa
+00003030: 6c5f 6174 7472 272c 0a20 2020 2020 2020  l_attr',.       
+00003040: 2027 6865 6164 6572 5f6f 6666 7365 7427   'header_offset'
+00003050: 2c0a 2020 2020 2020 2020 2743 5243 272c  ,.        'CRC',
+00003060: 0a20 2020 2020 2020 2027 636f 6d70 7265  .        'compre
+00003070: 7373 5f73 697a 6527 2c0a 2020 2020 2020  ss_size',.      
+00003080: 2020 2766 696c 655f 7369 7a65 272c 0a20    'file_size',. 
+00003090: 2020 2020 2020 2027 5f72 6177 5f74 696d         '_raw_tim
+000030a0: 6527 2c0a 2020 2020 290a 0a20 2020 2064  e',.    )..    d
+000030b0: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
+000030c0: 2c20 6669 6c65 6e61 6d65 3d22 4e6f 4e61  , filename="NoNa
+000030d0: 6d65 222c 2064 6174 655f 7469 6d65 3d28  me", date_time=(
+000030e0: 3139 3830 2c31 2c31 2c30 2c30 2c30 2929  1980,1,1,0,0,0))
+000030f0: 3a0a 2020 2020 2020 2020 7365 6c66 2e6f  :.        self.o
+00003100: 7269 675f 6669 6c65 6e61 6d65 203d 2066  rig_filename = f
+00003110: 696c 656e 616d 6520 2020 2320 4f72 6967  ilename   # Orig
+00003120: 696e 616c 2066 696c 6520 6e61 6d65 2069  inal file name i
+00003130: 6e20 6172 6368 6976 650a 0a20 2020 2020  n archive..     
+00003140: 2020 2023 2054 6572 6d69 6e61 7465 2074     # Terminate t
+00003150: 6865 2066 696c 6520 6e61 6d65 2061 7420  he file name at 
+00003160: 7468 6520 6669 7273 7420 6e75 6c6c 2062  the first null b
+00003170: 7974 652e 2020 4e75 6c6c 2062 7974 6573  yte.  Null bytes
+00003180: 2069 6e20 6669 6c65 0a20 2020 2020 2020   in file.       
+00003190: 2023 206e 616d 6573 2061 7265 2075 7365   # names are use
+000031a0: 6420 6173 2074 7269 636b 7320 6279 2076  d as tricks by v
+000031b0: 6972 7573 6573 2069 6e20 6172 6368 6976  iruses in archiv
+000031c0: 6573 2e0a 2020 2020 2020 2020 6e75 6c6c  es..        null
+000031d0: 5f62 7974 6520 3d20 6669 6c65 6e61 6d65  _byte = filename
+000031e0: 2e66 696e 6428 6368 7228 3029 290a 2020  .find(chr(0)).  
+000031f0: 2020 2020 2020 6966 206e 756c 6c5f 6279        if null_by
+00003200: 7465 203e 3d20 303a 0a20 2020 2020 2020  te >= 0:.       
+00003210: 2020 2020 2066 696c 656e 616d 6520 3d20       filename = 
+00003220: 6669 6c65 6e61 6d65 5b30 3a6e 756c 6c5f  filename[0:null_
+00003230: 6279 7465 5d0a 2020 2020 2020 2020 2320  byte].        # 
+00003240: 5468 6973 2069 7320 7573 6564 2074 6f20  This is used to 
+00003250: 656e 7375 7265 2070 6174 6873 2069 6e20  ensure paths in 
+00003260: 6765 6e65 7261 7465 6420 5a49 5020 6669  generated ZIP fi
+00003270: 6c65 7320 616c 7761 7973 2075 7365 0a20  les always use. 
+00003280: 2020 2020 2020 2023 2066 6f72 7761 7264         # forward
+00003290: 2073 6c61 7368 6573 2061 7320 7468 6520   slashes as the 
+000032a0: 6469 7265 6374 6f72 7920 7365 7061 7261  directory separa
+000032b0: 746f 722c 2061 7320 7265 7175 6972 6564  tor, as required
+000032c0: 2062 7920 7468 650a 2020 2020 2020 2020   by the.        
+000032d0: 2320 5a49 5020 666f 726d 6174 2073 7065  # ZIP format spe
+000032e0: 6369 6669 6361 7469 6f6e 2e0a 2020 2020  cification..    
+000032f0: 2020 2020 6966 206f 732e 7365 7020 213d      if os.sep !=
+00003300: 2022 2f22 2061 6e64 206f 732e 7365 7020   "/" and os.sep 
+00003310: 696e 2066 696c 656e 616d 653a 0a20 2020  in filename:.   
+00003320: 2020 2020 2020 2020 2066 696c 656e 616d           filenam
+00003330: 6520 3d20 6669 6c65 6e61 6d65 2e72 6570  e = filename.rep
+00003340: 6c61 6365 286f 732e 7365 702c 2022 2f22  lace(os.sep, "/"
+00003350: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00003360: 6669 6c65 6e61 6d65 203d 2066 696c 656e  filename = filen
+00003370: 616d 6520 2020 2020 2020 2023 204e 6f72  ame        # Nor
+00003380: 6d61 6c69 7a65 6420 6669 6c65 206e 616d  malized file nam
+00003390: 650a 2020 2020 2020 2020 7365 6c66 2e64  e.        self.d
+000033a0: 6174 655f 7469 6d65 203d 2064 6174 655f  ate_time = date_
+000033b0: 7469 6d65 2020 2020 2020 2320 7965 6172  time      # year
+000033c0: 2c20 6d6f 6e74 682c 2064 6179 2c20 686f  , month, day, ho
+000033d0: 7572 2c20 6d69 6e2c 2073 6563 0a0a 2020  ur, min, sec..  
+000033e0: 2020 2020 2020 6966 2064 6174 655f 7469        if date_ti
+000033f0: 6d65 5b30 5d20 3c20 3139 3830 3a0a 2020  me[0] < 1980:.  
+00003400: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00003410: 5661 6c75 6545 7272 6f72 2827 5a49 5020  ValueError('ZIP 
+00003420: 646f 6573 206e 6f74 2073 7570 706f 7274  does not support
+00003430: 2074 696d 6573 7461 6d70 7320 6265 666f   timestamps befo
+00003440: 7265 2031 3938 3027 290a 0a20 2020 2020  re 1980')..     
+00003450: 2020 2023 2053 7461 6e64 6172 6420 7661     # Standard va
+00003460: 6c75 6573 3a0a 2020 2020 2020 2020 7365  lues:.        se
+00003470: 6c66 2e63 6f6d 7072 6573 735f 7479 7065  lf.compress_type
+00003480: 203d 205a 4950 5f53 544f 5245 4420 2320   = ZIP_STORED # 
+00003490: 5479 7065 206f 6620 636f 6d70 7265 7373  Type of compress
+000034a0: 696f 6e20 666f 7220 7468 6520 6669 6c65  ion for the file
+000034b0: 0a20 2020 2020 2020 2073 656c 662e 5f63  .        self._c
+000034c0: 6f6d 7072 6573 736c 6576 656c 203d 204e  ompresslevel = N
+000034d0: 6f6e 6520 2020 2020 2023 204c 6576 656c  one      # Level
+000034e0: 2066 6f72 2074 6865 2063 6f6d 7072 6573   for the compres
+000034f0: 736f 720a 2020 2020 2020 2020 7365 6c66  sor.        self
+00003500: 2e63 6f6d 6d65 6e74 203d 2062 2222 2020  .comment = b""  
+00003510: 2020 2020 2020 2020 2020 2020 2320 436f              # Co
+00003520: 6d6d 656e 7420 666f 7220 6561 6368 2066  mment for each f
+00003530: 696c 650a 2020 2020 2020 2020 7365 6c66  ile.        self
+00003540: 2e65 7874 7261 203d 2062 2222 2020 2020  .extra = b""    
+00003550: 2020 2020 2020 2020 2020 2020 2320 5a49              # ZI
+00003560: 5020 6578 7472 6120 6461 7461 0a20 2020  P extra data.   
+00003570: 2020 2020 2069 6620 7379 732e 706c 6174       if sys.plat
+00003580: 666f 726d 203d 3d20 2777 696e 3332 273a  form == 'win32':
+00003590: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000035a0: 662e 6372 6561 7465 5f73 7973 7465 6d20  f.create_system 
+000035b0: 3d20 3020 2020 2020 2020 2020 2023 2053  = 0          # S
+000035c0: 7973 7465 6d20 7768 6963 6820 6372 6561  ystem which crea
+000035d0: 7465 6420 5a49 5020 6172 6368 6976 650a  ted ZIP archive.
+000035e0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+000035f0: 2020 2020 2020 2020 2020 2320 4173 7375            # Assu
+00003600: 6d65 2065 7665 7279 7468 696e 6720 656c  me everything el
+00003610: 7365 2069 7320 756e 6978 2d79 0a20 2020  se is unix-y.   
+00003620: 2020 2020 2020 2020 2073 656c 662e 6372           self.cr
+00003630: 6561 7465 5f73 7973 7465 6d20 3d20 3320  eate_system = 3 
+00003640: 2020 2020 2020 2020 2023 2053 7973 7465           # Syste
+00003650: 6d20 7768 6963 6820 6372 6561 7465 6420  m which created 
+00003660: 5a49 5020 6172 6368 6976 650a 2020 2020  ZIP archive.    
+00003670: 2020 2020 7365 6c66 2e63 7265 6174 655f      self.create_
+00003680: 7665 7273 696f 6e20 3d20 4445 4641 554c  version = DEFAUL
+00003690: 545f 5645 5253 494f 4e20 2023 2056 6572  T_VERSION  # Ver
+000036a0: 7369 6f6e 2077 6869 6368 2063 7265 6174  sion which creat
+000036b0: 6564 205a 4950 2061 7263 6869 7665 0a20  ed ZIP archive. 
+000036c0: 2020 2020 2020 2073 656c 662e 6578 7472         self.extr
+000036d0: 6163 745f 7665 7273 696f 6e20 3d20 4445  act_version = DE
+000036e0: 4641 554c 545f 5645 5253 494f 4e20 2320  FAULT_VERSION # 
+000036f0: 5665 7273 696f 6e20 6e65 6564 6564 2074  Version needed t
+00003700: 6f20 6578 7472 6163 7420 6172 6368 6976  o extract archiv
+00003710: 650a 2020 2020 2020 2020 7365 6c66 2e72  e.        self.r
+00003720: 6573 6572 7665 6420 3d20 3020 2020 2020  eserved = 0     
+00003730: 2020 2020 2020 2020 2020 2320 4d75 7374            # Must
+00003740: 2062 6520 7a65 726f 0a20 2020 2020 2020   be zero.       
+00003750: 2073 656c 662e 666c 6167 5f62 6974 7320   self.flag_bits 
+00003760: 3d20 3020 2020 2020 2020 2020 2020 2020  = 0             
+00003770: 2023 205a 4950 2066 6c61 6720 6269 7473   # ZIP flag bits
+00003780: 0a20 2020 2020 2020 2073 656c 662e 766f  .        self.vo
+00003790: 6c75 6d65 203d 2030 2020 2020 2020 2020  lume = 0        
+000037a0: 2020 2020 2020 2020 2023 2056 6f6c 756d           # Volum
+000037b0: 6520 6e75 6d62 6572 206f 6620 6669 6c65  e number of file
+000037c0: 2068 6561 6465 720a 2020 2020 2020 2020   header.        
+000037d0: 7365 6c66 2e69 6e74 6572 6e61 6c5f 6174  self.internal_at
+000037e0: 7472 203d 2030 2020 2020 2020 2020 2020  tr = 0          
+000037f0: 2320 496e 7465 726e 616c 2061 7474 7269  # Internal attri
+00003800: 6275 7465 730a 2020 2020 2020 2020 7365  butes.        se
+00003810: 6c66 2e65 7874 6572 6e61 6c5f 6174 7472  lf.external_attr
+00003820: 203d 2030 2020 2020 2020 2020 2020 2320   = 0          # 
+00003830: 4578 7465 726e 616c 2066 696c 6520 6174  External file at
+00003840: 7472 6962 7574 6573 0a20 2020 2020 2020  tributes.       
+00003850: 2073 656c 662e 636f 6d70 7265 7373 5f73   self.compress_s
+00003860: 697a 6520 3d20 3020 2020 2020 2020 2020  ize = 0         
+00003870: 2023 2053 697a 6520 6f66 2074 6865 2063   # Size of the c
+00003880: 6f6d 7072 6573 7365 6420 6669 6c65 0a20  ompressed file. 
+00003890: 2020 2020 2020 2073 656c 662e 6669 6c65         self.file
+000038a0: 5f73 697a 6520 3d20 3020 2020 2020 2020  _size = 0       
+000038b0: 2020 2020 2020 2023 2053 697a 6520 6f66         # Size of
+000038c0: 2074 6865 2075 6e63 6f6d 7072 6573 7365   the uncompresse
+000038d0: 6420 6669 6c65 0a20 2020 2020 2020 2023  d file.        #
+000038e0: 204f 7468 6572 2061 7474 7269 6275 7465   Other attribute
+000038f0: 7320 6172 6520 7365 7420 6279 2063 6c61  s are set by cla
+00003900: 7373 205a 6970 4669 6c65 3a0a 2020 2020  ss ZipFile:.    
+00003910: 2020 2020 2320 6865 6164 6572 5f6f 6666      # header_off
+00003920: 7365 7420 2020 2020 2020 2020 4279 7465  set         Byte
+00003930: 206f 6666 7365 7420 746f 2074 6865 2066   offset to the f
+00003940: 696c 6520 6865 6164 6572 0a20 2020 2020  ile header.     
+00003950: 2020 2023 2043 5243 2020 2020 2020 2020     # CRC        
+00003960: 2020 2020 2020 2020 2020 2043 5243 2d33             CRC-3
+00003970: 3220 6f66 2074 6865 2075 6e63 6f6d 7072  2 of the uncompr
+00003980: 6573 7365 6420 6669 6c65 0a0a 2020 2020  essed file..    
+00003990: 6465 6620 5f5f 7265 7072 5f5f 2873 656c  def __repr__(sel
+000039a0: 6629 3a0a 2020 2020 2020 2020 7265 7375  f):.        resu
+000039b0: 6c74 203d 205b 273c 2573 2066 696c 656e  lt = ['<%s filen
+000039c0: 616d 653d 2572 2720 2520 2873 656c 662e  ame=%r' % (self.
+000039d0: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
+000039e0: 5f5f 2c20 7365 6c66 2e66 696c 656e 616d  __, self.filenam
+000039f0: 6529 5d0a 2020 2020 2020 2020 6966 2073  e)].        if s
+00003a00: 656c 662e 636f 6d70 7265 7373 5f74 7970  elf.compress_typ
+00003a10: 6520 213d 205a 4950 5f53 544f 5245 443a  e != ZIP_STORED:
+00003a20: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+00003a30: 756c 742e 6170 7065 6e64 2827 2063 6f6d  ult.append(' com
+00003a40: 7072 6573 735f 7479 7065 3d25 7327 2025  press_type=%s' %
+00003a50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003a60: 2020 2020 2020 2020 2020 2063 6f6d 7072             compr
+00003a70: 6573 736f 725f 6e61 6d65 732e 6765 7428  essor_names.get(
+00003a80: 7365 6c66 2e63 6f6d 7072 6573 735f 7479  self.compress_ty
+00003a90: 7065 2c0a 2020 2020 2020 2020 2020 2020  pe,.            
+00003aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003ac0: 2020 2073 656c 662e 636f 6d70 7265 7373     self.compress
+00003ad0: 5f74 7970 6529 290a 2020 2020 2020 2020  _type)).        
+00003ae0: 6869 203d 2073 656c 662e 6578 7465 726e  hi = self.extern
+00003af0: 616c 5f61 7474 7220 3e3e 2031 360a 2020  al_attr >> 16.  
+00003b00: 2020 2020 2020 6c6f 203d 2073 656c 662e        lo = self.
+00003b10: 6578 7465 726e 616c 5f61 7474 7220 2620  external_attr & 
+00003b20: 3078 4646 4646 0a20 2020 2020 2020 2069  0xFFFF.        i
+00003b30: 6620 6869 3a0a 2020 2020 2020 2020 2020  f hi:.          
+00003b40: 2020 7265 7375 6c74 2e61 7070 656e 6428    result.append(
+00003b50: 2720 6669 6c65 6d6f 6465 3d25 7227 2025  ' filemode=%r' %
+00003b60: 2073 7461 742e 6669 6c65 6d6f 6465 2868   stat.filemode(h
+00003b70: 6929 290a 2020 2020 2020 2020 6966 206c  i)).        if l
+00003b80: 6f3a 0a20 2020 2020 2020 2020 2020 2072  o:.            r
+00003b90: 6573 756c 742e 6170 7065 6e64 2827 2065  esult.append(' e
+00003ba0: 7874 6572 6e61 6c5f 6174 7472 3d25 2378  xternal_attr=%#x
+00003bb0: 2720 2520 6c6f 290a 2020 2020 2020 2020  ' % lo).        
+00003bc0: 6973 6469 7220 3d20 7365 6c66 2e69 735f  isdir = self.is_
+00003bd0: 6469 7228 290a 2020 2020 2020 2020 6966  dir().        if
+00003be0: 206e 6f74 2069 7364 6972 206f 7220 7365   not isdir or se
+00003bf0: 6c66 2e66 696c 655f 7369 7a65 3a0a 2020  lf.file_size:.  
+00003c00: 2020 2020 2020 2020 2020 7265 7375 6c74            result
+00003c10: 2e61 7070 656e 6428 2720 6669 6c65 5f73  .append(' file_s
+00003c20: 697a 653d 2572 2720 2520 7365 6c66 2e66  ize=%r' % self.f
+00003c30: 696c 655f 7369 7a65 290a 2020 2020 2020  ile_size).      
+00003c40: 2020 6966 2028 286e 6f74 2069 7364 6972    if ((not isdir
+00003c50: 206f 7220 7365 6c66 2e63 6f6d 7072 6573   or self.compres
+00003c60: 735f 7369 7a65 2920 616e 640a 2020 2020  s_size) and.    
+00003c70: 2020 2020 2020 2020 2873 656c 662e 636f          (self.co
+00003c80: 6d70 7265 7373 5f74 7970 6520 213d 205a  mpress_type != Z
+00003c90: 4950 5f53 544f 5245 4420 6f72 0a20 2020  IP_STORED or.   
+00003ca0: 2020 2020 2020 2020 2020 7365 6c66 2e66            self.f
+00003cb0: 696c 655f 7369 7a65 2021 3d20 7365 6c66  ile_size != self
+00003cc0: 2e63 6f6d 7072 6573 735f 7369 7a65 2929  .compress_size))
+00003cd0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00003ce0: 7375 6c74 2e61 7070 656e 6428 2720 636f  sult.append(' co
+00003cf0: 6d70 7265 7373 5f73 697a 653d 2572 2720  mpress_size=%r' 
+00003d00: 2520 7365 6c66 2e63 6f6d 7072 6573 735f  % self.compress_
+00003d10: 7369 7a65 290a 2020 2020 2020 2020 7265  size).        re
+00003d20: 7375 6c74 2e61 7070 656e 6428 273e 2729  sult.append('>')
+00003d30: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00003d40: 2727 2e6a 6f69 6e28 7265 7375 6c74 290a  ''.join(result).
+00003d50: 0a20 2020 2064 6566 2046 696c 6548 6561  .    def FileHea
+00003d60: 6465 7228 7365 6c66 2c20 7a69 7036 343d  der(self, zip64=
+00003d70: 4e6f 6e65 293a 0a20 2020 2020 2020 2022  None):.        "
+00003d80: 2222 5265 7475 726e 2074 6865 2070 6572  ""Return the per
+00003d90: 2d66 696c 6520 6865 6164 6572 2061 7320  -file header as 
+00003da0: 6120 6279 7465 7320 6f62 6a65 6374 2e22  a bytes object."
+00003db0: 2222 0a20 2020 2020 2020 2064 7420 3d20  "".        dt = 
+00003dc0: 7365 6c66 2e64 6174 655f 7469 6d65 0a20  self.date_time. 
+00003dd0: 2020 2020 2020 2064 6f73 6461 7465 203d         dosdate =
+00003de0: 2028 6474 5b30 5d20 2d20 3139 3830 2920   (dt[0] - 1980) 
+00003df0: 3c3c 2039 207c 2064 745b 315d 203c 3c20  << 9 | dt[1] << 
+00003e00: 3520 7c20 6474 5b32 5d0a 2020 2020 2020  5 | dt[2].      
+00003e10: 2020 646f 7374 696d 6520 3d20 6474 5b33    dostime = dt[3
+00003e20: 5d20 3c3c 2031 3120 7c20 6474 5b34 5d20  ] << 11 | dt[4] 
+00003e30: 3c3c 2035 207c 2028 6474 5b35 5d20 2f2f  << 5 | (dt[5] //
+00003e40: 2032 290a 2020 2020 2020 2020 6966 2073   2).        if s
+00003e50: 656c 662e 666c 6167 5f62 6974 7320 2620  elf.flag_bits & 
+00003e60: 3078 3038 3a0a 2020 2020 2020 2020 2020  0x08:.          
+00003e70: 2020 2320 5365 7420 7468 6573 6520 746f    # Set these to
+00003e80: 207a 6572 6f20 6265 6361 7573 6520 7765   zero because we
+00003e90: 2077 7269 7465 2074 6865 6d20 6166 7465   write them afte
+00003ea0: 7220 7468 6520 6669 6c65 2064 6174 610a  r the file data.
+00003eb0: 2020 2020 2020 2020 2020 2020 4352 4320              CRC 
+00003ec0: 3d20 636f 6d70 7265 7373 5f73 697a 6520  = compress_size 
+00003ed0: 3d20 6669 6c65 5f73 697a 6520 3d20 300a  = file_size = 0.
+00003ee0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00003ef0: 2020 2020 2020 2020 2020 4352 4320 3d20            CRC = 
+00003f00: 7365 6c66 2e43 5243 0a20 2020 2020 2020  self.CRC.       
+00003f10: 2020 2020 2063 6f6d 7072 6573 735f 7369       compress_si
+00003f20: 7a65 203d 2073 656c 662e 636f 6d70 7265  ze = self.compre
+00003f30: 7373 5f73 697a 650a 2020 2020 2020 2020  ss_size.        
+00003f40: 2020 2020 6669 6c65 5f73 697a 6520 3d20      file_size = 
+00003f50: 7365 6c66 2e66 696c 655f 7369 7a65 0a0a  self.file_size..
+00003f60: 2020 2020 2020 2020 6578 7472 6120 3d20          extra = 
+00003f70: 7365 6c66 2e65 7874 7261 0a0a 2020 2020  self.extra..    
+00003f80: 2020 2020 6d69 6e5f 7665 7273 696f 6e20      min_version 
+00003f90: 3d20 300a 2020 2020 2020 2020 6966 207a  = 0.        if z
+00003fa0: 6970 3634 2069 7320 4e6f 6e65 3a0a 2020  ip64 is None:.  
+00003fb0: 2020 2020 2020 2020 2020 7a69 7036 3420            zip64 
+00003fc0: 3d20 6669 6c65 5f73 697a 6520 3e20 5a49  = file_size > ZI
+00003fd0: 5036 345f 4c49 4d49 5420 6f72 2063 6f6d  P64_LIMIT or com
+00003fe0: 7072 6573 735f 7369 7a65 203e 205a 4950  press_size > ZIP
+00003ff0: 3634 5f4c 494d 4954 0a20 2020 2020 2020  64_LIMIT.       
+00004000: 2069 6620 7a69 7036 343a 0a20 2020 2020   if zip64:.     
+00004010: 2020 2020 2020 2066 6d74 203d 2027 3c48         fmt = '<H
+00004020: 4851 5127 0a20 2020 2020 2020 2020 2020  HQQ'.           
+00004030: 2065 7874 7261 203d 2065 7874 7261 202b   extra = extra +
+00004040: 2073 7472 7563 742e 7061 636b 2866 6d74   struct.pack(fmt
+00004050: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00004060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004070: 2020 2020 2020 2020 2020 312c 2073 7472            1, str
+00004080: 7563 742e 6361 6c63 7369 7a65 2866 6d74  uct.calcsize(fmt
+00004090: 292d 342c 2066 696c 655f 7369 7a65 2c20  )-4, file_size, 
+000040a0: 636f 6d70 7265 7373 5f73 697a 6529 0a20  compress_size). 
+000040b0: 2020 2020 2020 2069 6620 6669 6c65 5f73         if file_s
+000040c0: 697a 6520 3e20 5a49 5036 345f 4c49 4d49  ize > ZIP64_LIMI
+000040d0: 5420 6f72 2063 6f6d 7072 6573 735f 7369  T or compress_si
+000040e0: 7a65 203e 205a 4950 3634 5f4c 494d 4954  ze > ZIP64_LIMIT
+000040f0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00004100: 206e 6f74 207a 6970 3634 3a0a 2020 2020   not zip64:.    
+00004110: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00004120: 6520 4c61 7267 655a 6970 4669 6c65 2822  e LargeZipFile("
+00004130: 4669 6c65 7369 7a65 2077 6f75 6c64 2072  Filesize would r
+00004140: 6571 7569 7265 205a 4950 3634 2065 7874  equire ZIP64 ext
+00004150: 656e 7369 6f6e 7322 290a 2020 2020 2020  ensions").      
+00004160: 2020 2020 2020 2320 4669 6c65 2069 7320        # File is 
+00004170: 6c61 7267 6572 2074 6861 6e20 7768 6174  larger than what
+00004180: 2066 6974 7320 696e 746f 2061 2034 2062   fits into a 4 b
+00004190: 7974 6520 696e 7465 6765 722c 0a20 2020  yte integer,.   
+000041a0: 2020 2020 2020 2020 2023 2066 616c 6c20           # fall 
+000041b0: 6261 636b 2074 6f20 7468 6520 5a49 5036  back to the ZIP6
+000041c0: 3420 6578 7465 6e73 696f 6e0a 2020 2020  4 extension.    
+000041d0: 2020 2020 2020 2020 6669 6c65 5f73 697a          file_siz
+000041e0: 6520 3d20 3078 6666 6666 6666 6666 0a20  e = 0xffffffff. 
+000041f0: 2020 2020 2020 2020 2020 2063 6f6d 7072             compr
+00004200: 6573 735f 7369 7a65 203d 2030 7866 6666  ess_size = 0xfff
+00004210: 6666 6666 660a 2020 2020 2020 2020 2020  fffff.          
+00004220: 2020 6d69 6e5f 7665 7273 696f 6e20 3d20    min_version = 
+00004230: 5a49 5036 345f 5645 5253 494f 4e0a 0a20  ZIP64_VERSION.. 
+00004240: 2020 2020 2020 2069 6620 7365 6c66 2e63         if self.c
+00004250: 6f6d 7072 6573 735f 7479 7065 203d 3d20  ompress_type == 
+00004260: 5a49 505f 4443 4c49 4d50 4c4f 4445 443a  ZIP_DCLIMPLODED:
+00004270: 0a20 2020 2020 2020 2020 2020 206d 696e  .            min
+00004280: 5f76 6572 7369 6f6e 203d 206d 6178 2844  _version = max(D
+00004290: 434c 494d 504c 4f44 4544 5f56 4552 5349  CLIMPLODED_VERSI
+000042a0: 4f4e 2c20 6d69 6e5f 7665 7273 696f 6e29  ON, min_version)
+000042b0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+000042c0: 2e63 6f6d 7072 6573 735f 7479 7065 203d  .compress_type =
+000042d0: 3d20 5a49 505f 4445 464c 4154 4544 3634  = ZIP_DEFLATED64
+000042e0: 3a0a 2020 2020 2020 2020 2020 2020 6d69  :.            mi
+000042f0: 6e5f 7665 7273 696f 6e20 3d20 6d61 7828  n_version = max(
+00004300: 4445 464c 4154 4544 3634 5f56 4552 5349  DEFLATED64_VERSI
+00004310: 4f4e 2c20 6d69 6e5f 7665 7273 696f 6e29  ON, min_version)
+00004320: 0a20 2020 2020 2020 2065 6c69 6620 7365  .        elif se
+00004330: 6c66 2e63 6f6d 7072 6573 735f 7479 7065  lf.compress_type
+00004340: 203d 3d20 5a49 505f 425a 4950 323a 0a20   == ZIP_BZIP2:. 
+00004350: 2020 2020 2020 2020 2020 206d 696e 5f76             min_v
+00004360: 6572 7369 6f6e 203d 206d 6178 2842 5a49  ersion = max(BZI
+00004370: 5032 5f56 4552 5349 4f4e 2c20 6d69 6e5f  P2_VERSION, min_
+00004380: 7665 7273 696f 6e29 0a20 2020 2020 2020  version).       
+00004390: 2065 6c69 6620 7365 6c66 2e63 6f6d 7072   elif self.compr
+000043a0: 6573 735f 7479 7065 203d 3d20 5a49 505f  ess_type == ZIP_
+000043b0: 4c5a 4d41 3a0a 2020 2020 2020 2020 2020  LZMA:.          
+000043c0: 2020 6d69 6e5f 7665 7273 696f 6e20 3d20    min_version = 
+000043d0: 6d61 7828 4c5a 4d41 5f56 4552 5349 4f4e  max(LZMA_VERSION
+000043e0: 2c20 6d69 6e5f 7665 7273 696f 6e29 0a20  , min_version). 
+000043f0: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
+00004400: 2e63 6f6d 7072 6573 735f 7479 7065 203d  .compress_type =
+00004410: 3d20 5a49 505f 585a 3a0a 2020 2020 2020  = ZIP_XZ:.      
+00004420: 2020 2020 2020 6d69 6e5f 7665 7273 696f        min_versio
+00004430: 6e20 3d20 6d61 7828 585a 5f56 4552 5349  n = max(XZ_VERSI
+00004440: 4f4e 2c20 6d69 6e5f 7665 7273 696f 6e29  ON, min_version)
+00004450: 0a20 2020 2020 2020 2065 6c69 6620 7365  .        elif se
+00004460: 6c66 2e63 6f6d 7072 6573 735f 7479 7065  lf.compress_type
+00004470: 203d 3d20 5a49 505f 5a53 5441 4e44 4152   == ZIP_ZSTANDAR
+00004480: 443a 0a20 2020 2020 2020 2020 2020 206d  D:.            m
+00004490: 696e 5f76 6572 7369 6f6e 203d 206d 6178  in_version = max
+000044a0: 285a 5354 414e 4441 5244 5f56 4552 5349  (ZSTANDARD_VERSI
+000044b0: 4f4e 2c20 6d69 6e5f 7665 7273 696f 6e29  ON, min_version)
+000044c0: 0a20 2020 2020 2020 2065 6c69 6620 7365  .        elif se
+000044d0: 6c66 2e63 6f6d 7072 6573 735f 7479 7065  lf.compress_type
+000044e0: 203d 3d20 5a49 505f 5050 4d44 3a0a 2020   == ZIP_PPMD:.  
+000044f0: 2020 2020 2020 2020 2020 6d69 6e5f 7665            min_ve
+00004500: 7273 696f 6e20 3d20 6d61 7828 5050 4d44  rsion = max(PPMD
+00004510: 5f56 4552 5349 4f4e 2c20 6d69 6e5f 7665  _VERSION, min_ve
+00004520: 7273 696f 6e29 0a0a 2020 2020 2020 2020  rsion)..        
 00004530: 7365 6c66 2e65 7874 7261 6374 5f76 6572  self.extract_ver
-00004540: 7369 6f6e 2c20 7365 6c66 2e72 6573 6572  sion, self.reser
-00004550: 7665 642c 2066 6c61 675f 6269 7473 2c0a  ved, flag_bits,.
-00004560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004570: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00004580: 662e 636f 6d70 7265 7373 5f74 7970 652c  f.compress_type,
-00004590: 2064 6f73 7469 6d65 2c20 646f 7364 6174   dostime, dosdat
-000045a0: 652c 2043 5243 2c0a 2020 2020 2020 2020  e, CRC,.        
-000045b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000045c0: 2020 2020 2063 6f6d 7072 6573 735f 7369       compress_si
-000045d0: 7a65 2c20 6669 6c65 5f73 697a 652c 0a20  ze, file_size,. 
-000045e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000045f0: 2020 2020 2020 2020 2020 2020 6c65 6e28              len(
-00004600: 6669 6c65 6e61 6d65 292c 206c 656e 2865  filename), len(e
-00004610: 7874 7261 2929 0a20 2020 2020 2020 2072  xtra)).        r
-00004620: 6574 7572 6e20 6865 6164 6572 202b 2066  eturn header + f
-00004630: 696c 656e 616d 6520 2b20 6578 7472 610a  ilename + extra.
-00004640: 0a20 2020 2064 6566 205f 656e 636f 6465  .    def _encode
-00004650: 4669 6c65 6e61 6d65 466c 6167 7328 7365  FilenameFlags(se
-00004660: 6c66 293a 0a20 2020 2020 2020 2074 7279  lf):.        try
-00004670: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00004680: 7475 726e 2073 656c 662e 6669 6c65 6e61  turn self.filena
-00004690: 6d65 2e65 6e63 6f64 6528 2761 7363 6969  me.encode('ascii
-000046a0: 2729 2c20 7365 6c66 2e66 6c61 675f 6269  '), self.flag_bi
-000046b0: 7473 0a20 2020 2020 2020 2065 7863 6570  ts.        excep
-000046c0: 7420 556e 6963 6f64 6545 6e63 6f64 6545  t UnicodeEncodeE
-000046d0: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
-000046e0: 2020 7265 7475 726e 2073 656c 662e 6669    return self.fi
-000046f0: 6c65 6e61 6d65 2e65 6e63 6f64 6528 2775  lename.encode('u
-00004700: 7466 2d38 2729 2c20 7365 6c66 2e66 6c61  tf-8'), self.fla
-00004710: 675f 6269 7473 207c 2030 7838 3030 0a0a  g_bits | 0x800..
-00004720: 2020 2020 6465 6620 5f64 6563 6f64 6545      def _decodeE
-00004730: 7874 7261 2873 656c 6629 3a0a 2020 2020  xtra(self):.    
-00004740: 2020 2020 2320 5472 7920 746f 2064 6563      # Try to dec
-00004750: 6f64 6520 7468 6520 6578 7472 6120 6669  ode the extra fi
-00004760: 656c 642e 0a20 2020 2020 2020 2065 7874  eld..        ext
-00004770: 7261 203d 2073 656c 662e 6578 7472 610a  ra = self.extra.
-00004780: 2020 2020 2020 2020 756e 7061 636b 203d          unpack =
-00004790: 2073 7472 7563 742e 756e 7061 636b 0a20   struct.unpack. 
-000047a0: 2020 2020 2020 2077 6869 6c65 206c 656e         while len
-000047b0: 2865 7874 7261 2920 3e3d 2034 3a0a 2020  (extra) >= 4:.  
-000047c0: 2020 2020 2020 2020 2020 7470 2c20 6c6e            tp, ln
-000047d0: 203d 2075 6e70 6163 6b28 273c 4848 272c   = unpack('<HH',
-000047e0: 2065 7874 7261 5b3a 345d 290a 2020 2020   extra[:4]).    
-000047f0: 2020 2020 2020 2020 6966 206c 6e2b 3420          if ln+4 
-00004800: 3e20 6c65 6e28 6578 7472 6129 3a0a 2020  > len(extra):.  
-00004810: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-00004820: 6973 6520 4261 645a 6970 4669 6c65 2822  ise BadZipFile("
-00004830: 436f 7272 7570 7420 6578 7472 6120 6669  Corrupt extra fi
-00004840: 656c 6420 2530 3478 2028 7369 7a65 3d25  eld %04x (size=%
-00004850: 6429 2220 2520 2874 702c 206c 6e29 290a  d)" % (tp, ln)).
-00004860: 2020 2020 2020 2020 2020 2020 6966 2074              if t
-00004870: 7020 3d3d 2030 7830 3030 313a 0a20 2020  p == 0x0001:.   
-00004880: 2020 2020 2020 2020 2020 2020 2064 6174               dat
-00004890: 6120 3d20 6578 7472 615b 343a 6c6e 2b34  a = extra[4:ln+4
-000048a0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-000048b0: 2020 2320 5a49 5036 3420 6578 7465 6e73    # ZIP64 extens
-000048c0: 696f 6e20 286c 6172 6765 2066 696c 6573  ion (large files
-000048d0: 2061 6e64 2f6f 7220 6c61 7267 6520 6172   and/or large ar
-000048e0: 6368 6976 6573 290a 2020 2020 2020 2020  chives).        
-000048f0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-00004900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004910: 2069 6620 7365 6c66 2e66 696c 655f 7369   if self.file_si
-00004920: 7a65 2069 6e20 2830 7846 4646 4646 4646  ze in (0xFFFFFFF
-00004930: 4646 4646 4646 4646 462c 2030 7846 4646  FFFFFFFFF, 0xFFF
-00004940: 4646 4646 4629 3a0a 2020 2020 2020 2020  FFFFF):.        
-00004950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004960: 6669 656c 6420 3d20 2246 696c 6520 7369  field = "File si
-00004970: 7a65 220a 2020 2020 2020 2020 2020 2020  ze".            
-00004980: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00004990: 2e66 696c 655f 7369 7a65 2c20 3d20 756e  .file_size, = un
-000049a0: 7061 636b 2827 3c51 272c 2064 6174 615b  pack('<Q', data[
-000049b0: 3a38 5d29 0a20 2020 2020 2020 2020 2020  :8]).           
-000049c0: 2020 2020 2020 2020 2020 2020 2064 6174               dat
-000049d0: 6120 3d20 6461 7461 5b38 3a5d 0a20 2020  a = data[8:].   
-000049e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000049f0: 2069 6620 7365 6c66 2e63 6f6d 7072 6573   if self.compres
-00004a00: 735f 7369 7a65 203d 3d20 3078 4646 4646  s_size == 0xFFFF
-00004a10: 4646 4646 3a0a 2020 2020 2020 2020 2020  FFFF:.          
-00004a20: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-00004a30: 656c 6420 3d20 2243 6f6d 7072 6573 7320  eld = "Compress 
-00004a40: 7369 7a65 220a 2020 2020 2020 2020 2020  size".          
-00004a50: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00004a60: 6c66 2e63 6f6d 7072 6573 735f 7369 7a65  lf.compress_size
-00004a70: 2c20 3d20 756e 7061 636b 2827 3c51 272c  , = unpack('<Q',
-00004a80: 2064 6174 615b 3a38 5d29 0a20 2020 2020   data[:8]).     
+00004540: 7369 6f6e 203d 206d 6178 286d 696e 5f76  sion = max(min_v
+00004550: 6572 7369 6f6e 2c20 7365 6c66 2e65 7874  ersion, self.ext
+00004560: 7261 6374 5f76 6572 7369 6f6e 290a 2020  ract_version).  
+00004570: 2020 2020 2020 7365 6c66 2e63 7265 6174        self.creat
+00004580: 655f 7665 7273 696f 6e20 3d20 6d61 7828  e_version = max(
+00004590: 6d69 6e5f 7665 7273 696f 6e2c 2073 656c  min_version, sel
+000045a0: 662e 6372 6561 7465 5f76 6572 7369 6f6e  f.create_version
+000045b0: 290a 2020 2020 2020 2020 6669 6c65 6e61  ).        filena
+000045c0: 6d65 2c20 666c 6167 5f62 6974 7320 3d20  me, flag_bits = 
+000045d0: 7365 6c66 2e5f 656e 636f 6465 4669 6c65  self._encodeFile
+000045e0: 6e61 6d65 466c 6167 7328 290a 2020 2020  nameFlags().    
+000045f0: 2020 2020 6865 6164 6572 203d 2073 7472      header = str
+00004600: 7563 742e 7061 636b 2873 7472 7563 7446  uct.pack(structF
+00004610: 696c 6548 6561 6465 722c 2073 7472 696e  ileHeader, strin
+00004620: 6746 696c 6548 6561 6465 722c 0a20 2020  gFileHeader,.   
+00004630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004640: 2020 2020 2020 2020 2020 7365 6c66 2e65            self.e
+00004650: 7874 7261 6374 5f76 6572 7369 6f6e 2c20  xtract_version, 
+00004660: 7365 6c66 2e72 6573 6572 7665 642c 2066  self.reserved, f
+00004670: 6c61 675f 6269 7473 2c0a 2020 2020 2020  lag_bits,.      
+00004680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004690: 2020 2020 2020 2073 656c 662e 636f 6d70         self.comp
+000046a0: 7265 7373 5f74 7970 652c 2064 6f73 7469  ress_type, dosti
+000046b0: 6d65 2c20 646f 7364 6174 652c 2043 5243  me, dosdate, CRC
+000046c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000046d0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+000046e0: 6f6d 7072 6573 735f 7369 7a65 2c20 6669  ompress_size, fi
+000046f0: 6c65 5f73 697a 652c 0a20 2020 2020 2020  le_size,.       
+00004700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004710: 2020 2020 2020 6c65 6e28 6669 6c65 6e61        len(filena
+00004720: 6d65 292c 206c 656e 2865 7874 7261 2929  me), len(extra))
+00004730: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00004740: 6865 6164 6572 202b 2066 696c 656e 616d  header + filenam
+00004750: 6520 2b20 6578 7472 610a 0a20 2020 2064  e + extra..    d
+00004760: 6566 205f 656e 636f 6465 4669 6c65 6e61  ef _encodeFilena
+00004770: 6d65 466c 6167 7328 7365 6c66 293a 0a20  meFlags(self):. 
+00004780: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+00004790: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+000047a0: 656c 662e 6669 6c65 6e61 6d65 2e65 6e63  elf.filename.enc
+000047b0: 6f64 6528 2761 7363 6969 2729 2c20 7365  ode('ascii'), se
+000047c0: 6c66 2e66 6c61 675f 6269 7473 0a20 2020  lf.flag_bits.   
+000047d0: 2020 2020 2065 7863 6570 7420 556e 6963       except Unic
+000047e0: 6f64 6545 6e63 6f64 6545 7272 6f72 3a0a  odeEncodeError:.
+000047f0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00004800: 726e 2073 656c 662e 6669 6c65 6e61 6d65  rn self.filename
+00004810: 2e65 6e63 6f64 6528 2775 7466 2d38 2729  .encode('utf-8')
+00004820: 2c20 7365 6c66 2e66 6c61 675f 6269 7473  , self.flag_bits
+00004830: 207c 2030 7838 3030 0a0a 2020 2020 6465   | 0x800..    de
+00004840: 6620 5f64 6563 6f64 6545 7874 7261 2873  f _decodeExtra(s
+00004850: 656c 6629 3a0a 2020 2020 2020 2020 2320  elf):.        # 
+00004860: 5472 7920 746f 2064 6563 6f64 6520 7468  Try to decode th
+00004870: 6520 6578 7472 6120 6669 656c 642e 0a20  e extra field.. 
+00004880: 2020 2020 2020 2065 7874 7261 203d 2073         extra = s
+00004890: 656c 662e 6578 7472 610a 2020 2020 2020  elf.extra.      
+000048a0: 2020 756e 7061 636b 203d 2073 7472 7563    unpack = struc
+000048b0: 742e 756e 7061 636b 0a20 2020 2020 2020  t.unpack.       
+000048c0: 2077 6869 6c65 206c 656e 2865 7874 7261   while len(extra
+000048d0: 2920 3e3d 2034 3a0a 2020 2020 2020 2020  ) >= 4:.        
+000048e0: 2020 2020 7470 2c20 6c6e 203d 2075 6e70      tp, ln = unp
+000048f0: 6163 6b28 273c 4848 272c 2065 7874 7261  ack('<HH', extra
+00004900: 5b3a 345d 290a 2020 2020 2020 2020 2020  [:4]).          
+00004910: 2020 6966 206c 6e2b 3420 3e20 6c65 6e28    if ln+4 > len(
+00004920: 6578 7472 6129 3a0a 2020 2020 2020 2020  extra):.        
+00004930: 2020 2020 2020 2020 7261 6973 6520 4261          raise Ba
+00004940: 645a 6970 4669 6c65 2822 436f 7272 7570  dZipFile("Corrup
+00004950: 7420 6578 7472 6120 6669 656c 6420 2530  t extra field %0
+00004960: 3478 2028 7369 7a65 3d25 6429 2220 2520  4x (size=%d)" % 
+00004970: 2874 702c 206c 6e29 290a 2020 2020 2020  (tp, ln)).      
+00004980: 2020 2020 2020 6966 2074 7020 3d3d 2030        if tp == 0
+00004990: 7830 3030 313a 0a20 2020 2020 2020 2020  x0001:.         
+000049a0: 2020 2020 2020 2064 6174 6120 3d20 6578         data = ex
+000049b0: 7472 615b 343a 6c6e 2b34 5d0a 2020 2020  tra[4:ln+4].    
+000049c0: 2020 2020 2020 2020 2020 2020 2320 5a49              # ZI
+000049d0: 5036 3420 6578 7465 6e73 696f 6e20 286c  P64 extension (l
+000049e0: 6172 6765 2066 696c 6573 2061 6e64 2f6f  arge files and/o
+000049f0: 7220 6c61 7267 6520 6172 6368 6976 6573  r large archives
+00004a00: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00004a10: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+00004a20: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+00004a30: 6c66 2e66 696c 655f 7369 7a65 2069 6e20  lf.file_size in 
+00004a40: 2830 7846 4646 4646 4646 4646 4646 4646  (0xFFFFFFFFFFFFF
+00004a50: 4646 462c 2030 7846 4646 4646 4646 4629  FFF, 0xFFFFFFFF)
+00004a60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00004a70: 2020 2020 2020 2020 2020 6669 656c 6420            field 
+00004a80: 3d20 2246 696c 6520 7369 7a65 220a 2020  = "File size".  
 00004a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004aa0: 2020 2064 6174 6120 3d20 6461 7461 5b38     data = data[8
-00004ab0: 3a5d 0a20 2020 2020 2020 2020 2020 2020  :].             
-00004ac0: 2020 2020 2020 2069 6620 7365 6c66 2e68         if self.h
-00004ad0: 6561 6465 725f 6f66 6673 6574 203d 3d20  eader_offset == 
-00004ae0: 3078 4646 4646 4646 4646 3a0a 2020 2020  0xFFFFFFFF:.    
-00004af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004b00: 2020 2020 6669 656c 6420 3d20 2248 6561      field = "Hea
-00004b10: 6465 7220 6f66 6673 6574 220a 2020 2020  der offset".    
-00004b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004b30: 2020 2020 7365 6c66 2e68 6561 6465 725f      self.header_
-00004b40: 6f66 6673 6574 2c20 3d20 756e 7061 636b  offset, = unpack
-00004b50: 2827 3c51 272c 2064 6174 615b 3a38 5d29  ('<Q', data[:8])
-00004b60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004b70: 2065 7863 6570 7420 7374 7275 6374 2e65   except struct.e
-00004b80: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
-00004b90: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00004ba0: 4261 645a 6970 4669 6c65 2822 436f 7272  BadZipFile("Corr
-00004bb0: 7570 7420 7a69 7036 3420 6578 7472 6120  upt zip64 extra 
-00004bc0: 6669 656c 642e 2025 7320 6e6f 7420 666f  field. %s not fo
-00004bd0: 756e 642e 2225 6669 656c 6429 0a0a 2020  und."%field)..  
-00004be0: 2020 2020 2020 2020 2020 6578 7472 6120            extra 
-00004bf0: 3d20 6578 7472 615b 6c6e 2b34 3a5d 0a0a  = extra[ln+4:]..
-00004c00: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
-00004c10: 0a20 2020 2064 6566 2066 726f 6d5f 6669  .    def from_fi
-00004c20: 6c65 2863 6c73 2c20 6669 6c65 6e61 6d65  le(cls, filename
-00004c30: 2c20 6172 636e 616d 653d 4e6f 6e65 2c20  , arcname=None, 
-00004c40: 7374 7269 6374 5f74 696d 6573 7461 6d70  strict_timestamp
-00004c50: 733d 5472 7565 293a 0a20 2020 2020 2020  s=True):.       
-00004c60: 2022 2222 436f 6e73 7472 7563 7420 616e   """Construct an
-00004c70: 2061 7070 726f 7072 6961 7465 205a 6970   appropriate Zip
-00004c80: 496e 666f 2066 6f72 2061 2066 696c 6520  Info for a file 
-00004c90: 6f6e 2074 6865 2066 696c 6573 7973 7465  on the filesyste
-00004ca0: 6d2e 0a0a 2020 2020 2020 2020 6669 6c65  m...        file
-00004cb0: 6e61 6d65 2073 686f 756c 6420 6265 2074  name should be t
-00004cc0: 6865 2070 6174 6820 746f 2061 2066 696c  he path to a fil
-00004cd0: 6520 6f72 2064 6972 6563 746f 7279 206f  e or directory o
-00004ce0: 6e20 7468 6520 6669 6c65 7379 7374 656d  n the filesystem
-00004cf0: 2e0a 0a20 2020 2020 2020 2061 7263 6e61  ...        arcna
-00004d00: 6d65 2069 7320 7468 6520 6e61 6d65 2077  me is the name w
-00004d10: 6869 6368 2069 7420 7769 6c6c 2068 6176  hich it will hav
-00004d20: 6520 7769 7468 696e 2074 6865 2061 7263  e within the arc
-00004d30: 6869 7665 2028 6279 2064 6566 6175 6c74  hive (by default
-00004d40: 2c0a 2020 2020 2020 2020 7468 6973 2077  ,.        this w
-00004d50: 696c 6c20 6265 2074 6865 2073 616d 6520  ill be the same 
-00004d60: 6173 2066 696c 656e 616d 652c 2062 7574  as filename, but
-00004d70: 2077 6974 686f 7574 2061 2064 7269 7665   without a drive
-00004d80: 206c 6574 7465 7220 616e 6420 7769 7468   letter and with
-00004d90: 0a20 2020 2020 2020 206c 6561 6469 6e67  .        leading
-00004da0: 2070 6174 6820 7365 7061 7261 746f 7273   path separators
-00004db0: 2072 656d 6f76 6564 292e 0a20 2020 2020   removed)..     
-00004dc0: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-00004dd0: 6620 7379 732e 7665 7273 696f 6e5f 696e  f sys.version_in
-00004de0: 666f 3e3d 2833 2c36 293a 0a20 2020 2020  fo>=(3,6):.     
-00004df0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-00004e00: 616e 6365 2866 696c 656e 616d 652c 206f  ance(filename, o
-00004e10: 732e 5061 7468 4c69 6b65 293a 0a20 2020  s.PathLike):.   
-00004e20: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-00004e30: 656e 616d 6520 3d20 6f73 2e66 7370 6174  ename = os.fspat
-00004e40: 6828 6669 6c65 6e61 6d65 290a 2020 2020  h(filename).    
-00004e50: 2020 2020 7374 203d 206f 732e 7374 6174      st = os.stat
-00004e60: 2866 696c 656e 616d 6529 0a20 2020 2020  (filename).     
-00004e70: 2020 2069 7364 6972 203d 2073 7461 742e     isdir = stat.
-00004e80: 535f 4953 4449 5228 7374 2e73 745f 6d6f  S_ISDIR(st.st_mo
-00004e90: 6465 290a 2020 2020 2020 2020 6d74 696d  de).        mtim
-00004ea0: 6520 3d20 7469 6d65 2e6c 6f63 616c 7469  e = time.localti
-00004eb0: 6d65 2873 742e 7374 5f6d 7469 6d65 290a  me(st.st_mtime).
-00004ec0: 2020 2020 2020 2020 6461 7465 5f74 696d          date_tim
-00004ed0: 6520 3d20 6d74 696d 655b 303a 365d 0a20  e = mtime[0:6]. 
-00004ee0: 2020 2020 2020 2069 6620 6e6f 7420 7374         if not st
-00004ef0: 7269 6374 5f74 696d 6573 7461 6d70 7320  rict_timestamps 
-00004f00: 616e 6420 6461 7465 5f74 696d 655b 305d  and date_time[0]
-00004f10: 203c 2031 3938 303a 0a20 2020 2020 2020   < 1980:.       
-00004f20: 2020 2020 2064 6174 655f 7469 6d65 203d       date_time =
-00004f30: 2028 3139 3830 2c20 312c 2031 2c20 302c   (1980, 1, 1, 0,
-00004f40: 2030 2c20 3029 0a20 2020 2020 2020 2065   0, 0).        e
-00004f50: 6c69 6620 6e6f 7420 7374 7269 6374 5f74  lif not strict_t
-00004f60: 696d 6573 7461 6d70 7320 616e 6420 6461  imestamps and da
-00004f70: 7465 5f74 696d 655b 305d 203e 2032 3130  te_time[0] > 210
-00004f80: 373a 0a20 2020 2020 2020 2020 2020 2064  7:.            d
-00004f90: 6174 655f 7469 6d65 203d 2028 3231 3037  ate_time = (2107
-00004fa0: 2c20 3132 2c20 3331 2c20 3233 2c20 3539  , 12, 31, 23, 59
-00004fb0: 2c20 3539 290a 2020 2020 2020 2020 2320  , 59).        # 
-00004fc0: 4372 6561 7465 205a 6970 496e 666f 2069  Create ZipInfo i
-00004fd0: 6e73 7461 6e63 6520 746f 2073 746f 7265  nstance to store
-00004fe0: 2066 696c 6520 696e 666f 726d 6174 696f   file informatio
-00004ff0: 6e0a 2020 2020 2020 2020 6966 2061 7263  n.        if arc
-00005000: 6e61 6d65 2069 7320 4e6f 6e65 3a0a 2020  name is None:.  
-00005010: 2020 2020 2020 2020 2020 6172 636e 616d            arcnam
-00005020: 6520 3d20 6669 6c65 6e61 6d65 0a20 2020  e = filename.   
-00005030: 2020 2020 2061 7263 6e61 6d65 203d 206f       arcname = o
-00005040: 732e 7061 7468 2e6e 6f72 6d70 6174 6828  s.path.normpath(
-00005050: 6f73 2e70 6174 682e 7370 6c69 7464 7269  os.path.splitdri
-00005060: 7665 2861 7263 6e61 6d65 295b 315d 290a  ve(arcname)[1]).
-00005070: 2020 2020 2020 2020 7768 696c 6520 6172          while ar
-00005080: 636e 616d 655b 305d 2069 6e20 286f 732e  cname[0] in (os.
-00005090: 7365 702c 206f 732e 616c 7473 6570 293a  sep, os.altsep):
-000050a0: 0a20 2020 2020 2020 2020 2020 2061 7263  .            arc
-000050b0: 6e61 6d65 203d 2061 7263 6e61 6d65 5b31  name = arcname[1
-000050c0: 3a5d 0a20 2020 2020 2020 2069 6620 6973  :].        if is
-000050d0: 6469 723a 0a20 2020 2020 2020 2020 2020  dir:.           
-000050e0: 2061 7263 6e61 6d65 202b 3d20 272f 270a   arcname += '/'.
-000050f0: 2020 2020 2020 2020 7a69 6e66 6f20 3d20          zinfo = 
-00005100: 636c 7328 6172 636e 616d 652c 2064 6174  cls(arcname, dat
-00005110: 655f 7469 6d65 290a 2020 2020 2020 2020  e_time).        
-00005120: 7a69 6e66 6f2e 6578 7465 726e 616c 5f61  zinfo.external_a
-00005130: 7474 7220 3d20 2873 742e 7374 5f6d 6f64  ttr = (st.st_mod
-00005140: 6520 2620 3078 4646 4646 2920 3c3c 2031  e & 0xFFFF) << 1
-00005150: 3620 2023 2055 6e69 7820 6174 7472 6962  6  # Unix attrib
-00005160: 7574 6573 0a20 2020 2020 2020 2069 6620  utes.        if 
-00005170: 6973 6469 723a 0a20 2020 2020 2020 2020  isdir:.         
-00005180: 2020 207a 696e 666f 2e66 696c 655f 7369     zinfo.file_si
-00005190: 7a65 203d 2030 0a20 2020 2020 2020 2020  ze = 0.         
-000051a0: 2020 207a 696e 666f 2e65 7874 6572 6e61     zinfo.externa
-000051b0: 6c5f 6174 7472 207c 3d20 3078 3130 2020  l_attr |= 0x10  
-000051c0: 2320 4d53 2d44 4f53 2064 6972 6563 746f  # MS-DOS directo
-000051d0: 7279 2066 6c61 670a 2020 2020 2020 2020  ry flag.        
-000051e0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-000051f0: 2020 7a69 6e66 6f2e 6669 6c65 5f73 697a    zinfo.file_siz
-00005200: 6520 3d20 7374 2e73 745f 7369 7a65 0a0a  e = st.st_size..
-00005210: 2020 2020 2020 2020 7265 7475 726e 207a          return z
-00005220: 696e 666f 0a0a 2020 2020 6465 6620 6973  info..    def is
-00005230: 5f64 6972 2873 656c 6629 3a0a 2020 2020  _dir(self):.    
-00005240: 2020 2020 2222 2252 6574 7572 6e20 5472      """Return Tr
-00005250: 7565 2069 6620 7468 6973 2061 7263 6869  ue if this archi
-00005260: 7665 206d 656d 6265 7220 6973 2061 2064  ve member is a d
-00005270: 6972 6563 746f 7279 2e22 2222 0a20 2020  irectory.""".   
-00005280: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00005290: 2e66 696c 656e 616d 655b 2d31 5d20 3d3d  .filename[-1] ==
-000052a0: 2027 2f27 0a0a 0a23 205a 4950 2065 6e63   '/'...# ZIP enc
-000052b0: 7279 7074 696f 6e20 7573 6573 2074 6865  ryption uses the
-000052c0: 2043 5243 3332 206f 6e65 2d62 7974 6520   CRC32 one-byte 
-000052d0: 7072 696d 6974 6976 6520 666f 7220 7363  primitive for sc
-000052e0: 7261 6d62 6c69 6e67 2073 6f6d 650a 2320  rambling some.# 
-000052f0: 696e 7465 726e 616c 206b 6579 732e 2057  internal keys. W
-00005300: 6520 6e6f 7469 6365 6420 7468 6174 2061  e noticed that a
-00005310: 2064 6972 6563 7420 696d 706c 656d 656e   direct implemen
-00005320: 7461 7469 6f6e 2069 7320 6661 7374 6572  tation is faster
-00005330: 2074 6861 6e0a 2320 7265 6c79 696e 6720   than.# relying 
-00005340: 6f6e 2062 696e 6173 6369 692e 6372 6333  on binascii.crc3
-00005350: 3228 292e 0a0a 5f63 7263 7461 626c 6520  2()..._crctable 
-00005360: 3d20 4e6f 6e65 0a64 6566 205f 6765 6e5f  = None.def _gen_
-00005370: 6372 6328 6372 6329 3a0a 2020 2020 666f  crc(crc):.    fo
-00005380: 7220 6a20 696e 2072 616e 6765 2838 293a  r j in range(8):
-00005390: 0a20 2020 2020 2020 2069 6620 6372 6320  .        if crc 
-000053a0: 2620 313a 0a20 2020 2020 2020 2020 2020  & 1:.           
-000053b0: 2063 7263 203d 2028 6372 6320 3e3e 2031   crc = (crc >> 1
-000053c0: 2920 5e20 3078 4544 4238 3833 3230 0a20  ) ^ 0xEDB88320. 
-000053d0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-000053e0: 2020 2020 2020 2020 2063 7263 203e 3e3d           crc >>=
-000053f0: 2031 0a20 2020 2072 6574 7572 6e20 6372   1.    return cr
-00005400: 630a 0a23 205a 4950 2073 7570 706f 7274  c..# ZIP support
-00005410: 7320 6120 7061 7373 776f 7264 2d62 6173  s a password-bas
-00005420: 6564 2066 6f72 6d20 6f66 2065 6e63 7279  ed form of encry
-00005430: 7074 696f 6e2e 2045 7665 6e20 7468 6f75  ption. Even thou
-00005440: 6768 206b 6e6f 776e 0a23 2070 6c61 696e  gh known.# plain
-00005450: 7465 7874 2061 7474 6163 6b73 2068 6176  text attacks hav
-00005460: 6520 6265 656e 2066 6f75 6e64 2061 6761  e been found aga
-00005470: 696e 7374 2069 742c 2069 7420 6973 2073  inst it, it is s
-00005480: 7469 6c6c 2075 7365 6675 6c0a 2320 746f  till useful.# to
-00005490: 2062 6520 6162 6c65 2074 6f20 6765 7420   be able to get 
-000054a0: 6461 7461 206f 7574 206f 6620 7375 6368  data out of such
-000054b0: 2061 2066 696c 652e 0a23 0a23 2055 7361   a file..#.# Usa
-000054c0: 6765 3a0a 2320 2020 2020 7a64 203d 205f  ge:.#     zd = _
-000054d0: 5a69 7044 6563 7279 7074 6572 286d 7970  ZipDecrypter(myp
-000054e0: 7764 290a 2320 2020 2020 706c 6169 6e5f  wd).#     plain_
-000054f0: 6279 7465 7320 3d20 7a64 2863 7970 6865  bytes = zd(cyphe
-00005500: 725f 6279 7465 7329 0a0a 636c 6173 7320  r_bytes)..class 
-00005510: 5f5a 6970 4465 6372 7970 7465 7228 6f62  _ZipDecrypter(ob
-00005520: 6a65 6374 293a 0a0a 2020 2020 6465 6620  ject):..    def 
-00005530: 5f5f 696e 6974 5f5f 2873 656c 662c 2070  __init__(self, p
-00005540: 7764 293a 0a20 2020 2020 2020 2073 656c  wd):.        sel
-00005550: 662e 6b65 7930 203d 2033 3035 3431 3938  f.key0 = 3054198
-00005560: 3936 0a20 2020 2020 2020 2073 656c 662e  96.        self.
-00005570: 6b65 7931 203d 2035 3931 3735 3130 3439  key1 = 591751049
-00005580: 0a20 2020 2020 2020 2073 656c 662e 6b65  .        self.ke
-00005590: 7932 203d 2038 3738 3038 3231 3932 0a0a  y2 = 878082192..
-000055a0: 2020 2020 2020 2020 666f 7220 7020 696e          for p in
-000055b0: 2070 7764 3a0a 2020 2020 2020 2020 2020   pwd:.          
-000055c0: 2020 7365 6c66 2e75 7064 6174 655f 6b65    self.update_ke
-000055d0: 7973 2870 290a 0a20 2020 2020 2020 2067  ys(p)..        g
-000055e0: 6c6f 6261 6c20 5f63 7263 7461 626c 650a  lobal _crctable.
-000055f0: 2020 2020 2020 2020 6966 205f 6372 6374          if _crct
-00005600: 6162 6c65 2069 7320 4e6f 6e65 3a0a 2020  able is None:.  
-00005610: 2020 2020 2020 2020 2020 5f63 7263 7461            _crcta
-00005620: 626c 6520 3d20 6c69 7374 286d 6170 285f  ble = list(map(_
-00005630: 6765 6e5f 6372 632c 2072 616e 6765 2832  gen_crc, range(2
-00005640: 3536 2929 290a 2020 2020 2020 2020 7365  56))).        se
-00005650: 6c66 2e63 7263 7461 626c 6520 3d20 5f63  lf.crctable = _c
-00005660: 7263 7461 626c 650a 0a20 2020 2064 6566  rctable..    def
-00005670: 2063 7263 3332 2873 656c 662c 2063 682c   crc32(self, ch,
-00005680: 2063 7263 293a 0a20 2020 2020 2020 2022   crc):.        "
-00005690: 2222 436f 6d70 7574 6520 7468 6520 4352  ""Compute the CR
-000056a0: 4333 3220 7072 696d 6974 6976 6520 6f6e  C32 primitive on
-000056b0: 206f 6e65 2062 7974 652e 2222 220a 2020   one byte.""".  
-000056c0: 2020 2020 2020 7265 7475 726e 2028 6372        return (cr
-000056d0: 6320 3e3e 2038 2920 5e20 7365 6c66 2e63  c >> 8) ^ self.c
-000056e0: 7263 7461 626c 655b 2863 7263 205e 2063  rctable[(crc ^ c
-000056f0: 6829 2026 2030 7846 465d 0a0a 2020 2020  h) & 0xFF]..    
-00005700: 6465 6620 7570 6461 7465 5f6b 6579 7328  def update_keys(
-00005710: 7365 6c66 2c20 6329 3a0a 2020 2020 2020  self, c):.      
-00005720: 2020 7365 6c66 2e6b 6579 3020 3d20 7365    self.key0 = se
-00005730: 6c66 2e63 7263 3332 2863 2c20 7365 6c66  lf.crc32(c, self
-00005740: 2e6b 6579 3029 0a20 2020 2020 2020 2073  .key0).        s
-00005750: 656c 662e 6b65 7931 203d 2028 7365 6c66  elf.key1 = (self
-00005760: 2e6b 6579 3120 2b20 2873 656c 662e 6b65  .key1 + (self.ke
-00005770: 7930 2026 2030 7846 4629 2920 2620 3078  y0 & 0xFF)) & 0x
-00005780: 4646 4646 4646 4646 0a20 2020 2020 2020  FFFFFFFF.       
-00005790: 2073 656c 662e 6b65 7931 203d 2028 7365   self.key1 = (se
-000057a0: 6c66 2e6b 6579 3120 2a20 3133 3437 3735  lf.key1 * 134775
-000057b0: 3831 3320 2b20 3129 2026 2030 7846 4646  813 + 1) & 0xFFF
-000057c0: 4646 4646 460a 2020 2020 2020 2020 7365  FFFFF.        se
-000057d0: 6c66 2e6b 6579 3220 3d20 7365 6c66 2e63  lf.key2 = self.c
-000057e0: 7263 3332 2873 656c 662e 6b65 7931 203e  rc32(self.key1 >
-000057f0: 3e20 3234 2c20 7365 6c66 2e6b 6579 3229  > 24, self.key2)
-00005800: 0a0a 2020 2020 6465 6620 5f5f 6361 6c6c  ..    def __call
-00005810: 5f5f 2873 656c 662c 2064 6174 6129 3a0a  __(self, data):.
-00005820: 2020 2020 2020 2020 2222 2244 6563 7279          """Decry
-00005830: 7074 2061 2062 7974 6573 206f 626a 6563  pt a bytes objec
-00005840: 742e 2222 220a 2020 2020 2020 2020 7265  t.""".        re
-00005850: 7375 6c74 203d 2062 7974 6561 7272 6179  sult = bytearray
-00005860: 2829 0a20 2020 2020 2020 2061 7070 656e  ().        appen
-00005870: 6420 3d20 7265 7375 6c74 2e61 7070 656e  d = result.appen
-00005880: 640a 2020 2020 2020 2020 666f 7220 6320  d.        for c 
-00005890: 696e 2064 6174 613a 0a20 2020 2020 2020  in data:.       
-000058a0: 2020 2020 206b 203d 2073 656c 662e 6b65       k = self.ke
-000058b0: 7932 207c 2032 0a20 2020 2020 2020 2020  y2 | 2.         
-000058c0: 2020 2063 205e 3d20 2828 6b20 2a20 286b     c ^= ((k * (k
-000058d0: 5e31 2929 203e 3e20 3829 2026 2030 7846  ^1)) >> 8) & 0xF
-000058e0: 460a 2020 2020 2020 2020 2020 2020 7365  F.            se
-000058f0: 6c66 2e75 7064 6174 655f 6b65 7973 2863  lf.update_keys(c
-00005900: 290a 2020 2020 2020 2020 2020 2020 6170  ).            ap
-00005910: 7065 6e64 2863 290a 2020 2020 2020 2020  pend(c).        
-00005920: 7265 7475 726e 2062 7974 6573 2872 6573  return bytes(res
-00005930: 756c 7429 0a0a 636c 6173 7320 4c5a 4d41  ult)..class LZMA
-00005940: 436f 6d70 7265 7373 6f72 286f 626a 6563  Compressor(objec
-00005950: 7429 3a0a 0a20 2020 2064 6566 205f 5f69  t):..    def __i
-00005960: 6e69 745f 5f28 7365 6c66 2c20 6c65 7665  nit__(self, leve
-00005970: 6c3d 4e6f 6e65 293a 0a20 2020 2020 2020  l=None):.       
-00005980: 2073 656c 662e 5f63 6f6d 7020 3d20 4e6f   self._comp = No
-00005990: 6e65 0a20 2020 2020 2020 2073 656c 662e  ne.        self.
-000059a0: 5f6c 6576 656c 203d 204e 6f6e 650a 2020  _level = None.  
-000059b0: 2020 2020 2020 7365 6c66 2e5f 6c65 7665        self._leve
-000059c0: 6c20 3d20 6c65 7665 6c0a 2020 2020 2020  l = level.      
-000059d0: 2020 6966 2073 656c 662e 5f6c 6576 656c    if self._level
-000059e0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-000059f0: 2020 2020 2020 7365 6c66 2e5f 6c65 7665        self._leve
-00005a00: 6c20 3d20 360a 2020 2020 2020 2020 6966  l = 6.        if
-00005a10: 2073 656c 662e 5f6c 6576 656c 203c 2031   self._level < 1
-00005a20: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-00005a30: 6c66 2e5f 6c65 7665 6c20 3d20 310a 2020  lf._level = 1.  
-00005a40: 2020 2020 2020 6966 2073 656c 662e 5f6c        if self._l
-00005a50: 6576 656c 203e 2039 3a0a 2020 2020 2020  evel > 9:.      
-00005a60: 2020 2020 2020 7365 6c66 2e5f 6c65 7665        self._leve
-00005a70: 6c20 3d20 390a 0a20 2020 2064 6566 205f  l = 9..    def _
-00005a80: 696e 6974 2873 656c 6629 3a0a 2020 2020  init(self):.    
-00005a90: 2020 2020 7072 6f70 7320 3d20 6c7a 6d61      props = lzma
-00005aa0: 2e5f 656e 636f 6465 5f66 696c 7465 725f  ._encode_filter_
-00005ab0: 7072 6f70 6572 7469 6573 287b 2769 6427  properties({'id'
-00005ac0: 3a20 6c7a 6d61 2e46 494c 5445 525f 4c5a  : lzma.FILTER_LZ
-00005ad0: 4d41 312c 2027 7072 6573 6574 273a 2073  MA1, 'preset': s
-00005ae0: 656c 662e 5f6c 6576 656c 7d29 0a20 2020  elf._level}).   
-00005af0: 2020 2020 2073 656c 662e 5f63 6f6d 7020       self._comp 
-00005b00: 3d20 6c7a 6d61 2e4c 5a4d 4143 6f6d 7072  = lzma.LZMACompr
-00005b10: 6573 736f 7228 6c7a 6d61 2e46 4f52 4d41  essor(lzma.FORMA
-00005b20: 545f 5241 572c 2066 696c 7465 7273 3d5b  T_RAW, filters=[
-00005b30: 0a20 2020 2020 2020 2020 2020 206c 7a6d  .            lzm
-00005b40: 612e 5f64 6563 6f64 655f 6669 6c74 6572  a._decode_filter
-00005b50: 5f70 726f 7065 7274 6965 7328 6c7a 6d61  _properties(lzma
-00005b60: 2e46 494c 5445 525f 4c5a 4d41 312c 2070  .FILTER_LZMA1, p
-00005b70: 726f 7073 290a 2020 2020 2020 2020 5d29  rops).        ])
-00005b80: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00005b90: 7374 7275 6374 2e70 6163 6b28 273c 4242  struct.pack('<BB
-00005ba0: 4827 2c20 392c 2034 2c20 6c65 6e28 7072  H', 9, 4, len(pr
-00005bb0: 6f70 7329 2920 2b20 7072 6f70 730a 0a20  ops)) + props.. 
-00005bc0: 2020 2064 6566 2063 6f6d 7072 6573 7328     def compress(
-00005bd0: 7365 6c66 2c20 6461 7461 293a 0a20 2020  self, data):.   
-00005be0: 2020 2020 2069 6620 7365 6c66 2e5f 636f       if self._co
-00005bf0: 6d70 2069 7320 4e6f 6e65 3a0a 2020 2020  mp is None:.    
-00005c00: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00005c10: 656c 662e 5f69 6e69 7428 2920 2b20 7365  elf._init() + se
-00005c20: 6c66 2e5f 636f 6d70 2e63 6f6d 7072 6573  lf._comp.compres
-00005c30: 7328 6461 7461 290a 2020 2020 2020 2020  s(data).        
-00005c40: 7265 7475 726e 2073 656c 662e 5f63 6f6d  return self._com
-00005c50: 702e 636f 6d70 7265 7373 2864 6174 6129  p.compress(data)
-00005c60: 0a0a 2020 2020 6465 6620 666c 7573 6828  ..    def flush(
-00005c70: 7365 6c66 293a 0a20 2020 2020 2020 2069  self):.        i
-00005c80: 6620 7365 6c66 2e5f 636f 6d70 2069 7320  f self._comp is 
-00005c90: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00005ca0: 2020 7265 7475 726e 2073 656c 662e 5f69    return self._i
-00005cb0: 6e69 7428 2920 2b20 7365 6c66 2e5f 636f  nit() + self._co
-00005cc0: 6d70 2e66 6c75 7368 2829 0a20 2020 2020  mp.flush().     
-00005cd0: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-00005ce0: 636f 6d70 2e66 6c75 7368 2829 0a0a 636c  comp.flush()..cl
-00005cf0: 6173 7320 4c5a 4d41 4465 636f 6d70 7265  ass LZMADecompre
-00005d00: 7373 6f72 286f 626a 6563 7429 3a0a 0a20  ssor(object):.. 
-00005d10: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
-00005d20: 7365 6c66 293a 0a20 2020 2020 2020 2073  self):.        s
-00005d30: 656c 662e 5f64 6563 6f6d 7020 3d20 4e6f  elf._decomp = No
-00005d40: 6e65 0a20 2020 2020 2020 2073 656c 662e  ne.        self.
-00005d50: 5f75 6e63 6f6e 7375 6d65 6420 3d20 6227  _unconsumed = b'
-00005d60: 270a 2020 2020 2020 2020 7365 6c66 2e65  '.        self.e
-00005d70: 6f66 203d 2046 616c 7365 0a0a 2020 2020  of = False..    
-00005d80: 6465 6620 6465 636f 6d70 7265 7373 2873  def decompress(s
-00005d90: 656c 662c 2064 6174 6129 3a0a 2020 2020  elf, data):.    
-00005da0: 2020 2020 6966 2073 656c 662e 5f64 6563      if self._dec
-00005db0: 6f6d 7020 6973 204e 6f6e 653a 0a20 2020  omp is None:.   
-00005dc0: 2020 2020 2020 2020 2073 656c 662e 5f75           self._u
-00005dd0: 6e63 6f6e 7375 6d65 6420 2b3d 2064 6174  nconsumed += dat
-00005de0: 610a 2020 2020 2020 2020 2020 2020 6966  a.            if
-00005df0: 206c 656e 2873 656c 662e 5f75 6e63 6f6e   len(self._uncon
-00005e00: 7375 6d65 6429 203c 3d20 343a 0a20 2020  sumed) <= 4:.   
-00005e10: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00005e20: 7572 6e20 6227 270a 2020 2020 2020 2020  urn b''.        
-00005e30: 2020 2020 7073 697a 652c 203d 2073 7472      psize, = str
-00005e40: 7563 742e 756e 7061 636b 2827 3c48 272c  uct.unpack('<H',
-00005e50: 2073 656c 662e 5f75 6e63 6f6e 7375 6d65   self._unconsume
-00005e60: 645b 323a 345d 290a 2020 2020 2020 2020  d[2:4]).        
-00005e70: 2020 2020 6966 206c 656e 2873 656c 662e      if len(self.
-00005e80: 5f75 6e63 6f6e 7375 6d65 6429 203c 3d20  _unconsumed) <= 
-00005e90: 3420 2b20 7073 697a 653a 0a20 2020 2020  4 + psize:.     
-00005ea0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00005eb0: 6e20 6227 270a 0a20 2020 2020 2020 2020  n b''..         
-00005ec0: 2020 2073 656c 662e 5f64 6563 6f6d 7020     self._decomp 
-00005ed0: 3d20 6c7a 6d61 2e4c 5a4d 4144 6563 6f6d  = lzma.LZMADecom
-00005ee0: 7072 6573 736f 7228 6c7a 6d61 2e46 4f52  pressor(lzma.FOR
-00005ef0: 4d41 545f 5241 572c 2066 696c 7465 7273  MAT_RAW, filters
-00005f00: 3d5b 0a20 2020 2020 2020 2020 2020 2020  =[.             
-00005f10: 2020 206c 7a6d 612e 5f64 6563 6f64 655f     lzma._decode_
-00005f20: 6669 6c74 6572 5f70 726f 7065 7274 6965  filter_propertie
-00005f30: 7328 6c7a 6d61 2e46 494c 5445 525f 4c5a  s(lzma.FILTER_LZ
-00005f40: 4d41 312c 0a20 2020 2020 2020 2020 2020  MA1,.           
-00005f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005f70: 2020 2020 7365 6c66 2e5f 756e 636f 6e73      self._uncons
-00005f80: 756d 6564 5b34 3a34 202b 2070 7369 7a65  umed[4:4 + psize
-00005f90: 5d29 0a20 2020 2020 2020 2020 2020 205d  ]).            ]
-00005fa0: 290a 2020 2020 2020 2020 2020 2020 6461  ).            da
-00005fb0: 7461 203d 2073 656c 662e 5f75 6e63 6f6e  ta = self._uncon
-00005fc0: 7375 6d65 645b 3420 2b20 7073 697a 653a  sumed[4 + psize:
-00005fd0: 5d0a 2020 2020 2020 2020 2020 2020 6465  ].            de
-00005fe0: 6c20 7365 6c66 2e5f 756e 636f 6e73 756d  l self._unconsum
-00005ff0: 6564 0a0a 2020 2020 2020 2020 7265 7375  ed..        resu
-00006000: 6c74 203d 2073 656c 662e 5f64 6563 6f6d  lt = self._decom
-00006010: 702e 6465 636f 6d70 7265 7373 2864 6174  p.decompress(dat
-00006020: 6129 0a20 2020 2020 2020 2073 656c 662e  a).        self.
-00006030: 656f 6620 3d20 7365 6c66 2e5f 6465 636f  eof = self._deco
-00006040: 6d70 2e65 6f66 0a20 2020 2020 2020 2072  mp.eof.        r
-00006050: 6574 7572 6e20 7265 7375 6c74 0a0a 636c  eturn result..cl
-00006060: 6173 7320 496e 666c 6174 6536 3443 6f6d  ass Inflate64Com
-00006070: 7072 6573 736f 7228 6f62 6a65 6374 293a  pressor(object):
-00006080: 0a0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
-00006090: 5f5f 2873 656c 662c 206c 6576 656c 3d4e  __(self, level=N
-000060a0: 6f6e 6529 3a0a 2020 2020 2020 2020 2320  one):.        # 
-000060b0: 696e 666c 6174 6536 342e 4465 666c 6174  inflate64.Deflat
-000060c0: 6572 2064 6f65 7320 6e6f 7420 6861 7665  er does not have
-000060d0: 2069 7473 206f 776e 206c 6576 656c 0a20   its own level. 
-000060e0: 2020 2020 2020 2073 656c 662e 5f63 6f6d         self._com
-000060f0: 7020 3d20 696e 666c 6174 6536 342e 4465  p = inflate64.De
-00006100: 666c 6174 6572 2829 0a0a 2020 2020 6465  flater()..    de
-00006110: 6620 636f 6d70 7265 7373 2873 656c 662c  f compress(self,
-00006120: 2064 6174 6129 3a0a 2020 2020 2020 2020   data):.        
-00006130: 7265 7475 726e 2073 656c 662e 5f63 6f6d  return self._com
-00006140: 702e 6465 666c 6174 6528 6461 7461 290a  p.deflate(data).
-00006150: 0a20 2020 2064 6566 2066 6c75 7368 2873  .    def flush(s
-00006160: 656c 6629 3a0a 2020 2020 2020 2020 7265  elf):.        re
-00006170: 7475 726e 2073 656c 662e 5f63 6f6d 702e  turn self._comp.
-00006180: 666c 7573 6828 290a 0a63 6c61 7373 2049  flush()..class I
-00006190: 6e66 6c61 7465 3634 4465 636f 6d70 7265  nflate64Decompre
-000061a0: 7373 6f72 286f 626a 6563 7429 3a0a 0a20  ssor(object):.. 
-000061b0: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
-000061c0: 7365 6c66 293a 0a20 2020 2020 2020 2073  self):.        s
-000061d0: 656c 662e 5f64 6563 6f6d 7020 3d20 696e  elf._decomp = in
-000061e0: 666c 6174 6536 342e 496e 666c 6174 6572  flate64.Inflater
-000061f0: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
-00006200: 656f 6620 3d20 4661 6c73 650a 0a20 2020  eof = False..   
-00006210: 2064 6566 2064 6563 6f6d 7072 6573 7328   def decompress(
-00006220: 7365 6c66 2c20 6461 7461 293a 0a20 2020  self, data):.   
-00006230: 2020 2020 2072 6573 756c 7420 3d20 7365       result = se
-00006240: 6c66 2e5f 6465 636f 6d70 2e69 6e66 6c61  lf._decomp.infla
-00006250: 7465 2864 6174 6129 0a20 2020 2020 2020  te(data).       
-00006260: 2073 656c 662e 656f 6620 3d20 7365 6c66   self.eof = self
-00006270: 2e5f 6465 636f 6d70 2e65 6f66 0a20 2020  ._decomp.eof.   
-00006280: 2020 2020 2072 6574 7572 6e20 7265 7375       return resu
-00006290: 6c74 0a0a 636c 6173 7320 5050 4d44 436f  lt..class PPMDCo
-000062a0: 6d70 7265 7373 6f72 286f 626a 6563 7429  mpressor(object)
-000062b0: 3a0a 0a20 2020 2064 6566 205f 5f69 6e69  :..    def __ini
-000062c0: 745f 5f28 7365 6c66 2c20 6c65 7665 6c3d  t__(self, level=
-000062d0: 4e6f 6e65 293a 0a20 2020 2020 2020 2073  None):.        s
-000062e0: 656c 662e 5f63 6f6d 7020 3d20 4e6f 6e65  elf._comp = None
-000062f0: 0a20 2020 2020 2020 2073 656c 662e 5f6c  .        self._l
-00006300: 6576 656c 203d 206c 6576 656c 0a20 2020  evel = level.   
-00006310: 2020 2020 2069 6620 7365 6c66 2e5f 6c65       if self._le
-00006320: 7665 6c20 6973 204e 6f6e 653a 0a20 2020  vel is None:.   
-00006330: 2020 2020 2020 2020 2073 656c 662e 5f6c           self._l
-00006340: 6576 656c 203d 2035 0a20 2020 2020 2020  evel = 5.       
-00006350: 2069 6620 7365 6c66 2e5f 6c65 7665 6c20   if self._level 
-00006360: 3c20 313a 0a20 2020 2020 2020 2020 2020  < 1:.           
-00006370: 2073 656c 662e 5f6c 6576 656c 203d 2031   self._level = 1
-00006380: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00006390: 2e5f 6c65 7665 6c20 3e20 393a 0a20 2020  ._level > 9:.   
-000063a0: 2020 2020 2020 2020 2073 656c 662e 5f6c           self._l
-000063b0: 6576 656c 203d 2039 0a0a 2020 2020 6465  evel = 9..    de
-000063c0: 6620 5f69 6e69 7428 7365 6c66 293a 0a20  f _init(self):. 
-000063d0: 2020 2020 2020 2023 2323 206c 6576 656c         ### level
-000063e0: 2069 6e74 6572 7072 6574 6174 696f 6e20   interpretation 
-000063f0: 2323 230a 2020 2020 2020 2020 2320 6874  ###.        # ht
-00006400: 7470 733a 2f2f 6769 7468 7562 2e63 6f6d  tps://github.com
-00006410: 2f6a 696e 6665 6968 616e 3537 2f70 377a  /jinfeihan57/p7z
-00006420: 6970 2f62 6c6f 622f 7631 372e 3034 2f43  ip/blob/v17.04/C
-00006430: 5050 2f37 7a69 702f 436f 6d70 7265 7373  PP/7zip/Compress
-00006440: 2f50 706d 645a 6970 2e63 7070 234c 3135  /PpmdZip.cpp#L15
-00006450: 350a 2020 2020 2020 2020 2320 6279 2074  5.        # by t
-00006460: 6865 2077 6179 2c20 7573 696e 6720 6e75  he way, using nu
-00006470: 6d65 7269 6320 7061 7261 6d65 7465 7220  meric parameter 
-00006480: 6973 206e 6f74 2063 6f76 6572 6564 2062  is not covered b
-00006490: 7920 4c47 504c 2028 6163 636f 7264 696e  y LGPL (accordin
-000064a0: 6720 746f 2063 6c61 7573 6520 3329 2e0a  g to clause 3)..
-000064b0: 2020 2020 2020 2020 6f72 6465 7220 3d20          order = 
-000064c0: 3320 2b20 7365 6c66 2e5f 6c65 7665 6c0a  3 + self._level.
-000064d0: 2020 2020 2020 2020 7361 7369 7a65 203d          sasize =
-000064e0: 2031 203c 3c20 6d69 6e28 7365 6c66 2e5f   1 << min(self._
-000064f0: 6c65 7665 6c2c 2038 290a 2020 2020 2020  level, 8).      
-00006500: 2020 7265 7374 6f72 655f 6d65 7468 6f64    restore_method
-00006510: 203d 2030 2069 6620 7365 6c66 2e5f 6c65   = 0 if self._le
-00006520: 7665 6c20 3c20 3720 656c 7365 2031 0a20  vel < 7 else 1. 
-00006530: 2020 2020 2020 2023 2323 206c 6576 656c         ### level
-00006540: 2069 6e74 6572 7072 6574 6174 696f 6e20   interpretation 
-00006550: 656e 6420 2323 230a 0a20 2020 2020 2020  end ###..       
-00006560: 2070 726f 7020 3d20 286f 7264 6572 2d31   prop = (order-1
-00006570: 2920 7c20 2873 6173 697a 652d 3129 3c3c  ) | (sasize-1)<<
-00006580: 3420 7c20 2872 6573 746f 7265 5f6d 6574  4 | (restore_met
-00006590: 686f 6429 3c3c 3132 3b0a 2020 2020 2020  hod)<<12;.      
-000065a0: 2020 7365 6c66 2e5f 636f 6d70 203d 2070    self._comp = p
-000065b0: 7970 706d 642e 5070 6d64 3845 6e63 6f64  yppmd.Ppmd8Encod
-000065c0: 6572 286f 7264 6572 2c20 7361 7369 7a65  er(order, sasize
-000065d0: 3c3c 3230 2c20 7265 7374 6f72 655f 6d65  <<20, restore_me
-000065e0: 7468 6f64 3d72 6573 746f 7265 5f6d 6574  thod=restore_met
-000065f0: 686f 6429 0a20 2020 2020 2020 2072 6574  hod).        ret
-00006600: 7572 6e20 7374 7275 6374 2e70 6163 6b28  urn struct.pack(
-00006610: 273c 4827 2c20 7072 6f70 290a 0a20 2020  '<H', prop)..   
-00006620: 2064 6566 2063 6f6d 7072 6573 7328 7365   def compress(se
-00006630: 6c66 2c20 6461 7461 293a 0a20 2020 2020  lf, data):.     
-00006640: 2020 2069 6620 7365 6c66 2e5f 636f 6d70     if self._comp
-00006650: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-00006660: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00006670: 662e 5f69 6e69 7428 2920 2b20 7365 6c66  f._init() + self
-00006680: 2e5f 636f 6d70 2e65 6e63 6f64 6528 6461  ._comp.encode(da
-00006690: 7461 290a 2020 2020 2020 2020 7265 7475  ta).        retu
-000066a0: 726e 2073 656c 662e 5f63 6f6d 702e 656e  rn self._comp.en
-000066b0: 636f 6465 2864 6174 6129 0a0a 2020 2020  code(data)..    
-000066c0: 6465 6620 666c 7573 6828 7365 6c66 293a  def flush(self):
-000066d0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-000066e0: 2e5f 636f 6d70 2069 7320 4e6f 6e65 3a0a  ._comp is None:.
-000066f0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00006700: 726e 2073 656c 662e 5f69 6e69 7428 2920  rn self._init() 
-00006710: 2b20 7365 6c66 2e5f 636f 6d70 2e66 6c75  + self._comp.flu
-00006720: 7368 2829 0a20 2020 2020 2020 2072 6574  sh().        ret
-00006730: 7572 6e20 7365 6c66 2e5f 636f 6d70 2e66  urn self._comp.f
-00006740: 6c75 7368 2829 0a0a 636c 6173 7320 5050  lush()..class PP
-00006750: 4d44 4465 636f 6d70 7265 7373 6f72 286f  MDDecompressor(o
-00006760: 626a 6563 7429 3a0a 0a20 2020 2064 6566  bject):..    def
-00006770: 205f 5f69 6e69 745f 5f28 7365 6c66 293a   __init__(self):
-00006780: 0a20 2020 2020 2020 2073 656c 662e 5f64  .        self._d
-00006790: 6563 6f6d 7020 3d20 4e6f 6e65 0a20 2020  ecomp = None.   
-000067a0: 2020 2020 2073 656c 662e 5f75 6e63 6f6e       self._uncon
-000067b0: 7375 6d65 6420 3d20 6227 270a 2020 2020  sumed = b''.    
-000067c0: 2020 2020 7365 6c66 2e65 6f66 203d 2046      self.eof = F
-000067d0: 616c 7365 0a0a 2020 2020 6465 6620 6465  alse..    def de
-000067e0: 636f 6d70 7265 7373 2873 656c 662c 2064  compress(self, d
-000067f0: 6174 6129 3a0a 2020 2020 2020 2020 6966  ata):.        if
-00006800: 2073 656c 662e 5f64 6563 6f6d 7020 6973   self._decomp is
-00006810: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00006820: 2020 2073 656c 662e 5f75 6e63 6f6e 7375     self._unconsu
-00006830: 6d65 6420 2b3d 2064 6174 610a 2020 2020  med += data.    
-00006840: 2020 2020 2020 2020 6966 206c 656e 2873          if len(s
-00006850: 656c 662e 5f75 6e63 6f6e 7375 6d65 6429  elf._unconsumed)
-00006860: 203c 3d20 323a 0a20 2020 2020 2020 2020   <= 2:.         
-00006870: 2020 2020 2020 2072 6574 7572 6e20 6227         return b'
-00006880: 270a 2020 2020 2020 2020 2020 2020 7072  '.            pr
-00006890: 6f70 2c20 3d20 7374 7275 6374 2e75 6e70  op, = struct.unp
-000068a0: 6163 6b28 273c 4827 2c20 7365 6c66 2e5f  ack('<H', self._
-000068b0: 756e 636f 6e73 756d 6564 5b3a 325d 290a  unconsumed[:2]).
-000068c0: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
-000068d0: 7220 3d20 2870 726f 7026 3078 3030 3066  r = (prop&0x000f
-000068e0: 292b 310a 2020 2020 2020 2020 2020 2020  )+1.            
-000068f0: 7361 7369 7a65 203d 2028 2870 726f 7026  sasize = ((prop&
-00006900: 3078 3066 6630 293e 3e34 292b 310a 2020  0x0ff0)>>4)+1.  
-00006910: 2020 2020 2020 2020 2020 7265 7374 6f72            restor
-00006920: 655f 6d65 7468 6f64 203d 2028 7072 6f70  e_method = (prop
-00006930: 2630 7866 3030 3029 3e3e 3132 0a0a 2020  &0xf000)>>12..  
-00006940: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00006950: 6465 636f 6d70 203d 2070 7970 706d 642e  decomp = pyppmd.
-00006960: 5070 6d64 3844 6563 6f64 6572 286f 7264  Ppmd8Decoder(ord
-00006970: 6572 2c20 7361 7369 7a65 3c3c 3230 2c20  er, sasize<<20, 
-00006980: 7265 7374 6f72 655f 6d65 7468 6f64 3d72  restore_method=r
-00006990: 6573 746f 7265 5f6d 6574 686f 6429 0a20  estore_method). 
-000069a0: 2020 2020 2020 2020 2020 2064 6174 6120             data 
-000069b0: 3d20 7365 6c66 2e5f 756e 636f 6e73 756d  = self._unconsum
-000069c0: 6564 5b32 3a5d 0a20 2020 2020 2020 2020  ed[2:].         
-000069d0: 2020 2064 656c 2073 656c 662e 5f75 6e63     del self._unc
-000069e0: 6f6e 7375 6d65 640a 0a20 2020 2020 2020  onsumed..       
-000069f0: 2072 6573 756c 7420 3d20 7365 6c66 2e5f   result = self._
-00006a00: 6465 636f 6d70 2e64 6563 6f64 6528 6461  decomp.decode(da
-00006a10: 7461 290a 2020 2020 2020 2020 7365 6c66  ta).        self
-00006a20: 2e65 6f66 203d 2073 656c 662e 5f64 6563  .eof = self._dec
-00006a30: 6f6d 702e 656f 660a 2020 2020 2020 2020  omp.eof.        
-00006a40: 7265 7475 726e 2072 6573 756c 740a 0a63  return result..c
-00006a50: 6f6d 7072 6573 736f 725f 6e61 6d65 7320  ompressor_names 
-00006a60: 3d20 7b0a 2020 2020 303a 2027 7374 6f72  = {.    0: 'stor
-00006a70: 6527 2c0a 2020 2020 313a 2027 7368 7269  e',.    1: 'shri
-00006a80: 6e6b 272c 0a20 2020 2032 3a20 2772 6564  nk',.    2: 'red
-00006a90: 7563 6527 2c0a 2020 2020 333a 2027 7265  uce',.    3: 're
-00006aa0: 6475 6365 272c 0a20 2020 2034 3a20 2772  duce',.    4: 'r
-00006ab0: 6564 7563 6527 2c0a 2020 2020 353a 2027  educe',.    5: '
-00006ac0: 7265 6475 6365 272c 0a20 2020 2036 3a20  reduce',.    6: 
-00006ad0: 2769 6d70 6c6f 6465 272c 0a20 2020 2037  'implode',.    7
-00006ae0: 3a20 2774 6f6b 656e 697a 6527 2c0a 2020  : 'tokenize',.  
-00006af0: 2020 383a 2027 6465 666c 6174 6527 2c0a    8: 'deflate',.
-00006b00: 2020 2020 393a 2027 6465 666c 6174 6536      9: 'deflate6
-00006b10: 3427 2c0a 2020 2020 3130 3a20 2769 6d70  4',.    10: 'imp
-00006b20: 6c6f 6465 272c 0a20 2020 2031 323a 2027  lode',.    12: '
-00006b30: 627a 6970 3227 2c0a 2020 2020 3134 3a20  bzip2',.    14: 
-00006b40: 276c 7a6d 6127 2c0a 2020 2020 3138 3a20  'lzma',.    18: 
-00006b50: 2774 6572 7365 272c 0a20 2020 2031 393a  'terse',.    19:
-00006b60: 2027 6c7a 3737 272c 0a20 2020 2039 333a   'lz77',.    93:
-00006b70: 2027 7a73 7461 6e64 6172 6427 2c0a 2020   'zstandard',.  
-00006b80: 2020 3934 3a20 276d 7033 272c 0a20 2020    94: 'mp3',.   
-00006b90: 2039 353a 2027 787a 272c 0a20 2020 2039   95: 'xz',.    9
-00006ba0: 363a 2027 6a70 6567 272c 0a20 2020 2039  6: 'jpeg',.    9
-00006bb0: 373a 2027 7761 7670 6163 6b27 2c0a 2020  7: 'wavpack',.  
-00006bc0: 2020 3938 3a20 2770 706d 6427 2c0a 2020    98: 'ppmd',.  
-00006bd0: 2020 3939 3a20 2761 6573 272c 0a7d 0a0a    99: 'aes',.}..
-00006be0: 6465 6620 5f63 6865 636b 5f63 6f6d 7072  def _check_compr
-00006bf0: 6573 7369 6f6e 2863 6f6d 7072 6573 7369  ession(compressi
-00006c00: 6f6e 293a 0a20 2020 2069 6620 636f 6d70  on):.    if comp
-00006c10: 7265 7373 696f 6e20 3d3d 205a 4950 5f53  ression == ZIP_S
-00006c20: 544f 5245 443a 0a20 2020 2020 2020 2070  TORED:.        p
-00006c30: 6173 730a 2020 2020 656c 6966 2063 6f6d  ass.    elif com
-00006c40: 7072 6573 7369 6f6e 203d 3d20 5a49 505f  pression == ZIP_
-00006c50: 4445 464c 4154 4544 3a0a 2020 2020 2020  DEFLATED:.      
-00006c60: 2020 6966 206e 6f74 207a 6c69 623a 0a20    if not zlib:. 
-00006c70: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00006c80: 2052 756e 7469 6d65 4572 726f 7228 0a20   RuntimeError(. 
-00006c90: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00006ca0: 436f 6d70 7265 7373 696f 6e20 7265 7175  Compression requ
-00006cb0: 6972 6573 2074 6865 2028 6d69 7373 696e  ires the (missin
-00006cc0: 6729 207a 6c69 6220 6d6f 6475 6c65 2229  g) zlib module")
-00006cd0: 0a20 2020 2065 6c69 6620 636f 6d70 7265  .    elif compre
-00006ce0: 7373 696f 6e20 3d3d 205a 4950 5f44 4546  ssion == ZIP_DEF
-00006cf0: 4c41 5445 4436 343a 0a20 2020 2020 2020  LATED64:.       
-00006d00: 2069 6620 6e6f 7420 6465 666c 6174 6536   if not deflate6
-00006d10: 3420 616e 6420 6e6f 7420 696e 666c 6174  4 and not inflat
-00006d20: 6536 343a 0a20 2020 2020 2020 2020 2020  e64:.           
-00006d30: 2072 6169 7365 2052 756e 7469 6d65 4572   raise RuntimeEr
-00006d40: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-00006d50: 2020 2020 2022 436f 6d70 7265 7373 696f       "Compressio
-00006d60: 6e20 7265 7175 6972 6573 2074 6865 2028  n requires the (
-00006d70: 6d69 7373 696e 6729 2064 6566 6c61 7465  missing) deflate
-00006d80: 3634 206d 6f64 756c 6522 290a 2020 2020  64 module").    
-00006d90: 656c 6966 2063 6f6d 7072 6573 7369 6f6e  elif compression
-00006da0: 203d 3d20 5a49 505f 4443 4c49 4d50 4c4f   == ZIP_DCLIMPLO
-00006db0: 4445 443a 0a20 2020 2020 2020 2069 6620  DED:.        if 
-00006dc0: 6e6f 7420 6463 6c69 6d70 6c6f 6465 3a0a  not dclimplode:.
-00006dd0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00006de0: 6520 5275 6e74 696d 6545 7272 6f72 280a  e RuntimeError(.
-00006df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006e00: 2243 6f6d 7072 6573 7369 6f6e 2072 6571  "Compression req
-00006e10: 7569 7265 7320 7468 6520 286d 6973 7369  uires the (missi
-00006e20: 6e67 2920 6463 6c69 6d70 6c6f 6465 206d  ng) dclimplode m
-00006e30: 6f64 756c 6522 290a 2020 2020 656c 6966  odule").    elif
-00006e40: 2063 6f6d 7072 6573 7369 6f6e 203d 3d20   compression == 
-00006e50: 5a49 505f 425a 4950 323a 0a20 2020 2020  ZIP_BZIP2:.     
-00006e60: 2020 2069 6620 6e6f 7420 627a 323a 0a20     if not bz2:. 
-00006e70: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00006e80: 2052 756e 7469 6d65 4572 726f 7228 0a20   RuntimeError(. 
-00006e90: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00006ea0: 436f 6d70 7265 7373 696f 6e20 7265 7175  Compression requ
-00006eb0: 6972 6573 2074 6865 2028 6d69 7373 696e  ires the (missin
-00006ec0: 6729 2062 7a32 206d 6f64 756c 6522 290a  g) bz2 module").
-00006ed0: 2020 2020 656c 6966 2063 6f6d 7072 6573      elif compres
-00006ee0: 7369 6f6e 203d 3d20 5a49 505f 4c5a 4d41  sion == ZIP_LZMA
-00006ef0: 206f 7220 636f 6d70 7265 7373 696f 6e20   or compression 
-00006f00: 3d3d 205a 4950 5f58 5a3a 0a20 2020 2020  == ZIP_XZ:.     
-00006f10: 2020 2069 6620 6e6f 7420 6c7a 6d61 3a0a     if not lzma:.
-00006f20: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00006f30: 6520 5275 6e74 696d 6545 7272 6f72 280a  e RuntimeError(.
-00006f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006f50: 2243 6f6d 7072 6573 7369 6f6e 2072 6571  "Compression req
-00006f60: 7569 7265 7320 7468 6520 286d 6973 7369  uires the (missi
-00006f70: 6e67 2920 6c7a 6d61 206d 6f64 756c 6522  ng) lzma module"
-00006f80: 290a 2020 2020 656c 6966 2063 6f6d 7072  ).    elif compr
-00006f90: 6573 7369 6f6e 203d 3d20 5a49 505f 5a53  ession == ZIP_ZS
-00006fa0: 5441 4e44 4152 443a 0a20 2020 2020 2020  TANDARD:.       
-00006fb0: 2069 6620 6e6f 7420 7a73 7461 6e64 6172   if not zstandar
-00006fc0: 6420 616e 6420 6e6f 7420 7079 7a73 7464  d and not pyzstd
-00006fd0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-00006fe0: 6973 6520 5275 6e74 696d 6545 7272 6f72  ise RuntimeError
-00006ff0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00007000: 2020 2243 6f6d 7072 6573 7369 6f6e 2072    "Compression r
-00007010: 6571 7569 7265 7320 7468 6520 286d 6973  equires the (mis
-00007020: 7369 6e67 2920 7a73 7461 6e64 6172 6420  sing) zstandard 
-00007030: 6d6f 6475 6c65 2229 0a20 2020 2065 6c69  module").    eli
-00007040: 6620 636f 6d70 7265 7373 696f 6e20 3d3d  f compression ==
-00007050: 205a 4950 5f50 504d 443a 0a20 2020 2020   ZIP_PPMD:.     
-00007060: 2020 2069 6620 6e6f 7420 7079 7070 6d64     if not pyppmd
-00007070: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-00007080: 6973 6520 5275 6e74 696d 6545 7272 6f72  ise RuntimeError
-00007090: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000070a0: 2020 2243 6f6d 7072 6573 7369 6f6e 2072    "Compression r
-000070b0: 6571 7569 7265 7320 7468 6520 286d 6973  equires the (mis
-000070c0: 7369 6e67 2920 7079 7070 6d64 206d 6f64  sing) pyppmd mod
-000070d0: 756c 6522 290a 2020 2020 656c 7365 3a0a  ule").    else:.
-000070e0: 2020 2020 2020 2020 7261 6973 6520 4e6f          raise No
-000070f0: 7449 6d70 6c65 6d65 6e74 6564 4572 726f  tImplementedErro
-00007100: 7228 2254 6861 7420 636f 6d70 7265 7373  r("That compress
-00007110: 696f 6e20 6d65 7468 6f64 2069 7320 6e6f  ion method is no
-00007120: 7420 7375 7070 6f72 7465 6422 290a 0a0a  t supported")...
-00007130: 6465 6620 5f67 6574 5f63 6f6d 7072 6573  def _get_compres
-00007140: 736f 7228 636f 6d70 7265 7373 5f74 7970  sor(compress_typ
-00007150: 652c 2063 6f6d 7072 6573 736c 6576 656c  e, compresslevel
-00007160: 3d4e 6f6e 6529 3a0a 2020 2020 6966 2063  =None):.    if c
-00007170: 6f6d 7072 6573 735f 7479 7065 203d 3d20  ompress_type == 
-00007180: 5a49 505f 4445 464c 4154 4544 3a0a 2020  ZIP_DEFLATED:.  
-00007190: 2020 2020 2020 6966 2063 6f6d 7072 6573        if compres
-000071a0: 736c 6576 656c 2069 7320 6e6f 7420 4e6f  slevel is not No
-000071b0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-000071c0: 6966 2063 6f6d 7072 6573 736c 6576 656c  if compresslevel
-000071d0: 203c 202d 3230 3a0a 2020 2020 2020 2020   < -20:.        
-000071e0: 2020 2020 2020 2020 6173 7365 7274 2073          assert s
-000071f0: 6c7a 2069 7320 6e6f 7420 4e6f 6e65 0a20  lz is not None. 
-00007200: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00007210: 6574 7572 6e20 736c 7a2e 636f 6d70 7265  eturn slz.compre
-00007220: 7373 6f62 6a28 290a 2020 2020 2020 2020  ssobj().        
-00007230: 2020 2020 6966 2063 6f6d 7072 6573 736c      if compressl
-00007240: 6576 656c 203c 3d20 2d31 303a 0a20 2020  evel <= -10:.   
-00007250: 2020 2020 2020 2020 2020 2020 2061 7373               ass
-00007260: 6572 7420 6973 616c 5f7a 6c69 6220 6973  ert isal_zlib is
-00007270: 206e 6f74 204e 6f6e 650a 2020 2020 2020   not None.      
-00007280: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00007290: 2069 7361 6c5f 7a6c 6962 2e63 6f6d 7072   isal_zlib.compr
-000072a0: 6573 736f 626a 282d 2863 6f6d 7072 6573  essobj(-(compres
-000072b0: 736c 6576 656c 2b31 3029 2c20 6973 616c  slevel+10), isal
-000072c0: 5f7a 6c69 622e 4445 464c 4154 4544 2c20  _zlib.DEFLATED, 
-000072d0: 2d31 352c 2039 290a 2020 2020 2020 2020  -15, 9).        
-000072e0: 2020 2020 6966 2063 6f6d 7072 6573 736c      if compressl
-000072f0: 6576 656c 203e 3d20 3130 3a0a 2020 2020  evel >= 10:.    
-00007300: 2020 2020 2020 2020 2020 2020 6173 7365              asse
-00007310: 7274 2063 6f64 6563 7337 7a20 6973 206e  rt codecs7z is n
-00007320: 6f74 204e 6f6e 650a 2020 2020 2020 2020  ot None.        
-00007330: 2020 2020 2020 2020 7265 7475 726e 2063          return c
-00007340: 6f64 6563 7337 7a2e 6465 666c 6174 655f  odecs7z.deflate_
-00007350: 636f 6d70 7265 7373 6f62 6a28 636f 6d70  compressobj(comp
-00007360: 7265 7373 6c65 7665 6c2d 3130 290a 2020  resslevel-10).  
-00007370: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00007380: 207a 6c69 622e 636f 6d70 7265 7373 6f62   zlib.compressob
-00007390: 6a28 636f 6d70 7265 7373 6c65 7665 6c2c  j(compresslevel,
-000073a0: 207a 6c69 622e 4445 464c 4154 4544 2c20   zlib.DEFLATED, 
-000073b0: 2d31 3529 0a20 2020 2020 2020 2072 6574  -15).        ret
-000073c0: 7572 6e20 7a6c 6962 2e63 6f6d 7072 6573  urn zlib.compres
-000073d0: 736f 626a 287a 6c69 622e 5a5f 4445 4641  sobj(zlib.Z_DEFA
-000073e0: 554c 545f 434f 4d50 5245 5353 494f 4e2c  ULT_COMPRESSION,
-000073f0: 207a 6c69 622e 4445 464c 4154 4544 2c20   zlib.DEFLATED, 
-00007400: 2d31 3529 0a20 2020 2065 6c69 6620 636f  -15).    elif co
-00007410: 6d70 7265 7373 5f74 7970 6520 3d3d 205a  mpress_type == Z
-00007420: 4950 5f44 4546 4c41 5445 4436 343a 0a20  IP_DEFLATED64:. 
-00007430: 2020 2020 2020 2069 6620 636f 6d70 7265         if compre
-00007440: 7373 6c65 7665 6c20 3e3d 2031 303a 0a20  sslevel >= 10:. 
-00007450: 2020 2020 2020 2020 2020 2023 2072 6573             # res
-00007460: 6572 7665 6420 636f 6d70 7265 7373 206c  erved compress l
-00007470: 6576 656c 2065 7665 6e20 6166 7465 7220  evel even after 
-00007480: 2274 7275 6520 6465 666c 6174 6536 3420  "true deflate64 
-00007490: 6d6f 6475 6c65 2220 6973 206f 7574 0a20  module" is out. 
-000074a0: 2020 2020 2020 2020 2020 2061 7373 6572             asser
-000074b0: 7420 636f 6465 6373 377a 2069 7320 6e6f  t codecs7z is no
-000074c0: 7420 4e6f 6e65 0a20 2020 2020 2020 2020  t None.         
-000074d0: 2020 2072 6574 7572 6e20 636f 6465 6373     return codecs
-000074e0: 377a 2e64 6566 6c61 7465 3634 5f63 6f6d  7z.deflate64_com
-000074f0: 7072 6573 736f 626a 2863 6f6d 7072 6573  pressobj(compres
-00007500: 736c 6576 656c 2d31 3029 0a20 2020 2020  slevel-10).     
-00007510: 2020 2061 7373 6572 7420 636f 6465 6373     assert codecs
-00007520: 377a 2069 7320 6e6f 7420 4e6f 6e65 206f  7z is not None o
-00007530: 7220 696e 666c 6174 6536 3420 6973 206e  r inflate64 is n
-00007540: 6f74 204e 6f6e 650a 2020 2020 2020 2020  ot None.        
-00007550: 6966 2069 6e66 6c61 7465 3634 2069 7320  if inflate64 is 
-00007560: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00007570: 2020 2020 2020 7265 7475 726e 2049 6e66        return Inf
-00007580: 6c61 7465 3634 436f 6d70 7265 7373 6f72  late64Compressor
-00007590: 2863 6f6d 7072 6573 736c 6576 656c 290a  (compresslevel).
-000075a0: 2020 2020 2020 2020 7265 7475 726e 2063          return c
-000075b0: 6f64 6563 7337 7a2e 6465 666c 6174 6536  odecs7z.deflate6
-000075c0: 345f 636f 6d70 7265 7373 6f62 6a28 636f  4_compressobj(co
-000075d0: 6d70 7265 7373 6c65 7665 6c29 0a20 2020  mpresslevel).   
-000075e0: 2065 6c69 6620 636f 6d70 7265 7373 5f74   elif compress_t
-000075f0: 7970 6520 3d3d 205a 4950 5f44 434c 494d  ype == ZIP_DCLIM
-00007600: 504c 4f44 4544 3a0a 2020 2020 2020 2020  PLODED:.        
-00007610: 6966 2063 6f6d 7072 6573 736c 6576 656c  if compresslevel
-00007620: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-00007630: 2020 2020 2020 636f 6d70 7265 7373 6c65        compressle
-00007640: 7665 6c20 3d20 330a 2020 2020 2020 2020  vel = 3.        
-00007650: 636f 6d70 7265 7373 6d65 7468 6f64 203d  compressmethod =
-00007660: 2063 6f6d 7072 6573 736c 6576 656c 2f2f   compresslevel//
-00007670: 3130 0a20 2020 2020 2020 2063 6f6d 7072  10.        compr
-00007680: 6573 736c 6576 656c 203d 2063 6f6d 7072  esslevel = compr
-00007690: 6573 736c 6576 656c 2531 300a 2020 2020  esslevel%10.    
-000076a0: 2020 2020 6173 7365 7274 2064 636c 696d      assert dclim
-000076b0: 706c 6f64 6520 6973 206e 6f74 204e 6f6e  plode is not Non
-000076c0: 650a 2020 2020 2020 2020 7265 7475 726e  e.        return
-000076d0: 2064 636c 696d 706c 6f64 652e 636f 6d70   dclimplode.comp
+00004aa0: 2020 2020 2020 7365 6c66 2e66 696c 655f        self.file_
+00004ab0: 7369 7a65 2c20 3d20 756e 7061 636b 2827  size, = unpack('
+00004ac0: 3c51 272c 2064 6174 615b 3a38 5d29 0a20  <Q', data[:8]). 
+00004ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004ae0: 2020 2020 2020 2064 6174 6120 3d20 6461         data = da
+00004af0: 7461 5b38 3a5d 0a20 2020 2020 2020 2020  ta[8:].         
+00004b00: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+00004b10: 6c66 2e63 6f6d 7072 6573 735f 7369 7a65  lf.compress_size
+00004b20: 203d 3d20 3078 4646 4646 4646 4646 3a0a   == 0xFFFFFFFF:.
+00004b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004b40: 2020 2020 2020 2020 6669 656c 6420 3d20          field = 
+00004b50: 2243 6f6d 7072 6573 7320 7369 7a65 220a  "Compress size".
+00004b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004b70: 2020 2020 2020 2020 7365 6c66 2e63 6f6d          self.com
+00004b80: 7072 6573 735f 7369 7a65 2c20 3d20 756e  press_size, = un
+00004b90: 7061 636b 2827 3c51 272c 2064 6174 615b  pack('<Q', data[
+00004ba0: 3a38 5d29 0a20 2020 2020 2020 2020 2020  :8]).           
+00004bb0: 2020 2020 2020 2020 2020 2020 2064 6174               dat
+00004bc0: 6120 3d20 6461 7461 5b38 3a5d 0a20 2020  a = data[8:].   
+00004bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004be0: 2069 6620 7365 6c66 2e68 6561 6465 725f   if self.header_
+00004bf0: 6f66 6673 6574 203d 3d20 3078 4646 4646  offset == 0xFFFF
+00004c00: 4646 4646 3a0a 2020 2020 2020 2020 2020  FFFF:.          
+00004c10: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+00004c20: 656c 6420 3d20 2248 6561 6465 7220 6f66  eld = "Header of
+00004c30: 6673 6574 220a 2020 2020 2020 2020 2020  fset".          
+00004c40: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00004c50: 6c66 2e68 6561 6465 725f 6f66 6673 6574  lf.header_offset
+00004c60: 2c20 3d20 756e 7061 636b 2827 3c51 272c  , = unpack('<Q',
+00004c70: 2064 6174 615b 3a38 5d29 0a20 2020 2020   data[:8]).     
+00004c80: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+00004c90: 7420 7374 7275 6374 2e65 7272 6f72 3a0a  t struct.error:.
+00004ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004cb0: 2020 2020 7261 6973 6520 4261 645a 6970      raise BadZip
+00004cc0: 4669 6c65 2822 436f 7272 7570 7420 7a69  File("Corrupt zi
+00004cd0: 7036 3420 6578 7472 6120 6669 656c 642e  p64 extra field.
+00004ce0: 2025 7320 6e6f 7420 666f 756e 642e 2225   %s not found."%
+00004cf0: 6669 656c 6429 0a0a 2020 2020 2020 2020  field)..        
+00004d00: 2020 2020 6578 7472 6120 3d20 6578 7472      extra = extr
+00004d10: 615b 6c6e 2b34 3a5d 0a0a 2020 2020 4063  a[ln+4:]..    @c
+00004d20: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
+00004d30: 6566 2066 726f 6d5f 6669 6c65 2863 6c73  ef from_file(cls
+00004d40: 2c20 6669 6c65 6e61 6d65 2c20 6172 636e  , filename, arcn
+00004d50: 616d 653d 4e6f 6e65 2c20 7374 7269 6374  ame=None, strict
+00004d60: 5f74 696d 6573 7461 6d70 733d 5472 7565  _timestamps=True
+00004d70: 293a 0a20 2020 2020 2020 2022 2222 436f  ):.        """Co
+00004d80: 6e73 7472 7563 7420 616e 2061 7070 726f  nstruct an appro
+00004d90: 7072 6961 7465 205a 6970 496e 666f 2066  priate ZipInfo f
+00004da0: 6f72 2061 2066 696c 6520 6f6e 2074 6865  or a file on the
+00004db0: 2066 696c 6573 7973 7465 6d2e 0a0a 2020   filesystem...  
+00004dc0: 2020 2020 2020 6669 6c65 6e61 6d65 2073        filename s
+00004dd0: 686f 756c 6420 6265 2074 6865 2070 6174  hould be the pat
+00004de0: 6820 746f 2061 2066 696c 6520 6f72 2064  h to a file or d
+00004df0: 6972 6563 746f 7279 206f 6e20 7468 6520  irectory on the 
+00004e00: 6669 6c65 7379 7374 656d 2e0a 0a20 2020  filesystem...   
+00004e10: 2020 2020 2061 7263 6e61 6d65 2069 7320       arcname is 
+00004e20: 7468 6520 6e61 6d65 2077 6869 6368 2069  the name which i
+00004e30: 7420 7769 6c6c 2068 6176 6520 7769 7468  t will have with
+00004e40: 696e 2074 6865 2061 7263 6869 7665 2028  in the archive (
+00004e50: 6279 2064 6566 6175 6c74 2c0a 2020 2020  by default,.    
+00004e60: 2020 2020 7468 6973 2077 696c 6c20 6265      this will be
+00004e70: 2074 6865 2073 616d 6520 6173 2066 696c   the same as fil
+00004e80: 656e 616d 652c 2062 7574 2077 6974 686f  ename, but witho
+00004e90: 7574 2061 2064 7269 7665 206c 6574 7465  ut a drive lette
+00004ea0: 7220 616e 6420 7769 7468 0a20 2020 2020  r and with.     
+00004eb0: 2020 206c 6561 6469 6e67 2070 6174 6820     leading path 
+00004ec0: 7365 7061 7261 746f 7273 2072 656d 6f76  separators remov
+00004ed0: 6564 292e 0a20 2020 2020 2020 2022 2222  ed)..        """
+00004ee0: 0a20 2020 2020 2020 2069 6620 7379 732e  .        if sys.
+00004ef0: 7665 7273 696f 6e5f 696e 666f 3e3d 2833  version_info>=(3
+00004f00: 2c36 293a 0a20 2020 2020 2020 2020 2020  ,6):.           
+00004f10: 2069 6620 6973 696e 7374 616e 6365 2866   if isinstance(f
+00004f20: 696c 656e 616d 652c 206f 732e 5061 7468  ilename, os.Path
+00004f30: 4c69 6b65 293a 0a20 2020 2020 2020 2020  Like):.         
+00004f40: 2020 2020 2020 2066 696c 656e 616d 6520         filename 
+00004f50: 3d20 6f73 2e66 7370 6174 6828 6669 6c65  = os.fspath(file
+00004f60: 6e61 6d65 290a 2020 2020 2020 2020 7374  name).        st
+00004f70: 203d 206f 732e 7374 6174 2866 696c 656e   = os.stat(filen
+00004f80: 616d 6529 0a20 2020 2020 2020 2069 7364  ame).        isd
+00004f90: 6972 203d 2073 7461 742e 535f 4953 4449  ir = stat.S_ISDI
+00004fa0: 5228 7374 2e73 745f 6d6f 6465 290a 2020  R(st.st_mode).  
+00004fb0: 2020 2020 2020 6d74 696d 6520 3d20 7469        mtime = ti
+00004fc0: 6d65 2e6c 6f63 616c 7469 6d65 2873 742e  me.localtime(st.
+00004fd0: 7374 5f6d 7469 6d65 290a 2020 2020 2020  st_mtime).      
+00004fe0: 2020 6461 7465 5f74 696d 6520 3d20 6d74    date_time = mt
+00004ff0: 696d 655b 303a 365d 0a20 2020 2020 2020  ime[0:6].       
+00005000: 2069 6620 6e6f 7420 7374 7269 6374 5f74   if not strict_t
+00005010: 696d 6573 7461 6d70 7320 616e 6420 6461  imestamps and da
+00005020: 7465 5f74 696d 655b 305d 203c 2031 3938  te_time[0] < 198
+00005030: 303a 0a20 2020 2020 2020 2020 2020 2064  0:.            d
+00005040: 6174 655f 7469 6d65 203d 2028 3139 3830  ate_time = (1980
+00005050: 2c20 312c 2031 2c20 302c 2030 2c20 3029  , 1, 1, 0, 0, 0)
+00005060: 0a20 2020 2020 2020 2065 6c69 6620 6e6f  .        elif no
+00005070: 7420 7374 7269 6374 5f74 696d 6573 7461  t strict_timesta
+00005080: 6d70 7320 616e 6420 6461 7465 5f74 696d  mps and date_tim
+00005090: 655b 305d 203e 2032 3130 373a 0a20 2020  e[0] > 2107:.   
+000050a0: 2020 2020 2020 2020 2064 6174 655f 7469           date_ti
+000050b0: 6d65 203d 2028 3231 3037 2c20 3132 2c20  me = (2107, 12, 
+000050c0: 3331 2c20 3233 2c20 3539 2c20 3539 290a  31, 23, 59, 59).
+000050d0: 2020 2020 2020 2020 2320 4372 6561 7465          # Create
+000050e0: 205a 6970 496e 666f 2069 6e73 7461 6e63   ZipInfo instanc
+000050f0: 6520 746f 2073 746f 7265 2066 696c 6520  e to store file 
+00005100: 696e 666f 726d 6174 696f 6e0a 2020 2020  information.    
+00005110: 2020 2020 6966 2061 7263 6e61 6d65 2069      if arcname i
+00005120: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00005130: 2020 2020 6172 636e 616d 6520 3d20 6669      arcname = fi
+00005140: 6c65 6e61 6d65 0a20 2020 2020 2020 2061  lename.        a
+00005150: 7263 6e61 6d65 203d 206f 732e 7061 7468  rcname = os.path
+00005160: 2e6e 6f72 6d70 6174 6828 6f73 2e70 6174  .normpath(os.pat
+00005170: 682e 7370 6c69 7464 7269 7665 2861 7263  h.splitdrive(arc
+00005180: 6e61 6d65 295b 315d 290a 2020 2020 2020  name)[1]).      
+00005190: 2020 7768 696c 6520 6172 636e 616d 655b    while arcname[
+000051a0: 305d 2069 6e20 286f 732e 7365 702c 206f  0] in (os.sep, o
+000051b0: 732e 616c 7473 6570 293a 0a20 2020 2020  s.altsep):.     
+000051c0: 2020 2020 2020 2061 7263 6e61 6d65 203d         arcname =
+000051d0: 2061 7263 6e61 6d65 5b31 3a5d 0a20 2020   arcname[1:].   
+000051e0: 2020 2020 2069 6620 6973 6469 723a 0a20       if isdir:. 
+000051f0: 2020 2020 2020 2020 2020 2061 7263 6e61             arcna
+00005200: 6d65 202b 3d20 272f 270a 2020 2020 2020  me += '/'.      
+00005210: 2020 7a69 6e66 6f20 3d20 636c 7328 6172    zinfo = cls(ar
+00005220: 636e 616d 652c 2064 6174 655f 7469 6d65  cname, date_time
+00005230: 290a 2020 2020 2020 2020 7a69 6e66 6f2e  ).        zinfo.
+00005240: 6578 7465 726e 616c 5f61 7474 7220 3d20  external_attr = 
+00005250: 2873 742e 7374 5f6d 6f64 6520 2620 3078  (st.st_mode & 0x
+00005260: 4646 4646 2920 3c3c 2031 3620 2023 2055  FFFF) << 16  # U
+00005270: 6e69 7820 6174 7472 6962 7574 6573 0a20  nix attributes. 
+00005280: 2020 2020 2020 2069 6620 6973 6469 723a         if isdir:
+00005290: 0a20 2020 2020 2020 2020 2020 207a 696e  .            zin
+000052a0: 666f 2e66 696c 655f 7369 7a65 203d 2030  fo.file_size = 0
+000052b0: 0a20 2020 2020 2020 2020 2020 207a 696e  .            zin
+000052c0: 666f 2e65 7874 6572 6e61 6c5f 6174 7472  fo.external_attr
+000052d0: 207c 3d20 3078 3130 2020 2320 4d53 2d44   |= 0x10  # MS-D
+000052e0: 4f53 2064 6972 6563 746f 7279 2066 6c61  OS directory fla
+000052f0: 670a 2020 2020 2020 2020 656c 7365 3a0a  g.        else:.
+00005300: 2020 2020 2020 2020 2020 2020 7a69 6e66              zinf
+00005310: 6f2e 6669 6c65 5f73 697a 6520 3d20 7374  o.file_size = st
+00005320: 2e73 745f 7369 7a65 0a0a 2020 2020 2020  .st_size..      
+00005330: 2020 7265 7475 726e 207a 696e 666f 0a0a    return zinfo..
+00005340: 2020 2020 6465 6620 6973 5f64 6972 2873      def is_dir(s
+00005350: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
+00005360: 2252 6574 7572 6e20 5472 7565 2069 6620  "Return True if 
+00005370: 7468 6973 2061 7263 6869 7665 206d 656d  this archive mem
+00005380: 6265 7220 6973 2061 2064 6972 6563 746f  ber is a directo
+00005390: 7279 2e22 2222 0a20 2020 2020 2020 2072  ry.""".        r
+000053a0: 6574 7572 6e20 7365 6c66 2e66 696c 656e  eturn self.filen
+000053b0: 616d 655b 2d31 5d20 3d3d 2027 2f27 0a0a  ame[-1] == '/'..
+000053c0: 0a23 205a 4950 2065 6e63 7279 7074 696f  .# ZIP encryptio
+000053d0: 6e20 7573 6573 2074 6865 2043 5243 3332  n uses the CRC32
+000053e0: 206f 6e65 2d62 7974 6520 7072 696d 6974   one-byte primit
+000053f0: 6976 6520 666f 7220 7363 7261 6d62 6c69  ive for scrambli
+00005400: 6e67 2073 6f6d 650a 2320 696e 7465 726e  ng some.# intern
+00005410: 616c 206b 6579 732e 2057 6520 6e6f 7469  al keys. We noti
+00005420: 6365 6420 7468 6174 2061 2064 6972 6563  ced that a direc
+00005430: 7420 696d 706c 656d 656e 7461 7469 6f6e  t implementation
+00005440: 2069 7320 6661 7374 6572 2074 6861 6e0a   is faster than.
+00005450: 2320 7265 6c79 696e 6720 6f6e 2062 696e  # relying on bin
+00005460: 6173 6369 692e 6372 6333 3228 292e 0a0a  ascii.crc32()...
+00005470: 5f63 7263 7461 626c 6520 3d20 4e6f 6e65  _crctable = None
+00005480: 0a64 6566 205f 6765 6e5f 6372 6328 6372  .def _gen_crc(cr
+00005490: 6329 3a0a 2020 2020 666f 7220 6a20 696e  c):.    for j in
+000054a0: 2072 616e 6765 2838 293a 0a20 2020 2020   range(8):.     
+000054b0: 2020 2069 6620 6372 6320 2620 313a 0a20     if crc & 1:. 
+000054c0: 2020 2020 2020 2020 2020 2063 7263 203d             crc =
+000054d0: 2028 6372 6320 3e3e 2031 2920 5e20 3078   (crc >> 1) ^ 0x
+000054e0: 4544 4238 3833 3230 0a20 2020 2020 2020  EDB88320.       
+000054f0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00005500: 2020 2063 7263 203e 3e3d 2031 0a20 2020     crc >>= 1.   
+00005510: 2072 6574 7572 6e20 6372 630a 0a23 205a   return crc..# Z
+00005520: 4950 2073 7570 706f 7274 7320 6120 7061  IP supports a pa
+00005530: 7373 776f 7264 2d62 6173 6564 2066 6f72  ssword-based for
+00005540: 6d20 6f66 2065 6e63 7279 7074 696f 6e2e  m of encryption.
+00005550: 2045 7665 6e20 7468 6f75 6768 206b 6e6f   Even though kno
+00005560: 776e 0a23 2070 6c61 696e 7465 7874 2061  wn.# plaintext a
+00005570: 7474 6163 6b73 2068 6176 6520 6265 656e  ttacks have been
+00005580: 2066 6f75 6e64 2061 6761 696e 7374 2069   found against i
+00005590: 742c 2069 7420 6973 2073 7469 6c6c 2075  t, it is still u
+000055a0: 7365 6675 6c0a 2320 746f 2062 6520 6162  seful.# to be ab
+000055b0: 6c65 2074 6f20 6765 7420 6461 7461 206f  le to get data o
+000055c0: 7574 206f 6620 7375 6368 2061 2066 696c  ut of such a fil
+000055d0: 652e 0a23 0a23 2055 7361 6765 3a0a 2320  e..#.# Usage:.# 
+000055e0: 2020 2020 7a64 203d 205f 5a69 7044 6563      zd = _ZipDec
+000055f0: 7279 7074 6572 286d 7970 7764 290a 2320  rypter(mypwd).# 
+00005600: 2020 2020 706c 6169 6e5f 6279 7465 7320      plain_bytes 
+00005610: 3d20 7a64 2863 7970 6865 725f 6279 7465  = zd(cypher_byte
+00005620: 7329 0a0a 636c 6173 7320 5f5a 6970 4465  s)..class _ZipDe
+00005630: 6372 7970 7465 7228 6f62 6a65 6374 293a  crypter(object):
+00005640: 0a0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
+00005650: 5f5f 2873 656c 662c 2070 7764 293a 0a20  __(self, pwd):. 
+00005660: 2020 2020 2020 2073 656c 662e 6b65 7930         self.key0
+00005670: 203d 2033 3035 3431 3938 3936 0a20 2020   = 305419896.   
+00005680: 2020 2020 2073 656c 662e 6b65 7931 203d       self.key1 =
+00005690: 2035 3931 3735 3130 3439 0a20 2020 2020   591751049.     
+000056a0: 2020 2073 656c 662e 6b65 7932 203d 2038     self.key2 = 8
+000056b0: 3738 3038 3231 3932 0a0a 2020 2020 2020  78082192..      
+000056c0: 2020 666f 7220 7020 696e 2070 7764 3a0a    for p in pwd:.
+000056d0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000056e0: 2e75 7064 6174 655f 6b65 7973 2870 290a  .update_keys(p).
+000056f0: 0a20 2020 2020 2020 2067 6c6f 6261 6c20  .        global 
+00005700: 5f63 7263 7461 626c 650a 2020 2020 2020  _crctable.      
+00005710: 2020 6966 205f 6372 6374 6162 6c65 2069    if _crctable i
+00005720: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00005730: 2020 2020 5f63 7263 7461 626c 6520 3d20      _crctable = 
+00005740: 6c69 7374 286d 6170 285f 6765 6e5f 6372  list(map(_gen_cr
+00005750: 632c 2072 616e 6765 2832 3536 2929 290a  c, range(256))).
+00005760: 2020 2020 2020 2020 7365 6c66 2e63 7263          self.crc
+00005770: 7461 626c 6520 3d20 5f63 7263 7461 626c  table = _crctabl
+00005780: 650a 0a20 2020 2064 6566 2063 7263 3332  e..    def crc32
+00005790: 2873 656c 662c 2063 682c 2063 7263 293a  (self, ch, crc):
+000057a0: 0a20 2020 2020 2020 2022 2222 436f 6d70  .        """Comp
+000057b0: 7574 6520 7468 6520 4352 4333 3220 7072  ute the CRC32 pr
+000057c0: 696d 6974 6976 6520 6f6e 206f 6e65 2062  imitive on one b
+000057d0: 7974 652e 2222 220a 2020 2020 2020 2020  yte.""".        
+000057e0: 7265 7475 726e 2028 6372 6320 3e3e 2038  return (crc >> 8
+000057f0: 2920 5e20 7365 6c66 2e63 7263 7461 626c  ) ^ self.crctabl
+00005800: 655b 2863 7263 205e 2063 6829 2026 2030  e[(crc ^ ch) & 0
+00005810: 7846 465d 0a0a 2020 2020 6465 6620 7570  xFF]..    def up
+00005820: 6461 7465 5f6b 6579 7328 7365 6c66 2c20  date_keys(self, 
+00005830: 6329 3a0a 2020 2020 2020 2020 7365 6c66  c):.        self
+00005840: 2e6b 6579 3020 3d20 7365 6c66 2e63 7263  .key0 = self.crc
+00005850: 3332 2863 2c20 7365 6c66 2e6b 6579 3029  32(c, self.key0)
+00005860: 0a20 2020 2020 2020 2073 656c 662e 6b65  .        self.ke
+00005870: 7931 203d 2028 7365 6c66 2e6b 6579 3120  y1 = (self.key1 
+00005880: 2b20 2873 656c 662e 6b65 7930 2026 2030  + (self.key0 & 0
+00005890: 7846 4629 2920 2620 3078 4646 4646 4646  xFF)) & 0xFFFFFF
+000058a0: 4646 0a20 2020 2020 2020 2073 656c 662e  FF.        self.
+000058b0: 6b65 7931 203d 2028 7365 6c66 2e6b 6579  key1 = (self.key
+000058c0: 3120 2a20 3133 3437 3735 3831 3320 2b20  1 * 134775813 + 
+000058d0: 3129 2026 2030 7846 4646 4646 4646 460a  1) & 0xFFFFFFFF.
+000058e0: 2020 2020 2020 2020 7365 6c66 2e6b 6579          self.key
+000058f0: 3220 3d20 7365 6c66 2e63 7263 3332 2873  2 = self.crc32(s
+00005900: 656c 662e 6b65 7931 203e 3e20 3234 2c20  elf.key1 >> 24, 
+00005910: 7365 6c66 2e6b 6579 3229 0a0a 2020 2020  self.key2)..    
+00005920: 6465 6620 5f5f 6361 6c6c 5f5f 2873 656c  def __call__(sel
+00005930: 662c 2064 6174 6129 3a0a 2020 2020 2020  f, data):.      
+00005940: 2020 2222 2244 6563 7279 7074 2061 2062    """Decrypt a b
+00005950: 7974 6573 206f 626a 6563 742e 2222 220a  ytes object.""".
+00005960: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
+00005970: 2062 7974 6561 7272 6179 2829 0a20 2020   bytearray().   
+00005980: 2020 2020 2061 7070 656e 6420 3d20 7265       append = re
+00005990: 7375 6c74 2e61 7070 656e 640a 2020 2020  sult.append.    
+000059a0: 2020 2020 666f 7220 6320 696e 2064 6174      for c in dat
+000059b0: 613a 0a20 2020 2020 2020 2020 2020 206b  a:.            k
+000059c0: 203d 2073 656c 662e 6b65 7932 207c 2032   = self.key2 | 2
+000059d0: 0a20 2020 2020 2020 2020 2020 2063 205e  .            c ^
+000059e0: 3d20 2828 6b20 2a20 286b 5e31 2929 203e  = ((k * (k^1)) >
+000059f0: 3e20 3829 2026 2030 7846 460a 2020 2020  > 8) & 0xFF.    
+00005a00: 2020 2020 2020 2020 7365 6c66 2e75 7064          self.upd
+00005a10: 6174 655f 6b65 7973 2863 290a 2020 2020  ate_keys(c).    
+00005a20: 2020 2020 2020 2020 6170 7065 6e64 2863          append(c
+00005a30: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00005a40: 2062 7974 6573 2872 6573 756c 7429 0a0a   bytes(result)..
+00005a50: 636c 6173 7320 4c5a 4d41 436f 6d70 7265  class LZMACompre
+00005a60: 7373 6f72 286f 626a 6563 7429 3a0a 0a20  ssor(object):.. 
+00005a70: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
+00005a80: 7365 6c66 2c20 6c65 7665 6c3d 4e6f 6e65  self, level=None
+00005a90: 293a 0a20 2020 2020 2020 2073 656c 662e  ):.        self.
+00005aa0: 5f63 6f6d 7020 3d20 4e6f 6e65 0a20 2020  _comp = None.   
+00005ab0: 2020 2020 2073 656c 662e 5f6c 6576 656c       self._level
+00005ac0: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
+00005ad0: 7365 6c66 2e5f 6c65 7665 6c20 3d20 6c65  self._level = le
+00005ae0: 7665 6c0a 2020 2020 2020 2020 6966 2073  vel.        if s
+00005af0: 656c 662e 5f6c 6576 656c 2069 7320 4e6f  elf._level is No
+00005b00: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00005b10: 7365 6c66 2e5f 6c65 7665 6c20 3d20 360a  self._level = 6.
+00005b20: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00005b30: 5f6c 6576 656c 203c 2031 3a0a 2020 2020  _level < 1:.    
+00005b40: 2020 2020 2020 2020 7365 6c66 2e5f 6c65          self._le
+00005b50: 7665 6c20 3d20 310a 2020 2020 2020 2020  vel = 1.        
+00005b60: 6966 2073 656c 662e 5f6c 6576 656c 203e  if self._level >
+00005b70: 2039 3a0a 2020 2020 2020 2020 2020 2020   9:.            
+00005b80: 7365 6c66 2e5f 6c65 7665 6c20 3d20 390a  self._level = 9.
+00005b90: 0a20 2020 2064 6566 205f 696e 6974 2873  .    def _init(s
+00005ba0: 656c 6629 3a0a 2020 2020 2020 2020 7072  elf):.        pr
+00005bb0: 6f70 7320 3d20 6c7a 6d61 2e5f 656e 636f  ops = lzma._enco
+00005bc0: 6465 5f66 696c 7465 725f 7072 6f70 6572  de_filter_proper
+00005bd0: 7469 6573 287b 2769 6427 3a20 6c7a 6d61  ties({'id': lzma
+00005be0: 2e46 494c 5445 525f 4c5a 4d41 312c 2027  .FILTER_LZMA1, '
+00005bf0: 7072 6573 6574 273a 2073 656c 662e 5f6c  preset': self._l
+00005c00: 6576 656c 7d29 0a20 2020 2020 2020 2073  evel}).        s
+00005c10: 656c 662e 5f63 6f6d 7020 3d20 6c7a 6d61  elf._comp = lzma
+00005c20: 2e4c 5a4d 4143 6f6d 7072 6573 736f 7228  .LZMACompressor(
+00005c30: 6c7a 6d61 2e46 4f52 4d41 545f 5241 572c  lzma.FORMAT_RAW,
+00005c40: 2066 696c 7465 7273 3d5b 0a20 2020 2020   filters=[.     
+00005c50: 2020 2020 2020 206c 7a6d 612e 5f64 6563         lzma._dec
+00005c60: 6f64 655f 6669 6c74 6572 5f70 726f 7065  ode_filter_prope
+00005c70: 7274 6965 7328 6c7a 6d61 2e46 494c 5445  rties(lzma.FILTE
+00005c80: 525f 4c5a 4d41 312c 2070 726f 7073 290a  R_LZMA1, props).
+00005c90: 2020 2020 2020 2020 5d29 0a20 2020 2020          ]).     
+00005ca0: 2020 2072 6574 7572 6e20 7374 7275 6374     return struct
+00005cb0: 2e70 6163 6b28 273c 4242 4827 2c20 392c  .pack('<BBH', 9,
+00005cc0: 2034 2c20 6c65 6e28 7072 6f70 7329 2920   4, len(props)) 
+00005cd0: 2b20 7072 6f70 730a 0a20 2020 2064 6566  + props..    def
+00005ce0: 2063 6f6d 7072 6573 7328 7365 6c66 2c20   compress(self, 
+00005cf0: 6461 7461 293a 0a20 2020 2020 2020 2069  data):.        i
+00005d00: 6620 7365 6c66 2e5f 636f 6d70 2069 7320  f self._comp is 
+00005d10: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00005d20: 2020 7265 7475 726e 2073 656c 662e 5f69    return self._i
+00005d30: 6e69 7428 2920 2b20 7365 6c66 2e5f 636f  nit() + self._co
+00005d40: 6d70 2e63 6f6d 7072 6573 7328 6461 7461  mp.compress(data
+00005d50: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00005d60: 2073 656c 662e 5f63 6f6d 702e 636f 6d70   self._comp.comp
+00005d70: 7265 7373 2864 6174 6129 0a0a 2020 2020  ress(data)..    
+00005d80: 6465 6620 666c 7573 6828 7365 6c66 293a  def flush(self):
+00005d90: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00005da0: 2e5f 636f 6d70 2069 7320 4e6f 6e65 3a0a  ._comp is None:.
+00005db0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00005dc0: 726e 2073 656c 662e 5f69 6e69 7428 2920  rn self._init() 
+00005dd0: 2b20 7365 6c66 2e5f 636f 6d70 2e66 6c75  + self._comp.flu
+00005de0: 7368 2829 0a20 2020 2020 2020 2072 6574  sh().        ret
+00005df0: 7572 6e20 7365 6c66 2e5f 636f 6d70 2e66  urn self._comp.f
+00005e00: 6c75 7368 2829 0a0a 636c 6173 7320 4c5a  lush()..class LZ
+00005e10: 4d41 4465 636f 6d70 7265 7373 6f72 286f  MADecompressor(o
+00005e20: 626a 6563 7429 3a0a 0a20 2020 2064 6566  bject):..    def
+00005e30: 205f 5f69 6e69 745f 5f28 7365 6c66 293a   __init__(self):
+00005e40: 0a20 2020 2020 2020 2073 656c 662e 5f64  .        self._d
+00005e50: 6563 6f6d 7020 3d20 4e6f 6e65 0a20 2020  ecomp = None.   
+00005e60: 2020 2020 2073 656c 662e 5f75 6e63 6f6e       self._uncon
+00005e70: 7375 6d65 6420 3d20 6227 270a 2020 2020  sumed = b''.    
+00005e80: 2020 2020 7365 6c66 2e65 6f66 203d 2046      self.eof = F
+00005e90: 616c 7365 0a0a 2020 2020 6465 6620 6465  alse..    def de
+00005ea0: 636f 6d70 7265 7373 2873 656c 662c 2064  compress(self, d
+00005eb0: 6174 6129 3a0a 2020 2020 2020 2020 6966  ata):.        if
+00005ec0: 2073 656c 662e 5f64 6563 6f6d 7020 6973   self._decomp is
+00005ed0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00005ee0: 2020 2073 656c 662e 5f75 6e63 6f6e 7375     self._unconsu
+00005ef0: 6d65 6420 2b3d 2064 6174 610a 2020 2020  med += data.    
+00005f00: 2020 2020 2020 2020 6966 206c 656e 2873          if len(s
+00005f10: 656c 662e 5f75 6e63 6f6e 7375 6d65 6429  elf._unconsumed)
+00005f20: 203c 3d20 343a 0a20 2020 2020 2020 2020   <= 4:.         
+00005f30: 2020 2020 2020 2072 6574 7572 6e20 6227         return b'
+00005f40: 270a 2020 2020 2020 2020 2020 2020 7073  '.            ps
+00005f50: 697a 652c 203d 2073 7472 7563 742e 756e  ize, = struct.un
+00005f60: 7061 636b 2827 3c48 272c 2073 656c 662e  pack('<H', self.
+00005f70: 5f75 6e63 6f6e 7375 6d65 645b 323a 345d  _unconsumed[2:4]
+00005f80: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00005f90: 206c 656e 2873 656c 662e 5f75 6e63 6f6e   len(self._uncon
+00005fa0: 7375 6d65 6429 203c 3d20 3420 2b20 7073  sumed) <= 4 + ps
+00005fb0: 697a 653a 0a20 2020 2020 2020 2020 2020  ize:.           
+00005fc0: 2020 2020 2072 6574 7572 6e20 6227 270a       return b''.
+00005fd0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00005fe0: 662e 5f64 6563 6f6d 7020 3d20 6c7a 6d61  f._decomp = lzma
+00005ff0: 2e4c 5a4d 4144 6563 6f6d 7072 6573 736f  .LZMADecompresso
+00006000: 7228 6c7a 6d61 2e46 4f52 4d41 545f 5241  r(lzma.FORMAT_RA
+00006010: 572c 2066 696c 7465 7273 3d5b 0a20 2020  W, filters=[.   
+00006020: 2020 2020 2020 2020 2020 2020 206c 7a6d               lzm
+00006030: 612e 5f64 6563 6f64 655f 6669 6c74 6572  a._decode_filter
+00006040: 5f70 726f 7065 7274 6965 7328 6c7a 6d61  _properties(lzma
+00006050: 2e46 494c 5445 525f 4c5a 4d41 312c 0a20  .FILTER_LZMA1,. 
+00006060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006080: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00006090: 6c66 2e5f 756e 636f 6e73 756d 6564 5b34  lf._unconsumed[4
+000060a0: 3a34 202b 2070 7369 7a65 5d29 0a20 2020  :4 + psize]).   
+000060b0: 2020 2020 2020 2020 205d 290a 2020 2020           ]).    
+000060c0: 2020 2020 2020 2020 6461 7461 203d 2073          data = s
+000060d0: 656c 662e 5f75 6e63 6f6e 7375 6d65 645b  elf._unconsumed[
+000060e0: 3420 2b20 7073 697a 653a 5d0a 2020 2020  4 + psize:].    
+000060f0: 2020 2020 2020 2020 6465 6c20 7365 6c66          del self
+00006100: 2e5f 756e 636f 6e73 756d 6564 0a0a 2020  ._unconsumed..  
+00006110: 2020 2020 2020 7265 7375 6c74 203d 2073        result = s
+00006120: 656c 662e 5f64 6563 6f6d 702e 6465 636f  elf._decomp.deco
+00006130: 6d70 7265 7373 2864 6174 6129 0a20 2020  mpress(data).   
+00006140: 2020 2020 2073 656c 662e 656f 6620 3d20       self.eof = 
+00006150: 7365 6c66 2e5f 6465 636f 6d70 2e65 6f66  self._decomp.eof
+00006160: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00006170: 7265 7375 6c74 0a0a 636c 6173 7320 496e  result..class In
+00006180: 666c 6174 6536 3443 6f6d 7072 6573 736f  flate64Compresso
+00006190: 7228 6f62 6a65 6374 293a 0a0a 2020 2020  r(object):..    
+000061a0: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
+000061b0: 662c 206c 6576 656c 3d4e 6f6e 6529 3a0a  f, level=None):.
+000061c0: 2020 2020 2020 2020 2320 696e 666c 6174          # inflat
+000061d0: 6536 342e 4465 666c 6174 6572 2064 6f65  e64.Deflater doe
+000061e0: 7320 6e6f 7420 6861 7665 2069 7473 206f  s not have its o
+000061f0: 776e 206c 6576 656c 0a20 2020 2020 2020  wn level.       
+00006200: 2073 656c 662e 5f63 6f6d 7020 3d20 696e   self._comp = in
+00006210: 666c 6174 6536 342e 4465 666c 6174 6572  flate64.Deflater
+00006220: 2829 0a0a 2020 2020 6465 6620 636f 6d70  ()..    def comp
+00006230: 7265 7373 2873 656c 662c 2064 6174 6129  ress(self, data)
+00006240: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+00006250: 2073 656c 662e 5f63 6f6d 702e 6465 666c   self._comp.defl
+00006260: 6174 6528 6461 7461 290a 0a20 2020 2064  ate(data)..    d
+00006270: 6566 2066 6c75 7368 2873 656c 6629 3a0a  ef flush(self):.
+00006280: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00006290: 656c 662e 5f63 6f6d 702e 666c 7573 6828  elf._comp.flush(
+000062a0: 290a 0a63 6c61 7373 2049 6e66 6c61 7465  )..class Inflate
+000062b0: 3634 4465 636f 6d70 7265 7373 6f72 286f  64Decompressor(o
+000062c0: 626a 6563 7429 3a0a 0a20 2020 2064 6566  bject):..    def
+000062d0: 205f 5f69 6e69 745f 5f28 7365 6c66 293a   __init__(self):
+000062e0: 0a20 2020 2020 2020 2073 656c 662e 5f64  .        self._d
+000062f0: 6563 6f6d 7020 3d20 696e 666c 6174 6536  ecomp = inflate6
+00006300: 342e 496e 666c 6174 6572 2829 0a20 2020  4.Inflater().   
+00006310: 2020 2020 2073 656c 662e 656f 6620 3d20       self.eof = 
+00006320: 4661 6c73 650a 0a20 2020 2064 6566 2064  False..    def d
+00006330: 6563 6f6d 7072 6573 7328 7365 6c66 2c20  ecompress(self, 
+00006340: 6461 7461 293a 0a20 2020 2020 2020 2072  data):.        r
+00006350: 6573 756c 7420 3d20 7365 6c66 2e5f 6465  esult = self._de
+00006360: 636f 6d70 2e69 6e66 6c61 7465 2864 6174  comp.inflate(dat
+00006370: 6129 0a20 2020 2020 2020 2073 656c 662e  a).        self.
+00006380: 656f 6620 3d20 7365 6c66 2e5f 6465 636f  eof = self._deco
+00006390: 6d70 2e65 6f66 0a20 2020 2020 2020 2072  mp.eof.        r
+000063a0: 6574 7572 6e20 7265 7375 6c74 0a0a 636c  eturn result..cl
+000063b0: 6173 7320 5050 4d44 436f 6d70 7265 7373  ass PPMDCompress
+000063c0: 6f72 286f 626a 6563 7429 3a0a 0a20 2020  or(object):..   
+000063d0: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
+000063e0: 6c66 2c20 6c65 7665 6c3d 4e6f 6e65 293a  lf, level=None):
+000063f0: 0a20 2020 2020 2020 2073 656c 662e 5f63  .        self._c
+00006400: 6f6d 7020 3d20 4e6f 6e65 0a20 2020 2020  omp = None.     
+00006410: 2020 2073 656c 662e 5f6c 6576 656c 203d     self._level =
+00006420: 206c 6576 656c 0a20 2020 2020 2020 2069   level.        i
+00006430: 6620 7365 6c66 2e5f 6c65 7665 6c20 6973  f self._level is
+00006440: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00006450: 2020 2073 656c 662e 5f6c 6576 656c 203d     self._level =
+00006460: 2035 0a20 2020 2020 2020 2069 6620 7365   5.        if se
+00006470: 6c66 2e5f 6c65 7665 6c20 3c20 313a 0a20  lf._level < 1:. 
+00006480: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00006490: 5f6c 6576 656c 203d 2031 0a20 2020 2020  _level = 1.     
+000064a0: 2020 2069 6620 7365 6c66 2e5f 6c65 7665     if self._leve
+000064b0: 6c20 3e20 393a 0a20 2020 2020 2020 2020  l > 9:.         
+000064c0: 2020 2073 656c 662e 5f6c 6576 656c 203d     self._level =
+000064d0: 2039 0a0a 2020 2020 6465 6620 5f69 6e69   9..    def _ini
+000064e0: 7428 7365 6c66 293a 0a20 2020 2020 2020  t(self):.       
+000064f0: 2023 2323 206c 6576 656c 2069 6e74 6572   ### level inter
+00006500: 7072 6574 6174 696f 6e20 2323 230a 2020  pretation ###.  
+00006510: 2020 2020 2020 2320 6874 7470 733a 2f2f        # https://
+00006520: 6769 7468 7562 2e63 6f6d 2f6a 696e 6665  github.com/jinfe
+00006530: 6968 616e 3537 2f70 377a 6970 2f62 6c6f  ihan57/p7zip/blo
+00006540: 622f 7631 372e 3034 2f43 5050 2f37 7a69  b/v17.04/CPP/7zi
+00006550: 702f 436f 6d70 7265 7373 2f50 706d 645a  p/Compress/PpmdZ
+00006560: 6970 2e63 7070 234c 3135 350a 2020 2020  ip.cpp#L155.    
+00006570: 2020 2020 2320 6279 2074 6865 2077 6179      # by the way
+00006580: 2c20 7573 696e 6720 6e75 6d65 7269 6320  , using numeric 
+00006590: 7061 7261 6d65 7465 7220 6973 206e 6f74  parameter is not
+000065a0: 2063 6f76 6572 6564 2062 7920 4c47 504c   covered by LGPL
+000065b0: 2028 6163 636f 7264 696e 6720 746f 2063   (according to c
+000065c0: 6c61 7573 6520 3329 2e0a 2020 2020 2020  lause 3)..      
+000065d0: 2020 6f72 6465 7220 3d20 3320 2b20 7365    order = 3 + se
+000065e0: 6c66 2e5f 6c65 7665 6c0a 2020 2020 2020  lf._level.      
+000065f0: 2020 7361 7369 7a65 203d 2031 203c 3c20    sasize = 1 << 
+00006600: 6d69 6e28 7365 6c66 2e5f 6c65 7665 6c2c  min(self._level,
+00006610: 2038 290a 2020 2020 2020 2020 7265 7374   8).        rest
+00006620: 6f72 655f 6d65 7468 6f64 203d 2030 2069  ore_method = 0 i
+00006630: 6620 7365 6c66 2e5f 6c65 7665 6c20 3c20  f self._level < 
+00006640: 3720 656c 7365 2031 0a20 2020 2020 2020  7 else 1.       
+00006650: 2023 2323 206c 6576 656c 2069 6e74 6572   ### level inter
+00006660: 7072 6574 6174 696f 6e20 656e 6420 2323  pretation end ##
+00006670: 230a 0a20 2020 2020 2020 2070 726f 7020  #..        prop 
+00006680: 3d20 286f 7264 6572 2d31 2920 7c20 2873  = (order-1) | (s
+00006690: 6173 697a 652d 3129 3c3c 3420 7c20 2872  asize-1)<<4 | (r
+000066a0: 6573 746f 7265 5f6d 6574 686f 6429 3c3c  estore_method)<<
+000066b0: 3132 3b0a 2020 2020 2020 2020 7365 6c66  12;.        self
+000066c0: 2e5f 636f 6d70 203d 2070 7970 706d 642e  ._comp = pyppmd.
+000066d0: 5070 6d64 3845 6e63 6f64 6572 286f 7264  Ppmd8Encoder(ord
+000066e0: 6572 2c20 7361 7369 7a65 3c3c 3230 2c20  er, sasize<<20, 
+000066f0: 7265 7374 6f72 655f 6d65 7468 6f64 3d72  restore_method=r
+00006700: 6573 746f 7265 5f6d 6574 686f 6429 0a20  estore_method). 
+00006710: 2020 2020 2020 2072 6574 7572 6e20 7374         return st
+00006720: 7275 6374 2e70 6163 6b28 273c 4827 2c20  ruct.pack('<H', 
+00006730: 7072 6f70 290a 0a20 2020 2064 6566 2063  prop)..    def c
+00006740: 6f6d 7072 6573 7328 7365 6c66 2c20 6461  ompress(self, da
+00006750: 7461 293a 0a20 2020 2020 2020 2069 6620  ta):.        if 
+00006760: 7365 6c66 2e5f 636f 6d70 2069 7320 4e6f  self._comp is No
+00006770: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00006780: 7265 7475 726e 2073 656c 662e 5f69 6e69  return self._ini
+00006790: 7428 2920 2b20 7365 6c66 2e5f 636f 6d70  t() + self._comp
+000067a0: 2e65 6e63 6f64 6528 6461 7461 290a 2020  .encode(data).  
+000067b0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+000067c0: 662e 5f63 6f6d 702e 656e 636f 6465 2864  f._comp.encode(d
+000067d0: 6174 6129 0a0a 2020 2020 6465 6620 666c  ata)..    def fl
+000067e0: 7573 6828 7365 6c66 293a 0a20 2020 2020  ush(self):.     
+000067f0: 2020 2069 6620 7365 6c66 2e5f 636f 6d70     if self._comp
+00006800: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00006810: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00006820: 662e 5f69 6e69 7428 2920 2b20 7365 6c66  f._init() + self
+00006830: 2e5f 636f 6d70 2e66 6c75 7368 2829 0a20  ._comp.flush(). 
+00006840: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00006850: 6c66 2e5f 636f 6d70 2e66 6c75 7368 2829  lf._comp.flush()
+00006860: 0a0a 636c 6173 7320 5050 4d44 4465 636f  ..class PPMDDeco
+00006870: 6d70 7265 7373 6f72 286f 626a 6563 7429  mpressor(object)
+00006880: 3a0a 0a20 2020 2064 6566 205f 5f69 6e69  :..    def __ini
+00006890: 745f 5f28 7365 6c66 293a 0a20 2020 2020  t__(self):.     
+000068a0: 2020 2073 656c 662e 5f64 6563 6f6d 7020     self._decomp 
+000068b0: 3d20 4e6f 6e65 0a20 2020 2020 2020 2073  = None.        s
+000068c0: 656c 662e 5f75 6e63 6f6e 7375 6d65 6420  elf._unconsumed 
+000068d0: 3d20 6227 270a 2020 2020 2020 2020 7365  = b''.        se
+000068e0: 6c66 2e65 6f66 203d 2046 616c 7365 0a0a  lf.eof = False..
+000068f0: 2020 2020 6465 6620 6465 636f 6d70 7265      def decompre
+00006900: 7373 2873 656c 662c 2064 6174 6129 3a0a  ss(self, data):.
+00006910: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00006920: 5f64 6563 6f6d 7020 6973 204e 6f6e 653a  _decomp is None:
+00006930: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00006940: 662e 5f75 6e63 6f6e 7375 6d65 6420 2b3d  f._unconsumed +=
+00006950: 2064 6174 610a 2020 2020 2020 2020 2020   data.          
+00006960: 2020 6966 206c 656e 2873 656c 662e 5f75    if len(self._u
+00006970: 6e63 6f6e 7375 6d65 6429 203c 3d20 323a  nconsumed) <= 2:
+00006980: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006990: 2072 6574 7572 6e20 6227 270a 2020 2020   return b''.    
+000069a0: 2020 2020 2020 2020 7072 6f70 2c20 3d20          prop, = 
+000069b0: 7374 7275 6374 2e75 6e70 6163 6b28 273c  struct.unpack('<
+000069c0: 4827 2c20 7365 6c66 2e5f 756e 636f 6e73  H', self._uncons
+000069d0: 756d 6564 5b3a 325d 290a 2020 2020 2020  umed[:2]).      
+000069e0: 2020 2020 2020 6f72 6465 7220 3d20 2870        order = (p
+000069f0: 726f 7026 3078 3030 3066 292b 310a 2020  rop&0x000f)+1.  
+00006a00: 2020 2020 2020 2020 2020 7361 7369 7a65            sasize
+00006a10: 203d 2028 2870 726f 7026 3078 3066 6630   = ((prop&0x0ff0
+00006a20: 293e 3e34 292b 310a 2020 2020 2020 2020  )>>4)+1.        
+00006a30: 2020 2020 7265 7374 6f72 655f 6d65 7468      restore_meth
+00006a40: 6f64 203d 2028 7072 6f70 2630 7866 3030  od = (prop&0xf00
+00006a50: 3029 3e3e 3132 0a0a 2020 2020 2020 2020  0)>>12..        
+00006a60: 2020 2020 7365 6c66 2e5f 6465 636f 6d70      self._decomp
+00006a70: 203d 2070 7970 706d 642e 5070 6d64 3844   = pyppmd.Ppmd8D
+00006a80: 6563 6f64 6572 286f 7264 6572 2c20 7361  ecoder(order, sa
+00006a90: 7369 7a65 3c3c 3230 2c20 7265 7374 6f72  size<<20, restor
+00006aa0: 655f 6d65 7468 6f64 3d72 6573 746f 7265  e_method=restore
+00006ab0: 5f6d 6574 686f 6429 0a20 2020 2020 2020  _method).       
+00006ac0: 2020 2020 2064 6174 6120 3d20 7365 6c66       data = self
+00006ad0: 2e5f 756e 636f 6e73 756d 6564 5b32 3a5d  ._unconsumed[2:]
+00006ae0: 0a20 2020 2020 2020 2020 2020 2064 656c  .            del
+00006af0: 2073 656c 662e 5f75 6e63 6f6e 7375 6d65   self._unconsume
+00006b00: 640a 0a20 2020 2020 2020 2072 6573 756c  d..        resul
+00006b10: 7420 3d20 7365 6c66 2e5f 6465 636f 6d70  t = self._decomp
+00006b20: 2e64 6563 6f64 6528 6461 7461 290a 2020  .decode(data).  
+00006b30: 2020 2020 2020 7365 6c66 2e65 6f66 203d        self.eof =
+00006b40: 2073 656c 662e 5f64 6563 6f6d 702e 656f   self._decomp.eo
+00006b50: 660a 2020 2020 2020 2020 7265 7475 726e  f.        return
+00006b60: 2072 6573 756c 740a 0a63 6f6d 7072 6573   result..compres
+00006b70: 736f 725f 6e61 6d65 7320 3d20 7b0a 2020  sor_names = {.  
+00006b80: 2020 303a 2027 7374 6f72 6527 2c0a 2020    0: 'store',.  
+00006b90: 2020 313a 2027 7368 7269 6e6b 272c 0a20    1: 'shrink',. 
+00006ba0: 2020 2032 3a20 2772 6564 7563 6527 2c0a     2: 'reduce',.
+00006bb0: 2020 2020 333a 2027 7265 6475 6365 272c      3: 'reduce',
+00006bc0: 0a20 2020 2034 3a20 2772 6564 7563 6527  .    4: 'reduce'
+00006bd0: 2c0a 2020 2020 353a 2027 7265 6475 6365  ,.    5: 'reduce
+00006be0: 272c 0a20 2020 2036 3a20 2769 6d70 6c6f  ',.    6: 'implo
+00006bf0: 6465 272c 0a20 2020 2037 3a20 2774 6f6b  de',.    7: 'tok
+00006c00: 656e 697a 6527 2c0a 2020 2020 383a 2027  enize',.    8: '
+00006c10: 6465 666c 6174 6527 2c0a 2020 2020 393a  deflate',.    9:
+00006c20: 2027 6465 666c 6174 6536 3427 2c0a 2020   'deflate64',.  
+00006c30: 2020 3130 3a20 2769 6d70 6c6f 6465 272c    10: 'implode',
+00006c40: 0a20 2020 2031 323a 2027 627a 6970 3227  .    12: 'bzip2'
+00006c50: 2c0a 2020 2020 3134 3a20 276c 7a6d 6127  ,.    14: 'lzma'
+00006c60: 2c0a 2020 2020 3138 3a20 2774 6572 7365  ,.    18: 'terse
+00006c70: 272c 0a20 2020 2031 393a 2027 6c7a 3737  ',.    19: 'lz77
+00006c80: 272c 0a20 2020 2039 333a 2027 7a73 7461  ',.    93: 'zsta
+00006c90: 6e64 6172 6427 2c0a 2020 2020 3934 3a20  ndard',.    94: 
+00006ca0: 276d 7033 272c 0a20 2020 2039 353a 2027  'mp3',.    95: '
+00006cb0: 787a 272c 0a20 2020 2039 363a 2027 6a70  xz',.    96: 'jp
+00006cc0: 6567 272c 0a20 2020 2039 373a 2027 7761  eg',.    97: 'wa
+00006cd0: 7670 6163 6b27 2c0a 2020 2020 3938 3a20  vpack',.    98: 
+00006ce0: 2770 706d 6427 2c0a 2020 2020 3939 3a20  'ppmd',.    99: 
+00006cf0: 2761 6573 272c 0a7d 0a0a 6465 6620 5f63  'aes',.}..def _c
+00006d00: 6865 636b 5f63 6f6d 7072 6573 7369 6f6e  heck_compression
+00006d10: 2863 6f6d 7072 6573 7369 6f6e 293a 0a20  (compression):. 
+00006d20: 2020 2069 6620 636f 6d70 7265 7373 696f     if compressio
+00006d30: 6e20 3d3d 205a 4950 5f53 544f 5245 443a  n == ZIP_STORED:
+00006d40: 0a20 2020 2020 2020 2070 6173 730a 2020  .        pass.  
+00006d50: 2020 656c 6966 2063 6f6d 7072 6573 7369    elif compressi
+00006d60: 6f6e 203d 3d20 5a49 505f 4445 464c 4154  on == ZIP_DEFLAT
+00006d70: 4544 3a0a 2020 2020 2020 2020 6966 206e  ED:.        if n
+00006d80: 6f74 207a 6c69 623a 0a20 2020 2020 2020  ot zlib:.       
+00006d90: 2020 2020 2072 6169 7365 2052 756e 7469       raise Runti
+00006da0: 6d65 4572 726f 7228 0a20 2020 2020 2020  meError(.       
+00006db0: 2020 2020 2020 2020 2022 436f 6d70 7265           "Compre
+00006dc0: 7373 696f 6e20 7265 7175 6972 6573 2074  ssion requires t
+00006dd0: 6865 2028 6d69 7373 696e 6729 207a 6c69  he (missing) zli
+00006de0: 6220 6d6f 6475 6c65 2229 0a20 2020 2065  b module").    e
+00006df0: 6c69 6620 636f 6d70 7265 7373 696f 6e20  lif compression 
+00006e00: 3d3d 205a 4950 5f44 4546 4c41 5445 4436  == ZIP_DEFLATED6
+00006e10: 343a 0a20 2020 2020 2020 2069 6620 6e6f  4:.        if no
+00006e20: 7420 6465 666c 6174 6536 3420 616e 6420  t deflate64 and 
+00006e30: 6e6f 7420 696e 666c 6174 6536 343a 0a20  not inflate64:. 
+00006e40: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00006e50: 2052 756e 7469 6d65 4572 726f 7228 0a20   RuntimeError(. 
+00006e60: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00006e70: 436f 6d70 7265 7373 696f 6e20 7265 7175  Compression requ
+00006e80: 6972 6573 2074 6865 2028 6d69 7373 696e  ires the (missin
+00006e90: 6729 2064 6566 6c61 7465 3634 206d 6f64  g) deflate64 mod
+00006ea0: 756c 6522 290a 2020 2020 656c 6966 2063  ule").    elif c
+00006eb0: 6f6d 7072 6573 7369 6f6e 203d 3d20 5a49  ompression == ZI
+00006ec0: 505f 4443 4c49 4d50 4c4f 4445 443a 0a20  P_DCLIMPLODED:. 
+00006ed0: 2020 2020 2020 2069 6620 6e6f 7420 6463         if not dc
+00006ee0: 6c69 6d70 6c6f 6465 3a0a 2020 2020 2020  limplode:.      
+00006ef0: 2020 2020 2020 7261 6973 6520 5275 6e74        raise Runt
+00006f00: 696d 6545 7272 6f72 280a 2020 2020 2020  imeError(.      
+00006f10: 2020 2020 2020 2020 2020 2243 6f6d 7072            "Compr
+00006f20: 6573 7369 6f6e 2072 6571 7569 7265 7320  ession requires 
+00006f30: 7468 6520 286d 6973 7369 6e67 2920 6463  the (missing) dc
+00006f40: 6c69 6d70 6c6f 6465 206d 6f64 756c 6522  limplode module"
+00006f50: 290a 2020 2020 656c 6966 2063 6f6d 7072  ).    elif compr
+00006f60: 6573 7369 6f6e 203d 3d20 5a49 505f 425a  ession == ZIP_BZ
+00006f70: 4950 323a 0a20 2020 2020 2020 2069 6620  IP2:.        if 
+00006f80: 6e6f 7420 627a 323a 0a20 2020 2020 2020  not bz2:.       
+00006f90: 2020 2020 2072 6169 7365 2052 756e 7469       raise Runti
+00006fa0: 6d65 4572 726f 7228 0a20 2020 2020 2020  meError(.       
+00006fb0: 2020 2020 2020 2020 2022 436f 6d70 7265           "Compre
+00006fc0: 7373 696f 6e20 7265 7175 6972 6573 2074  ssion requires t
+00006fd0: 6865 2028 6d69 7373 696e 6729 2062 7a32  he (missing) bz2
+00006fe0: 206d 6f64 756c 6522 290a 2020 2020 656c   module").    el
+00006ff0: 6966 2063 6f6d 7072 6573 7369 6f6e 203d  if compression =
+00007000: 3d20 5a49 505f 4c5a 4d41 206f 7220 636f  = ZIP_LZMA or co
+00007010: 6d70 7265 7373 696f 6e20 3d3d 205a 4950  mpression == ZIP
+00007020: 5f58 5a3a 0a20 2020 2020 2020 2069 6620  _XZ:.        if 
+00007030: 6e6f 7420 6c7a 6d61 3a0a 2020 2020 2020  not lzma:.      
+00007040: 2020 2020 2020 7261 6973 6520 5275 6e74        raise Runt
+00007050: 696d 6545 7272 6f72 280a 2020 2020 2020  imeError(.      
+00007060: 2020 2020 2020 2020 2020 2243 6f6d 7072            "Compr
+00007070: 6573 7369 6f6e 2072 6571 7569 7265 7320  ession requires 
+00007080: 7468 6520 286d 6973 7369 6e67 2920 6c7a  the (missing) lz
+00007090: 6d61 206d 6f64 756c 6522 290a 2020 2020  ma module").    
+000070a0: 656c 6966 2063 6f6d 7072 6573 7369 6f6e  elif compression
+000070b0: 203d 3d20 5a49 505f 5a53 5441 4e44 4152   == ZIP_ZSTANDAR
+000070c0: 443a 0a20 2020 2020 2020 2069 6620 6e6f  D:.        if no
+000070d0: 7420 7a73 7461 6e64 6172 6420 616e 6420  t zstandard and 
+000070e0: 6e6f 7420 7079 7a73 7464 3a0a 2020 2020  not pyzstd:.    
+000070f0: 2020 2020 2020 2020 7261 6973 6520 5275          raise Ru
+00007100: 6e74 696d 6545 7272 6f72 280a 2020 2020  ntimeError(.    
+00007110: 2020 2020 2020 2020 2020 2020 2243 6f6d              "Com
+00007120: 7072 6573 7369 6f6e 2072 6571 7569 7265  pression require
+00007130: 7320 7468 6520 286d 6973 7369 6e67 2920  s the (missing) 
+00007140: 7a73 7461 6e64 6172 6420 6d6f 6475 6c65  zstandard module
+00007150: 2229 0a20 2020 2065 6c69 6620 636f 6d70  ").    elif comp
+00007160: 7265 7373 696f 6e20 3d3d 205a 4950 5f50  ression == ZIP_P
+00007170: 504d 443a 0a20 2020 2020 2020 2069 6620  PMD:.        if 
+00007180: 6e6f 7420 7079 7070 6d64 3a0a 2020 2020  not pyppmd:.    
+00007190: 2020 2020 2020 2020 7261 6973 6520 5275          raise Ru
+000071a0: 6e74 696d 6545 7272 6f72 280a 2020 2020  ntimeError(.    
+000071b0: 2020 2020 2020 2020 2020 2020 2243 6f6d              "Com
+000071c0: 7072 6573 7369 6f6e 2072 6571 7569 7265  pression require
+000071d0: 7320 7468 6520 286d 6973 7369 6e67 2920  s the (missing) 
+000071e0: 7079 7070 6d64 206d 6f64 756c 6522 290a  pyppmd module").
+000071f0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00007200: 2020 7261 6973 6520 4e6f 7449 6d70 6c65    raise NotImple
+00007210: 6d65 6e74 6564 4572 726f 7228 2254 6861  mentedError("Tha
+00007220: 7420 636f 6d70 7265 7373 696f 6e20 6d65  t compression me
+00007230: 7468 6f64 2069 7320 6e6f 7420 7375 7070  thod is not supp
+00007240: 6f72 7465 6422 290a 0a0a 6465 6620 5f67  orted")...def _g
+00007250: 6574 5f63 6f6d 7072 6573 736f 7228 636f  et_compressor(co
+00007260: 6d70 7265 7373 5f74 7970 652c 2063 6f6d  mpress_type, com
+00007270: 7072 6573 736c 6576 656c 3d4e 6f6e 6529  presslevel=None)
+00007280: 3a0a 2020 2020 6966 2063 6f6d 7072 6573  :.    if compres
+00007290: 735f 7479 7065 203d 3d20 5a49 505f 4445  s_type == ZIP_DE
+000072a0: 464c 4154 4544 3a0a 2020 2020 2020 2020  FLATED:.        
+000072b0: 6966 2063 6f6d 7072 6573 736c 6576 656c  if compresslevel
+000072c0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+000072d0: 2020 2020 2020 2020 2020 6966 2063 6f6d            if com
+000072e0: 7072 6573 736c 6576 656c 203c 202d 3230  presslevel < -20
+000072f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00007300: 2020 6173 7365 7274 2073 6c7a 2069 7320    assert slz is 
+00007310: 6e6f 7420 4e6f 6e65 0a20 2020 2020 2020  not None.       
+00007320: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00007330: 736c 7a2e 636f 6d70 7265 7373 6f62 6a28  slz.compressobj(
+00007340: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00007350: 2063 6f6d 7072 6573 736c 6576 656c 203c   compresslevel <
+00007360: 3d20 2d31 303a 0a20 2020 2020 2020 2020  = -10:.         
+00007370: 2020 2020 2020 2061 7373 6572 7420 6973         assert is
+00007380: 616c 5f7a 6c69 6220 6973 206e 6f74 204e  al_zlib is not N
+00007390: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+000073a0: 2020 2020 7265 7475 726e 2069 7361 6c5f      return isal_
+000073b0: 7a6c 6962 2e63 6f6d 7072 6573 736f 626a  zlib.compressobj
+000073c0: 282d 2863 6f6d 7072 6573 736c 6576 656c  (-(compresslevel
+000073d0: 2b31 3029 2c20 6973 616c 5f7a 6c69 622e  +10), isal_zlib.
+000073e0: 4445 464c 4154 4544 2c20 2d31 352c 2039  DEFLATED, -15, 9
+000073f0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00007400: 2063 6f6d 7072 6573 736c 6576 656c 203e   compresslevel >
+00007410: 3d20 3130 3a0a 2020 2020 2020 2020 2020  = 10:.          
+00007420: 2020 2020 2020 6173 7365 7274 2063 6f64        assert cod
+00007430: 6563 7337 7a20 6973 206e 6f74 204e 6f6e  ecs7z is not Non
+00007440: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00007450: 2020 7265 7475 726e 2063 6f64 6563 7337    return codecs7
+00007460: 7a2e 6465 666c 6174 655f 636f 6d70 7265  z.deflate_compre
+00007470: 7373 6f62 6a28 636f 6d70 7265 7373 6c65  ssobj(compressle
+00007480: 7665 6c2d 3130 290a 2020 2020 2020 2020  vel-10).        
+00007490: 2020 2020 7265 7475 726e 207a 6c69 622e      return zlib.
+000074a0: 636f 6d70 7265 7373 6f62 6a28 636f 6d70  compressobj(comp
+000074b0: 7265 7373 6c65 7665 6c2c 207a 6c69 622e  resslevel, zlib.
+000074c0: 4445 464c 4154 4544 2c20 2d31 3529 0a20  DEFLATED, -15). 
+000074d0: 2020 2020 2020 2072 6574 7572 6e20 7a6c         return zl
+000074e0: 6962 2e63 6f6d 7072 6573 736f 626a 287a  ib.compressobj(z
+000074f0: 6c69 622e 5a5f 4445 4641 554c 545f 434f  lib.Z_DEFAULT_CO
+00007500: 4d50 5245 5353 494f 4e2c 207a 6c69 622e  MPRESSION, zlib.
+00007510: 4445 464c 4154 4544 2c20 2d31 3529 0a20  DEFLATED, -15). 
+00007520: 2020 2065 6c69 6620 636f 6d70 7265 7373     elif compress
+00007530: 5f74 7970 6520 3d3d 205a 4950 5f44 4546  _type == ZIP_DEF
+00007540: 4c41 5445 4436 343a 0a20 2020 2020 2020  LATED64:.       
+00007550: 2069 6620 636f 6d70 7265 7373 6c65 7665   if compressleve
+00007560: 6c20 3e3d 2031 303a 0a20 2020 2020 2020  l >= 10:.       
+00007570: 2020 2020 2023 2072 6573 6572 7665 6420       # reserved 
+00007580: 636f 6d70 7265 7373 206c 6576 656c 2065  compress level e
+00007590: 7665 6e20 6166 7465 7220 2274 7275 6520  ven after "true 
+000075a0: 6465 666c 6174 6536 3420 6d6f 6475 6c65  deflate64 module
+000075b0: 2220 6973 206f 7574 0a20 2020 2020 2020  " is out.       
+000075c0: 2020 2020 2061 7373 6572 7420 636f 6465       assert code
+000075d0: 6373 377a 2069 7320 6e6f 7420 4e6f 6e65  cs7z is not None
+000075e0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+000075f0: 7572 6e20 636f 6465 6373 377a 2e64 6566  urn codecs7z.def
+00007600: 6c61 7465 3634 5f63 6f6d 7072 6573 736f  late64_compresso
+00007610: 626a 2863 6f6d 7072 6573 736c 6576 656c  bj(compresslevel
+00007620: 2d31 3029 0a20 2020 2020 2020 2061 7373  -10).        ass
+00007630: 6572 7420 636f 6465 6373 377a 2069 7320  ert codecs7z is 
+00007640: 6e6f 7420 4e6f 6e65 206f 7220 696e 666c  not None or infl
+00007650: 6174 6536 3420 6973 206e 6f74 204e 6f6e  ate64 is not Non
+00007660: 650a 2020 2020 2020 2020 6966 2069 6e66  e.        if inf
+00007670: 6c61 7465 3634 2069 7320 6e6f 7420 4e6f  late64 is not No
+00007680: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00007690: 7265 7475 726e 2049 6e66 6c61 7465 3634  return Inflate64
+000076a0: 436f 6d70 7265 7373 6f72 2863 6f6d 7072  Compressor(compr
+000076b0: 6573 736c 6576 656c 290a 2020 2020 2020  esslevel).      
+000076c0: 2020 7265 7475 726e 2063 6f64 6563 7337    return codecs7
+000076d0: 7a2e 6465 666c 6174 6536 345f 636f 6d70  z.deflate64_comp
 000076e0: 7265 7373 6f62 6a28 636f 6d70 7265 7373  ressobj(compress
-000076f0: 6d65 7468 6f64 2c20 313c 3c28 392b 636f  method, 1<<(9+co
-00007700: 6d70 7265 7373 6c65 7665 6c29 290a 2020  mpresslevel)).  
-00007710: 2020 656c 6966 2063 6f6d 7072 6573 735f    elif compress_
-00007720: 7479 7065 203d 3d20 5a49 505f 425a 4950  type == ZIP_BZIP
-00007730: 323a 0a20 2020 2020 2020 2069 6620 636f  2:.        if co
-00007740: 6d70 7265 7373 6c65 7665 6c20 6973 206e  mpresslevel is n
-00007750: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00007760: 2020 2020 2069 6620 636f 6d70 7265 7373       if compress
-00007770: 6c65 7665 6c20 3e3d 2031 303a 0a20 2020  level >= 10:.   
-00007780: 2020 2020 2020 2020 2020 2020 2061 7373               ass
-00007790: 6572 7420 636f 6465 6373 377a 2069 7320  ert codecs7z is 
-000077a0: 6e6f 7420 4e6f 6e65 0a20 2020 2020 2020  not None.       
-000077b0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-000077c0: 636f 6465 6373 377a 2e62 7a69 7032 5f63  codecs7z.bzip2_c
-000077d0: 6f6d 7072 6573 736f 626a 2863 6f6d 7072  ompressobj(compr
-000077e0: 6573 736c 6576 656c 2d31 3029 0a20 2020  esslevel-10).   
-000077f0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00007800: 627a 322e 425a 3243 6f6d 7072 6573 736f  bz2.BZ2Compresso
-00007810: 7228 636f 6d70 7265 7373 6c65 7665 6c29  r(compresslevel)
-00007820: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00007830: 627a 322e 425a 3243 6f6d 7072 6573 736f  bz2.BZ2Compresso
-00007840: 7228 290a 2020 2020 656c 6966 2063 6f6d  r().    elif com
-00007850: 7072 6573 735f 7479 7065 203d 3d20 5a49  press_type == ZI
-00007860: 505f 4c5a 4d41 3a0a 2020 2020 2020 2020  P_LZMA:.        
-00007870: 6173 7365 7274 206c 7a6d 6120 6973 206e  assert lzma is n
-00007880: 6f74 204e 6f6e 650a 2020 2020 2020 2020  ot None.        
-00007890: 7265 7475 726e 204c 5a4d 4143 6f6d 7072  return LZMACompr
-000078a0: 6573 736f 7228 636f 6d70 7265 7373 6c65  essor(compressle
-000078b0: 7665 6c29 0a20 2020 2065 6c69 6620 636f  vel).    elif co
-000078c0: 6d70 7265 7373 5f74 7970 6520 3d3d 205a  mpress_type == Z
-000078d0: 4950 5f58 5a3a 0a20 2020 2020 2020 2061  IP_XZ:.        a
-000078e0: 7373 6572 7420 6c7a 6d61 2069 7320 6e6f  ssert lzma is no
-000078f0: 7420 4e6f 6e65 0a20 2020 2020 2020 2072  t None.        r
-00007900: 6574 7572 6e20 6c7a 6d61 2e4c 5a4d 4143  eturn lzma.LZMAC
-00007910: 6f6d 7072 6573 736f 7228 6c7a 6d61 2e46  ompressor(lzma.F
-00007920: 4f52 4d41 545f 585a 2c20 7072 6573 6574  ORMAT_XZ, preset
-00007930: 3d63 6f6d 7072 6573 736c 6576 656c 290a  =compresslevel).
-00007940: 2020 2020 656c 6966 2063 6f6d 7072 6573      elif compres
-00007950: 735f 7479 7065 203d 3d20 5a49 505f 5a53  s_type == ZIP_ZS
-00007960: 5441 4e44 4152 443a 0a20 2020 2020 2020  TANDARD:.       
-00007970: 2069 6620 636f 6d70 7265 7373 6c65 7665   if compressleve
-00007980: 6c20 6973 204e 6f6e 653a 0a20 2020 2020  l is None:.     
-00007990: 2020 2020 2020 2063 6f6d 7072 6573 736c         compressl
-000079a0: 6576 656c 203d 2033 0a20 2020 2020 2020  evel = 3.       
-000079b0: 2061 7373 6572 7420 7a73 7461 6e64 6172   assert zstandar
-000079c0: 6420 6973 206e 6f74 204e 6f6e 6520 6f72  d is not None or
-000079d0: 2070 797a 7374 6420 6973 206e 6f74 204e   pyzstd is not N
-000079e0: 6f6e 650a 2020 2020 2020 2020 6966 207a  one.        if z
-000079f0: 7374 616e 6461 7264 2069 7320 6e6f 7420  standard is not 
-00007a00: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00007a10: 2020 7265 7475 726e 207a 7374 616e 6461    return zstanda
-00007a20: 7264 2e5a 7374 6443 6f6d 7072 6573 736f  rd.ZstdCompresso
-00007a30: 7228 6c65 7665 6c3d 636f 6d70 7265 7373  r(level=compress
-00007a40: 6c65 7665 6c2c 2074 6872 6561 6473 3d34  level, threads=4
-00007a50: 292e 636f 6d70 7265 7373 6f62 6a28 290a  ).compressobj().
-00007a60: 2020 2020 2020 2020 7265 7475 726e 2070          return p
-00007a70: 797a 7374 642e 5a73 7464 436f 6d70 7265  yzstd.ZstdCompre
-00007a80: 7373 6f72 287b 7079 7a73 7464 2e43 5061  ssor({pyzstd.CPa
-00007a90: 7261 6d65 7465 722e 636f 6d70 7265 7373  rameter.compress
-00007aa0: 696f 6e4c 6576 656c 3a20 636f 6d70 7265  ionLevel: compre
-00007ab0: 7373 6c65 7665 6c2c 2070 797a 7374 642e  sslevel, pyzstd.
-00007ac0: 4350 6172 616d 6574 6572 2e6e 6257 6f72  CParameter.nbWor
-00007ad0: 6b65 7273 3a20 347d 290a 2020 2020 656c  kers: 4}).    el
-00007ae0: 6966 2063 6f6d 7072 6573 735f 7479 7065  if compress_type
-00007af0: 203d 3d20 5a49 505f 5050 4d44 3a0a 2020   == ZIP_PPMD:.  
-00007b00: 2020 2020 2020 6173 7365 7274 2070 7970        assert pyp
-00007b10: 706d 6420 6973 206e 6f74 204e 6f6e 650a  pmd is not None.
-00007b20: 2020 2020 2020 2020 7265 7475 726e 2050          return P
-00007b30: 504d 4443 6f6d 7072 6573 736f 7228 636f  PMDCompressor(co
-00007b40: 6d70 7265 7373 6c65 7665 6c29 0a20 2020  mpresslevel).   
-00007b50: 2065 6c73 653a 0a20 2020 2020 2020 2072   else:.        r
-00007b60: 6574 7572 6e20 4e6f 6e65 0a0a 6465 6620  eturn None..def 
-00007b70: 5f67 6574 5f64 6563 6f6d 7072 6573 736f  _get_decompresso
-00007b80: 7228 636f 6d70 7265 7373 5f74 7970 6529  r(compress_type)
-00007b90: 3a0a 2020 2020 5f63 6865 636b 5f63 6f6d  :.    _check_com
-00007ba0: 7072 6573 7369 6f6e 2863 6f6d 7072 6573  pression(compres
-00007bb0: 735f 7479 7065 290a 2020 2020 6966 2063  s_type).    if c
-00007bc0: 6f6d 7072 6573 735f 7479 7065 203d 3d20  ompress_type == 
-00007bd0: 5a49 505f 5354 4f52 4544 3a0a 2020 2020  ZIP_STORED:.    
-00007be0: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
-00007bf0: 2020 2020 656c 6966 2063 6f6d 7072 6573      elif compres
-00007c00: 735f 7479 7065 203d 3d20 5a49 505f 4445  s_type == ZIP_DE
-00007c10: 464c 4154 4544 3a0a 2020 2020 2020 2020  FLATED:.        
-00007c20: 6966 2069 7361 6c5f 7a6c 6962 2069 7320  if isal_zlib is 
-00007c30: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00007c40: 2020 2020 2020 7265 7475 726e 2069 7361        return isa
-00007c50: 6c5f 7a6c 6962 2e64 6563 6f6d 7072 6573  l_zlib.decompres
-00007c60: 736f 626a 282d 3135 290a 2020 2020 2020  sobj(-15).      
-00007c70: 2020 7265 7475 726e 207a 6c69 622e 6465    return zlib.de
-00007c80: 636f 6d70 7265 7373 6f62 6a28 2d31 3529  compressobj(-15)
-00007c90: 0a20 2020 2065 6c69 6620 636f 6d70 7265  .    elif compre
-00007ca0: 7373 5f74 7970 6520 3d3d 205a 4950 5f44  ss_type == ZIP_D
-00007cb0: 4546 4c41 5445 4436 343a 0a20 2020 2020  EFLATED64:.     
-00007cc0: 2020 2069 6620 6465 666c 6174 6536 3420     if deflate64 
-00007cd0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-00007ce0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00007cf0: 6465 666c 6174 6536 342e 4465 666c 6174  deflate64.Deflat
-00007d00: 6536 3428 290a 2020 2020 2020 2020 7265  e64().        re
-00007d10: 7475 726e 2049 6e66 6c61 7465 3634 4465  turn Inflate64De
-00007d20: 636f 6d70 7265 7373 6f72 2829 0a20 2020  compressor().   
-00007d30: 2065 6c69 6620 636f 6d70 7265 7373 5f74   elif compress_t
-00007d40: 7970 6520 3d3d 205a 4950 5f44 434c 494d  ype == ZIP_DCLIM
-00007d50: 504c 4f44 4544 3a0a 2020 2020 2020 2020  PLODED:.        
-00007d60: 7265 7475 726e 2064 636c 696d 706c 6f64  return dclimplod
-00007d70: 652e 6465 636f 6d70 7265 7373 6f62 6a28  e.decompressobj(
-00007d80: 290a 2020 2020 656c 6966 2063 6f6d 7072  ).    elif compr
-00007d90: 6573 735f 7479 7065 203d 3d20 5a49 505f  ess_type == ZIP_
-00007da0: 425a 4950 323a 0a20 2020 2020 2020 2072  BZIP2:.        r
-00007db0: 6574 7572 6e20 627a 322e 425a 3244 6563  eturn bz2.BZ2Dec
-00007dc0: 6f6d 7072 6573 736f 7228 290a 2020 2020  ompressor().    
-00007dd0: 656c 6966 2063 6f6d 7072 6573 735f 7479  elif compress_ty
-00007de0: 7065 203d 3d20 5a49 505f 4c5a 4d41 3a0a  pe == ZIP_LZMA:.
-00007df0: 2020 2020 2020 2020 7265 7475 726e 204c          return L
-00007e00: 5a4d 4144 6563 6f6d 7072 6573 736f 7228  ZMADecompressor(
-00007e10: 290a 2020 2020 656c 6966 2063 6f6d 7072  ).    elif compr
-00007e20: 6573 735f 7479 7065 203d 3d20 5a49 505f  ess_type == ZIP_
-00007e30: 585a 3a0a 2020 2020 2020 2020 7265 7475  XZ:.        retu
-00007e40: 726e 206c 7a6d 612e 4c5a 4d41 4465 636f  rn lzma.LZMADeco
-00007e50: 6d70 7265 7373 6f72 286c 7a6d 612e 464f  mpressor(lzma.FO
-00007e60: 524d 4154 5f58 5a29 0a20 2020 2065 6c69  RMAT_XZ).    eli
-00007e70: 6620 636f 6d70 7265 7373 5f74 7970 6520  f compress_type 
-00007e80: 3d3d 205a 4950 5f5a 5354 414e 4441 5244  == ZIP_ZSTANDARD
-00007e90: 3a0a 2020 2020 2020 2020 6966 207a 7374  :.        if zst
-00007ea0: 616e 6461 7264 2069 7320 6e6f 7420 4e6f  andard is not No
-00007eb0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00007ec0: 7265 7475 726e 207a 7374 616e 6461 7264  return zstandard
-00007ed0: 2e5a 7374 6444 6563 6f6d 7072 6573 736f  .ZstdDecompresso
-00007ee0: 7228 292e 6465 636f 6d70 7265 7373 6f62  r().decompressob
-00007ef0: 6a28 290a 2020 2020 2020 2020 7265 7475  j().        retu
-00007f00: 726e 2070 797a 7374 642e 5a73 7464 4465  rn pyzstd.ZstdDe
-00007f10: 636f 6d70 7265 7373 6f72 2829 0a20 2020  compressor().   
-00007f20: 2065 6c69 6620 636f 6d70 7265 7373 5f74   elif compress_t
-00007f30: 7970 6520 3d3d 205a 4950 5f50 504d 443a  ype == ZIP_PPMD:
-00007f40: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00007f50: 5050 4d44 4465 636f 6d70 7265 7373 6f72  PPMDDecompressor
-00007f60: 2829 0a20 2020 2065 6c73 653a 0a20 2020  ().    else:.   
-00007f70: 2020 2020 2064 6573 6372 203d 2063 6f6d       descr = com
-00007f80: 7072 6573 736f 725f 6e61 6d65 732e 6765  pressor_names.ge
-00007f90: 7428 636f 6d70 7265 7373 5f74 7970 6529  t(compress_type)
-00007fa0: 0a20 2020 2020 2020 2069 6620 6465 7363  .        if desc
-00007fb0: 723a 0a20 2020 2020 2020 2020 2020 2072  r:.            r
-00007fc0: 6169 7365 204e 6f74 496d 706c 656d 656e  aise NotImplemen
-00007fd0: 7465 6445 7272 6f72 2822 636f 6d70 7265  tedError("compre
-00007fe0: 7373 696f 6e20 7479 7065 2025 6420 2825  ssion type %d (%
-00007ff0: 7329 2220 2520 2863 6f6d 7072 6573 735f  s)" % (compress_
-00008000: 7479 7065 2c20 6465 7363 7229 290a 2020  type, descr)).  
-00008010: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00008020: 2020 2020 2020 2020 7261 6973 6520 4e6f          raise No
-00008030: 7449 6d70 6c65 6d65 6e74 6564 4572 726f  tImplementedErro
-00008040: 7228 2263 6f6d 7072 6573 7369 6f6e 2074  r("compression t
-00008050: 7970 6520 2564 2220 2520 2863 6f6d 7072  ype %d" % (compr
-00008060: 6573 735f 7479 7065 2c29 290a 0a0a 636c  ess_type,))...cl
-00008070: 6173 7320 5f53 6861 7265 6446 696c 6528  ass _SharedFile(
-00008080: 6f62 6a65 6374 293a 0a20 2020 2064 6566  object):.    def
-00008090: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
-000080a0: 6669 6c65 2c20 706f 732c 2063 6c6f 7365  file, pos, close
-000080b0: 2c20 6c6f 636b 2c20 7772 6974 696e 6729  , lock, writing)
-000080c0: 3a0a 2020 2020 2020 2020 7365 6c66 2e5f  :.        self._
-000080d0: 6669 6c65 203d 2066 696c 650a 2020 2020  file = file.    
-000080e0: 2020 2020 7365 6c66 2e5f 706f 7320 3d20      self._pos = 
-000080f0: 706f 730a 2020 2020 2020 2020 7365 6c66  pos.        self
-00008100: 2e5f 636c 6f73 6520 3d20 636c 6f73 650a  ._close = close.
-00008110: 2020 2020 2020 2020 7365 6c66 2e5f 6c6f          self._lo
-00008120: 636b 203d 206c 6f63 6b0a 2020 2020 2020  ck = lock.      
-00008130: 2020 7365 6c66 2e5f 7772 6974 696e 6720    self._writing 
-00008140: 3d20 7772 6974 696e 670a 2020 2020 2020  = writing.      
-00008150: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-00008160: 2020 2073 656c 662e 7365 656b 6162 6c65     self.seekable
-00008170: 203d 2066 696c 652e 7365 656b 6162 6c65   = file.seekable
-00008180: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-00008190: 4174 7472 6962 7574 6545 7272 6f72 3a0a  AttributeError:.
-000081a0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000081b0: 2e73 6565 6b61 626c 6520 3d20 6c61 6d62  .seekable = lamb
-000081c0: 6461 3a20 4661 6c73 650a 2020 2020 2020  da: False.      
-000081d0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-000081e0: 2020 2020 2020 2020 2020 2066 696c 652e             file.
-000081f0: 7365 656b 2830 2c20 6f73 2e53 4545 4b5f  seek(0, os.SEEK_
-00008200: 5345 5429 0a20 2020 2020 2020 2020 2020  SET).           
-00008210: 2020 2020 2073 656c 662e 7365 656b 6162       self.seekab
-00008220: 6c65 203d 206c 616d 6264 613a 2054 7275  le = lambda: Tru
-00008230: 650a 2020 2020 2020 2020 2020 2020 6578  e.            ex
-00008240: 6365 7074 204f 5345 7272 6f72 3a0a 2020  cept OSError:.  
-00008250: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-00008260: 7373 0a20 2020 2020 2020 2073 656c 662e  ss.        self.
-00008270: 7465 6c6c 203d 2066 696c 652e 7465 6c6c  tell = file.tell
-00008280: 0a0a 2020 2020 6465 6620 7365 656b 2873  ..    def seek(s
-00008290: 656c 662c 206f 6666 7365 742c 2077 6865  elf, offset, whe
-000082a0: 6e63 653d 3029 3a0a 2020 2020 2020 2020  nce=0):.        
-000082b0: 7769 7468 2073 656c 662e 5f6c 6f63 6b3a  with self._lock:
-000082c0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000082d0: 7365 6c66 2e5f 7772 6974 696e 6728 293a  self._writing():
-000082e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000082f0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-00008300: 7228 2243 616e 2774 2072 6570 6f73 6974  r("Can't reposit
-00008310: 696f 6e20 696e 2074 6865 205a 4950 2066  ion in the ZIP f
-00008320: 696c 6520 7768 696c 6520 220a 2020 2020  ile while ".    
-00008330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008340: 2020 2020 2274 6865 7265 2069 7320 616e      "there is an
-00008350: 206f 7065 6e20 7772 6974 696e 6720 6861   open writing ha
-00008360: 6e64 6c65 206f 6e20 6974 2e20 220a 2020  ndle on it. ".  
-00008370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008380: 2020 2020 2020 2243 6c6f 7365 2074 6865        "Close the
-00008390: 2077 7269 7469 6e67 2068 616e 646c 6520   writing handle 
-000083a0: 6265 666f 7265 2074 7279 696e 6720 746f  before trying to
-000083b0: 2072 6561 642e 2229 0a20 2020 2020 2020   read.").       
-000083c0: 2020 2020 2073 656c 662e 5f66 696c 652e       self._file.
-000083d0: 7365 656b 286f 6666 7365 742c 2077 6865  seek(offset, whe
-000083e0: 6e63 6529 0a20 2020 2020 2020 2020 2020  nce).           
-000083f0: 2073 656c 662e 5f70 6f73 203d 2073 656c   self._pos = sel
-00008400: 662e 5f66 696c 652e 7465 6c6c 2829 0a20  f._file.tell(). 
-00008410: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00008420: 6e20 7365 6c66 2e5f 706f 730a 0a20 2020  n self._pos..   
-00008430: 2064 6566 2072 6561 6428 7365 6c66 2c20   def read(self, 
-00008440: 6e3d 2d31 293a 0a20 2020 2020 2020 2077  n=-1):.        w
-00008450: 6974 6820 7365 6c66 2e5f 6c6f 636b 3a0a  ith self._lock:.
-00008460: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-00008470: 656c 662e 5f77 7269 7469 6e67 2829 3a0a  elf._writing():.
-00008480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008490: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-000084a0: 2822 4361 6e27 7420 7265 6164 2066 726f  ("Can't read fro
-000084b0: 6d20 7468 6520 5a49 5020 6669 6c65 2077  m the ZIP file w
-000084c0: 6869 6c65 2074 6865 7265 2022 0a20 2020  hile there ".   
-000084d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000084e0: 2020 2020 2022 6973 2061 6e20 6f70 656e       "is an open
-000084f0: 2077 7269 7469 6e67 2068 616e 646c 6520   writing handle 
-00008500: 6f6e 2069 742e 2022 0a20 2020 2020 2020  on it. ".       
-00008510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008520: 2022 436c 6f73 6520 7468 6520 7772 6974   "Close the writ
-00008530: 696e 6720 6861 6e64 6c65 2062 6566 6f72  ing handle befor
-00008540: 6520 7472 7969 6e67 2074 6f20 7265 6164  e trying to read
-00008550: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
-00008560: 7365 6c66 2e5f 6669 6c65 2e73 6565 6b28  self._file.seek(
-00008570: 7365 6c66 2e5f 706f 7329 0a20 2020 2020  self._pos).     
-00008580: 2020 2020 2020 2064 6174 6120 3d20 7365         data = se
-00008590: 6c66 2e5f 6669 6c65 2e72 6561 6428 6e29  lf._file.read(n)
-000085a0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000085b0: 662e 5f70 6f73 203d 2073 656c 662e 5f66  f._pos = self._f
-000085c0: 696c 652e 7465 6c6c 2829 0a20 2020 2020  ile.tell().     
-000085d0: 2020 2020 2020 2072 6574 7572 6e20 6461         return da
-000085e0: 7461 0a0a 2020 2020 6465 6620 636c 6f73  ta..    def clos
-000085f0: 6528 7365 6c66 293a 0a20 2020 2020 2020  e(self):.       
-00008600: 2069 6620 7365 6c66 2e5f 6669 6c65 2069   if self._file i
-00008610: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00008620: 2020 2020 2020 2020 6669 6c65 6f62 6a20          fileobj 
-00008630: 3d20 7365 6c66 2e5f 6669 6c65 0a20 2020  = self._file.   
-00008640: 2020 2020 2020 2020 2073 656c 662e 5f66           self._f
-00008650: 696c 6520 3d20 4e6f 6e65 0a20 2020 2020  ile = None.     
-00008660: 2020 2020 2020 2073 656c 662e 5f63 6c6f         self._clo
-00008670: 7365 2866 696c 656f 626a 290a 0a23 2050  se(fileobj)..# P
-00008680: 726f 7669 6465 2074 6865 2074 656c 6c20  rovide the tell 
-00008690: 6d65 7468 6f64 2066 6f72 2075 6e73 6565  method for unsee
-000086a0: 6b61 626c 6520 7374 7265 616d 0a63 6c61  kable stream.cla
-000086b0: 7373 205f 5465 6c6c 6162 6c65 286f 626a  ss _Tellable(obj
-000086c0: 6563 7429 3a0a 2020 2020 6465 6620 5f5f  ect):.    def __
-000086d0: 696e 6974 5f5f 2873 656c 662c 2066 7029  init__(self, fp)
-000086e0: 3a0a 2020 2020 2020 2020 7365 6c66 2e66  :.        self.f
-000086f0: 7020 3d20 6670 0a20 2020 2020 2020 2073  p = fp.        s
-00008700: 656c 662e 6f66 6673 6574 203d 2030 0a0a  elf.offset = 0..
-00008710: 2020 2020 6465 6620 7772 6974 6528 7365      def write(se
-00008720: 6c66 2c20 6461 7461 293a 0a20 2020 2020  lf, data):.     
-00008730: 2020 206e 203d 2073 656c 662e 6670 2e77     n = self.fp.w
-00008740: 7269 7465 2864 6174 6129 0a20 2020 2020  rite(data).     
-00008750: 2020 2073 656c 662e 6f66 6673 6574 202b     self.offset +
-00008760: 3d20 6e0a 2020 2020 2020 2020 7265 7475  = n.        retu
-00008770: 726e 206e 0a0a 2020 2020 6465 6620 7465  rn n..    def te
-00008780: 6c6c 2873 656c 6629 3a0a 2020 2020 2020  ll(self):.      
-00008790: 2020 7265 7475 726e 2073 656c 662e 6f66    return self.of
-000087a0: 6673 6574 0a0a 2020 2020 6465 6620 666c  fset..    def fl
-000087b0: 7573 6828 7365 6c66 293a 0a20 2020 2020  ush(self):.     
-000087c0: 2020 2073 656c 662e 6670 2e66 6c75 7368     self.fp.flush
-000087d0: 2829 0a0a 2020 2020 6465 6620 636c 6f73  ()..    def clos
-000087e0: 6528 7365 6c66 293a 0a20 2020 2020 2020  e(self):.       
-000087f0: 2073 656c 662e 6670 2e63 6c6f 7365 2829   self.fp.close()
-00008800: 0a0a 0a63 6c61 7373 205a 6970 4578 7446  ...class ZipExtF
-00008810: 696c 6528 696f 2e42 7566 6665 7265 6449  ile(io.BufferedI
-00008820: 4f42 6173 6529 3a0a 2020 2020 2222 2246  OBase):.    """F
-00008830: 696c 652d 6c69 6b65 206f 626a 6563 7420  ile-like object 
-00008840: 666f 7220 7265 6164 696e 6720 616e 2061  for reading an a
-00008850: 7263 6869 7665 206d 656d 6265 722e 0a20  rchive member.. 
-00008860: 2020 2020 2020 4973 2072 6574 7572 6e65        Is returne
-00008870: 6420 6279 205a 6970 4669 6c65 2e6f 7065  d by ZipFile.ope
-00008880: 6e28 292e 0a20 2020 2022 2222 0a0a 2020  n()..    """..  
-00008890: 2020 2320 4d61 7820 7369 7a65 2073 7570    # Max size sup
-000088a0: 706f 7274 6564 2062 7920 6465 636f 6d70  ported by decomp
-000088b0: 7265 7373 6f72 2e0a 2020 2020 4d41 585f  ressor..    MAX_
-000088c0: 4e20 3d20 3120 3c3c 2033 3120 2d20 310a  N = 1 << 31 - 1.
-000088d0: 0a20 2020 2023 2052 6561 6420 6672 6f6d  .    # Read from
-000088e0: 2063 6f6d 7072 6573 7365 6420 6669 6c65   compressed file
-000088f0: 7320 696e 2034 6b20 626c 6f63 6b73 2e0a  s in 4k blocks..
-00008900: 2020 2020 4d49 4e5f 5245 4144 5f53 495a      MIN_READ_SIZ
-00008910: 4520 3d20 3430 3936 0a0a 2020 2020 2320  E = 4096..    # 
-00008920: 4368 756e 6b20 7369 7a65 2074 6f20 7265  Chunk size to re
-00008930: 6164 2064 7572 696e 6720 7365 656b 0a20  ad during seek. 
-00008940: 2020 204d 4158 5f53 4545 4b5f 5245 4144     MAX_SEEK_READ
-00008950: 203d 2031 203c 3c20 3234 0a0a 2020 2020   = 1 << 24..    
-00008960: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
-00008970: 662c 2066 696c 656f 626a 2c20 6d6f 6465  f, fileobj, mode
-00008980: 2c20 7a69 7069 6e66 6f2c 2070 7764 3d4e  , zipinfo, pwd=N
-00008990: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
-000089a0: 2020 2020 2020 636c 6f73 655f 6669 6c65        close_file
-000089b0: 6f62 6a3d 4661 6c73 6529 3a0a 2020 2020  obj=False):.    
-000089c0: 2020 2020 7365 6c66 2e5f 6669 6c65 6f62      self._fileob
-000089d0: 6a20 3d20 6669 6c65 6f62 6a0a 2020 2020  j = fileobj.    
-000089e0: 2020 2020 7365 6c66 2e5f 7077 6420 3d20      self._pwd = 
-000089f0: 7077 640a 2020 2020 2020 2020 7365 6c66  pwd.        self
-00008a00: 2e5f 636c 6f73 655f 6669 6c65 6f62 6a20  ._close_fileobj 
-00008a10: 3d20 636c 6f73 655f 6669 6c65 6f62 6a0a  = close_fileobj.
-00008a20: 0a20 2020 2020 2020 2073 656c 662e 5f63  .        self._c
-00008a30: 6f6d 7072 6573 735f 7479 7065 203d 207a  ompress_type = z
-00008a40: 6970 696e 666f 2e63 6f6d 7072 6573 735f  ipinfo.compress_
-00008a50: 7479 7065 0a20 2020 2020 2020 2073 656c  type.        sel
-00008a60: 662e 5f63 6f6d 7072 6573 735f 6c65 6674  f._compress_left
-00008a70: 203d 207a 6970 696e 666f 2e63 6f6d 7072   = zipinfo.compr
-00008a80: 6573 735f 7369 7a65 0a20 2020 2020 2020  ess_size.       
-00008a90: 2073 656c 662e 5f6c 6566 7420 3d20 7a69   self._left = zi
-00008aa0: 7069 6e66 6f2e 6669 6c65 5f73 697a 650a  pinfo.file_size.
-00008ab0: 0a20 2020 2020 2020 2073 656c 662e 5f64  .        self._d
-00008ac0: 6563 6f6d 7072 6573 736f 7220 3d20 5f67  ecompressor = _g
-00008ad0: 6574 5f64 6563 6f6d 7072 6573 736f 7228  et_decompressor(
-00008ae0: 7365 6c66 2e5f 636f 6d70 7265 7373 5f74  self._compress_t
-00008af0: 7970 6529 0a0a 2020 2020 2020 2020 7365  ype)..        se
-00008b00: 6c66 2e5f 656f 6620 3d20 4661 6c73 650a  lf._eof = False.
-00008b10: 2020 2020 2020 2020 7365 6c66 2e5f 7265          self._re
-00008b20: 6164 6275 6666 6572 203d 2062 2727 0a20  adbuffer = b''. 
-00008b30: 2020 2020 2020 2073 656c 662e 5f6f 6666         self._off
-00008b40: 7365 7420 3d20 300a 0a20 2020 2020 2020  set = 0..       
-00008b50: 2073 656c 662e 6e65 776c 696e 6573 203d   self.newlines =
-00008b60: 204e 6f6e 650a 0a20 2020 2020 2020 2073   None..        s
-00008b70: 656c 662e 6d6f 6465 203d 206d 6f64 650a  elf.mode = mode.
-00008b80: 2020 2020 2020 2020 7365 6c66 2e6e 616d          self.nam
-00008b90: 6520 3d20 7a69 7069 6e66 6f2e 6669 6c65  e = zipinfo.file
-00008ba0: 6e61 6d65 0a0a 2020 2020 2020 2020 6966  name..        if
-00008bb0: 2068 6173 6174 7472 287a 6970 696e 666f   hasattr(zipinfo
-00008bc0: 2c20 2743 5243 2729 3a0a 2020 2020 2020  , 'CRC'):.      
-00008bd0: 2020 2020 2020 7365 6c66 2e5f 6578 7065        self._expe
-00008be0: 6374 6564 5f63 7263 203d 207a 6970 696e  cted_crc = zipin
-00008bf0: 666f 2e43 5243 0a20 2020 2020 2020 2020  fo.CRC.         
-00008c00: 2020 2073 656c 662e 5f72 756e 6e69 6e67     self._running
-00008c10: 5f63 7263 203d 2063 7263 3332 2862 2727  _crc = crc32(b''
-00008c20: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-00008c30: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00008c40: 2e5f 6578 7065 6374 6564 5f63 7263 203d  ._expected_crc =
-00008c50: 204e 6f6e 650a 0a20 2020 2020 2020 2073   None..        s
-00008c60: 656c 662e 5f73 6565 6b61 626c 6520 3d20  elf._seekable = 
-00008c70: 4661 6c73 650a 2020 2020 2020 2020 7472  False.        tr
-00008c80: 793a 0a20 2020 2020 2020 2020 2020 2069  y:.            i
-00008c90: 6620 6669 6c65 6f62 6a2e 7365 656b 6162  f fileobj.seekab
-00008ca0: 6c65 2829 3a0a 2020 2020 2020 2020 2020  le():.          
-00008cb0: 2020 2020 2020 7365 6c66 2e5f 6f72 6967        self._orig
-00008cc0: 5f63 6f6d 7072 6573 735f 7374 6172 7420  _compress_start 
-00008cd0: 3d20 6669 6c65 6f62 6a2e 7465 6c6c 2829  = fileobj.tell()
-00008ce0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008cf0: 2073 656c 662e 5f6f 7269 675f 636f 6d70   self._orig_comp
-00008d00: 7265 7373 5f73 697a 6520 3d20 7a69 7069  ress_size = zipi
-00008d10: 6e66 6f2e 636f 6d70 7265 7373 5f73 697a  nfo.compress_siz
-00008d20: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00008d30: 2020 7365 6c66 2e5f 6f72 6967 5f66 696c    self._orig_fil
-00008d40: 655f 7369 7a65 203d 207a 6970 696e 666f  e_size = zipinfo
-00008d50: 2e66 696c 655f 7369 7a65 0a20 2020 2020  .file_size.     
-00008d60: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00008d70: 5f6f 7269 675f 7374 6172 745f 6372 6320  _orig_start_crc 
-00008d80: 3d20 7365 6c66 2e5f 7275 6e6e 696e 675f  = self._running_
-00008d90: 6372 630a 2020 2020 2020 2020 2020 2020  crc.            
-00008da0: 2020 2020 7365 6c66 2e5f 7365 656b 6162      self._seekab
-00008db0: 6c65 203d 2054 7275 650a 2020 2020 2020  le = True.      
-00008dc0: 2020 6578 6365 7074 2041 7474 7269 6275    except Attribu
-00008dd0: 7465 4572 726f 723a 0a20 2020 2020 2020  teError:.       
-00008de0: 2020 2020 2070 6173 730a 0a20 2020 2020       pass..     
-00008df0: 2020 2073 656c 662e 5f64 6563 7279 7074     self._decrypt
-00008e00: 6572 203d 204e 6f6e 650a 2020 2020 2020  er = None.      
-00008e10: 2020 6966 2070 7764 3a0a 2020 2020 2020    if pwd:.      
-00008e20: 2020 2020 2020 6966 207a 6970 696e 666f        if zipinfo
-00008e30: 2e66 6c61 675f 6269 7473 2026 2030 7838  .flag_bits & 0x8
-00008e40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00008e50: 2020 2320 636f 6d70 6172 6520 6167 6169    # compare agai
-00008e60: 6e73 7420 7468 6520 6669 6c65 2074 7970  nst the file typ
-00008e70: 6520 6672 6f6d 2065 7874 656e 6465 6420  e from extended 
-00008e80: 6c6f 6361 6c20 6865 6164 6572 730a 2020  local headers.  
-00008e90: 2020 2020 2020 2020 2020 2020 2020 6368                ch
-00008ea0: 6563 6b5f 6279 7465 203d 2028 7a69 7069  eck_byte = (zipi
-00008eb0: 6e66 6f2e 5f72 6177 5f74 696d 6520 3e3e  nfo._raw_time >>
-00008ec0: 2038 2920 2620 3078 6666 0a20 2020 2020   8) & 0xff.     
-00008ed0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00008ee0: 2020 2020 2020 2020 2020 2020 2023 2063               # c
-00008ef0: 6f6d 7061 7265 2061 6761 696e 7374 2074  ompare against t
-00008f00: 6865 2043 5243 206f 7468 6572 7769 7365  he CRC otherwise
-00008f10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008f20: 2063 6865 636b 5f62 7974 6520 3d20 287a   check_byte = (z
-00008f30: 6970 696e 666f 2e43 5243 203e 3e20 3234  ipinfo.CRC >> 24
-00008f40: 2920 2620 3078 6666 0a20 2020 2020 2020  ) & 0xff.       
-00008f50: 2020 2020 2068 203d 2073 656c 662e 5f69       h = self._i
-00008f60: 6e69 745f 6465 6372 7970 7465 7228 290a  nit_decrypter().
-00008f70: 2020 2020 2020 2020 2020 2020 6966 2068              if h
-00008f80: 2021 3d20 6368 6563 6b5f 6279 7465 3a0a   != check_byte:.
-00008f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008fa0: 7261 6973 6520 5275 6e74 696d 6545 7272  raise RuntimeErr
-00008fb0: 6f72 2822 4261 6420 7061 7373 776f 7264  or("Bad password
-00008fc0: 2066 6f72 2066 696c 6520 2572 2220 2520   for file %r" % 
-00008fd0: 7a69 7069 6e66 6f2e 6f72 6967 5f66 696c  zipinfo.orig_fil
-00008fe0: 656e 616d 6529 0a0a 2020 2020 2020 2020  ename)..        
-00008ff0: 6966 2073 656c 662e 5f63 6f6d 7072 6573  if self._compres
-00009000: 735f 7479 7065 203d 3d20 5a49 505f 4445  s_type == ZIP_DE
-00009010: 464c 4154 4544 3634 3a0a 2020 2020 2020  FLATED64:.      
-00009020: 2020 2020 2020 7365 6c66 2e4d 494e 5f52        self.MIN_R
-00009030: 4541 445f 5349 5a45 203d 2036 3420 2a20  EAD_SIZE = 64 * 
-00009040: 322a 2a31 300a 0a20 2020 2064 6566 205f  2**10..    def _
-00009050: 696e 6974 5f64 6563 7279 7074 6572 2873  init_decrypter(s
-00009060: 656c 6629 3a0a 2020 2020 2020 2020 7365  elf):.        se
-00009070: 6c66 2e5f 6465 6372 7970 7465 7220 3d20  lf._decrypter = 
-00009080: 5f5a 6970 4465 6372 7970 7465 7228 7365  _ZipDecrypter(se
-00009090: 6c66 2e5f 7077 6429 0a20 2020 2020 2020  lf._pwd).       
-000090a0: 2023 2054 6865 2066 6972 7374 2031 3220   # The first 12 
-000090b0: 6279 7465 7320 696e 2074 6865 2063 7970  bytes in the cyp
-000090c0: 6865 7220 7374 7265 616d 2069 7320 616e  her stream is an
-000090d0: 2065 6e63 7279 7074 696f 6e20 6865 6164   encryption head
-000090e0: 6572 0a20 2020 2020 2020 2023 2020 7573  er.        #  us
-000090f0: 6564 2074 6f20 7374 7265 6e67 7468 656e  ed to strengthen
-00009100: 2074 6865 2061 6c67 6f72 6974 686d 2e20   the algorithm. 
-00009110: 5468 6520 6669 7273 7420 3131 2062 7974  The first 11 byt
-00009120: 6573 2061 7265 0a20 2020 2020 2020 2023  es are.        #
-00009130: 2020 636f 6d70 6c65 7465 6c79 2072 616e    completely ran
-00009140: 646f 6d2c 2077 6869 6c65 2074 6865 2031  dom, while the 1
-00009150: 3274 6820 636f 6e74 6169 6e73 2074 6865  2th contains the
-00009160: 204d 5342 206f 6620 7468 6520 4352 432c   MSB of the CRC,
-00009170: 0a20 2020 2020 2020 2023 2020 6f72 2074  .        #  or t
-00009180: 6865 204d 5342 206f 6620 7468 6520 6669  he MSB of the fi
-00009190: 6c65 2074 696d 6520 6465 7065 6e64 696e  le time dependin
-000091a0: 6720 6f6e 2074 6865 2068 6561 6465 7220  g on the header 
-000091b0: 7479 7065 0a20 2020 2020 2020 2023 2020  type.        #  
-000091c0: 616e 6420 6973 2075 7365 6420 746f 2063  and is used to c
-000091d0: 6865 636b 2074 6865 2063 6f72 7265 6374  heck the correct
-000091e0: 6e65 7373 206f 6620 7468 6520 7061 7373  ness of the pass
-000091f0: 776f 7264 2e0a 2020 2020 2020 2020 6865  word..        he
-00009200: 6164 6572 203d 2073 656c 662e 5f66 696c  ader = self._fil
-00009210: 656f 626a 2e72 6561 6428 3132 290a 2020  eobj.read(12).  
-00009220: 2020 2020 2020 7365 6c66 2e5f 636f 6d70        self._comp
-00009230: 7265 7373 5f6c 6566 7420 2d3d 2031 320a  ress_left -= 12.
-00009240: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00009250: 656c 662e 5f64 6563 7279 7074 6572 2868  elf._decrypter(h
-00009260: 6561 6465 7229 5b31 315d 0a0a 2020 2020  eader)[11]..    
-00009270: 6465 6620 5f5f 7265 7072 5f5f 2873 656c  def __repr__(sel
-00009280: 6629 3a0a 2020 2020 2020 2020 7265 7375  f):.        resu
-00009290: 6c74 203d 205b 273c 2573 2e25 7327 2025  lt = ['<%s.%s' %
-000092a0: 2028 7365 6c66 2e5f 5f63 6c61 7373 5f5f   (self.__class__
-000092b0: 2e5f 5f6d 6f64 756c 655f 5f2c 0a20 2020  .__module__,.   
-000092c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000092d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000092e0: 5f5f 636c 6173 735f 5f2e 5f5f 7175 616c  __class__.__qual
-000092f0: 6e61 6d65 5f5f 295d 0a20 2020 2020 2020  name__)].       
-00009300: 2069 6620 6e6f 7420 7365 6c66 2e63 6c6f   if not self.clo
-00009310: 7365 643a 0a20 2020 2020 2020 2020 2020  sed:.           
-00009320: 2072 6573 756c 742e 6170 7065 6e64 2827   result.append('
-00009330: 206e 616d 653d 2572 206d 6f64 653d 2572   name=%r mode=%r
-00009340: 2720 2520 2873 656c 662e 6e61 6d65 2c20  ' % (self.name, 
-00009350: 7365 6c66 2e6d 6f64 6529 290a 2020 2020  self.mode)).    
-00009360: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00009370: 5f63 6f6d 7072 6573 735f 7479 7065 2021  _compress_type !
-00009380: 3d20 5a49 505f 5354 4f52 4544 3a0a 2020  = ZIP_STORED:.  
-00009390: 2020 2020 2020 2020 2020 2020 2020 7265                re
-000093a0: 7375 6c74 2e61 7070 656e 6428 2720 636f  sult.append(' co
-000093b0: 6d70 7265 7373 5f74 7970 653d 2573 2720  mpress_type=%s' 
-000093c0: 250a 2020 2020 2020 2020 2020 2020 2020  %.              
-000093d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000093e0: 636f 6d70 7265 7373 6f72 5f6e 616d 6573  compressor_names
-000093f0: 2e67 6574 2873 656c 662e 5f63 6f6d 7072  .get(self._compr
-00009400: 6573 735f 7479 7065 2c0a 2020 2020 2020  ess_type,.      
-00009410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009430: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00009440: 662e 5f63 6f6d 7072 6573 735f 7479 7065  f._compress_type
-00009450: 2929 0a20 2020 2020 2020 2065 6c73 653a  )).        else:
-00009460: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-00009470: 756c 742e 6170 7065 6e64 2827 205b 636c  ult.append(' [cl
-00009480: 6f73 6564 5d27 290a 2020 2020 2020 2020  osed]').        
-00009490: 7265 7375 6c74 2e61 7070 656e 6428 273e  result.append('>
-000094a0: 2729 0a20 2020 2020 2020 2072 6574 7572  ').        retur
-000094b0: 6e20 2727 2e6a 6f69 6e28 7265 7375 6c74  n ''.join(result
-000094c0: 290a 0a20 2020 2064 6566 2072 6561 646c  )..    def readl
-000094d0: 696e 6528 7365 6c66 2c20 6c69 6d69 743d  ine(self, limit=
-000094e0: 2d31 293a 0a20 2020 2020 2020 2022 2222  -1):.        """
-000094f0: 5265 6164 2061 6e64 2072 6574 7572 6e20  Read and return 
-00009500: 6120 6c69 6e65 2066 726f 6d20 7468 6520  a line from the 
-00009510: 7374 7265 616d 2e0a 0a20 2020 2020 2020  stream...       
-00009520: 2049 6620 6c69 6d69 7420 6973 2073 7065   If limit is spe
-00009530: 6369 6669 6564 2c20 6174 206d 6f73 7420  cified, at most 
-00009540: 6c69 6d69 7420 6279 7465 7320 7769 6c6c  limit bytes will
-00009550: 2062 6520 7265 6164 2e0a 2020 2020 2020   be read..      
-00009560: 2020 2222 220a 0a20 2020 2020 2020 2069    """..        i
-00009570: 6620 6c69 6d69 7420 3c20 303a 0a20 2020  f limit < 0:.   
-00009580: 2020 2020 2020 2020 2023 2053 686f 7274           # Short
-00009590: 6375 7420 636f 6d6d 6f6e 2063 6173 6520  cut common case 
-000095a0: 2d20 6e65 776c 696e 6520 666f 756e 6420  - newline found 
-000095b0: 696e 2062 7566 6665 722e 0a20 2020 2020  in buffer..     
-000095c0: 2020 2020 2020 2069 203d 2073 656c 662e         i = self.
-000095d0: 5f72 6561 6462 7566 6665 722e 6669 6e64  _readbuffer.find
-000095e0: 2862 275c 6e27 2c20 7365 6c66 2e5f 6f66  (b'\n', self._of
-000095f0: 6673 6574 2920 2b20 310a 2020 2020 2020  fset) + 1.      
-00009600: 2020 2020 2020 6966 2069 203e 2030 3a0a        if i > 0:.
-00009610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009620: 6c69 6e65 203d 2073 656c 662e 5f72 6561  line = self._rea
-00009630: 6462 7566 6665 725b 7365 6c66 2e5f 6f66  dbuffer[self._of
-00009640: 6673 6574 3a20 695d 0a20 2020 2020 2020  fset: i].       
-00009650: 2020 2020 2020 2020 2073 656c 662e 5f6f           self._o
-00009660: 6666 7365 7420 3d20 690a 2020 2020 2020  ffset = i.      
-00009670: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00009680: 206c 696e 650a 0a20 2020 2020 2020 2072   line..        r
-00009690: 6574 7572 6e20 696f 2e42 7566 6665 7265  eturn io.Buffere
-000096a0: 6449 4f42 6173 652e 7265 6164 6c69 6e65  dIOBase.readline
-000096b0: 2873 656c 662c 206c 696d 6974 290a 0a20  (self, limit).. 
-000096c0: 2020 2064 6566 2070 6565 6b28 7365 6c66     def peek(self
-000096d0: 2c20 6e3d 3129 3a0a 2020 2020 2020 2020  , n=1):.        
-000096e0: 2222 2252 6574 7572 6e73 2062 7566 6665  """Returns buffe
-000096f0: 7265 6420 6279 7465 7320 7769 7468 6f75  red bytes withou
-00009700: 7420 6164 7661 6e63 696e 6720 7468 6520  t advancing the 
-00009710: 706f 7369 7469 6f6e 2e22 2222 0a20 2020  position.""".   
-00009720: 2020 2020 2069 6620 6e20 3e20 6c65 6e28       if n > len(
-00009730: 7365 6c66 2e5f 7265 6164 6275 6666 6572  self._readbuffer
-00009740: 2920 2d20 7365 6c66 2e5f 6f66 6673 6574  ) - self._offset
-00009750: 3a0a 2020 2020 2020 2020 2020 2020 6368  :.            ch
-00009760: 756e 6b20 3d20 7365 6c66 2e72 6561 6428  unk = self.read(
-00009770: 6e29 0a20 2020 2020 2020 2020 2020 2069  n).            i
-00009780: 6620 6c65 6e28 6368 756e 6b29 203e 2073  f len(chunk) > s
-00009790: 656c 662e 5f6f 6666 7365 743a 0a20 2020  elf._offset:.   
-000097a0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-000097b0: 662e 5f72 6561 6462 7566 6665 7220 3d20  f._readbuffer = 
-000097c0: 6368 756e 6b20 2b20 7365 6c66 2e5f 7265  chunk + self._re
-000097d0: 6164 6275 6666 6572 5b73 656c 662e 5f6f  adbuffer[self._o
-000097e0: 6666 7365 743a 5d0a 2020 2020 2020 2020  ffset:].        
-000097f0: 2020 2020 2020 2020 7365 6c66 2e5f 6f66          self._of
-00009800: 6673 6574 203d 2030 0a20 2020 2020 2020  fset = 0.       
-00009810: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00009820: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00009830: 5f6f 6666 7365 7420 2d3d 206c 656e 2863  _offset -= len(c
-00009840: 6875 6e6b 290a 0a20 2020 2020 2020 2023  hunk)..        #
-00009850: 2052 6574 7572 6e20 7570 2074 6f20 3531   Return up to 51
-00009860: 3220 6279 7465 7320 746f 2072 6564 7563  2 bytes to reduc
-00009870: 6520 616c 6c6f 6361 7469 6f6e 206f 7665  e allocation ove
-00009880: 7268 6561 6420 666f 7220 7469 6768 7420  rhead for tight 
-00009890: 6c6f 6f70 732e 0a20 2020 2020 2020 2072  loops..        r
-000098a0: 6574 7572 6e20 7365 6c66 2e5f 7265 6164  eturn self._read
-000098b0: 6275 6666 6572 5b73 656c 662e 5f6f 6666  buffer[self._off
-000098c0: 7365 743a 2073 656c 662e 5f6f 6666 7365  set: self._offse
-000098d0: 7420 2b20 3531 325d 0a0a 2020 2020 6465  t + 512]..    de
-000098e0: 6620 7265 6164 6162 6c65 2873 656c 6629  f readable(self)
-000098f0: 3a0a 2020 2020 2020 2020 6966 2073 656c  :.        if sel
-00009900: 662e 636c 6f73 6564 3a0a 2020 2020 2020  f.closed:.      
-00009910: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00009920: 6545 7272 6f72 2822 492f 4f20 6f70 6572  eError("I/O oper
-00009930: 6174 696f 6e20 6f6e 2063 6c6f 7365 6420  ation on closed 
-00009940: 6669 6c65 2e22 290a 2020 2020 2020 2020  file.").        
-00009950: 7265 7475 726e 2054 7275 650a 0a20 2020  return True..   
-00009960: 2064 6566 2072 6561 6428 7365 6c66 2c20   def read(self, 
-00009970: 6e3d 2d31 293a 0a20 2020 2020 2020 2022  n=-1):.        "
-00009980: 2222 5265 6164 2061 6e64 2072 6574 7572  ""Read and retur
-00009990: 6e20 7570 2074 6f20 6e20 6279 7465 732e  n up to n bytes.
-000099a0: 0a20 2020 2020 2020 2049 6620 7468 6520  .        If the 
-000099b0: 6172 6775 6d65 6e74 2069 7320 6f6d 6974  argument is omit
-000099c0: 7465 642c 204e 6f6e 652c 206f 7220 6e65  ted, None, or ne
-000099d0: 6761 7469 7665 2c20 6461 7461 2069 7320  gative, data is 
-000099e0: 7265 6164 2061 6e64 2072 6574 7572 6e65  read and returne
-000099f0: 6420 756e 7469 6c20 454f 4620 6973 2072  d until EOF is r
-00009a00: 6561 6368 6564 2e0a 2020 2020 2020 2020  eached..        
-00009a10: 2222 220a 2020 2020 2020 2020 6966 2073  """.        if s
-00009a20: 656c 662e 636c 6f73 6564 3a0a 2020 2020  elf.closed:.    
-00009a30: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-00009a40: 6c75 6545 7272 6f72 2822 7265 6164 2066  lueError("read f
-00009a50: 726f 6d20 636c 6f73 6564 2066 696c 652e  rom closed file.
-00009a60: 2229 0a20 2020 2020 2020 2069 6620 6e20  ").        if n 
-00009a70: 6973 204e 6f6e 6520 6f72 206e 203c 2030  is None or n < 0
-00009a80: 3a0a 2020 2020 2020 2020 2020 2020 6275  :.            bu
-00009a90: 6620 3d20 7365 6c66 2e5f 7265 6164 6275  f = self._readbu
-00009aa0: 6666 6572 5b73 656c 662e 5f6f 6666 7365  ffer[self._offse
-00009ab0: 743a 5d0a 2020 2020 2020 2020 2020 2020  t:].            
-00009ac0: 7365 6c66 2e5f 7265 6164 6275 6666 6572  self._readbuffer
-00009ad0: 203d 2062 2727 0a20 2020 2020 2020 2020   = b''.         
-00009ae0: 2020 2073 656c 662e 5f6f 6666 7365 7420     self._offset 
-00009af0: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
-00009b00: 7768 696c 6520 6e6f 7420 7365 6c66 2e5f  while not self._
-00009b10: 656f 663a 0a20 2020 2020 2020 2020 2020  eof:.           
-00009b20: 2020 2020 2062 7566 202b 3d20 7365 6c66       buf += self
-00009b30: 2e5f 7265 6164 3128 7365 6c66 2e4d 4158  ._read1(self.MAX
-00009b40: 5f4e 290a 2020 2020 2020 2020 2020 2020  _N).            
-00009b50: 7265 7475 726e 2062 7566 0a0a 2020 2020  return buf..    
-00009b60: 2020 2020 656e 6420 3d20 6e20 2b20 7365      end = n + se
-00009b70: 6c66 2e5f 6f66 6673 6574 0a20 2020 2020  lf._offset.     
-00009b80: 2020 2069 6620 656e 6420 3c20 6c65 6e28     if end < len(
-00009b90: 7365 6c66 2e5f 7265 6164 6275 6666 6572  self._readbuffer
-00009ba0: 293a 0a20 2020 2020 2020 2020 2020 2062  ):.            b
-00009bb0: 7566 203d 2073 656c 662e 5f72 6561 6462  uf = self._readb
-00009bc0: 7566 6665 725b 7365 6c66 2e5f 6f66 6673  uffer[self._offs
-00009bd0: 6574 3a65 6e64 5d0a 2020 2020 2020 2020  et:end].        
-00009be0: 2020 2020 7365 6c66 2e5f 6f66 6673 6574      self._offset
-00009bf0: 203d 2065 6e64 0a20 2020 2020 2020 2020   = end.         
-00009c00: 2020 2072 6574 7572 6e20 6275 660a 0a20     return buf.. 
-00009c10: 2020 2020 2020 206e 203d 2065 6e64 202d         n = end -
-00009c20: 206c 656e 2873 656c 662e 5f72 6561 6462   len(self._readb
-00009c30: 7566 6665 7229 0a20 2020 2020 2020 2062  uffer).        b
-00009c40: 7566 203d 2073 656c 662e 5f72 6561 6462  uf = self._readb
-00009c50: 7566 6665 725b 7365 6c66 2e5f 6f66 6673  uffer[self._offs
-00009c60: 6574 3a5d 0a20 2020 2020 2020 2073 656c  et:].        sel
-00009c70: 662e 5f72 6561 6462 7566 6665 7220 3d20  f._readbuffer = 
-00009c80: 6227 270a 2020 2020 2020 2020 7365 6c66  b''.        self
-00009c90: 2e5f 6f66 6673 6574 203d 2030 0a20 2020  ._offset = 0.   
-00009ca0: 2020 2020 2077 6869 6c65 206e 203e 2030       while n > 0
-00009cb0: 2061 6e64 206e 6f74 2073 656c 662e 5f65   and not self._e
-00009cc0: 6f66 3a0a 2020 2020 2020 2020 2020 2020  of:.            
-00009cd0: 6461 7461 203d 2073 656c 662e 5f72 6561  data = self._rea
-00009ce0: 6431 286e 290a 2020 2020 2020 2020 2020  d1(n).          
-00009cf0: 2020 6966 206e 203c 206c 656e 2864 6174    if n < len(dat
-00009d00: 6129 3a0a 2020 2020 2020 2020 2020 2020  a):.            
-00009d10: 2020 2020 7365 6c66 2e5f 7265 6164 6275      self._readbu
-00009d20: 6666 6572 203d 2064 6174 610a 2020 2020  ffer = data.    
-00009d30: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00009d40: 2e5f 6f66 6673 6574 203d 206e 0a20 2020  ._offset = n.   
-00009d50: 2020 2020 2020 2020 2020 2020 2062 7566               buf
-00009d60: 202b 3d20 6461 7461 5b3a 6e5d 0a20 2020   += data[:n].   
-00009d70: 2020 2020 2020 2020 2020 2020 2062 7265               bre
-00009d80: 616b 0a20 2020 2020 2020 2020 2020 2062  ak.            b
-00009d90: 7566 202b 3d20 6461 7461 0a20 2020 2020  uf += data.     
-00009da0: 2020 2020 2020 206e 202d 3d20 6c65 6e28         n -= len(
-00009db0: 6461 7461 290a 2020 2020 2020 2020 7265  data).        re
-00009dc0: 7475 726e 2062 7566 0a0a 2020 2020 6465  turn buf..    de
-00009dd0: 6620 5f75 7064 6174 655f 6372 6328 7365  f _update_crc(se
-00009de0: 6c66 2c20 6e65 7764 6174 6129 3a0a 2020  lf, newdata):.  
-00009df0: 2020 2020 2020 2320 5570 6461 7465 2074        # Update t
-00009e00: 6865 2043 5243 2075 7369 6e67 2074 6865  he CRC using the
-00009e10: 2067 6976 656e 2064 6174 612e 0a20 2020   given data..   
-00009e20: 2020 2020 2069 6620 7365 6c66 2e5f 6578       if self._ex
-00009e30: 7065 6374 6564 5f63 7263 2069 7320 4e6f  pected_crc is No
-00009e40: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00009e50: 2320 4e6f 206e 6565 6420 746f 2063 6f6d  # No need to com
-00009e60: 7075 7465 2074 6865 2043 5243 2069 6620  pute the CRC if 
-00009e70: 7765 2064 6f6e 2774 2068 6176 6520 6120  we don't have a 
-00009e80: 7265 6665 7265 6e63 6520 7661 6c75 650a  reference value.
-00009e90: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00009ea0: 726e 0a20 2020 2020 2020 2073 656c 662e  rn.        self.
-00009eb0: 5f72 756e 6e69 6e67 5f63 7263 203d 2063  _running_crc = c
-00009ec0: 7263 3332 286e 6577 6461 7461 2c20 7365  rc32(newdata, se
-00009ed0: 6c66 2e5f 7275 6e6e 696e 675f 6372 6329  lf._running_crc)
-00009ee0: 2026 2030 7866 6666 6666 6666 660a 2020   & 0xffffffff.  
-00009ef0: 2020 2020 2020 2320 4368 6563 6b20 7468        # Check th
-00009f00: 6520 4352 4320 6966 2077 6527 7265 2061  e CRC if we're a
-00009f10: 7420 7468 6520 656e 6420 6f66 2074 6865  t the end of the
-00009f20: 2066 696c 650a 2020 2020 2020 2020 6966   file.        if
-00009f30: 2073 656c 662e 5f65 6f66 2061 6e64 2073   self._eof and s
-00009f40: 656c 662e 5f72 756e 6e69 6e67 5f63 7263  elf._running_crc
-00009f50: 2021 3d20 7365 6c66 2e5f 6578 7065 6374   != self._expect
-00009f60: 6564 5f63 7263 3a0a 2020 2020 2020 2020  ed_crc:.        
-00009f70: 2020 2020 7261 6973 6520 4261 645a 6970      raise BadZip
-00009f80: 4669 6c65 2822 4261 6420 4352 432d 3332  File("Bad CRC-32
-00009f90: 2066 6f72 2066 696c 6520 2572 2220 2520   for file %r" % 
-00009fa0: 7365 6c66 2e6e 616d 6529 0a0a 2020 2020  self.name)..    
-00009fb0: 6465 6620 7265 6164 3128 7365 6c66 2c20  def read1(self, 
-00009fc0: 6e29 3a0a 2020 2020 2020 2020 2222 2252  n):.        """R
-00009fd0: 6561 6420 7570 2074 6f20 6e20 6279 7465  ead up to n byte
-00009fe0: 7320 7769 7468 2061 7420 6d6f 7374 206f  s with at most o
-00009ff0: 6e65 2072 6561 6428 2920 7379 7374 656d  ne read() system
-0000a000: 2063 616c 6c2e 2222 220a 0a20 2020 2020   call."""..     
-0000a010: 2020 2069 6620 6e20 6973 204e 6f6e 6520     if n is None 
-0000a020: 6f72 206e 203c 2030 3a0a 2020 2020 2020  or n < 0:.      
-0000a030: 2020 2020 2020 6275 6620 3d20 7365 6c66        buf = self
-0000a040: 2e5f 7265 6164 6275 6666 6572 5b73 656c  ._readbuffer[sel
-0000a050: 662e 5f6f 6666 7365 743a 5d0a 2020 2020  f._offset:].    
-0000a060: 2020 2020 2020 2020 7365 6c66 2e5f 7265          self._re
-0000a070: 6164 6275 6666 6572 203d 2062 2727 0a20  adbuffer = b''. 
-0000a080: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000a090: 5f6f 6666 7365 7420 3d20 300a 2020 2020  _offset = 0.    
-0000a0a0: 2020 2020 2020 2020 7768 696c 6520 6e6f          while no
-0000a0b0: 7420 7365 6c66 2e5f 656f 663a 0a20 2020  t self._eof:.   
-0000a0c0: 2020 2020 2020 2020 2020 2020 2064 6174               dat
-0000a0d0: 6120 3d20 7365 6c66 2e5f 7265 6164 3128  a = self._read1(
-0000a0e0: 7365 6c66 2e4d 4158 5f4e 290a 2020 2020  self.MAX_N).    
-0000a0f0: 2020 2020 2020 2020 2020 2020 6966 2064              if d
-0000a100: 6174 613a 0a20 2020 2020 2020 2020 2020  ata:.           
-0000a110: 2020 2020 2020 2020 2062 7566 202b 3d20           buf += 
-0000a120: 6461 7461 0a20 2020 2020 2020 2020 2020  data.           
-0000a130: 2020 2020 2020 2020 2062 7265 616b 0a20           break. 
-0000a140: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000a150: 6e20 6275 660a 0a20 2020 2020 2020 2065  n buf..        e
-0000a160: 6e64 203d 206e 202b 2073 656c 662e 5f6f  nd = n + self._o
-0000a170: 6666 7365 740a 2020 2020 2020 2020 6966  ffset.        if
-0000a180: 2065 6e64 203c 206c 656e 2873 656c 662e   end < len(self.
-0000a190: 5f72 6561 6462 7566 6665 7229 3a0a 2020  _readbuffer):.  
-0000a1a0: 2020 2020 2020 2020 2020 6275 6620 3d20            buf = 
-0000a1b0: 7365 6c66 2e5f 7265 6164 6275 6666 6572  self._readbuffer
-0000a1c0: 5b73 656c 662e 5f6f 6666 7365 743a 656e  [self._offset:en
-0000a1d0: 645d 0a20 2020 2020 2020 2020 2020 2073  d].            s
-0000a1e0: 656c 662e 5f6f 6666 7365 7420 3d20 656e  elf._offset = en
-0000a1f0: 640a 2020 2020 2020 2020 2020 2020 7265  d.            re
-0000a200: 7475 726e 2062 7566 0a0a 2020 2020 2020  turn buf..      
-0000a210: 2020 6e20 3d20 656e 6420 2d20 6c65 6e28    n = end - len(
-0000a220: 7365 6c66 2e5f 7265 6164 6275 6666 6572  self._readbuffer
-0000a230: 290a 2020 2020 2020 2020 6275 6620 3d20  ).        buf = 
-0000a240: 7365 6c66 2e5f 7265 6164 6275 6666 6572  self._readbuffer
-0000a250: 5b73 656c 662e 5f6f 6666 7365 743a 5d0a  [self._offset:].
-0000a260: 2020 2020 2020 2020 7365 6c66 2e5f 7265          self._re
-0000a270: 6164 6275 6666 6572 203d 2062 2727 0a20  adbuffer = b''. 
-0000a280: 2020 2020 2020 2073 656c 662e 5f6f 6666         self._off
-0000a290: 7365 7420 3d20 300a 2020 2020 2020 2020  set = 0.        
-0000a2a0: 6966 206e 203e 2030 3a0a 2020 2020 2020  if n > 0:.      
-0000a2b0: 2020 2020 2020 7768 696c 6520 6e6f 7420        while not 
-0000a2c0: 7365 6c66 2e5f 656f 663a 0a20 2020 2020  self._eof:.     
-0000a2d0: 2020 2020 2020 2020 2020 2064 6174 6120             data 
-0000a2e0: 3d20 7365 6c66 2e5f 7265 6164 3128 6e29  = self._read1(n)
-0000a2f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a300: 2069 6620 6e20 3c20 6c65 6e28 6461 7461   if n < len(data
-0000a310: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0000a320: 2020 2020 2020 2073 656c 662e 5f72 6561         self._rea
-0000a330: 6462 7566 6665 7220 3d20 6461 7461 0a20  dbuffer = data. 
-0000a340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a350: 2020 2073 656c 662e 5f6f 6666 7365 7420     self._offset 
-0000a360: 3d20 6e0a 2020 2020 2020 2020 2020 2020  = n.            
-0000a370: 2020 2020 2020 2020 6275 6620 2b3d 2064          buf += d
-0000a380: 6174 615b 3a6e 5d0a 2020 2020 2020 2020  ata[:n].        
-0000a390: 2020 2020 2020 2020 2020 2020 6272 6561              brea
-0000a3a0: 6b0a 2020 2020 2020 2020 2020 2020 2020  k.              
-0000a3b0: 2020 6966 2064 6174 613a 0a20 2020 2020    if data:.     
-0000a3c0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-0000a3d0: 7566 202b 3d20 6461 7461 0a20 2020 2020  uf += data.     
-0000a3e0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-0000a3f0: 7265 616b 0a20 2020 2020 2020 2072 6574  reak.        ret
-0000a400: 7572 6e20 6275 660a 0a20 2020 2064 6566  urn buf..    def
-0000a410: 205f 7265 6164 3128 7365 6c66 2c20 6e29   _read1(self, n)
-0000a420: 3a0a 2020 2020 2020 2020 2320 5265 6164  :.        # Read
-0000a430: 2075 7020 746f 206e 2063 6f6d 7072 6573   up to n compres
-0000a440: 7365 6420 6279 7465 7320 7769 7468 2061  sed bytes with a
-0000a450: 7420 6d6f 7374 206f 6e65 2072 6561 6428  t most one read(
-0000a460: 2920 7379 7374 656d 2063 616c 6c2c 0a20  ) system call,. 
-0000a470: 2020 2020 2020 2023 2064 6563 7279 7074         # decrypt
-0000a480: 2061 6e64 2064 6563 6f6d 7072 6573 7320   and decompress 
-0000a490: 7468 656d 2e0a 2020 2020 2020 2020 6966  them..        if
-0000a4a0: 2073 656c 662e 5f65 6f66 206f 7220 6e20   self._eof or n 
-0000a4b0: 3c3d 2030 3a0a 2020 2020 2020 2020 2020  <= 0:.          
-0000a4c0: 2020 7265 7475 726e 2062 2727 0a0a 2020    return b''..  
-0000a4d0: 2020 2020 2020 2320 5265 6164 2066 726f        # Read fro
-0000a4e0: 6d20 6669 6c65 2e0a 2020 2020 2020 2020  m file..        
-0000a4f0: 6966 2073 656c 662e 5f63 6f6d 7072 6573  if self._compres
-0000a500: 735f 7479 7065 203d 3d20 5a49 505f 4445  s_type == ZIP_DE
-0000a510: 464c 4154 4544 3a0a 2020 2020 2020 2020  FLATED:.        
-0000a520: 2020 2020 2323 2048 616e 646c 6520 756e      ## Handle un
-0000a530: 636f 6e73 756d 6564 2064 6174 612e 0a20  consumed data.. 
-0000a540: 2020 2020 2020 2020 2020 2064 6174 6120             data 
-0000a550: 3d20 7365 6c66 2e5f 6465 636f 6d70 7265  = self._decompre
-0000a560: 7373 6f72 2e75 6e63 6f6e 7375 6d65 645f  ssor.unconsumed_
-0000a570: 7461 696c 0a20 2020 2020 2020 2020 2020  tail.           
-0000a580: 2069 6620 6e20 3e20 6c65 6e28 6461 7461   if n > len(data
-0000a590: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0000a5a0: 2020 2064 6174 6120 2b3d 2073 656c 662e     data += self.
-0000a5b0: 5f72 6561 6432 286e 202d 206c 656e 2864  _read2(n - len(d
-0000a5c0: 6174 6129 290a 2020 2020 2020 2020 656c  ata)).        el
-0000a5d0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0000a5e0: 6461 7461 203d 2073 656c 662e 5f72 6561  data = self._rea
-0000a5f0: 6432 286e 290a 0a20 2020 2020 2020 2069  d2(n)..        i
-0000a600: 6620 7365 6c66 2e5f 636f 6d70 7265 7373  f self._compress
-0000a610: 5f74 7970 6520 3d3d 205a 4950 5f53 544f  _type == ZIP_STO
-0000a620: 5245 443a 0a20 2020 2020 2020 2020 2020  RED:.           
-0000a630: 2073 656c 662e 5f65 6f66 203d 2073 656c   self._eof = sel
-0000a640: 662e 5f63 6f6d 7072 6573 735f 6c65 6674  f._compress_left
-0000a650: 203c 3d20 300a 2020 2020 2020 2020 656c   <= 0.        el
-0000a660: 6966 2073 656c 662e 5f63 6f6d 7072 6573  if self._compres
-0000a670: 735f 7479 7065 203d 3d20 5a49 505f 4445  s_type == ZIP_DE
-0000a680: 464c 4154 4544 3a0a 2020 2020 2020 2020  FLATED:.        
-0000a690: 2020 2020 6e20 3d20 6d61 7828 6e2c 2073      n = max(n, s
-0000a6a0: 656c 662e 4d49 4e5f 5245 4144 5f53 495a  elf.MIN_READ_SIZ
-0000a6b0: 4529 0a20 2020 2020 2020 2020 2020 2064  E).            d
-0000a6c0: 6174 6120 3d20 7365 6c66 2e5f 6465 636f  ata = self._deco
-0000a6d0: 6d70 7265 7373 6f72 2e64 6563 6f6d 7072  mpressor.decompr
-0000a6e0: 6573 7328 6461 7461 2c20 6e29 0a20 2020  ess(data, n).   
-0000a6f0: 2020 2020 2020 2020 2073 656c 662e 5f65           self._e
-0000a700: 6f66 203d 2028 6765 7461 7474 7228 7365  of = (getattr(se
-0000a710: 6c66 2e5f 6465 636f 6d70 7265 7373 6f72  lf._decompressor
-0000a720: 2c20 2765 6f66 272c 2046 616c 7365 2920  , 'eof', False) 
-0000a730: 6f72 0a20 2020 2020 2020 2020 2020 2020  or.             
-0000a740: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000a750: 2e5f 636f 6d70 7265 7373 5f6c 6566 7420  ._compress_left 
-0000a760: 3c3d 2030 2061 6e64 0a20 2020 2020 2020  <= 0 and.       
-0000a770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a780: 2020 6e6f 7420 7365 6c66 2e5f 6465 636f    not self._deco
-0000a790: 6d70 7265 7373 6f72 2e75 6e63 6f6e 7375  mpressor.unconsu
-0000a7a0: 6d65 645f 7461 696c 290a 2020 2020 2020  med_tail).      
-0000a7b0: 2020 2020 2020 6966 2073 656c 662e 5f65        if self._e
-0000a7c0: 6f66 3a0a 2020 2020 2020 2020 2020 2020  of:.            
-0000a7d0: 2020 2020 6461 7461 202b 3d20 7365 6c66      data += self
-0000a7e0: 2e5f 6465 636f 6d70 7265 7373 6f72 2e66  ._decompressor.f
-0000a7f0: 6c75 7368 2829 0a20 2020 2020 2020 2065  lush().        e
-0000a800: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0000a810: 2064 6174 6120 3d20 7365 6c66 2e5f 6465   data = self._de
-0000a820: 636f 6d70 7265 7373 6f72 2e64 6563 6f6d  compressor.decom
-0000a830: 7072 6573 7328 6461 7461 290a 2020 2020  press(data).    
-0000a840: 2020 2020 2020 2020 7365 6c66 2e5f 656f          self._eo
-0000a850: 6620 3d20 6765 7461 7474 7228 7365 6c66  f = getattr(self
-0000a860: 2e5f 6465 636f 6d70 7265 7373 6f72 2c20  ._decompressor, 
-0000a870: 2765 6f66 272c 2046 616c 7365 2920 6f72  'eof', False) or
-0000a880: 2073 656c 662e 5f63 6f6d 7072 6573 735f   self._compress_
-0000a890: 6c65 6674 203c 3d20 300a 0a20 2020 2020  left <= 0..     
-0000a8a0: 2020 2064 6174 6120 3d20 6461 7461 5b3a     data = data[:
-0000a8b0: 7365 6c66 2e5f 6c65 6674 5d0a 2020 2020  self._left].    
-0000a8c0: 2020 2020 7365 6c66 2e5f 6c65 6674 202d      self._left -
-0000a8d0: 3d20 6c65 6e28 6461 7461 290a 2020 2020  = len(data).    
-0000a8e0: 2020 2020 6966 2073 656c 662e 5f6c 6566      if self._lef
-0000a8f0: 7420 3c3d 2030 3a0a 2020 2020 2020 2020  t <= 0:.        
-0000a900: 2020 2020 7365 6c66 2e5f 656f 6620 3d20      self._eof = 
-0000a910: 5472 7565 0a20 2020 2020 2020 2073 656c  True.        sel
-0000a920: 662e 5f75 7064 6174 655f 6372 6328 6461  f._update_crc(da
-0000a930: 7461 290a 2020 2020 2020 2020 7265 7475  ta).        retu
-0000a940: 726e 2064 6174 610a 0a20 2020 2064 6566  rn data..    def
-0000a950: 205f 7265 6164 3228 7365 6c66 2c20 6e29   _read2(self, n)
-0000a960: 3a0a 2020 2020 2020 2020 6966 2073 656c  :.        if sel
-0000a970: 662e 5f63 6f6d 7072 6573 735f 6c65 6674  f._compress_left
-0000a980: 203c 3d20 303a 0a20 2020 2020 2020 2020   <= 0:.         
-0000a990: 2020 2072 6574 7572 6e20 6227 270a 0a20     return b''.. 
-0000a9a0: 2020 2020 2020 206e 203d 206d 6178 286e         n = max(n
-0000a9b0: 2c20 7365 6c66 2e4d 494e 5f52 4541 445f  , self.MIN_READ_
-0000a9c0: 5349 5a45 290a 2020 2020 2020 2020 6e20  SIZE).        n 
-0000a9d0: 3d20 6d69 6e28 6e2c 2073 656c 662e 5f63  = min(n, self._c
-0000a9e0: 6f6d 7072 6573 735f 6c65 6674 290a 0a20  ompress_left).. 
-0000a9f0: 2020 2020 2020 2064 6174 6120 3d20 7365         data = se
-0000aa00: 6c66 2e5f 6669 6c65 6f62 6a2e 7265 6164  lf._fileobj.read
-0000aa10: 286e 290a 2020 2020 2020 2020 7365 6c66  (n).        self
-0000aa20: 2e5f 636f 6d70 7265 7373 5f6c 6566 7420  ._compress_left 
-0000aa30: 2d3d 206c 656e 2864 6174 6129 0a20 2020  -= len(data).   
-0000aa40: 2020 2020 2069 6620 6e6f 7420 6461 7461       if not data
-0000aa50: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-0000aa60: 6973 6520 454f 4645 7272 6f72 0a0a 2020  ise EOFError..  
-0000aa70: 2020 2020 2020 6966 2073 656c 662e 5f64        if self._d
-0000aa80: 6563 7279 7074 6572 2069 7320 6e6f 7420  ecrypter is not 
-0000aa90: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0000aaa0: 2020 6461 7461 203d 2073 656c 662e 5f64    data = self._d
-0000aab0: 6563 7279 7074 6572 2864 6174 6129 0a20  ecrypter(data). 
-0000aac0: 2020 2020 2020 2072 6574 7572 6e20 6461         return da
-0000aad0: 7461 0a0a 2020 2020 6465 6620 636c 6f73  ta..    def clos
-0000aae0: 6528 7365 6c66 293a 0a20 2020 2020 2020  e(self):.       
-0000aaf0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-0000ab00: 2020 6966 2073 656c 662e 5f63 6c6f 7365    if self._close
-0000ab10: 5f66 696c 656f 626a 3a0a 2020 2020 2020  _fileobj:.      
-0000ab20: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-0000ab30: 6669 6c65 6f62 6a2e 636c 6f73 6528 290a  fileobj.close().
-0000ab40: 2020 2020 2020 2020 6669 6e61 6c6c 793a          finally:
-0000ab50: 0a20 2020 2020 2020 2020 2020 2073 7570  .            sup
-0000ab60: 6572 285a 6970 4578 7446 696c 652c 2073  er(ZipExtFile, s
-0000ab70: 656c 6629 2e63 6c6f 7365 2829 0a0a 2020  elf).close()..  
-0000ab80: 2020 6465 6620 7365 656b 6162 6c65 2873    def seekable(s
-0000ab90: 656c 6629 3a0a 2020 2020 2020 2020 6966  elf):.        if
-0000aba0: 2073 656c 662e 636c 6f73 6564 3a0a 2020   self.closed:.  
-0000abb0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0000abc0: 5661 6c75 6545 7272 6f72 2822 492f 4f20  ValueError("I/O 
-0000abd0: 6f70 6572 6174 696f 6e20 6f6e 2063 6c6f  operation on clo
-0000abe0: 7365 6420 6669 6c65 2e22 290a 2020 2020  sed file.").    
-0000abf0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0000ac00: 5f73 6565 6b61 626c 650a 0a20 2020 2064  _seekable..    d
-0000ac10: 6566 2073 6565 6b28 7365 6c66 2c20 6f66  ef seek(self, of
-0000ac20: 6673 6574 2c20 7768 656e 6365 3d30 293a  fset, whence=0):
-0000ac30: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-0000ac40: 2e63 6c6f 7365 643a 0a20 2020 2020 2020  .closed:.       
-0000ac50: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-0000ac60: 4572 726f 7228 2273 6565 6b20 6f6e 2063  Error("seek on c
-0000ac70: 6c6f 7365 6420 6669 6c65 2e22 290a 2020  losed file.").  
-0000ac80: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
-0000ac90: 662e 5f73 6565 6b61 626c 653a 0a20 2020  f._seekable:.   
-0000aca0: 2020 2020 2020 2020 2072 6169 7365 2069           raise i
-0000acb0: 6f2e 556e 7375 7070 6f72 7465 644f 7065  o.UnsupportedOpe
-0000acc0: 7261 7469 6f6e 2822 756e 6465 726c 7969  ration("underlyi
-0000acd0: 6e67 2073 7472 6561 6d20 6973 206e 6f74  ng stream is not
-0000ace0: 2073 6565 6b61 626c 6522 290a 2020 2020   seekable").    
-0000acf0: 2020 2020 6375 7272 5f70 6f73 203d 2073      curr_pos = s
-0000ad00: 656c 662e 7465 6c6c 2829 0a20 2020 2020  elf.tell().     
-0000ad10: 2020 2069 6620 7768 656e 6365 203d 3d20     if whence == 
-0000ad20: 303a 2023 2053 6565 6b20 6672 6f6d 2073  0: # Seek from s
-0000ad30: 7461 7274 206f 6620 6669 6c65 0a20 2020  tart of file.   
-0000ad40: 2020 2020 2020 2020 206e 6577 5f70 6f73           new_pos
-0000ad50: 203d 206f 6666 7365 740a 2020 2020 2020   = offset.      
-0000ad60: 2020 656c 6966 2077 6865 6e63 6520 3d3d    elif whence ==
-0000ad70: 2031 3a20 2320 5365 656b 2066 726f 6d20   1: # Seek from 
-0000ad80: 6375 7272 656e 7420 706f 7369 7469 6f6e  current position
-0000ad90: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
-0000ada0: 5f70 6f73 203d 2063 7572 725f 706f 7320  _pos = curr_pos 
-0000adb0: 2b20 6f66 6673 6574 0a20 2020 2020 2020  + offset.       
-0000adc0: 2065 6c69 6620 7768 656e 6365 203d 3d20   elif whence == 
-0000add0: 323a 2023 2053 6565 6b20 6672 6f6d 2045  2: # Seek from E
-0000ade0: 4f46 0a20 2020 2020 2020 2020 2020 206e  OF.            n
-0000adf0: 6577 5f70 6f73 203d 2073 656c 662e 5f6f  ew_pos = self._o
-0000ae00: 7269 675f 6669 6c65 5f73 697a 6520 2b20  rig_file_size + 
-0000ae10: 6f66 6673 6574 0a20 2020 2020 2020 2065  offset.        e
-0000ae20: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0000ae30: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-0000ae40: 7228 2277 6865 6e63 6520 6d75 7374 2062  r("whence must b
-0000ae50: 6520 6f73 2e53 4545 4b5f 5345 5420 2830  e os.SEEK_SET (0
-0000ae60: 292c 2022 0a20 2020 2020 2020 2020 2020  ), ".           
-0000ae70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ae80: 2020 226f 732e 5345 454b 5f43 5552 2028    "os.SEEK_CUR (
-0000ae90: 3129 2c20 6f72 206f 732e 5345 454b 5f45  1), or os.SEEK_E
-0000aea0: 4e44 2028 3229 2229 0a0a 2020 2020 2020  ND (2)")..      
-0000aeb0: 2020 6966 206e 6577 5f70 6f73 203e 2073    if new_pos > s
-0000aec0: 656c 662e 5f6f 7269 675f 6669 6c65 5f73  elf._orig_file_s
-0000aed0: 697a 653a 0a20 2020 2020 2020 2020 2020  ize:.           
-0000aee0: 206e 6577 5f70 6f73 203d 2073 656c 662e   new_pos = self.
-0000aef0: 5f6f 7269 675f 6669 6c65 5f73 697a 650a  _orig_file_size.
-0000af00: 0a20 2020 2020 2020 2069 6620 6e65 775f  .        if new_
-0000af10: 706f 7320 3c20 303a 0a20 2020 2020 2020  pos < 0:.       
-0000af20: 2020 2020 206e 6577 5f70 6f73 203d 2030       new_pos = 0
-0000af30: 0a0a 2020 2020 2020 2020 7265 6164 5f6f  ..        read_o
-0000af40: 6666 7365 7420 3d20 6e65 775f 706f 7320  ffset = new_pos 
-0000af50: 2d20 6375 7272 5f70 6f73 0a20 2020 2020  - curr_pos.     
-0000af60: 2020 2062 7566 665f 6f66 6673 6574 203d     buff_offset =
-0000af70: 2072 6561 645f 6f66 6673 6574 202b 2073   read_offset + s
-0000af80: 656c 662e 5f6f 6666 7365 740a 0a20 2020  elf._offset..   
-0000af90: 2020 2020 2069 6620 6275 6666 5f6f 6666       if buff_off
-0000afa0: 7365 7420 3e3d 2030 2061 6e64 2062 7566  set >= 0 and buf
-0000afb0: 665f 6f66 6673 6574 203c 206c 656e 2873  f_offset < len(s
-0000afc0: 656c 662e 5f72 6561 6462 7566 6665 7229  elf._readbuffer)
-0000afd0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-0000afe0: 4a75 7374 206d 6f76 6520 7468 6520 5f6f  Just move the _o
-0000aff0: 6666 7365 7420 696e 6465 7820 6966 2074  ffset index if t
-0000b000: 6865 206e 6577 2070 6f73 6974 696f 6e20  he new position 
-0000b010: 6973 2069 6e20 7468 6520 5f72 6561 6462  is in the _readb
-0000b020: 7566 6665 720a 2020 2020 2020 2020 2020  uffer.          
-0000b030: 2020 7365 6c66 2e5f 6f66 6673 6574 203d    self._offset =
-0000b040: 2062 7566 665f 6f66 6673 6574 0a20 2020   buff_offset.   
-0000b050: 2020 2020 2020 2020 2072 6561 645f 6f66           read_of
-0000b060: 6673 6574 203d 2030 0a20 2020 2020 2020  fset = 0.       
-0000b070: 2065 6c69 6620 7265 6164 5f6f 6666 7365   elif read_offse
-0000b080: 7420 3c20 303a 0a20 2020 2020 2020 2020  t < 0:.         
-0000b090: 2020 2023 2050 6f73 6974 696f 6e20 6973     # Position is
-0000b0a0: 2062 6566 6f72 6520 7468 6520 6375 7272   before the curr
-0000b0b0: 656e 7420 706f 7369 7469 6f6e 2e20 5265  ent position. Re
-0000b0c0: 7365 7420 7468 6520 5a69 7045 7874 4669  set the ZipExtFi
-0000b0d0: 6c65 0a20 2020 2020 2020 2020 2020 2073  le.            s
-0000b0e0: 656c 662e 5f66 696c 656f 626a 2e73 6565  elf._fileobj.see
-0000b0f0: 6b28 7365 6c66 2e5f 6f72 6967 5f63 6f6d  k(self._orig_com
-0000b100: 7072 6573 735f 7374 6172 7429 0a20 2020  press_start).   
-0000b110: 2020 2020 2020 2020 2073 656c 662e 5f72           self._r
-0000b120: 756e 6e69 6e67 5f63 7263 203d 2073 656c  unning_crc = sel
-0000b130: 662e 5f6f 7269 675f 7374 6172 745f 6372  f._orig_start_cr
-0000b140: 630a 2020 2020 2020 2020 2020 2020 7365  c.            se
-0000b150: 6c66 2e5f 636f 6d70 7265 7373 5f6c 6566  lf._compress_lef
-0000b160: 7420 3d20 7365 6c66 2e5f 6f72 6967 5f63  t = self._orig_c
-0000b170: 6f6d 7072 6573 735f 7369 7a65 0a20 2020  ompress_size.   
-0000b180: 2020 2020 2020 2020 2073 656c 662e 5f6c           self._l
-0000b190: 6566 7420 3d20 7365 6c66 2e5f 6f72 6967  eft = self._orig
-0000b1a0: 5f66 696c 655f 7369 7a65 0a20 2020 2020  _file_size.     
-0000b1b0: 2020 2020 2020 2073 656c 662e 5f72 6561         self._rea
-0000b1c0: 6462 7566 6665 7220 3d20 6227 270a 2020  dbuffer = b''.  
-0000b1d0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-0000b1e0: 6f66 6673 6574 203d 2030 0a20 2020 2020  offset = 0.     
-0000b1f0: 2020 2020 2020 2073 656c 662e 5f64 6563         self._dec
-0000b200: 6f6d 7072 6573 736f 7220 3d20 5f67 6574  ompressor = _get
-0000b210: 5f64 6563 6f6d 7072 6573 736f 7228 7365  _decompressor(se
-0000b220: 6c66 2e5f 636f 6d70 7265 7373 5f74 7970  lf._compress_typ
-0000b230: 6529 0a20 2020 2020 2020 2020 2020 2073  e).            s
-0000b240: 656c 662e 5f65 6f66 203d 2046 616c 7365  elf._eof = False
-0000b250: 0a20 2020 2020 2020 2020 2020 2072 6561  .            rea
-0000b260: 645f 6f66 6673 6574 203d 206e 6577 5f70  d_offset = new_p
-0000b270: 6f73 0a20 2020 2020 2020 2020 2020 2069  os.            i
-0000b280: 6620 7365 6c66 2e5f 6465 6372 7970 7465  f self._decrypte
-0000b290: 7220 6973 206e 6f74 204e 6f6e 653a 0a20  r is not None:. 
-0000b2a0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000b2b0: 656c 662e 5f69 6e69 745f 6465 6372 7970  elf._init_decryp
-0000b2c0: 7465 7228 290a 0a20 2020 2020 2020 2077  ter()..        w
-0000b2d0: 6869 6c65 2072 6561 645f 6f66 6673 6574  hile read_offset
-0000b2e0: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
-0000b2f0: 2020 7265 6164 5f6c 656e 203d 206d 696e    read_len = min
-0000b300: 2873 656c 662e 4d41 585f 5345 454b 5f52  (self.MAX_SEEK_R
-0000b310: 4541 442c 2072 6561 645f 6f66 6673 6574  EAD, read_offset
-0000b320: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-0000b330: 6c66 2e72 6561 6428 7265 6164 5f6c 656e  lf.read(read_len
-0000b340: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-0000b350: 6164 5f6f 6666 7365 7420 2d3d 2072 6561  ad_offset -= rea
-0000b360: 645f 6c65 6e0a 0a20 2020 2020 2020 2072  d_len..        r
-0000b370: 6574 7572 6e20 7365 6c66 2e74 656c 6c28  eturn self.tell(
-0000b380: 290a 0a20 2020 2064 6566 2074 656c 6c28  )..    def tell(
-0000b390: 7365 6c66 293a 0a20 2020 2020 2020 2069  self):.        i
-0000b3a0: 6620 7365 6c66 2e63 6c6f 7365 643a 0a20  f self.closed:. 
-0000b3b0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0000b3c0: 2056 616c 7565 4572 726f 7228 2274 656c   ValueError("tel
-0000b3d0: 6c20 6f6e 2063 6c6f 7365 6420 6669 6c65  l on closed file
-0000b3e0: 2e22 290a 2020 2020 2020 2020 6966 206e  .").        if n
-0000b3f0: 6f74 2073 656c 662e 5f73 6565 6b61 626c  ot self._seekabl
-0000b400: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-0000b410: 6169 7365 2069 6f2e 556e 7375 7070 6f72  aise io.Unsuppor
-0000b420: 7465 644f 7065 7261 7469 6f6e 2822 756e  tedOperation("un
-0000b430: 6465 726c 7969 6e67 2073 7472 6561 6d20  derlying stream 
-0000b440: 6973 206e 6f74 2073 6565 6b61 626c 6522  is not seekable"
-0000b450: 290a 2020 2020 2020 2020 6669 6c65 706f  ).        filepo
-0000b460: 7320 3d20 7365 6c66 2e5f 6f72 6967 5f66  s = self._orig_f
-0000b470: 696c 655f 7369 7a65 202d 2073 656c 662e  ile_size - self.
-0000b480: 5f6c 6566 7420 2d20 6c65 6e28 7365 6c66  _left - len(self
-0000b490: 2e5f 7265 6164 6275 6666 6572 2920 2b20  ._readbuffer) + 
-0000b4a0: 7365 6c66 2e5f 6f66 6673 6574 0a20 2020  self._offset.   
-0000b4b0: 2020 2020 2072 6574 7572 6e20 6669 6c65       return file
-0000b4c0: 706f 730a 0a0a 636c 6173 7320 5f5a 6970  pos...class _Zip
-0000b4d0: 5772 6974 6546 696c 6528 696f 2e42 7566  WriteFile(io.Buf
-0000b4e0: 6665 7265 6449 4f42 6173 6529 3a0a 2020  feredIOBase):.  
-0000b4f0: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
-0000b500: 656c 662c 207a 662c 207a 696e 666f 2c20  elf, zf, zinfo, 
-0000b510: 7a69 7036 3429 3a0a 2020 2020 2020 2020  zip64):.        
-0000b520: 7365 6c66 2e5f 7a69 6e66 6f20 3d20 7a69  self._zinfo = zi
-0000b530: 6e66 6f0a 2020 2020 2020 2020 7365 6c66  nfo.        self
-0000b540: 2e5f 7a69 7036 3420 3d20 7a69 7036 340a  ._zip64 = zip64.
-0000b550: 2020 2020 2020 2020 7365 6c66 2e5f 7a69          self._zi
-0000b560: 7066 696c 6520 3d20 7a66 0a20 2020 2020  pfile = zf.     
-0000b570: 2020 2073 656c 662e 5f63 6f6d 7072 6573     self._compres
-0000b580: 736f 7220 3d20 5f67 6574 5f63 6f6d 7072  sor = _get_compr
-0000b590: 6573 736f 7228 7a69 6e66 6f2e 636f 6d70  essor(zinfo.comp
-0000b5a0: 7265 7373 5f74 7970 652c 0a20 2020 2020  ress_type,.     
-0000b5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b5d0: 2020 2020 2020 7a69 6e66 6f2e 5f63 6f6d        zinfo._com
-0000b5e0: 7072 6573 736c 6576 656c 290a 2020 2020  presslevel).    
-0000b5f0: 2020 2020 7365 6c66 2e5f 6669 6c65 5f73      self._file_s
-0000b600: 697a 6520 3d20 300a 2020 2020 2020 2020  ize = 0.        
-0000b610: 7365 6c66 2e5f 636f 6d70 7265 7373 5f73  self._compress_s
-0000b620: 697a 6520 3d20 300a 2020 2020 2020 2020  ize = 0.        
-0000b630: 7365 6c66 2e5f 6372 6320 3d20 300a 0a20  self._crc = 0.. 
-0000b640: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
-0000b650: 2064 6566 205f 6669 6c65 6f62 6a28 7365   def _fileobj(se
-0000b660: 6c66 293a 0a20 2020 2020 2020 2072 6574  lf):.        ret
-0000b670: 7572 6e20 7365 6c66 2e5f 7a69 7066 696c  urn self._zipfil
-0000b680: 652e 6670 0a0a 2020 2020 6465 6620 7772  e.fp..    def wr
-0000b690: 6974 6162 6c65 2873 656c 6629 3a0a 2020  itable(self):.  
-0000b6a0: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
-0000b6b0: 650a 0a20 2020 2064 6566 2077 7269 7465  e..    def write
-0000b6c0: 2873 656c 662c 2064 6174 6129 3a0a 2020  (self, data):.  
-0000b6d0: 2020 2020 2020 6966 2073 656c 662e 636c        if self.cl
-0000b6e0: 6f73 6564 3a0a 2020 2020 2020 2020 2020  osed:.          
-0000b6f0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-0000b700: 6f72 2827 492f 4f20 6f70 6572 6174 696f  or('I/O operatio
-0000b710: 6e20 6f6e 2063 6c6f 7365 6420 6669 6c65  n on closed file
-0000b720: 2e27 290a 2020 2020 2020 2020 6e62 7974  .').        nbyt
-0000b730: 6573 203d 206c 656e 2864 6174 6129 0a20  es = len(data). 
-0000b740: 2020 2020 2020 2073 656c 662e 5f66 696c         self._fil
-0000b750: 655f 7369 7a65 202b 3d20 6e62 7974 6573  e_size += nbytes
-0000b760: 0a20 2020 2020 2020 2073 656c 662e 5f63  .        self._c
-0000b770: 7263 203d 2063 7263 3332 2864 6174 612c  rc = crc32(data,
-0000b780: 2073 656c 662e 5f63 7263 2920 2620 3078   self._crc) & 0x
-0000b790: 6666 6666 6666 6666 0a20 2020 2020 2020  ffffffff.       
-0000b7a0: 2069 6620 7365 6c66 2e5f 636f 6d70 7265   if self._compre
-0000b7b0: 7373 6f72 3a0a 2020 2020 2020 2020 2020  ssor:.          
-0000b7c0: 2020 6461 7461 203d 2073 656c 662e 5f63    data = self._c
-0000b7d0: 6f6d 7072 6573 736f 722e 636f 6d70 7265  ompressor.compre
-0000b7e0: 7373 2864 6174 6129 0a20 2020 2020 2020  ss(data).       
-0000b7f0: 2020 2020 2073 656c 662e 5f63 6f6d 7072       self._compr
-0000b800: 6573 735f 7369 7a65 202b 3d20 6c65 6e28  ess_size += len(
-0000b810: 6461 7461 290a 2020 2020 2020 2020 7365  data).        se
-0000b820: 6c66 2e5f 6669 6c65 6f62 6a2e 7772 6974  lf._fileobj.writ
-0000b830: 6528 6461 7461 290a 2020 2020 2020 2020  e(data).        
-0000b840: 7265 7475 726e 206e 6279 7465 730a 0a20  return nbytes.. 
-0000b850: 2020 2064 6566 2063 6c6f 7365 2873 656c     def close(sel
-0000b860: 6629 3a0a 2020 2020 2020 2020 6966 2073  f):.        if s
-0000b870: 656c 662e 636c 6f73 6564 3a0a 2020 2020  elf.closed:.    
-0000b880: 2020 2020 2020 2020 7265 7475 726e 0a20          return. 
-0000b890: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-0000b8a0: 2020 2020 2020 2020 7375 7065 7228 5f5a          super(_Z
-0000b8b0: 6970 5772 6974 6546 696c 652c 2073 656c  ipWriteFile, sel
-0000b8c0: 6629 2e63 6c6f 7365 2829 0a20 2020 2020  f).close().     
-0000b8d0: 2020 2020 2020 2023 2046 6c75 7368 2061         # Flush a
-0000b8e0: 6e79 2064 6174 6120 6672 6f6d 2074 6865  ny data from the
-0000b8f0: 2063 6f6d 7072 6573 736f 722c 2061 6e64   compressor, and
-0000b900: 2075 7064 6174 6520 6865 6164 6572 2069   update header i
-0000b910: 6e66 6f0a 2020 2020 2020 2020 2020 2020  nfo.            
-0000b920: 6966 2073 656c 662e 5f63 6f6d 7072 6573  if self._compres
-0000b930: 736f 723a 0a20 2020 2020 2020 2020 2020  sor:.           
-0000b940: 2020 2020 2062 7566 203d 2073 656c 662e       buf = self.
-0000b950: 5f63 6f6d 7072 6573 736f 722e 666c 7573  _compressor.flus
-0000b960: 6828 290a 2020 2020 2020 2020 2020 2020  h().            
-0000b970: 2020 2020 7365 6c66 2e5f 636f 6d70 7265      self._compre
-0000b980: 7373 5f73 697a 6520 2b3d 206c 656e 2862  ss_size += len(b
-0000b990: 7566 290a 2020 2020 2020 2020 2020 2020  uf).            
-0000b9a0: 2020 2020 7365 6c66 2e5f 6669 6c65 6f62      self._fileob
-0000b9b0: 6a2e 7772 6974 6528 6275 6629 0a20 2020  j.write(buf).   
-0000b9c0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0000b9d0: 662e 5f7a 696e 666f 2e63 6f6d 7072 6573  f._zinfo.compres
-0000b9e0: 735f 7369 7a65 203d 2073 656c 662e 5f63  s_size = self._c
-0000b9f0: 6f6d 7072 6573 735f 7369 7a65 0a20 2020  ompress_size.   
-0000ba00: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0000ba10: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000ba20: 656c 662e 5f7a 696e 666f 2e63 6f6d 7072  elf._zinfo.compr
-0000ba30: 6573 735f 7369 7a65 203d 2073 656c 662e  ess_size = self.
-0000ba40: 5f66 696c 655f 7369 7a65 0a20 2020 2020  _file_size.     
-0000ba50: 2020 2020 2020 2073 656c 662e 5f7a 696e         self._zin
-0000ba60: 666f 2e43 5243 203d 2073 656c 662e 5f63  fo.CRC = self._c
-0000ba70: 7263 0a20 2020 2020 2020 2020 2020 2073  rc.            s
-0000ba80: 656c 662e 5f7a 696e 666f 2e66 696c 655f  elf._zinfo.file_
-0000ba90: 7369 7a65 203d 2073 656c 662e 5f66 696c  size = self._fil
-0000baa0: 655f 7369 7a65 0a0a 2020 2020 2020 2020  e_size..        
-0000bab0: 2020 2020 2320 5772 6974 6520 7570 6461      # Write upda
-0000bac0: 7465 6420 6865 6164 6572 2069 6e66 6f0a  ted header info.
-0000bad0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-0000bae0: 656c 662e 5f7a 696e 666f 2e66 6c61 675f  elf._zinfo.flag_
-0000baf0: 6269 7473 2026 2030 7830 383a 0a20 2020  bits & 0x08:.   
-0000bb00: 2020 2020 2020 2020 2020 2020 2023 2057               # W
-0000bb10: 7269 7465 2043 5243 2061 6e64 2066 696c  rite CRC and fil
-0000bb20: 6520 7369 7a65 7320 6166 7465 7220 7468  e sizes after th
-0000bb30: 6520 6669 6c65 2064 6174 610a 2020 2020  e file data.    
-0000bb40: 2020 2020 2020 2020 2020 2020 666d 7420              fmt 
-0000bb50: 3d20 273c 4c4c 5151 2720 6966 2073 656c  = '<LLQQ' if sel
-0000bb60: 662e 5f7a 6970 3634 2065 6c73 6520 273c  f._zip64 else '<
-0000bb70: 4c4c 4c4c 270a 2020 2020 2020 2020 2020  LLLL'.          
-0000bb80: 2020 2020 2020 7365 6c66 2e5f 6669 6c65        self._file
-0000bb90: 6f62 6a2e 7772 6974 6528 7374 7275 6374  obj.write(struct
-0000bba0: 2e70 6163 6b28 666d 742c 205f 4444 5f53  .pack(fmt, _DD_S
-0000bbb0: 4947 4e41 5455 5245 2c20 7365 6c66 2e5f  IGNATURE, self._
-0000bbc0: 7a69 6e66 6f2e 4352 432c 0a20 2020 2020  zinfo.CRC,.     
-0000bbd0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000bbe0: 656c 662e 5f7a 696e 666f 2e63 6f6d 7072  elf._zinfo.compr
-0000bbf0: 6573 735f 7369 7a65 2c20 7365 6c66 2e5f  ess_size, self._
-0000bc00: 7a69 6e66 6f2e 6669 6c65 5f73 697a 6529  zinfo.file_size)
-0000bc10: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000bc20: 2020 7365 6c66 2e5f 7a69 7066 696c 652e    self._zipfile.
-0000bc30: 7374 6172 745f 6469 7220 3d20 7365 6c66  start_dir = self
-0000bc40: 2e5f 6669 6c65 6f62 6a2e 7465 6c6c 2829  ._fileobj.tell()
-0000bc50: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-0000bc60: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0000bc70: 2020 2069 6620 6e6f 7420 7365 6c66 2e5f     if not self._
-0000bc80: 7a69 7036 343a 0a20 2020 2020 2020 2020  zip64:.         
-0000bc90: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-0000bca0: 6c66 2e5f 6669 6c65 5f73 697a 6520 3e20  lf._file_size > 
-0000bcb0: 5a49 5036 345f 4c49 4d49 543a 0a20 2020  ZIP64_LIMIT:.   
-0000bcc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bcd0: 2020 2020 2072 6169 7365 2052 756e 7469       raise Runti
-0000bce0: 6d65 4572 726f 7228 0a20 2020 2020 2020  meError(.       
-0000bcf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bd00: 2020 2020 2027 4669 6c65 2073 697a 6520       'File size 
-0000bd10: 756e 6578 7065 6374 6564 6c79 2065 7863  unexpectedly exc
-0000bd20: 6565 6465 6420 5a49 5036 3420 6c69 6d69  eeded ZIP64 limi
-0000bd30: 7427 290a 2020 2020 2020 2020 2020 2020  t').            
-0000bd40: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0000bd50: 5f63 6f6d 7072 6573 735f 7369 7a65 203e  _compress_size >
-0000bd60: 205a 4950 3634 5f4c 494d 4954 3a0a 2020   ZIP64_LIMIT:.  
-0000bd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bd80: 2020 2020 2020 7261 6973 6520 5275 6e74        raise Runt
-0000bd90: 696d 6545 7272 6f72 280a 2020 2020 2020  imeError(.      
-0000bda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bdb0: 2020 2020 2020 2743 6f6d 7072 6573 7365        'Compresse
-0000bdc0: 6420 7369 7a65 2075 6e65 7870 6563 7465  d size unexpecte
-0000bdd0: 646c 7920 6578 6365 6564 6564 205a 4950  dly exceeded ZIP
-0000bde0: 3634 206c 696d 6974 2729 0a20 2020 2020  64 limit').     
-0000bdf0: 2020 2020 2020 2020 2020 2023 2053 6565             # See
-0000be00: 6b20 6261 636b 7761 7264 7320 616e 6420  k backwards and 
-0000be10: 7772 6974 6520 6669 6c65 2068 6561 6465  write file heade
-0000be20: 7220 2877 6869 6368 2077 696c 6c20 6e6f  r (which will no
-0000be30: 7720 696e 636c 7564 650a 2020 2020 2020  w include.      
-0000be40: 2020 2020 2020 2020 2020 2320 636f 7272            # corr
-0000be50: 6563 7420 4352 4320 616e 6420 6669 6c65  ect CRC and file
-0000be60: 2073 697a 6573 290a 0a20 2020 2020 2020   sizes)..       
-0000be70: 2020 2020 2020 2020 2023 2050 7265 7365           # Prese
-0000be80: 7276 6520 6375 7272 656e 7420 706f 7369  rve current posi
-0000be90: 7469 6f6e 2069 6e20 6669 6c65 0a20 2020  tion in file.   
-0000bea0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0000beb0: 662e 5f7a 6970 6669 6c65 2e73 7461 7274  f._zipfile.start
-0000bec0: 5f64 6972 203d 2073 656c 662e 5f66 696c  _dir = self._fil
-0000bed0: 656f 626a 2e74 656c 6c28 290a 2020 2020  eobj.tell().    
-0000bee0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000bef0: 2e5f 6669 6c65 6f62 6a2e 7365 656b 2873  ._fileobj.seek(s
-0000bf00: 656c 662e 5f7a 696e 666f 2e68 6561 6465  elf._zinfo.heade
-0000bf10: 725f 6f66 6673 6574 290a 2020 2020 2020  r_offset).      
-0000bf20: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-0000bf30: 6669 6c65 6f62 6a2e 7772 6974 6528 7365  fileobj.write(se
-0000bf40: 6c66 2e5f 7a69 6e66 6f2e 4669 6c65 4865  lf._zinfo.FileHe
-0000bf50: 6164 6572 2873 656c 662e 5f7a 6970 3634  ader(self._zip64
-0000bf60: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
-0000bf70: 2020 2073 656c 662e 5f66 696c 656f 626a     self._fileobj
-0000bf80: 2e73 6565 6b28 7365 6c66 2e5f 7a69 7066  .seek(self._zipf
-0000bf90: 696c 652e 7374 6172 745f 6469 7229 0a0a  ile.start_dir)..
-0000bfa0: 2020 2020 2020 2020 2020 2020 2320 5375              # Su
-0000bfb0: 6363 6573 7366 756c 6c79 2077 7269 7474  ccessfully writt
-0000bfc0: 656e 3a20 4164 6420 6669 6c65 2074 6f20  en: Add file to 
-0000bfd0: 6f75 7220 6361 6368 6573 0a20 2020 2020  our caches.     
-0000bfe0: 2020 2020 2020 2073 656c 662e 5f7a 6970         self._zip
-0000bff0: 6669 6c65 2e66 696c 656c 6973 742e 6170  file.filelist.ap
-0000c000: 7065 6e64 2873 656c 662e 5f7a 696e 666f  pend(self._zinfo
-0000c010: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-0000c020: 6c66 2e5f 7a69 7066 696c 652e 4e61 6d65  lf._zipfile.Name
-0000c030: 546f 496e 666f 5b73 656c 662e 5f7a 696e  ToInfo[self._zin
-0000c040: 666f 2e66 696c 656e 616d 655d 203d 2073  fo.filename] = s
-0000c050: 656c 662e 5f7a 696e 666f 0a20 2020 2020  elf._zinfo.     
-0000c060: 2020 2066 696e 616c 6c79 3a0a 2020 2020     finally:.    
-0000c070: 2020 2020 2020 2020 7365 6c66 2e5f 7a69          self._zi
-0000c080: 7066 696c 652e 5f77 7269 7469 6e67 203d  pfile._writing =
-0000c090: 2046 616c 7365 0a0a 0a0a 636c 6173 7320   False....class 
-0000c0a0: 5a69 7046 696c 6528 6f62 6a65 6374 293a  ZipFile(object):
-0000c0b0: 0a20 2020 2022 2222 2043 6c61 7373 2077  .    """ Class w
-0000c0c0: 6974 6820 6d65 7468 6f64 7320 746f 206f  ith methods to o
-0000c0d0: 7065 6e2c 2072 6561 642c 2077 7269 7465  pen, read, write
-0000c0e0: 2c20 636c 6f73 652c 206c 6973 7420 7a69  , close, list zi
-0000c0f0: 7020 6669 6c65 732e 0a0a 2020 2020 7a20  p files...    z 
-0000c100: 3d20 5a69 7046 696c 6528 6669 6c65 2c20  = ZipFile(file, 
-0000c110: 6d6f 6465 3d22 7222 2c20 636f 6d70 7265  mode="r", compre
-0000c120: 7373 696f 6e3d 5a49 505f 5354 4f52 4544  ssion=ZIP_STORED
-0000c130: 2c20 616c 6c6f 775a 6970 3634 3d54 7275  , allowZip64=Tru
-0000c140: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-0000c150: 2020 2063 6f6d 7072 6573 736c 6576 656c     compresslevel
-0000c160: 3d4e 6f6e 6529 0a0a 2020 2020 6669 6c65  =None)..    file
-0000c170: 3a20 4569 7468 6572 2074 6865 2070 6174  : Either the pat
-0000c180: 6820 746f 2074 6865 2066 696c 652c 206f  h to the file, o
-0000c190: 7220 6120 6669 6c65 2d6c 696b 6520 6f62  r a file-like ob
-0000c1a0: 6a65 6374 2e0a 2020 2020 2020 2020 2020  ject..          
-0000c1b0: 4966 2069 7420 6973 2061 2070 6174 682c  If it is a path,
-0000c1c0: 2074 6865 2066 696c 6520 7769 6c6c 2062   the file will b
-0000c1d0: 6520 6f70 656e 6564 2061 6e64 2063 6c6f  e opened and clo
-0000c1e0: 7365 6420 6279 205a 6970 4669 6c65 2e0a  sed by ZipFile..
-0000c1f0: 2020 2020 6d6f 6465 3a20 5468 6520 6d6f      mode: The mo
-0000c200: 6465 2063 616e 2062 6520 6569 7468 6572  de can be either
-0000c210: 2072 6561 6420 2772 272c 2077 7269 7465   read 'r', write
-0000c220: 2027 7727 2c20 6578 636c 7573 6976 6520   'w', exclusive 
-0000c230: 6372 6561 7465 2027 7827 2c0a 2020 2020  create 'x',.    
-0000c240: 2020 2020 2020 6f72 2061 7070 656e 6420        or append 
-0000c250: 2761 272e 0a20 2020 2063 6f6d 7072 6573  'a'..    compres
-0000c260: 7369 6f6e 3a20 5a49 505f 5354 4f52 4544  sion: ZIP_STORED
-0000c270: 2028 6e6f 2063 6f6d 7072 6573 7369 6f6e   (no compression
-0000c280: 292c 205a 4950 5f44 4546 4c41 5445 4420  ), ZIP_DEFLATED 
-0000c290: 2872 6571 7569 7265 7320 7a6c 6962 292c  (requires zlib),
-0000c2a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c2b0: 2020 5a49 505f 425a 4950 3220 2872 6571    ZIP_BZIP2 (req
-0000c2c0: 7569 7265 7320 627a 3229 206f 7220 5a49  uires bz2) or ZI
-0000c2d0: 505f 4c5a 4d41 2028 7265 7175 6972 6573  P_LZMA (requires
-0000c2e0: 206c 7a6d 6129 2e0a 2020 2020 616c 6c6f   lzma)..    allo
-0000c2f0: 775a 6970 3634 3a20 6966 2054 7275 6520  wZip64: if True 
-0000c300: 5a69 7046 696c 6520 7769 6c6c 2063 7265  ZipFile will cre
-0000c310: 6174 6520 6669 6c65 7320 7769 7468 205a  ate files with Z
-0000c320: 4950 3634 2065 7874 656e 7369 6f6e 7320  IP64 extensions 
-0000c330: 7768 656e 0a20 2020 2020 2020 2020 2020  when.           
-0000c340: 2020 2020 206e 6565 6465 642c 206f 7468       needed, oth
-0000c350: 6572 7769 7365 2069 7420 7769 6c6c 2072  erwise it will r
-0000c360: 6169 7365 2061 6e20 6578 6365 7074 696f  aise an exceptio
-0000c370: 6e20 7768 656e 2074 6869 7320 776f 756c  n when this woul
-0000c380: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
-0000c390: 2020 6265 206e 6563 6573 7361 7279 2e0a    be necessary..
-0000c3a0: 2020 2020 636f 6d70 7265 7373 6c65 7665      compressleve
-0000c3b0: 6c3a 204e 6f6e 6520 2864 6566 6175 6c74  l: None (default
-0000c3c0: 2066 6f72 2074 6865 2067 6976 656e 2063   for the given c
-0000c3d0: 6f6d 7072 6573 7369 6f6e 2074 7970 6529  ompression type)
-0000c3e0: 206f 7220 616e 2069 6e74 6567 6572 0a20   or an integer. 
-0000c3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c400: 2020 7370 6563 6966 7969 6e67 2074 6865    specifying the
-0000c410: 206c 6576 656c 2074 6f20 7061 7373 2074   level to pass t
-0000c420: 6f20 7468 6520 636f 6d70 7265 7373 6f72  o the compressor
-0000c430: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000c440: 2020 2020 2057 6865 6e20 7573 696e 6720       When using 
-0000c450: 5a49 505f 5354 4f52 4544 206f 7220 5a49  ZIP_STORED or ZI
-0000c460: 505f 4c5a 4d41 2074 6869 7320 6b65 7977  P_LZMA this keyw
-0000c470: 6f72 6420 6861 7320 6e6f 2065 6666 6563  ord has no effec
-0000c480: 742e 0a20 2020 2020 2020 2020 2020 2020  t..             
-0000c490: 2020 2020 2020 5768 656e 2075 7369 6e67        When using
-0000c4a0: 205a 4950 5f44 4546 4c41 5445 4420 696e   ZIP_DEFLATED in
-0000c4b0: 7465 6765 7273 2030 2074 6872 6f75 6768  tegers 0 through
-0000c4c0: 2039 2061 7265 2061 6363 6570 7465 642e   9 are accepted.
-0000c4d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c4e0: 2020 2020 5768 656e 2075 7369 6e67 205a      When using Z
-0000c4f0: 4950 5f42 5a49 5032 2069 6e74 6567 6572  IP_BZIP2 integer
-0000c500: 7320 3120 7468 726f 7567 6820 3920 6172  s 1 through 9 ar
-0000c510: 6520 6163 6365 7074 6564 2e0a 0a20 2020  e accepted...   
-0000c520: 2022 2222 0a0a 2020 2020 6670 203d 204e   """..    fp = N
-0000c530: 6f6e 6520 2020 2020 2020 2020 2020 2020  one             
-0000c540: 2020 2020 2020 2320 5365 7420 6865 7265        # Set here
-0000c550: 2073 696e 6365 205f 5f64 656c 5f5f 2063   since __del__ c
-0000c560: 6865 636b 7320 6974 0a20 2020 205f 7769  hecks it.    _wi
-0000c570: 6e64 6f77 735f 696c 6c65 6761 6c5f 6e61  ndows_illegal_na
-0000c580: 6d65 5f74 7261 6e73 5f74 6162 6c65 203d  me_trans_table =
-0000c590: 204e 6f6e 650a 0a20 2020 2064 6566 205f   None..    def _
-0000c5a0: 5f69 6e69 745f 5f28 7365 6c66 2c20 6669  _init__(self, fi
-0000c5b0: 6c65 2c20 6d6f 6465 3d22 7222 2c20 636f  le, mode="r", co
-0000c5c0: 6d70 7265 7373 696f 6e3d 5a49 505f 5354  mpression=ZIP_ST
-0000c5d0: 4f52 4544 2c20 616c 6c6f 775a 6970 3634  ORED, allowZip64
-0000c5e0: 3d54 7275 652c 0a20 2020 2020 2020 2020  =True,.         
-0000c5f0: 2020 2020 2020 2020 636f 6d70 7265 7373          compress
-0000c600: 6c65 7665 6c3d 4e6f 6e65 2c20 7374 7269  level=None, stri
-0000c610: 6374 5f74 696d 6573 7461 6d70 733d 5472  ct_timestamps=Tr
-0000c620: 7565 293a 0a20 2020 2020 2020 2022 2222  ue):.        """
-0000c630: 4f70 656e 2074 6865 205a 4950 2066 696c  Open the ZIP fil
-0000c640: 6520 7769 7468 206d 6f64 6520 7265 6164  e with mode read
-0000c650: 2027 7227 2c20 7772 6974 6520 2777 272c   'r', write 'w',
-0000c660: 2065 7863 6c75 7369 7665 2063 7265 6174   exclusive creat
-0000c670: 6520 2778 272c 0a20 2020 2020 2020 206f  e 'x',.        o
-0000c680: 7220 6170 7065 6e64 2027 6127 2e22 2222  r append 'a'."""
-0000c690: 0a20 2020 2020 2020 2069 6620 6d6f 6465  .        if mode
-0000c6a0: 206e 6f74 2069 6e20 2827 7227 2c20 2777   not in ('r', 'w
-0000c6b0: 272c 2027 7827 2c20 2761 2729 3a0a 2020  ', 'x', 'a'):.  
-0000c6c0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0000c6d0: 5661 6c75 6545 7272 6f72 2822 5a69 7046  ValueError("ZipF
-0000c6e0: 696c 6520 7265 7175 6972 6573 206d 6f64  ile requires mod
-0000c6f0: 6520 2772 272c 2027 7727 2c20 2778 272c  e 'r', 'w', 'x',
-0000c700: 206f 7220 2761 2722 290a 0a20 2020 2020   or 'a'")..     
-0000c710: 2020 205f 6368 6563 6b5f 636f 6d70 7265     _check_compre
-0000c720: 7373 696f 6e28 636f 6d70 7265 7373 696f  ssion(compressio
-0000c730: 6e29 0a0a 2020 2020 2020 2020 7365 6c66  n)..        self
-0000c740: 2e5f 616c 6c6f 775a 6970 3634 203d 2061  ._allowZip64 = a
-0000c750: 6c6c 6f77 5a69 7036 340a 2020 2020 2020  llowZip64.      
-0000c760: 2020 7365 6c66 2e5f 6469 644d 6f64 6966    self._didModif
-0000c770: 7920 3d20 4661 6c73 650a 2020 2020 2020  y = False.      
-0000c780: 2020 7365 6c66 2e64 6562 7567 203d 2030    self.debug = 0
-0000c790: 2020 2320 4c65 7665 6c20 6f66 2070 7269    # Level of pri
-0000c7a0: 6e74 696e 673a 2030 2074 6872 6f75 6768  nting: 0 through
-0000c7b0: 2033 0a20 2020 2020 2020 2073 656c 662e   3.        self.
-0000c7c0: 4e61 6d65 546f 496e 666f 203d 207b 7d20  NameToInfo = {} 
-0000c7d0: 2020 2023 2046 696e 6420 6669 6c65 2069     # Find file i
-0000c7e0: 6e66 6f20 6769 7665 6e20 6e61 6d65 0a20  nfo given name. 
-0000c7f0: 2020 2020 2020 2073 656c 662e 6669 6c65         self.file
-0000c800: 6c69 7374 203d 205b 5d20 2020 2020 2023  list = []      #
-0000c810: 204c 6973 7420 6f66 205a 6970 496e 666f   List of ZipInfo
-0000c820: 2069 6e73 7461 6e63 6573 2066 6f72 2061   instances for a
-0000c830: 7263 6869 7665 0a20 2020 2020 2020 2073  rchive.        s
-0000c840: 656c 662e 636f 6d70 7265 7373 696f 6e20  elf.compression 
-0000c850: 3d20 636f 6d70 7265 7373 696f 6e20 2023  = compression  #
-0000c860: 204d 6574 686f 6420 6f66 2063 6f6d 7072   Method of compr
-0000c870: 6573 7369 6f6e 0a20 2020 2020 2020 2073  ession.        s
-0000c880: 656c 662e 636f 6d70 7265 7373 6c65 7665  elf.compressleve
-0000c890: 6c20 3d20 636f 6d70 7265 7373 6c65 7665  l = compressleve
-0000c8a0: 6c0a 2020 2020 2020 2020 7365 6c66 2e6d  l.        self.m
-0000c8b0: 6f64 6520 3d20 6d6f 6465 0a20 2020 2020  ode = mode.     
-0000c8c0: 2020 2073 656c 662e 7077 6420 3d20 4e6f     self.pwd = No
-0000c8d0: 6e65 0a20 2020 2020 2020 2073 656c 662e  ne.        self.
-0000c8e0: 5f63 6f6d 6d65 6e74 203d 2062 2727 0a20  _comment = b''. 
-0000c8f0: 2020 2020 2020 2073 656c 662e 5f73 7472         self._str
-0000c900: 6963 745f 7469 6d65 7374 616d 7073 203d  ict_timestamps =
-0000c910: 2073 7472 6963 745f 7469 6d65 7374 616d   strict_timestam
-0000c920: 7073 0a0a 2020 2020 2020 2020 2320 4368  ps..        # Ch
-0000c930: 6563 6b20 6966 2077 6520 7765 7265 2070  eck if we were p
-0000c940: 6173 7365 6420 6120 6669 6c65 2d6c 696b  assed a file-lik
-0000c950: 6520 6f62 6a65 6374 0a20 2020 2020 2020  e object.       
-0000c960: 2069 6620 7379 732e 7665 7273 696f 6e5f   if sys.version_
-0000c970: 696e 666f 3e3d 2833 2c36 293a 0a20 2020  info>=(3,6):.   
-0000c980: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
-0000c990: 7374 616e 6365 2866 696c 652c 206f 732e  stance(file, os.
-0000c9a0: 5061 7468 4c69 6b65 293a 0a20 2020 2020  PathLike):.     
-0000c9b0: 2020 2020 2020 2020 2020 2066 696c 6520             file 
-0000c9c0: 3d20 6f73 2e66 7370 6174 6828 6669 6c65  = os.fspath(file
-0000c9d0: 290a 2020 2020 2020 2020 6966 2069 7369  ).        if isi
-0000c9e0: 6e73 7461 6e63 6528 6669 6c65 2c20 6261  nstance(file, ba
-0000c9f0: 7365 7374 7269 6e67 293a 0a20 2020 2020  sestring):.     
-0000ca00: 2020 2020 2020 2023 204e 6f2c 2069 7427         # No, it'
-0000ca10: 7320 6120 6669 6c65 6e61 6d65 0a20 2020  s a filename.   
-0000ca20: 2020 2020 2020 2020 2073 656c 662e 5f66           self._f
-0000ca30: 696c 6550 6173 7365 6420 3d20 300a 2020  ilePassed = 0.  
-0000ca40: 2020 2020 2020 2020 2020 7365 6c66 2e66            self.f
-0000ca50: 696c 656e 616d 6520 3d20 6669 6c65 0a20  ilename = file. 
-0000ca60: 2020 2020 2020 2020 2020 206d 6f64 6544             modeD
-0000ca70: 6963 7420 3d20 7b27 7227 203a 2027 7262  ict = {'r' : 'rb
-0000ca80: 272c 2027 7727 3a20 2777 2b62 272c 2027  ', 'w': 'w+b', '
-0000ca90: 7827 3a20 2778 2b62 272c 2027 6127 203a  x': 'x+b', 'a' :
-0000caa0: 2027 722b 6227 2c0a 2020 2020 2020 2020   'r+b',.        
-0000cab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cac0: 2772 2b62 273a 2027 772b 6227 2c20 2777  'r+b': 'w+b', 'w
-0000cad0: 2b62 273a 2027 7762 272c 2027 782b 6227  +b': 'wb', 'x+b'
-0000cae0: 3a20 2778 6227 7d0a 2020 2020 2020 2020  : 'xb'}.        
-0000caf0: 2020 2020 6669 6c65 6d6f 6465 203d 206d      filemode = m
-0000cb00: 6f64 6544 6963 745b 6d6f 6465 5d0a 2020  odeDict[mode].  
-0000cb10: 2020 2020 2020 2020 2020 7768 696c 6520            while 
-0000cb20: 5472 7565 3a0a 2020 2020 2020 2020 2020  True:.          
-0000cb30: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-0000cb40: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000cb50: 656c 662e 6670 203d 2069 6f2e 6f70 656e  elf.fp = io.open
-0000cb60: 2866 696c 652c 2066 696c 656d 6f64 6529  (file, filemode)
-0000cb70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000cb80: 2065 7863 6570 7420 4f53 4572 726f 723a   except OSError:
-0000cb90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000cba0: 2020 2020 2069 6620 6669 6c65 6d6f 6465       if filemode
-0000cbb0: 2069 6e20 6d6f 6465 4469 6374 3a0a 2020   in modeDict:.  
-0000cbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cbd0: 2020 2020 2020 6669 6c65 6d6f 6465 203d        filemode =
-0000cbe0: 206d 6f64 6544 6963 745b 6669 6c65 6d6f   modeDict[filemo
-0000cbf0: 6465 5d0a 2020 2020 2020 2020 2020 2020  de].            
-0000cc00: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-0000cc10: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
-0000cc20: 2020 2020 2020 2020 2072 6169 7365 0a20           raise. 
-0000cc30: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-0000cc40: 7265 616b 0a20 2020 2020 2020 2065 6c73  reak.        els
-0000cc50: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
-0000cc60: 656c 662e 5f66 696c 6550 6173 7365 6420  elf._filePassed 
-0000cc70: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
-0000cc80: 7365 6c66 2e66 7020 3d20 6669 6c65 0a20  self.fp = file. 
-0000cc90: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000cca0: 6669 6c65 6e61 6d65 203d 2067 6574 6174  filename = getat
-0000ccb0: 7472 2866 696c 652c 2027 6e61 6d65 272c  tr(file, 'name',
-0000ccc0: 204e 6f6e 6529 0a20 2020 2020 2020 2073   None).        s
-0000ccd0: 656c 662e 5f66 696c 6552 6566 436e 7420  elf._fileRefCnt 
-0000cce0: 3d20 310a 2020 2020 2020 2020 7365 6c66  = 1.        self
-0000ccf0: 2e5f 6c6f 636b 203d 2074 6872 6561 6469  ._lock = threadi
-0000cd00: 6e67 2e52 4c6f 636b 2829 0a20 2020 2020  ng.RLock().     
-0000cd10: 2020 2073 656c 662e 5f73 6565 6b61 626c     self._seekabl
-0000cd20: 6520 3d20 5472 7565 0a20 2020 2020 2020  e = True.       
-0000cd30: 2073 656c 662e 5f77 7269 7469 6e67 203d   self._writing =
-0000cd40: 2046 616c 7365 0a0a 2020 2020 2020 2020   False..        
-0000cd50: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-0000cd60: 2069 6620 6d6f 6465 203d 3d20 2772 273a   if mode == 'r':
-0000cd70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000cd80: 2073 656c 662e 5f52 6561 6c47 6574 436f   self._RealGetCo
-0000cd90: 6e74 656e 7473 2829 0a20 2020 2020 2020  ntents().       
-0000cda0: 2020 2020 2065 6c69 6620 6d6f 6465 2069       elif mode i
-0000cdb0: 6e20 2827 7727 2c20 2778 2729 3a0a 2020  n ('w', 'x'):.  
-0000cdc0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0000cdd0: 7365 7420 7468 6520 6d6f 6469 6669 6564  set the modified
-0000cde0: 2066 6c61 6720 736f 2063 656e 7472 616c   flag so central
-0000cdf0: 2064 6972 6563 746f 7279 2067 6574 7320   directory gets 
-0000ce00: 7772 6974 7465 6e0a 2020 2020 2020 2020  written.        
-0000ce10: 2020 2020 2020 2020 2320 6576 656e 2069          # even i
-0000ce20: 6620 6e6f 2066 696c 6573 2061 7265 2061  f no files are a
-0000ce30: 6464 6564 2074 6f20 7468 6520 6172 6368  dded to the arch
-0000ce40: 6976 650a 2020 2020 2020 2020 2020 2020  ive.            
-0000ce50: 2020 2020 7365 6c66 2e5f 6469 644d 6f64      self._didMod
-0000ce60: 6966 7920 3d20 5472 7565 0a20 2020 2020  ify = True.     
-0000ce70: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
-0000ce80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ce90: 2020 2020 7365 6c66 2e73 7461 7274 5f64      self.start_d
-0000cea0: 6972 203d 2073 656c 662e 6670 2e74 656c  ir = self.fp.tel
-0000ceb0: 6c28 290a 2020 2020 2020 2020 2020 2020  l().            
-0000cec0: 2020 2020 6578 6365 7074 2028 4174 7472      except (Attr
-0000ced0: 6962 7574 6545 7272 6f72 2c20 4f53 4572  ibuteError, OSEr
-0000cee0: 726f 7229 3a0a 2020 2020 2020 2020 2020  ror):.          
-0000cef0: 2020 2020 2020 2020 2020 7365 6c66 2e66            self.f
-0000cf00: 7020 3d20 5f54 656c 6c61 626c 6528 7365  p = _Tellable(se
-0000cf10: 6c66 2e66 7029 0a20 2020 2020 2020 2020  lf.fp).         
-0000cf20: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000cf30: 7374 6172 745f 6469 7220 3d20 300a 2020  start_dir = 0.  
-0000cf40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cf50: 2020 7365 6c66 2e5f 7365 656b 6162 6c65    self._seekable
-0000cf60: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
-0000cf70: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0000cf80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cf90: 2020 2023 2053 6f6d 6520 6669 6c65 2d6c     # Some file-l
-0000cfa0: 696b 6520 6f62 6a65 6374 7320 6361 6e20  ike objects can 
-0000cfb0: 7072 6f76 6964 6520 7465 6c6c 2829 2062  provide tell() b
-0000cfc0: 7574 206e 6f74 2073 6565 6b28 290a 2020  ut not seek().  
-0000cfd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cfe0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-0000cff0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000d000: 656c 662e 6670 2e73 6565 6b28 7365 6c66  elf.fp.seek(self
-0000d010: 2e73 7461 7274 5f64 6972 290a 2020 2020  .start_dir).    
-0000d020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d030: 6578 6365 7074 2028 4174 7472 6962 7574  except (Attribut
-0000d040: 6545 7272 6f72 2c20 4f53 4572 726f 7229  eError, OSError)
-0000d050: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000d060: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-0000d070: 7365 656b 6162 6c65 203d 2046 616c 7365  seekable = False
-0000d080: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-0000d090: 6620 6d6f 6465 203d 3d20 2761 273a 0a20  f mode == 'a':. 
-0000d0a0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0000d0b0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-0000d0c0: 2020 2020 2020 2020 2320 5365 6520 6966          # See if
-0000d0d0: 2066 696c 6520 6973 2061 207a 6970 2066   file is a zip f
-0000d0e0: 696c 650a 2020 2020 2020 2020 2020 2020  ile.            
-0000d0f0: 2020 2020 2020 2020 7365 6c66 2e5f 5265          self._Re
-0000d100: 616c 4765 7443 6f6e 7465 6e74 7328 290a  alGetContents().
-0000d110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d120: 2020 2020 2320 7365 656b 2074 6f20 7374      # seek to st
-0000d130: 6172 7420 6f66 2064 6972 6563 746f 7279  art of directory
-0000d140: 2061 6e64 206f 7665 7277 7269 7465 0a20   and overwrite. 
-0000d150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d160: 2020 2073 656c 662e 6670 2e73 6565 6b28     self.fp.seek(
-0000d170: 7365 6c66 2e73 7461 7274 5f64 6972 290a  self.start_dir).
-0000d180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d190: 6578 6365 7074 2042 6164 5a69 7046 696c  except BadZipFil
-0000d1a0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0000d1b0: 2020 2020 2020 2023 2066 696c 6520 6973         # file is
-0000d1c0: 206e 6f74 2061 207a 6970 2066 696c 652c   not a zip file,
-0000d1d0: 206a 7573 7420 6170 7065 6e64 0a20 2020   just append.   
-0000d1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d1f0: 2073 656c 662e 6670 2e73 6565 6b28 302c   self.fp.seek(0,
-0000d200: 2032 290a 0a20 2020 2020 2020 2020 2020   2)..           
-0000d210: 2020 2020 2020 2020 2023 2073 6574 2074           # set t
-0000d220: 6865 206d 6f64 6966 6965 6420 666c 6167  he modified flag
-0000d230: 2073 6f20 6365 6e74 7261 6c20 6469 7265   so central dire
-0000d240: 6374 6f72 7920 6765 7473 2077 7269 7474  ctory gets writt
-0000d250: 656e 0a20 2020 2020 2020 2020 2020 2020  en.             
-0000d260: 2020 2020 2020 2023 2065 7665 6e20 6966         # even if
-0000d270: 206e 6f20 6669 6c65 7320 6172 6520 6164   no files are ad
-0000d280: 6465 6420 746f 2074 6865 2061 7263 6869  ded to the archi
-0000d290: 7665 0a20 2020 2020 2020 2020 2020 2020  ve.             
-0000d2a0: 2020 2020 2020 2073 656c 662e 5f64 6964         self._did
-0000d2b0: 4d6f 6469 6679 203d 2054 7275 650a 2020  Modify = True.  
+000076f0: 6c65 7665 6c29 0a20 2020 2065 6c69 6620  level).    elif 
+00007700: 636f 6d70 7265 7373 5f74 7970 6520 3d3d  compress_type ==
+00007710: 205a 4950 5f44 434c 494d 504c 4f44 4544   ZIP_DCLIMPLODED
+00007720: 3a0a 2020 2020 2020 2020 6966 2063 6f6d  :.        if com
+00007730: 7072 6573 736c 6576 656c 2069 7320 4e6f  presslevel is No
+00007740: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00007750: 636f 6d70 7265 7373 6c65 7665 6c20 3d20  compresslevel = 
+00007760: 330a 2020 2020 2020 2020 636f 6d70 7265  3.        compre
+00007770: 7373 6d65 7468 6f64 203d 2063 6f6d 7072  ssmethod = compr
+00007780: 6573 736c 6576 656c 2f2f 3130 0a20 2020  esslevel//10.   
+00007790: 2020 2020 2063 6f6d 7072 6573 736c 6576       compresslev
+000077a0: 656c 203d 2063 6f6d 7072 6573 736c 6576  el = compresslev
+000077b0: 656c 2531 300a 2020 2020 2020 2020 6173  el%10.        as
+000077c0: 7365 7274 2064 636c 696d 706c 6f64 6520  sert dclimplode 
+000077d0: 6973 206e 6f74 204e 6f6e 650a 2020 2020  is not None.    
+000077e0: 2020 2020 7265 7475 726e 2064 636c 696d      return dclim
+000077f0: 706c 6f64 652e 636f 6d70 7265 7373 6f62  plode.compressob
+00007800: 6a28 636f 6d70 7265 7373 6d65 7468 6f64  j(compressmethod
+00007810: 2c20 313c 3c28 392b 636f 6d70 7265 7373  , 1<<(9+compress
+00007820: 6c65 7665 6c29 290a 2020 2020 656c 6966  level)).    elif
+00007830: 2063 6f6d 7072 6573 735f 7479 7065 203d   compress_type =
+00007840: 3d20 5a49 505f 425a 4950 323a 0a20 2020  = ZIP_BZIP2:.   
+00007850: 2020 2020 2069 6620 636f 6d70 7265 7373       if compress
+00007860: 6c65 7665 6c20 6973 206e 6f74 204e 6f6e  level is not Non
+00007870: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
+00007880: 6620 636f 6d70 7265 7373 6c65 7665 6c20  f compresslevel 
+00007890: 3e3d 2031 303a 0a20 2020 2020 2020 2020  >= 10:.         
+000078a0: 2020 2020 2020 2061 7373 6572 7420 636f         assert co
+000078b0: 6465 6373 377a 2069 7320 6e6f 7420 4e6f  decs7z is not No
+000078c0: 6e65 0a20 2020 2020 2020 2020 2020 2020  ne.             
+000078d0: 2020 2072 6574 7572 6e20 636f 6465 6373     return codecs
+000078e0: 377a 2e62 7a69 7032 5f63 6f6d 7072 6573  7z.bzip2_compres
+000078f0: 736f 626a 2863 6f6d 7072 6573 736c 6576  sobj(compresslev
+00007900: 656c 2d31 3029 0a20 2020 2020 2020 2020  el-10).         
+00007910: 2020 2072 6574 7572 6e20 627a 322e 425a     return bz2.BZ
+00007920: 3243 6f6d 7072 6573 736f 7228 636f 6d70  2Compressor(comp
+00007930: 7265 7373 6c65 7665 6c29 0a20 2020 2020  resslevel).     
+00007940: 2020 2072 6574 7572 6e20 627a 322e 425a     return bz2.BZ
+00007950: 3243 6f6d 7072 6573 736f 7228 290a 2020  2Compressor().  
+00007960: 2020 656c 6966 2063 6f6d 7072 6573 735f    elif compress_
+00007970: 7479 7065 203d 3d20 5a49 505f 4c5a 4d41  type == ZIP_LZMA
+00007980: 3a0a 2020 2020 2020 2020 6173 7365 7274  :.        assert
+00007990: 206c 7a6d 6120 6973 206e 6f74 204e 6f6e   lzma is not Non
+000079a0: 650a 2020 2020 2020 2020 7265 7475 726e  e.        return
+000079b0: 204c 5a4d 4143 6f6d 7072 6573 736f 7228   LZMACompressor(
+000079c0: 636f 6d70 7265 7373 6c65 7665 6c29 0a20  compresslevel). 
+000079d0: 2020 2065 6c69 6620 636f 6d70 7265 7373     elif compress
+000079e0: 5f74 7970 6520 3d3d 205a 4950 5f58 5a3a  _type == ZIP_XZ:
+000079f0: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
+00007a00: 6c7a 6d61 2069 7320 6e6f 7420 4e6f 6e65  lzma is not None
+00007a10: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00007a20: 6c7a 6d61 2e4c 5a4d 4143 6f6d 7072 6573  lzma.LZMACompres
+00007a30: 736f 7228 6c7a 6d61 2e46 4f52 4d41 545f  sor(lzma.FORMAT_
+00007a40: 585a 2c20 7072 6573 6574 3d63 6f6d 7072  XZ, preset=compr
+00007a50: 6573 736c 6576 656c 290a 2020 2020 656c  esslevel).    el
+00007a60: 6966 2063 6f6d 7072 6573 735f 7479 7065  if compress_type
+00007a70: 203d 3d20 5a49 505f 5a53 5441 4e44 4152   == ZIP_ZSTANDAR
+00007a80: 443a 0a20 2020 2020 2020 2069 6620 636f  D:.        if co
+00007a90: 6d70 7265 7373 6c65 7665 6c20 6973 204e  mpresslevel is N
+00007aa0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00007ab0: 2063 6f6d 7072 6573 736c 6576 656c 203d   compresslevel =
+00007ac0: 2033 0a20 2020 2020 2020 2061 7373 6572   3.        asser
+00007ad0: 7420 7a73 7461 6e64 6172 6420 6973 206e  t zstandard is n
+00007ae0: 6f74 204e 6f6e 6520 6f72 2070 797a 7374  ot None or pyzst
+00007af0: 6420 6973 206e 6f74 204e 6f6e 650a 2020  d is not None.  
+00007b00: 2020 2020 2020 6966 207a 7374 616e 6461        if zstanda
+00007b10: 7264 2069 7320 6e6f 7420 4e6f 6e65 3a0a  rd is not None:.
+00007b20: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00007b30: 726e 207a 7374 616e 6461 7264 2e5a 7374  rn zstandard.Zst
+00007b40: 6443 6f6d 7072 6573 736f 7228 6c65 7665  dCompressor(leve
+00007b50: 6c3d 636f 6d70 7265 7373 6c65 7665 6c2c  l=compresslevel,
+00007b60: 2074 6872 6561 6473 3d34 292e 636f 6d70   threads=4).comp
+00007b70: 7265 7373 6f62 6a28 290a 2020 2020 2020  ressobj().      
+00007b80: 2020 7265 7475 726e 2070 797a 7374 642e    return pyzstd.
+00007b90: 5a73 7464 436f 6d70 7265 7373 6f72 287b  ZstdCompressor({
+00007ba0: 7079 7a73 7464 2e43 5061 7261 6d65 7465  pyzstd.CParamete
+00007bb0: 722e 636f 6d70 7265 7373 696f 6e4c 6576  r.compressionLev
+00007bc0: 656c 3a20 636f 6d70 7265 7373 6c65 7665  el: compressleve
+00007bd0: 6c2c 2070 797a 7374 642e 4350 6172 616d  l, pyzstd.CParam
+00007be0: 6574 6572 2e6e 6257 6f72 6b65 7273 3a20  eter.nbWorkers: 
+00007bf0: 347d 290a 2020 2020 656c 6966 2063 6f6d  4}).    elif com
+00007c00: 7072 6573 735f 7479 7065 203d 3d20 5a49  press_type == ZI
+00007c10: 505f 5050 4d44 3a0a 2020 2020 2020 2020  P_PPMD:.        
+00007c20: 6173 7365 7274 2070 7970 706d 6420 6973  assert pyppmd is
+00007c30: 206e 6f74 204e 6f6e 650a 2020 2020 2020   not None.      
+00007c40: 2020 7265 7475 726e 2050 504d 4443 6f6d    return PPMDCom
+00007c50: 7072 6573 736f 7228 636f 6d70 7265 7373  pressor(compress
+00007c60: 6c65 7665 6c29 0a20 2020 2065 6c73 653a  level).    else:
+00007c70: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00007c80: 4e6f 6e65 0a0a 6465 6620 5f67 6574 5f64  None..def _get_d
+00007c90: 6563 6f6d 7072 6573 736f 7228 636f 6d70  ecompressor(comp
+00007ca0: 7265 7373 5f74 7970 6529 3a0a 2020 2020  ress_type):.    
+00007cb0: 5f63 6865 636b 5f63 6f6d 7072 6573 7369  _check_compressi
+00007cc0: 6f6e 2863 6f6d 7072 6573 735f 7479 7065  on(compress_type
+00007cd0: 290a 2020 2020 6966 2063 6f6d 7072 6573  ).    if compres
+00007ce0: 735f 7479 7065 203d 3d20 5a49 505f 5354  s_type == ZIP_ST
+00007cf0: 4f52 4544 3a0a 2020 2020 2020 2020 7265  ORED:.        re
+00007d00: 7475 726e 204e 6f6e 650a 2020 2020 656c  turn None.    el
+00007d10: 6966 2063 6f6d 7072 6573 735f 7479 7065  if compress_type
+00007d20: 203d 3d20 5a49 505f 4445 464c 4154 4544   == ZIP_DEFLATED
+00007d30: 3a0a 2020 2020 2020 2020 6966 2069 7361  :.        if isa
+00007d40: 6c5f 7a6c 6962 2069 7320 6e6f 7420 4e6f  l_zlib is not No
+00007d50: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00007d60: 7265 7475 726e 2069 7361 6c5f 7a6c 6962  return isal_zlib
+00007d70: 2e64 6563 6f6d 7072 6573 736f 626a 282d  .decompressobj(-
+00007d80: 3135 290a 2020 2020 2020 2020 7265 7475  15).        retu
+00007d90: 726e 207a 6c69 622e 6465 636f 6d70 7265  rn zlib.decompre
+00007da0: 7373 6f62 6a28 2d31 3529 0a20 2020 2065  ssobj(-15).    e
+00007db0: 6c69 6620 636f 6d70 7265 7373 5f74 7970  lif compress_typ
+00007dc0: 6520 3d3d 205a 4950 5f44 4546 4c41 5445  e == ZIP_DEFLATE
+00007dd0: 4436 343a 0a20 2020 2020 2020 2069 6620  D64:.        if 
+00007de0: 6465 666c 6174 6536 3420 6973 206e 6f74  deflate64 is not
+00007df0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00007e00: 2020 2072 6574 7572 6e20 6465 666c 6174     return deflat
+00007e10: 6536 342e 4465 666c 6174 6536 3428 290a  e64.Deflate64().
+00007e20: 2020 2020 2020 2020 7265 7475 726e 2049          return I
+00007e30: 6e66 6c61 7465 3634 4465 636f 6d70 7265  nflate64Decompre
+00007e40: 7373 6f72 2829 0a20 2020 2065 6c69 6620  ssor().    elif 
+00007e50: 636f 6d70 7265 7373 5f74 7970 6520 3d3d  compress_type ==
+00007e60: 205a 4950 5f44 434c 494d 504c 4f44 4544   ZIP_DCLIMPLODED
+00007e70: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+00007e80: 2064 636c 696d 706c 6f64 652e 6465 636f   dclimplode.deco
+00007e90: 6d70 7265 7373 6f62 6a28 290a 2020 2020  mpressobj().    
+00007ea0: 656c 6966 2063 6f6d 7072 6573 735f 7479  elif compress_ty
+00007eb0: 7065 203d 3d20 5a49 505f 425a 4950 323a  pe == ZIP_BZIP2:
+00007ec0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00007ed0: 627a 322e 425a 3244 6563 6f6d 7072 6573  bz2.BZ2Decompres
+00007ee0: 736f 7228 290a 2020 2020 656c 6966 2063  sor().    elif c
+00007ef0: 6f6d 7072 6573 735f 7479 7065 203d 3d20  ompress_type == 
+00007f00: 5a49 505f 4c5a 4d41 3a0a 2020 2020 2020  ZIP_LZMA:.      
+00007f10: 2020 7265 7475 726e 204c 5a4d 4144 6563    return LZMADec
+00007f20: 6f6d 7072 6573 736f 7228 290a 2020 2020  ompressor().    
+00007f30: 656c 6966 2063 6f6d 7072 6573 735f 7479  elif compress_ty
+00007f40: 7065 203d 3d20 5a49 505f 585a 3a0a 2020  pe == ZIP_XZ:.  
+00007f50: 2020 2020 2020 7265 7475 726e 206c 7a6d        return lzm
+00007f60: 612e 4c5a 4d41 4465 636f 6d70 7265 7373  a.LZMADecompress
+00007f70: 6f72 286c 7a6d 612e 464f 524d 4154 5f58  or(lzma.FORMAT_X
+00007f80: 5a29 0a20 2020 2065 6c69 6620 636f 6d70  Z).    elif comp
+00007f90: 7265 7373 5f74 7970 6520 3d3d 205a 4950  ress_type == ZIP
+00007fa0: 5f5a 5354 414e 4441 5244 3a0a 2020 2020  _ZSTANDARD:.    
+00007fb0: 2020 2020 6966 207a 7374 616e 6461 7264      if zstandard
+00007fc0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00007fd0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00007fe0: 207a 7374 616e 6461 7264 2e5a 7374 6444   zstandard.ZstdD
+00007ff0: 6563 6f6d 7072 6573 736f 7228 292e 6465  ecompressor().de
+00008000: 636f 6d70 7265 7373 6f62 6a28 290a 2020  compressobj().  
+00008010: 2020 2020 2020 7265 7475 726e 2070 797a        return pyz
+00008020: 7374 642e 5a73 7464 4465 636f 6d70 7265  std.ZstdDecompre
+00008030: 7373 6f72 2829 0a20 2020 2065 6c69 6620  ssor().    elif 
+00008040: 636f 6d70 7265 7373 5f74 7970 6520 3d3d  compress_type ==
+00008050: 205a 4950 5f50 504d 443a 0a20 2020 2020   ZIP_PPMD:.     
+00008060: 2020 2072 6574 7572 6e20 5050 4d44 4465     return PPMDDe
+00008070: 636f 6d70 7265 7373 6f72 2829 0a20 2020  compressor().   
+00008080: 2065 6c73 653a 0a20 2020 2020 2020 2064   else:.        d
+00008090: 6573 6372 203d 2063 6f6d 7072 6573 736f  escr = compresso
+000080a0: 725f 6e61 6d65 732e 6765 7428 636f 6d70  r_names.get(comp
+000080b0: 7265 7373 5f74 7970 6529 0a20 2020 2020  ress_type).     
+000080c0: 2020 2069 6620 6465 7363 723a 0a20 2020     if descr:.   
+000080d0: 2020 2020 2020 2020 2072 6169 7365 204e           raise N
+000080e0: 6f74 496d 706c 656d 656e 7465 6445 7272  otImplementedErr
+000080f0: 6f72 2822 636f 6d70 7265 7373 696f 6e20  or("compression 
+00008100: 7479 7065 2025 6420 2825 7329 2220 2520  type %d (%s)" % 
+00008110: 2863 6f6d 7072 6573 735f 7479 7065 2c20  (compress_type, 
+00008120: 6465 7363 7229 290a 2020 2020 2020 2020  descr)).        
+00008130: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00008140: 2020 7261 6973 6520 4e6f 7449 6d70 6c65    raise NotImple
+00008150: 6d65 6e74 6564 4572 726f 7228 2263 6f6d  mentedError("com
+00008160: 7072 6573 7369 6f6e 2074 7970 6520 2564  pression type %d
+00008170: 2220 2520 2863 6f6d 7072 6573 735f 7479  " % (compress_ty
+00008180: 7065 2c29 290a 0a0a 636c 6173 7320 5f53  pe,))...class _S
+00008190: 6861 7265 6446 696c 6528 6f62 6a65 6374  haredFile(object
+000081a0: 293a 0a20 2020 2064 6566 205f 5f69 6e69  ):.    def __ini
+000081b0: 745f 5f28 7365 6c66 2c20 6669 6c65 2c20  t__(self, file, 
+000081c0: 706f 732c 2063 6c6f 7365 2c20 6c6f 636b  pos, close, lock
+000081d0: 2c20 7772 6974 696e 6729 3a0a 2020 2020  , writing):.    
+000081e0: 2020 2020 7365 6c66 2e5f 6669 6c65 203d      self._file =
+000081f0: 2066 696c 650a 2020 2020 2020 2020 7365   file.        se
+00008200: 6c66 2e5f 706f 7320 3d20 706f 730a 2020  lf._pos = pos.  
+00008210: 2020 2020 2020 7365 6c66 2e5f 636c 6f73        self._clos
+00008220: 6520 3d20 636c 6f73 650a 2020 2020 2020  e = close.      
+00008230: 2020 7365 6c66 2e5f 6c6f 636b 203d 206c    self._lock = l
+00008240: 6f63 6b0a 2020 2020 2020 2020 7365 6c66  ock.        self
+00008250: 2e5f 7772 6974 696e 6720 3d20 7772 6974  ._writing = writ
+00008260: 696e 670a 2020 2020 2020 2020 7472 793a  ing.        try:
+00008270: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00008280: 662e 7365 656b 6162 6c65 203d 2066 696c  f.seekable = fil
+00008290: 652e 7365 656b 6162 6c65 0a20 2020 2020  e.seekable.     
+000082a0: 2020 2065 7863 6570 7420 4174 7472 6962     except Attrib
+000082b0: 7574 6545 7272 6f72 3a0a 2020 2020 2020  uteError:.      
+000082c0: 2020 2020 2020 7365 6c66 2e73 6565 6b61        self.seeka
+000082d0: 626c 6520 3d20 6c61 6d62 6461 3a20 4661  ble = lambda: Fa
+000082e0: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+000082f0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+00008300: 2020 2020 2066 696c 652e 7365 656b 2830       file.seek(0
+00008310: 2c20 6f73 2e53 4545 4b5f 5345 5429 0a20  , os.SEEK_SET). 
+00008320: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00008330: 656c 662e 7365 656b 6162 6c65 203d 206c  elf.seekable = l
+00008340: 616d 6264 613a 2054 7275 650a 2020 2020  ambda: True.    
+00008350: 2020 2020 2020 2020 6578 6365 7074 204f          except O
+00008360: 5345 7272 6f72 3a0a 2020 2020 2020 2020  SError:.        
+00008370: 2020 2020 2020 2020 7061 7373 0a20 2020          pass.   
+00008380: 2020 2020 2073 656c 662e 7465 6c6c 203d       self.tell =
+00008390: 2066 696c 652e 7465 6c6c 0a0a 2020 2020   file.tell..    
+000083a0: 6465 6620 7365 656b 2873 656c 662c 206f  def seek(self, o
+000083b0: 6666 7365 742c 2077 6865 6e63 653d 3029  ffset, whence=0)
+000083c0: 3a0a 2020 2020 2020 2020 7769 7468 2073  :.        with s
+000083d0: 656c 662e 5f6c 6f63 6b3a 0a20 2020 2020  elf._lock:.     
+000083e0: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
+000083f0: 7772 6974 696e 6728 293a 0a20 2020 2020  writing():.     
+00008400: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00008410: 2056 616c 7565 4572 726f 7228 2243 616e   ValueError("Can
+00008420: 2774 2072 6570 6f73 6974 696f 6e20 696e  't reposition in
+00008430: 2074 6865 205a 4950 2066 696c 6520 7768   the ZIP file wh
+00008440: 696c 6520 220a 2020 2020 2020 2020 2020  ile ".          
+00008450: 2020 2020 2020 2020 2020 2020 2020 2274                "t
+00008460: 6865 7265 2069 7320 616e 206f 7065 6e20  here is an open 
+00008470: 7772 6974 696e 6720 6861 6e64 6c65 206f  writing handle o
+00008480: 6e20 6974 2e20 220a 2020 2020 2020 2020  n it. ".        
+00008490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000084a0: 2243 6c6f 7365 2074 6865 2077 7269 7469  "Close the writi
+000084b0: 6e67 2068 616e 646c 6520 6265 666f 7265  ng handle before
+000084c0: 2074 7279 696e 6720 746f 2072 6561 642e   trying to read.
+000084d0: 2229 0a20 2020 2020 2020 2020 2020 2073  ").            s
+000084e0: 656c 662e 5f66 696c 652e 7365 656b 286f  elf._file.seek(o
+000084f0: 6666 7365 742c 2077 6865 6e63 6529 0a20  ffset, whence). 
+00008500: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00008510: 5f70 6f73 203d 2073 656c 662e 5f66 696c  _pos = self._fil
+00008520: 652e 7465 6c6c 2829 0a20 2020 2020 2020  e.tell().       
+00008530: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00008540: 2e5f 706f 730a 0a20 2020 2064 6566 2072  ._pos..    def r
+00008550: 6561 6428 7365 6c66 2c20 6e3d 2d31 293a  ead(self, n=-1):
+00008560: 0a20 2020 2020 2020 2077 6974 6820 7365  .        with se
+00008570: 6c66 2e5f 6c6f 636b 3a0a 2020 2020 2020  lf._lock:.      
+00008580: 2020 2020 2020 6966 2073 656c 662e 5f77        if self._w
+00008590: 7269 7469 6e67 2829 3a0a 2020 2020 2020  riting():.      
+000085a0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+000085b0: 5661 6c75 6545 7272 6f72 2822 4361 6e27  ValueError("Can'
+000085c0: 7420 7265 6164 2066 726f 6d20 7468 6520  t read from the 
+000085d0: 5a49 5020 6669 6c65 2077 6869 6c65 2074  ZIP file while t
+000085e0: 6865 7265 2022 0a20 2020 2020 2020 2020  here ".         
+000085f0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00008600: 6973 2061 6e20 6f70 656e 2077 7269 7469  is an open writi
+00008610: 6e67 2068 616e 646c 6520 6f6e 2069 742e  ng handle on it.
+00008620: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+00008630: 2020 2020 2020 2020 2020 2022 436c 6f73             "Clos
+00008640: 6520 7468 6520 7772 6974 696e 6720 6861  e the writing ha
+00008650: 6e64 6c65 2062 6566 6f72 6520 7472 7969  ndle before tryi
+00008660: 6e67 2074 6f20 7265 6164 2e22 290a 2020  ng to read.").  
+00008670: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00008680: 6669 6c65 2e73 6565 6b28 7365 6c66 2e5f  file.seek(self._
+00008690: 706f 7329 0a20 2020 2020 2020 2020 2020  pos).           
+000086a0: 2064 6174 6120 3d20 7365 6c66 2e5f 6669   data = self._fi
+000086b0: 6c65 2e72 6561 6428 6e29 0a20 2020 2020  le.read(n).     
+000086c0: 2020 2020 2020 2073 656c 662e 5f70 6f73         self._pos
+000086d0: 203d 2073 656c 662e 5f66 696c 652e 7465   = self._file.te
+000086e0: 6c6c 2829 0a20 2020 2020 2020 2020 2020  ll().           
+000086f0: 2072 6574 7572 6e20 6461 7461 0a0a 2020   return data..  
+00008700: 2020 6465 6620 636c 6f73 6528 7365 6c66    def close(self
+00008710: 293a 0a20 2020 2020 2020 2069 6620 7365  ):.        if se
+00008720: 6c66 2e5f 6669 6c65 2069 7320 6e6f 7420  lf._file is not 
+00008730: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00008740: 2020 6669 6c65 6f62 6a20 3d20 7365 6c66    fileobj = self
+00008750: 2e5f 6669 6c65 0a20 2020 2020 2020 2020  ._file.         
+00008760: 2020 2073 656c 662e 5f66 696c 6520 3d20     self._file = 
+00008770: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+00008780: 2073 656c 662e 5f63 6c6f 7365 2866 696c   self._close(fil
+00008790: 656f 626a 290a 0a23 2050 726f 7669 6465  eobj)..# Provide
+000087a0: 2074 6865 2074 656c 6c20 6d65 7468 6f64   the tell method
+000087b0: 2066 6f72 2075 6e73 6565 6b61 626c 6520   for unseekable 
+000087c0: 7374 7265 616d 0a63 6c61 7373 205f 5465  stream.class _Te
+000087d0: 6c6c 6162 6c65 286f 626a 6563 7429 3a0a  llable(object):.
+000087e0: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
+000087f0: 2873 656c 662c 2066 7029 3a0a 2020 2020  (self, fp):.    
+00008800: 2020 2020 7365 6c66 2e66 7020 3d20 6670      self.fp = fp
+00008810: 0a20 2020 2020 2020 2073 656c 662e 6f66  .        self.of
+00008820: 6673 6574 203d 2030 0a0a 2020 2020 6465  fset = 0..    de
+00008830: 6620 7772 6974 6528 7365 6c66 2c20 6461  f write(self, da
+00008840: 7461 293a 0a20 2020 2020 2020 206e 203d  ta):.        n =
+00008850: 2073 656c 662e 6670 2e77 7269 7465 2864   self.fp.write(d
+00008860: 6174 6129 0a20 2020 2020 2020 2073 656c  ata).        sel
+00008870: 662e 6f66 6673 6574 202b 3d20 6e0a 2020  f.offset += n.  
+00008880: 2020 2020 2020 7265 7475 726e 206e 0a0a        return n..
+00008890: 2020 2020 6465 6620 7465 6c6c 2873 656c      def tell(sel
+000088a0: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
+000088b0: 726e 2073 656c 662e 6f66 6673 6574 0a0a  rn self.offset..
+000088c0: 2020 2020 6465 6620 666c 7573 6828 7365      def flush(se
+000088d0: 6c66 293a 0a20 2020 2020 2020 2073 656c  lf):.        sel
+000088e0: 662e 6670 2e66 6c75 7368 2829 0a0a 2020  f.fp.flush()..  
+000088f0: 2020 6465 6620 636c 6f73 6528 7365 6c66    def close(self
+00008900: 293a 0a20 2020 2020 2020 2073 656c 662e  ):.        self.
+00008910: 6670 2e63 6c6f 7365 2829 0a0a 0a63 6c61  fp.close()...cla
+00008920: 7373 205a 6970 4578 7446 696c 6528 696f  ss ZipExtFile(io
+00008930: 2e42 7566 6665 7265 6449 4f42 6173 6529  .BufferedIOBase)
+00008940: 3a0a 2020 2020 2222 2246 696c 652d 6c69  :.    """File-li
+00008950: 6b65 206f 626a 6563 7420 666f 7220 7265  ke object for re
+00008960: 6164 696e 6720 616e 2061 7263 6869 7665  ading an archive
+00008970: 206d 656d 6265 722e 0a20 2020 2020 2020   member..       
+00008980: 4973 2072 6574 7572 6e65 6420 6279 205a  Is returned by Z
+00008990: 6970 4669 6c65 2e6f 7065 6e28 292e 0a20  ipFile.open().. 
+000089a0: 2020 2022 2222 0a0a 2020 2020 2320 4d61     """..    # Ma
+000089b0: 7820 7369 7a65 2073 7570 706f 7274 6564  x size supported
+000089c0: 2062 7920 6465 636f 6d70 7265 7373 6f72   by decompressor
+000089d0: 2e0a 2020 2020 4d41 585f 4e20 3d20 3120  ..    MAX_N = 1 
+000089e0: 3c3c 2033 3120 2d20 310a 0a20 2020 2023  << 31 - 1..    #
+000089f0: 2052 6561 6420 6672 6f6d 2063 6f6d 7072   Read from compr
+00008a00: 6573 7365 6420 6669 6c65 7320 696e 2034  essed files in 4
+00008a10: 6b20 626c 6f63 6b73 2e0a 2020 2020 4d49  k blocks..    MI
+00008a20: 4e5f 5245 4144 5f53 495a 4520 3d20 3430  N_READ_SIZE = 40
+00008a30: 3936 0a0a 2020 2020 2320 4368 756e 6b20  96..    # Chunk 
+00008a40: 7369 7a65 2074 6f20 7265 6164 2064 7572  size to read dur
+00008a50: 696e 6720 7365 656b 0a20 2020 204d 4158  ing seek.    MAX
+00008a60: 5f53 4545 4b5f 5245 4144 203d 2031 203c  _SEEK_READ = 1 <
+00008a70: 3c20 3234 0a0a 2020 2020 6465 6620 5f5f  < 24..    def __
+00008a80: 696e 6974 5f5f 2873 656c 662c 2066 696c  init__(self, fil
+00008a90: 656f 626a 2c20 6d6f 6465 2c20 7a69 7069  eobj, mode, zipi
+00008aa0: 6e66 6f2c 2070 7764 3d4e 6f6e 652c 0a20  nfo, pwd=None,. 
+00008ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008ac0: 636c 6f73 655f 6669 6c65 6f62 6a3d 4661  close_fileobj=Fa
+00008ad0: 6c73 6529 3a0a 2020 2020 2020 2020 7365  lse):.        se
+00008ae0: 6c66 2e5f 6669 6c65 6f62 6a20 3d20 6669  lf._fileobj = fi
+00008af0: 6c65 6f62 6a0a 2020 2020 2020 2020 7365  leobj.        se
+00008b00: 6c66 2e5f 7077 6420 3d20 7077 640a 2020  lf._pwd = pwd.  
+00008b10: 2020 2020 2020 7365 6c66 2e5f 636c 6f73        self._clos
+00008b20: 655f 6669 6c65 6f62 6a20 3d20 636c 6f73  e_fileobj = clos
+00008b30: 655f 6669 6c65 6f62 6a0a 0a20 2020 2020  e_fileobj..     
+00008b40: 2020 2073 656c 662e 5f63 6f6d 7072 6573     self._compres
+00008b50: 735f 7479 7065 203d 207a 6970 696e 666f  s_type = zipinfo
+00008b60: 2e63 6f6d 7072 6573 735f 7479 7065 0a20  .compress_type. 
+00008b70: 2020 2020 2020 2073 656c 662e 5f63 6f6d         self._com
+00008b80: 7072 6573 735f 6c65 6674 203d 207a 6970  press_left = zip
+00008b90: 696e 666f 2e63 6f6d 7072 6573 735f 7369  info.compress_si
+00008ba0: 7a65 0a20 2020 2020 2020 2073 656c 662e  ze.        self.
+00008bb0: 5f6c 6566 7420 3d20 7a69 7069 6e66 6f2e  _left = zipinfo.
+00008bc0: 6669 6c65 5f73 697a 650a 0a20 2020 2020  file_size..     
+00008bd0: 2020 2073 656c 662e 5f64 6563 6f6d 7072     self._decompr
+00008be0: 6573 736f 7220 3d20 5f67 6574 5f64 6563  essor = _get_dec
+00008bf0: 6f6d 7072 6573 736f 7228 7365 6c66 2e5f  ompressor(self._
+00008c00: 636f 6d70 7265 7373 5f74 7970 6529 0a0a  compress_type)..
+00008c10: 2020 2020 2020 2020 7365 6c66 2e5f 656f          self._eo
+00008c20: 6620 3d20 4661 6c73 650a 2020 2020 2020  f = False.      
+00008c30: 2020 7365 6c66 2e5f 7265 6164 6275 6666    self._readbuff
+00008c40: 6572 203d 2062 2727 0a20 2020 2020 2020  er = b''.       
+00008c50: 2073 656c 662e 5f6f 6666 7365 7420 3d20   self._offset = 
+00008c60: 300a 0a20 2020 2020 2020 2073 656c 662e  0..        self.
+00008c70: 6e65 776c 696e 6573 203d 204e 6f6e 650a  newlines = None.
+00008c80: 0a20 2020 2020 2020 2073 656c 662e 6d6f  .        self.mo
+00008c90: 6465 203d 206d 6f64 650a 2020 2020 2020  de = mode.      
+00008ca0: 2020 7365 6c66 2e6e 616d 6520 3d20 7a69    self.name = zi
+00008cb0: 7069 6e66 6f2e 6669 6c65 6e61 6d65 0a0a  pinfo.filename..
+00008cc0: 2020 2020 2020 2020 6966 2068 6173 6174          if hasat
+00008cd0: 7472 287a 6970 696e 666f 2c20 2743 5243  tr(zipinfo, 'CRC
+00008ce0: 2729 3a0a 2020 2020 2020 2020 2020 2020  '):.            
+00008cf0: 7365 6c66 2e5f 6578 7065 6374 6564 5f63  self._expected_c
+00008d00: 7263 203d 207a 6970 696e 666f 2e43 5243  rc = zipinfo.CRC
+00008d10: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00008d20: 662e 5f72 756e 6e69 6e67 5f63 7263 203d  f._running_crc =
+00008d30: 2063 7263 3332 2862 2727 290a 2020 2020   crc32(b'').    
+00008d40: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00008d50: 2020 2020 2020 7365 6c66 2e5f 6578 7065        self._expe
+00008d60: 6374 6564 5f63 7263 203d 204e 6f6e 650a  cted_crc = None.
+00008d70: 0a20 2020 2020 2020 2073 656c 662e 5f73  .        self._s
+00008d80: 6565 6b61 626c 6520 3d20 4661 6c73 650a  eekable = False.
+00008d90: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+00008da0: 2020 2020 2020 2020 2069 6620 6669 6c65           if file
+00008db0: 6f62 6a2e 7365 656b 6162 6c65 2829 3a0a  obj.seekable():.
+00008dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008dd0: 7365 6c66 2e5f 6f72 6967 5f63 6f6d 7072  self._orig_compr
+00008de0: 6573 735f 7374 6172 7420 3d20 6669 6c65  ess_start = file
+00008df0: 6f62 6a2e 7465 6c6c 2829 0a20 2020 2020  obj.tell().     
+00008e00: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00008e10: 5f6f 7269 675f 636f 6d70 7265 7373 5f73  _orig_compress_s
+00008e20: 697a 6520 3d20 7a69 7069 6e66 6f2e 636f  ize = zipinfo.co
+00008e30: 6d70 7265 7373 5f73 697a 650a 2020 2020  mpress_size.    
+00008e40: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00008e50: 2e5f 6f72 6967 5f66 696c 655f 7369 7a65  ._orig_file_size
+00008e60: 203d 207a 6970 696e 666f 2e66 696c 655f   = zipinfo.file_
+00008e70: 7369 7a65 0a20 2020 2020 2020 2020 2020  size.           
+00008e80: 2020 2020 2073 656c 662e 5f6f 7269 675f       self._orig_
+00008e90: 7374 6172 745f 6372 6320 3d20 7365 6c66  start_crc = self
+00008ea0: 2e5f 7275 6e6e 696e 675f 6372 630a 2020  ._running_crc.  
+00008eb0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00008ec0: 6c66 2e5f 7365 656b 6162 6c65 203d 2054  lf._seekable = T
+00008ed0: 7275 650a 2020 2020 2020 2020 6578 6365  rue.        exce
+00008ee0: 7074 2041 7474 7269 6275 7465 4572 726f  pt AttributeErro
+00008ef0: 723a 0a20 2020 2020 2020 2020 2020 2070  r:.            p
+00008f00: 6173 730a 0a20 2020 2020 2020 2073 656c  ass..        sel
+00008f10: 662e 5f64 6563 7279 7074 6572 203d 204e  f._decrypter = N
+00008f20: 6f6e 650a 2020 2020 2020 2020 6966 2070  one.        if p
+00008f30: 7764 3a0a 2020 2020 2020 2020 2020 2020  wd:.            
+00008f40: 6966 207a 6970 696e 666f 2e66 6c61 675f  if zipinfo.flag_
+00008f50: 6269 7473 2026 2030 7838 3a0a 2020 2020  bits & 0x8:.    
+00008f60: 2020 2020 2020 2020 2020 2020 2320 636f              # co
+00008f70: 6d70 6172 6520 6167 6169 6e73 7420 7468  mpare against th
+00008f80: 6520 6669 6c65 2074 7970 6520 6672 6f6d  e file type from
+00008f90: 2065 7874 656e 6465 6420 6c6f 6361 6c20   extended local 
+00008fa0: 6865 6164 6572 730a 2020 2020 2020 2020  headers.        
+00008fb0: 2020 2020 2020 2020 6368 6563 6b5f 6279          check_by
+00008fc0: 7465 203d 2028 7a69 7069 6e66 6f2e 5f72  te = (zipinfo._r
+00008fd0: 6177 5f74 696d 6520 3e3e 2038 2920 2620  aw_time >> 8) & 
+00008fe0: 3078 6666 0a20 2020 2020 2020 2020 2020  0xff.           
+00008ff0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00009000: 2020 2020 2020 2023 2063 6f6d 7061 7265         # compare
+00009010: 2061 6761 696e 7374 2074 6865 2043 5243   against the CRC
+00009020: 206f 7468 6572 7769 7365 0a20 2020 2020   otherwise.     
+00009030: 2020 2020 2020 2020 2020 2063 6865 636b             check
+00009040: 5f62 7974 6520 3d20 287a 6970 696e 666f  _byte = (zipinfo
+00009050: 2e43 5243 203e 3e20 3234 2920 2620 3078  .CRC >> 24) & 0x
+00009060: 6666 0a20 2020 2020 2020 2020 2020 2068  ff.            h
+00009070: 203d 2073 656c 662e 5f69 6e69 745f 6465   = self._init_de
+00009080: 6372 7970 7465 7228 290a 2020 2020 2020  crypter().      
+00009090: 2020 2020 2020 6966 2068 2021 3d20 6368        if h != ch
+000090a0: 6563 6b5f 6279 7465 3a0a 2020 2020 2020  eck_byte:.      
+000090b0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+000090c0: 5275 6e74 696d 6545 7272 6f72 2822 4261  RuntimeError("Ba
+000090d0: 6420 7061 7373 776f 7264 2066 6f72 2066  d password for f
+000090e0: 696c 6520 2572 2220 2520 7a69 7069 6e66  ile %r" % zipinf
+000090f0: 6f2e 6f72 6967 5f66 696c 656e 616d 6529  o.orig_filename)
+00009100: 0a0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+00009110: 662e 5f63 6f6d 7072 6573 735f 7479 7065  f._compress_type
+00009120: 203d 3d20 5a49 505f 4445 464c 4154 4544   == ZIP_DEFLATED
+00009130: 3634 3a0a 2020 2020 2020 2020 2020 2020  64:.            
+00009140: 7365 6c66 2e4d 494e 5f52 4541 445f 5349  self.MIN_READ_SI
+00009150: 5a45 203d 2036 3420 2a20 322a 2a31 300a  ZE = 64 * 2**10.
+00009160: 0a20 2020 2064 6566 205f 696e 6974 5f64  .    def _init_d
+00009170: 6563 7279 7074 6572 2873 656c 6629 3a0a  ecrypter(self):.
+00009180: 2020 2020 2020 2020 7365 6c66 2e5f 6465          self._de
+00009190: 6372 7970 7465 7220 3d20 5f5a 6970 4465  crypter = _ZipDe
+000091a0: 6372 7970 7465 7228 7365 6c66 2e5f 7077  crypter(self._pw
+000091b0: 6429 0a20 2020 2020 2020 2023 2054 6865  d).        # The
+000091c0: 2066 6972 7374 2031 3220 6279 7465 7320   first 12 bytes 
+000091d0: 696e 2074 6865 2063 7970 6865 7220 7374  in the cypher st
+000091e0: 7265 616d 2069 7320 616e 2065 6e63 7279  ream is an encry
+000091f0: 7074 696f 6e20 6865 6164 6572 0a20 2020  ption header.   
+00009200: 2020 2020 2023 2020 7573 6564 2074 6f20       #  used to 
+00009210: 7374 7265 6e67 7468 656e 2074 6865 2061  strengthen the a
+00009220: 6c67 6f72 6974 686d 2e20 5468 6520 6669  lgorithm. The fi
+00009230: 7273 7420 3131 2062 7974 6573 2061 7265  rst 11 bytes are
+00009240: 0a20 2020 2020 2020 2023 2020 636f 6d70  .        #  comp
+00009250: 6c65 7465 6c79 2072 616e 646f 6d2c 2077  letely random, w
+00009260: 6869 6c65 2074 6865 2031 3274 6820 636f  hile the 12th co
+00009270: 6e74 6169 6e73 2074 6865 204d 5342 206f  ntains the MSB o
+00009280: 6620 7468 6520 4352 432c 0a20 2020 2020  f the CRC,.     
+00009290: 2020 2023 2020 6f72 2074 6865 204d 5342     #  or the MSB
+000092a0: 206f 6620 7468 6520 6669 6c65 2074 696d   of the file tim
+000092b0: 6520 6465 7065 6e64 696e 6720 6f6e 2074  e depending on t
+000092c0: 6865 2068 6561 6465 7220 7479 7065 0a20  he header type. 
+000092d0: 2020 2020 2020 2023 2020 616e 6420 6973         #  and is
+000092e0: 2075 7365 6420 746f 2063 6865 636b 2074   used to check t
+000092f0: 6865 2063 6f72 7265 6374 6e65 7373 206f  he correctness o
+00009300: 6620 7468 6520 7061 7373 776f 7264 2e0a  f the password..
+00009310: 2020 2020 2020 2020 6865 6164 6572 203d          header =
+00009320: 2073 656c 662e 5f66 696c 656f 626a 2e72   self._fileobj.r
+00009330: 6561 6428 3132 290a 2020 2020 2020 2020  ead(12).        
+00009340: 7365 6c66 2e5f 636f 6d70 7265 7373 5f6c  self._compress_l
+00009350: 6566 7420 2d3d 2031 320a 2020 2020 2020  eft -= 12.      
+00009360: 2020 7265 7475 726e 2073 656c 662e 5f64    return self._d
+00009370: 6563 7279 7074 6572 2868 6561 6465 7229  ecrypter(header)
+00009380: 5b31 315d 0a0a 2020 2020 6465 6620 5f5f  [11]..    def __
+00009390: 7265 7072 5f5f 2873 656c 6629 3a0a 2020  repr__(self):.  
+000093a0: 2020 2020 2020 7265 7375 6c74 203d 205b        result = [
+000093b0: 273c 2573 2e25 7327 2025 2028 7365 6c66  '<%s.%s' % (self
+000093c0: 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6d 6f64  .__class__.__mod
+000093d0: 756c 655f 5f2c 0a20 2020 2020 2020 2020  ule__,.         
+000093e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000093f0: 2020 2020 2073 656c 662e 5f5f 636c 6173       self.__clas
+00009400: 735f 5f2e 5f5f 7175 616c 6e61 6d65 5f5f  s__.__qualname__
+00009410: 295d 0a20 2020 2020 2020 2069 6620 6e6f  )].        if no
+00009420: 7420 7365 6c66 2e63 6c6f 7365 643a 0a20  t self.closed:. 
+00009430: 2020 2020 2020 2020 2020 2072 6573 756c             resul
+00009440: 742e 6170 7065 6e64 2827 206e 616d 653d  t.append(' name=
+00009450: 2572 206d 6f64 653d 2572 2720 2520 2873  %r mode=%r' % (s
+00009460: 656c 662e 6e61 6d65 2c20 7365 6c66 2e6d  elf.name, self.m
+00009470: 6f64 6529 290a 2020 2020 2020 2020 2020  ode)).          
+00009480: 2020 6966 2073 656c 662e 5f63 6f6d 7072    if self._compr
+00009490: 6573 735f 7479 7065 2021 3d20 5a49 505f  ess_type != ZIP_
+000094a0: 5354 4f52 4544 3a0a 2020 2020 2020 2020  STORED:.        
+000094b0: 2020 2020 2020 2020 7265 7375 6c74 2e61          result.a
+000094c0: 7070 656e 6428 2720 636f 6d70 7265 7373  ppend(' compress
+000094d0: 5f74 7970 653d 2573 2720 250a 2020 2020  _type=%s' %.    
+000094e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000094f0: 2020 2020 2020 2020 2020 636f 6d70 7265            compre
+00009500: 7373 6f72 5f6e 616d 6573 2e67 6574 2873  ssor_names.get(s
+00009510: 656c 662e 5f63 6f6d 7072 6573 735f 7479  elf._compress_ty
+00009520: 7065 2c0a 2020 2020 2020 2020 2020 2020  pe,.            
+00009530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009550: 2020 2020 2020 2073 656c 662e 5f63 6f6d         self._com
+00009560: 7072 6573 735f 7479 7065 2929 0a20 2020  press_type)).   
+00009570: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00009580: 2020 2020 2020 2072 6573 756c 742e 6170         result.ap
+00009590: 7065 6e64 2827 205b 636c 6f73 6564 5d27  pend(' [closed]'
+000095a0: 290a 2020 2020 2020 2020 7265 7375 6c74  ).        result
+000095b0: 2e61 7070 656e 6428 273e 2729 0a20 2020  .append('>').   
+000095c0: 2020 2020 2072 6574 7572 6e20 2727 2e6a       return ''.j
+000095d0: 6f69 6e28 7265 7375 6c74 290a 0a20 2020  oin(result)..   
+000095e0: 2064 6566 2072 6561 646c 696e 6528 7365   def readline(se
+000095f0: 6c66 2c20 6c69 6d69 743d 2d31 293a 0a20  lf, limit=-1):. 
+00009600: 2020 2020 2020 2022 2222 5265 6164 2061         """Read a
+00009610: 6e64 2072 6574 7572 6e20 6120 6c69 6e65  nd return a line
+00009620: 2066 726f 6d20 7468 6520 7374 7265 616d   from the stream
+00009630: 2e0a 0a20 2020 2020 2020 2049 6620 6c69  ...        If li
+00009640: 6d69 7420 6973 2073 7065 6369 6669 6564  mit is specified
+00009650: 2c20 6174 206d 6f73 7420 6c69 6d69 7420  , at most limit 
+00009660: 6279 7465 7320 7769 6c6c 2062 6520 7265  bytes will be re
+00009670: 6164 2e0a 2020 2020 2020 2020 2222 220a  ad..        """.
+00009680: 0a20 2020 2020 2020 2069 6620 6c69 6d69  .        if limi
+00009690: 7420 3c20 303a 0a20 2020 2020 2020 2020  t < 0:.         
+000096a0: 2020 2023 2053 686f 7274 6375 7420 636f     # Shortcut co
+000096b0: 6d6d 6f6e 2063 6173 6520 2d20 6e65 776c  mmon case - newl
+000096c0: 696e 6520 666f 756e 6420 696e 2062 7566  ine found in buf
+000096d0: 6665 722e 0a20 2020 2020 2020 2020 2020  fer..           
+000096e0: 2069 203d 2073 656c 662e 5f72 6561 6462   i = self._readb
+000096f0: 7566 6665 722e 6669 6e64 2862 275c 6e27  uffer.find(b'\n'
+00009700: 2c20 7365 6c66 2e5f 6f66 6673 6574 2920  , self._offset) 
+00009710: 2b20 310a 2020 2020 2020 2020 2020 2020  + 1.            
+00009720: 6966 2069 203e 2030 3a0a 2020 2020 2020  if i > 0:.      
+00009730: 2020 2020 2020 2020 2020 6c69 6e65 203d            line =
+00009740: 2073 656c 662e 5f72 6561 6462 7566 6665   self._readbuffe
+00009750: 725b 7365 6c66 2e5f 6f66 6673 6574 3a20  r[self._offset: 
+00009760: 695d 0a20 2020 2020 2020 2020 2020 2020  i].             
+00009770: 2020 2073 656c 662e 5f6f 6666 7365 7420     self._offset 
+00009780: 3d20 690a 2020 2020 2020 2020 2020 2020  = i.            
+00009790: 2020 2020 7265 7475 726e 206c 696e 650a      return line.
+000097a0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000097b0: 696f 2e42 7566 6665 7265 6449 4f42 6173  io.BufferedIOBas
+000097c0: 652e 7265 6164 6c69 6e65 2873 656c 662c  e.readline(self,
+000097d0: 206c 696d 6974 290a 0a20 2020 2064 6566   limit)..    def
+000097e0: 2070 6565 6b28 7365 6c66 2c20 6e3d 3129   peek(self, n=1)
+000097f0: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
+00009800: 7572 6e73 2062 7566 6665 7265 6420 6279  urns buffered by
+00009810: 7465 7320 7769 7468 6f75 7420 6164 7661  tes without adva
+00009820: 6e63 696e 6720 7468 6520 706f 7369 7469  ncing the positi
+00009830: 6f6e 2e22 2222 0a20 2020 2020 2020 2069  on.""".        i
+00009840: 6620 6e20 3e20 6c65 6e28 7365 6c66 2e5f  f n > len(self._
+00009850: 7265 6164 6275 6666 6572 2920 2d20 7365  readbuffer) - se
+00009860: 6c66 2e5f 6f66 6673 6574 3a0a 2020 2020  lf._offset:.    
+00009870: 2020 2020 2020 2020 6368 756e 6b20 3d20          chunk = 
+00009880: 7365 6c66 2e72 6561 6428 6e29 0a20 2020  self.read(n).   
+00009890: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
+000098a0: 6368 756e 6b29 203e 2073 656c 662e 5f6f  chunk) > self._o
+000098b0: 6666 7365 743a 0a20 2020 2020 2020 2020  ffset:.         
+000098c0: 2020 2020 2020 2073 656c 662e 5f72 6561         self._rea
+000098d0: 6462 7566 6665 7220 3d20 6368 756e 6b20  dbuffer = chunk 
+000098e0: 2b20 7365 6c66 2e5f 7265 6164 6275 6666  + self._readbuff
+000098f0: 6572 5b73 656c 662e 5f6f 6666 7365 743a  er[self._offset:
+00009900: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00009910: 2020 7365 6c66 2e5f 6f66 6673 6574 203d    self._offset =
+00009920: 2030 0a20 2020 2020 2020 2020 2020 2065   0.            e
+00009930: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00009940: 2020 2020 2073 656c 662e 5f6f 6666 7365       self._offse
+00009950: 7420 2d3d 206c 656e 2863 6875 6e6b 290a  t -= len(chunk).
+00009960: 0a20 2020 2020 2020 2023 2052 6574 7572  .        # Retur
+00009970: 6e20 7570 2074 6f20 3531 3220 6279 7465  n up to 512 byte
+00009980: 7320 746f 2072 6564 7563 6520 616c 6c6f  s to reduce allo
+00009990: 6361 7469 6f6e 206f 7665 7268 6561 6420  cation overhead 
+000099a0: 666f 7220 7469 6768 7420 6c6f 6f70 732e  for tight loops.
+000099b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000099c0: 7365 6c66 2e5f 7265 6164 6275 6666 6572  self._readbuffer
+000099d0: 5b73 656c 662e 5f6f 6666 7365 743a 2073  [self._offset: s
+000099e0: 656c 662e 5f6f 6666 7365 7420 2b20 3531  elf._offset + 51
+000099f0: 325d 0a0a 2020 2020 6465 6620 7265 6164  2]..    def read
+00009a00: 6162 6c65 2873 656c 6629 3a0a 2020 2020  able(self):.    
+00009a10: 2020 2020 6966 2073 656c 662e 636c 6f73      if self.clos
+00009a20: 6564 3a0a 2020 2020 2020 2020 2020 2020  ed:.            
+00009a30: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+00009a40: 2822 492f 4f20 6f70 6572 6174 696f 6e20  ("I/O operation 
+00009a50: 6f6e 2063 6c6f 7365 6420 6669 6c65 2e22  on closed file."
+00009a60: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00009a70: 2054 7275 650a 0a20 2020 2064 6566 2072   True..    def r
+00009a80: 6561 6428 7365 6c66 2c20 6e3d 2d31 293a  ead(self, n=-1):
+00009a90: 0a20 2020 2020 2020 2022 2222 5265 6164  .        """Read
+00009aa0: 2061 6e64 2072 6574 7572 6e20 7570 2074   and return up t
+00009ab0: 6f20 6e20 6279 7465 732e 0a20 2020 2020  o n bytes..     
+00009ac0: 2020 2049 6620 7468 6520 6172 6775 6d65     If the argume
+00009ad0: 6e74 2069 7320 6f6d 6974 7465 642c 204e  nt is omitted, N
+00009ae0: 6f6e 652c 206f 7220 6e65 6761 7469 7665  one, or negative
+00009af0: 2c20 6461 7461 2069 7320 7265 6164 2061  , data is read a
+00009b00: 6e64 2072 6574 7572 6e65 6420 756e 7469  nd returned unti
+00009b10: 6c20 454f 4620 6973 2072 6561 6368 6564  l EOF is reached
+00009b20: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+00009b30: 2020 2020 2020 6966 2073 656c 662e 636c        if self.cl
+00009b40: 6f73 6564 3a0a 2020 2020 2020 2020 2020  osed:.          
+00009b50: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+00009b60: 6f72 2822 7265 6164 2066 726f 6d20 636c  or("read from cl
+00009b70: 6f73 6564 2066 696c 652e 2229 0a20 2020  osed file.").   
+00009b80: 2020 2020 2069 6620 6e20 6973 204e 6f6e       if n is Non
+00009b90: 6520 6f72 206e 203c 2030 3a0a 2020 2020  e or n < 0:.    
+00009ba0: 2020 2020 2020 2020 6275 6620 3d20 7365          buf = se
+00009bb0: 6c66 2e5f 7265 6164 6275 6666 6572 5b73  lf._readbuffer[s
+00009bc0: 656c 662e 5f6f 6666 7365 743a 5d0a 2020  elf._offset:].  
+00009bd0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00009be0: 7265 6164 6275 6666 6572 203d 2062 2727  readbuffer = b''
+00009bf0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00009c00: 662e 5f6f 6666 7365 7420 3d20 300a 2020  f._offset = 0.  
+00009c10: 2020 2020 2020 2020 2020 7768 696c 6520            while 
+00009c20: 6e6f 7420 7365 6c66 2e5f 656f 663a 0a20  not self._eof:. 
+00009c30: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+00009c40: 7566 202b 3d20 7365 6c66 2e5f 7265 6164  uf += self._read
+00009c50: 3128 7365 6c66 2e4d 4158 5f4e 290a 2020  1(self.MAX_N).  
+00009c60: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00009c70: 2062 7566 0a0a 2020 2020 2020 2020 656e   buf..        en
+00009c80: 6420 3d20 6e20 2b20 7365 6c66 2e5f 6f66  d = n + self._of
+00009c90: 6673 6574 0a20 2020 2020 2020 2069 6620  fset.        if 
+00009ca0: 656e 6420 3c20 6c65 6e28 7365 6c66 2e5f  end < len(self._
+00009cb0: 7265 6164 6275 6666 6572 293a 0a20 2020  readbuffer):.   
+00009cc0: 2020 2020 2020 2020 2062 7566 203d 2073           buf = s
+00009cd0: 656c 662e 5f72 6561 6462 7566 6665 725b  elf._readbuffer[
+00009ce0: 7365 6c66 2e5f 6f66 6673 6574 3a65 6e64  self._offset:end
+00009cf0: 5d0a 2020 2020 2020 2020 2020 2020 7365  ].            se
+00009d00: 6c66 2e5f 6f66 6673 6574 203d 2065 6e64  lf._offset = end
+00009d10: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00009d20: 7572 6e20 6275 660a 0a20 2020 2020 2020  urn buf..       
+00009d30: 206e 203d 2065 6e64 202d 206c 656e 2873   n = end - len(s
+00009d40: 656c 662e 5f72 6561 6462 7566 6665 7229  elf._readbuffer)
+00009d50: 0a20 2020 2020 2020 2062 7566 203d 2073  .        buf = s
+00009d60: 656c 662e 5f72 6561 6462 7566 6665 725b  elf._readbuffer[
+00009d70: 7365 6c66 2e5f 6f66 6673 6574 3a5d 0a20  self._offset:]. 
+00009d80: 2020 2020 2020 2073 656c 662e 5f72 6561         self._rea
+00009d90: 6462 7566 6665 7220 3d20 6227 270a 2020  dbuffer = b''.  
+00009da0: 2020 2020 2020 7365 6c66 2e5f 6f66 6673        self._offs
+00009db0: 6574 203d 2030 0a20 2020 2020 2020 2077  et = 0.        w
+00009dc0: 6869 6c65 206e 203e 2030 2061 6e64 206e  hile n > 0 and n
+00009dd0: 6f74 2073 656c 662e 5f65 6f66 3a0a 2020  ot self._eof:.  
+00009de0: 2020 2020 2020 2020 2020 6461 7461 203d            data =
+00009df0: 2073 656c 662e 5f72 6561 6431 286e 290a   self._read1(n).
+00009e00: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+00009e10: 203c 206c 656e 2864 6174 6129 3a0a 2020   < len(data):.  
+00009e20: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00009e30: 6c66 2e5f 7265 6164 6275 6666 6572 203d  lf._readbuffer =
+00009e40: 2064 6174 610a 2020 2020 2020 2020 2020   data.          
+00009e50: 2020 2020 2020 7365 6c66 2e5f 6f66 6673        self._offs
+00009e60: 6574 203d 206e 0a20 2020 2020 2020 2020  et = n.         
+00009e70: 2020 2020 2020 2062 7566 202b 3d20 6461         buf += da
+00009e80: 7461 5b3a 6e5d 0a20 2020 2020 2020 2020  ta[:n].         
+00009e90: 2020 2020 2020 2062 7265 616b 0a20 2020         break.   
+00009ea0: 2020 2020 2020 2020 2062 7566 202b 3d20           buf += 
+00009eb0: 6461 7461 0a20 2020 2020 2020 2020 2020  data.           
+00009ec0: 206e 202d 3d20 6c65 6e28 6461 7461 290a   n -= len(data).
+00009ed0: 2020 2020 2020 2020 7265 7475 726e 2062          return b
+00009ee0: 7566 0a0a 2020 2020 6465 6620 5f75 7064  uf..    def _upd
+00009ef0: 6174 655f 6372 6328 7365 6c66 2c20 6e65  ate_crc(self, ne
+00009f00: 7764 6174 6129 3a0a 2020 2020 2020 2020  wdata):.        
+00009f10: 2320 5570 6461 7465 2074 6865 2043 5243  # Update the CRC
+00009f20: 2075 7369 6e67 2074 6865 2067 6976 656e   using the given
+00009f30: 2064 6174 612e 0a20 2020 2020 2020 2069   data..        i
+00009f40: 6620 7365 6c66 2e5f 6578 7065 6374 6564  f self._expected
+00009f50: 5f63 7263 2069 7320 4e6f 6e65 3a0a 2020  _crc is None:.  
+00009f60: 2020 2020 2020 2020 2020 2320 4e6f 206e            # No n
+00009f70: 6565 6420 746f 2063 6f6d 7075 7465 2074  eed to compute t
+00009f80: 6865 2043 5243 2069 6620 7765 2064 6f6e  he CRC if we don
+00009f90: 2774 2068 6176 6520 6120 7265 6665 7265  't have a refere
+00009fa0: 6e63 6520 7661 6c75 650a 2020 2020 2020  nce value.      
+00009fb0: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
+00009fc0: 2020 2020 2073 656c 662e 5f72 756e 6e69       self._runni
+00009fd0: 6e67 5f63 7263 203d 2063 7263 3332 286e  ng_crc = crc32(n
+00009fe0: 6577 6461 7461 2c20 7365 6c66 2e5f 7275  ewdata, self._ru
+00009ff0: 6e6e 696e 675f 6372 6329 2026 2030 7866  nning_crc) & 0xf
+0000a000: 6666 6666 6666 660a 2020 2020 2020 2020  fffffff.        
+0000a010: 2320 4368 6563 6b20 7468 6520 4352 4320  # Check the CRC 
+0000a020: 6966 2077 6527 7265 2061 7420 7468 6520  if we're at the 
+0000a030: 656e 6420 6f66 2074 6865 2066 696c 650a  end of the file.
+0000a040: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0000a050: 5f65 6f66 2061 6e64 2073 656c 662e 5f72  _eof and self._r
+0000a060: 756e 6e69 6e67 5f63 7263 2021 3d20 7365  unning_crc != se
+0000a070: 6c66 2e5f 6578 7065 6374 6564 5f63 7263  lf._expected_crc
+0000a080: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+0000a090: 6973 6520 4261 645a 6970 4669 6c65 2822  ise BadZipFile("
+0000a0a0: 4261 6420 4352 432d 3332 2066 6f72 2066  Bad CRC-32 for f
+0000a0b0: 696c 6520 2572 2220 2520 7365 6c66 2e6e  ile %r" % self.n
+0000a0c0: 616d 6529 0a0a 2020 2020 6465 6620 7265  ame)..    def re
+0000a0d0: 6164 3128 7365 6c66 2c20 6e29 3a0a 2020  ad1(self, n):.  
+0000a0e0: 2020 2020 2020 2222 2252 6561 6420 7570        """Read up
+0000a0f0: 2074 6f20 6e20 6279 7465 7320 7769 7468   to n bytes with
+0000a100: 2061 7420 6d6f 7374 206f 6e65 2072 6561   at most one rea
+0000a110: 6428 2920 7379 7374 656d 2063 616c 6c2e  d() system call.
+0000a120: 2222 220a 0a20 2020 2020 2020 2069 6620  """..        if 
+0000a130: 6e20 6973 204e 6f6e 6520 6f72 206e 203c  n is None or n <
+0000a140: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+0000a150: 6275 6620 3d20 7365 6c66 2e5f 7265 6164  buf = self._read
+0000a160: 6275 6666 6572 5b73 656c 662e 5f6f 6666  buffer[self._off
+0000a170: 7365 743a 5d0a 2020 2020 2020 2020 2020  set:].          
+0000a180: 2020 7365 6c66 2e5f 7265 6164 6275 6666    self._readbuff
+0000a190: 6572 203d 2062 2727 0a20 2020 2020 2020  er = b''.       
+0000a1a0: 2020 2020 2073 656c 662e 5f6f 6666 7365       self._offse
+0000a1b0: 7420 3d20 300a 2020 2020 2020 2020 2020  t = 0.          
+0000a1c0: 2020 7768 696c 6520 6e6f 7420 7365 6c66    while not self
+0000a1d0: 2e5f 656f 663a 0a20 2020 2020 2020 2020  ._eof:.         
+0000a1e0: 2020 2020 2020 2064 6174 6120 3d20 7365         data = se
+0000a1f0: 6c66 2e5f 7265 6164 3128 7365 6c66 2e4d  lf._read1(self.M
+0000a200: 4158 5f4e 290a 2020 2020 2020 2020 2020  AX_N).          
+0000a210: 2020 2020 2020 6966 2064 6174 613a 0a20        if data:. 
+0000a220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a230: 2020 2062 7566 202b 3d20 6461 7461 0a20     buf += data. 
+0000a240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a250: 2020 2062 7265 616b 0a20 2020 2020 2020     break.       
+0000a260: 2020 2020 2072 6574 7572 6e20 6275 660a       return buf.
+0000a270: 0a20 2020 2020 2020 2065 6e64 203d 206e  .        end = n
+0000a280: 202b 2073 656c 662e 5f6f 6666 7365 740a   + self._offset.
+0000a290: 2020 2020 2020 2020 6966 2065 6e64 203c          if end <
+0000a2a0: 206c 656e 2873 656c 662e 5f72 6561 6462   len(self._readb
+0000a2b0: 7566 6665 7229 3a0a 2020 2020 2020 2020  uffer):.        
+0000a2c0: 2020 2020 6275 6620 3d20 7365 6c66 2e5f      buf = self._
+0000a2d0: 7265 6164 6275 6666 6572 5b73 656c 662e  readbuffer[self.
+0000a2e0: 5f6f 6666 7365 743a 656e 645d 0a20 2020  _offset:end].   
+0000a2f0: 2020 2020 2020 2020 2073 656c 662e 5f6f           self._o
+0000a300: 6666 7365 7420 3d20 656e 640a 2020 2020  ffset = end.    
+0000a310: 2020 2020 2020 2020 7265 7475 726e 2062          return b
+0000a320: 7566 0a0a 2020 2020 2020 2020 6e20 3d20  uf..        n = 
+0000a330: 656e 6420 2d20 6c65 6e28 7365 6c66 2e5f  end - len(self._
+0000a340: 7265 6164 6275 6666 6572 290a 2020 2020  readbuffer).    
+0000a350: 2020 2020 6275 6620 3d20 7365 6c66 2e5f      buf = self._
+0000a360: 7265 6164 6275 6666 6572 5b73 656c 662e  readbuffer[self.
+0000a370: 5f6f 6666 7365 743a 5d0a 2020 2020 2020  _offset:].      
+0000a380: 2020 7365 6c66 2e5f 7265 6164 6275 6666    self._readbuff
+0000a390: 6572 203d 2062 2727 0a20 2020 2020 2020  er = b''.       
+0000a3a0: 2073 656c 662e 5f6f 6666 7365 7420 3d20   self._offset = 
+0000a3b0: 300a 2020 2020 2020 2020 6966 206e 203e  0.        if n >
+0000a3c0: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+0000a3d0: 7768 696c 6520 6e6f 7420 7365 6c66 2e5f  while not self._
+0000a3e0: 656f 663a 0a20 2020 2020 2020 2020 2020  eof:.           
+0000a3f0: 2020 2020 2064 6174 6120 3d20 7365 6c66       data = self
+0000a400: 2e5f 7265 6164 3128 6e29 0a20 2020 2020  ._read1(n).     
+0000a410: 2020 2020 2020 2020 2020 2069 6620 6e20             if n 
+0000a420: 3c20 6c65 6e28 6461 7461 293a 0a20 2020  < len(data):.   
+0000a430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a440: 2073 656c 662e 5f72 6561 6462 7566 6665   self._readbuffe
+0000a450: 7220 3d20 6461 7461 0a20 2020 2020 2020  r = data.       
+0000a460: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0000a470: 662e 5f6f 6666 7365 7420 3d20 6e0a 2020  f._offset = n.  
+0000a480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a490: 2020 6275 6620 2b3d 2064 6174 615b 3a6e    buf += data[:n
+0000a4a0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0000a4b0: 2020 2020 2020 6272 6561 6b0a 2020 2020        break.    
+0000a4c0: 2020 2020 2020 2020 2020 2020 6966 2064              if d
+0000a4d0: 6174 613a 0a20 2020 2020 2020 2020 2020  ata:.           
+0000a4e0: 2020 2020 2020 2020 2062 7566 202b 3d20           buf += 
+0000a4f0: 6461 7461 0a20 2020 2020 2020 2020 2020  data.           
+0000a500: 2020 2020 2020 2020 2062 7265 616b 0a20           break. 
+0000a510: 2020 2020 2020 2072 6574 7572 6e20 6275         return bu
+0000a520: 660a 0a20 2020 2064 6566 205f 7265 6164  f..    def _read
+0000a530: 3128 7365 6c66 2c20 6e29 3a0a 2020 2020  1(self, n):.    
+0000a540: 2020 2020 2320 5265 6164 2075 7020 746f      # Read up to
+0000a550: 206e 2063 6f6d 7072 6573 7365 6420 6279   n compressed by
+0000a560: 7465 7320 7769 7468 2061 7420 6d6f 7374  tes with at most
+0000a570: 206f 6e65 2072 6561 6428 2920 7379 7374   one read() syst
+0000a580: 656d 2063 616c 6c2c 0a20 2020 2020 2020  em call,.       
+0000a590: 2023 2064 6563 7279 7074 2061 6e64 2064   # decrypt and d
+0000a5a0: 6563 6f6d 7072 6573 7320 7468 656d 2e0a  ecompress them..
+0000a5b0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0000a5c0: 5f65 6f66 206f 7220 6e20 3c3d 2030 3a0a  _eof or n <= 0:.
+0000a5d0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000a5e0: 726e 2062 2727 0a0a 2020 2020 2020 2020  rn b''..        
+0000a5f0: 2320 5265 6164 2066 726f 6d20 6669 6c65  # Read from file
+0000a600: 2e0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+0000a610: 662e 5f63 6f6d 7072 6573 735f 7479 7065  f._compress_type
+0000a620: 203d 3d20 5a49 505f 4445 464c 4154 4544   == ZIP_DEFLATED
+0000a630: 3a0a 2020 2020 2020 2020 2020 2020 2323  :.            ##
+0000a640: 2048 616e 646c 6520 756e 636f 6e73 756d   Handle unconsum
+0000a650: 6564 2064 6174 612e 0a20 2020 2020 2020  ed data..       
+0000a660: 2020 2020 2064 6174 6120 3d20 7365 6c66       data = self
+0000a670: 2e5f 6465 636f 6d70 7265 7373 6f72 2e75  ._decompressor.u
+0000a680: 6e63 6f6e 7375 6d65 645f 7461 696c 0a20  nconsumed_tail. 
+0000a690: 2020 2020 2020 2020 2020 2069 6620 6e20             if n 
+0000a6a0: 3e20 6c65 6e28 6461 7461 293a 0a20 2020  > len(data):.   
+0000a6b0: 2020 2020 2020 2020 2020 2020 2064 6174               dat
+0000a6c0: 6120 2b3d 2073 656c 662e 5f72 6561 6432  a += self._read2
+0000a6d0: 286e 202d 206c 656e 2864 6174 6129 290a  (n - len(data)).
+0000a6e0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0000a6f0: 2020 2020 2020 2020 2020 6461 7461 203d            data =
+0000a700: 2073 656c 662e 5f72 6561 6432 286e 290a   self._read2(n).
+0000a710: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+0000a720: 2e5f 636f 6d70 7265 7373 5f74 7970 6520  ._compress_type 
+0000a730: 3d3d 205a 4950 5f53 544f 5245 443a 0a20  == ZIP_STORED:. 
+0000a740: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000a750: 5f65 6f66 203d 2073 656c 662e 5f63 6f6d  _eof = self._com
+0000a760: 7072 6573 735f 6c65 6674 203c 3d20 300a  press_left <= 0.
+0000a770: 2020 2020 2020 2020 656c 6966 2073 656c          elif sel
+0000a780: 662e 5f63 6f6d 7072 6573 735f 7479 7065  f._compress_type
+0000a790: 203d 3d20 5a49 505f 4445 464c 4154 4544   == ZIP_DEFLATED
+0000a7a0: 3a0a 2020 2020 2020 2020 2020 2020 6e20  :.            n 
+0000a7b0: 3d20 6d61 7828 6e2c 2073 656c 662e 4d49  = max(n, self.MI
+0000a7c0: 4e5f 5245 4144 5f53 495a 4529 0a20 2020  N_READ_SIZE).   
+0000a7d0: 2020 2020 2020 2020 2064 6174 6120 3d20           data = 
+0000a7e0: 7365 6c66 2e5f 6465 636f 6d70 7265 7373  self._decompress
+0000a7f0: 6f72 2e64 6563 6f6d 7072 6573 7328 6461  or.decompress(da
+0000a800: 7461 2c20 6e29 0a20 2020 2020 2020 2020  ta, n).         
+0000a810: 2020 2073 656c 662e 5f65 6f66 203d 2028     self._eof = (
+0000a820: 6765 7461 7474 7228 7365 6c66 2e5f 6465  getattr(self._de
+0000a830: 636f 6d70 7265 7373 6f72 2c20 2765 6f66  compressor, 'eof
+0000a840: 272c 2046 616c 7365 2920 6f72 0a20 2020  ', False) or.   
+0000a850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a860: 2020 2020 2020 7365 6c66 2e5f 636f 6d70        self._comp
+0000a870: 7265 7373 5f6c 6566 7420 3c3d 2030 2061  ress_left <= 0 a
+0000a880: 6e64 0a20 2020 2020 2020 2020 2020 2020  nd.             
+0000a890: 2020 2020 2020 2020 2020 2020 6e6f 7420              not 
+0000a8a0: 7365 6c66 2e5f 6465 636f 6d70 7265 7373  self._decompress
+0000a8b0: 6f72 2e75 6e63 6f6e 7375 6d65 645f 7461  or.unconsumed_ta
+0000a8c0: 696c 290a 2020 2020 2020 2020 2020 2020  il).            
+0000a8d0: 6966 2073 656c 662e 5f65 6f66 3a0a 2020  if self._eof:.  
+0000a8e0: 2020 2020 2020 2020 2020 2020 2020 6461                da
+0000a8f0: 7461 202b 3d20 7365 6c66 2e5f 6465 636f  ta += self._deco
+0000a900: 6d70 7265 7373 6f72 2e66 6c75 7368 2829  mpressor.flush()
+0000a910: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+0000a920: 2020 2020 2020 2020 2020 2064 6174 6120             data 
+0000a930: 3d20 7365 6c66 2e5f 6465 636f 6d70 7265  = self._decompre
+0000a940: 7373 6f72 2e64 6563 6f6d 7072 6573 7328  ssor.decompress(
+0000a950: 6461 7461 290a 2020 2020 2020 2020 2020  data).          
+0000a960: 2020 7365 6c66 2e5f 656f 6620 3d20 6765    self._eof = ge
+0000a970: 7461 7474 7228 7365 6c66 2e5f 6465 636f  tattr(self._deco
+0000a980: 6d70 7265 7373 6f72 2c20 2765 6f66 272c  mpressor, 'eof',
+0000a990: 2046 616c 7365 2920 6f72 2073 656c 662e   False) or self.
+0000a9a0: 5f63 6f6d 7072 6573 735f 6c65 6674 203c  _compress_left <
+0000a9b0: 3d20 300a 0a20 2020 2020 2020 2064 6174  = 0..        dat
+0000a9c0: 6120 3d20 6461 7461 5b3a 7365 6c66 2e5f  a = data[:self._
+0000a9d0: 6c65 6674 5d0a 2020 2020 2020 2020 7365  left].        se
+0000a9e0: 6c66 2e5f 6c65 6674 202d 3d20 6c65 6e28  lf._left -= len(
+0000a9f0: 6461 7461 290a 2020 2020 2020 2020 6966  data).        if
+0000aa00: 2073 656c 662e 5f6c 6566 7420 3c3d 2030   self._left <= 0
+0000aa10: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+0000aa20: 6c66 2e5f 656f 6620 3d20 5472 7565 0a20  lf._eof = True. 
+0000aa30: 2020 2020 2020 2073 656c 662e 5f75 7064         self._upd
+0000aa40: 6174 655f 6372 6328 6461 7461 290a 2020  ate_crc(data).  
+0000aa50: 2020 2020 2020 7265 7475 726e 2064 6174        return dat
+0000aa60: 610a 0a20 2020 2064 6566 205f 7265 6164  a..    def _read
+0000aa70: 3228 7365 6c66 2c20 6e29 3a0a 2020 2020  2(self, n):.    
+0000aa80: 2020 2020 6966 2073 656c 662e 5f63 6f6d      if self._com
+0000aa90: 7072 6573 735f 6c65 6674 203c 3d20 303a  press_left <= 0:
+0000aaa0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0000aab0: 7572 6e20 6227 270a 0a20 2020 2020 2020  urn b''..       
+0000aac0: 206e 203d 206d 6178 286e 2c20 7365 6c66   n = max(n, self
+0000aad0: 2e4d 494e 5f52 4541 445f 5349 5a45 290a  .MIN_READ_SIZE).
+0000aae0: 2020 2020 2020 2020 6e20 3d20 6d69 6e28          n = min(
+0000aaf0: 6e2c 2073 656c 662e 5f63 6f6d 7072 6573  n, self._compres
+0000ab00: 735f 6c65 6674 290a 0a20 2020 2020 2020  s_left)..       
+0000ab10: 2064 6174 6120 3d20 7365 6c66 2e5f 6669   data = self._fi
+0000ab20: 6c65 6f62 6a2e 7265 6164 286e 290a 2020  leobj.read(n).  
+0000ab30: 2020 2020 2020 7365 6c66 2e5f 636f 6d70        self._comp
+0000ab40: 7265 7373 5f6c 6566 7420 2d3d 206c 656e  ress_left -= len
+0000ab50: 2864 6174 6129 0a20 2020 2020 2020 2069  (data).        i
+0000ab60: 6620 6e6f 7420 6461 7461 3a0a 2020 2020  f not data:.    
+0000ab70: 2020 2020 2020 2020 7261 6973 6520 454f          raise EO
+0000ab80: 4645 7272 6f72 0a0a 2020 2020 2020 2020  FError..        
+0000ab90: 6966 2073 656c 662e 5f64 6563 7279 7074  if self._decrypt
+0000aba0: 6572 2069 7320 6e6f 7420 4e6f 6e65 3a0a  er is not None:.
+0000abb0: 2020 2020 2020 2020 2020 2020 6461 7461              data
+0000abc0: 203d 2073 656c 662e 5f64 6563 7279 7074   = self._decrypt
+0000abd0: 6572 2864 6174 6129 0a20 2020 2020 2020  er(data).       
+0000abe0: 2072 6574 7572 6e20 6461 7461 0a0a 2020   return data..  
+0000abf0: 2020 6465 6620 636c 6f73 6528 7365 6c66    def close(self
+0000ac00: 293a 0a20 2020 2020 2020 2074 7279 3a0a  ):.        try:.
+0000ac10: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+0000ac20: 656c 662e 5f63 6c6f 7365 5f66 696c 656f  elf._close_fileo
+0000ac30: 626a 3a0a 2020 2020 2020 2020 2020 2020  bj:.            
+0000ac40: 2020 2020 7365 6c66 2e5f 6669 6c65 6f62      self._fileob
+0000ac50: 6a2e 636c 6f73 6528 290a 2020 2020 2020  j.close().      
+0000ac60: 2020 6669 6e61 6c6c 793a 0a20 2020 2020    finally:.     
+0000ac70: 2020 2020 2020 2073 7570 6572 285a 6970         super(Zip
+0000ac80: 4578 7446 696c 652c 2073 656c 6629 2e63  ExtFile, self).c
+0000ac90: 6c6f 7365 2829 0a0a 2020 2020 6465 6620  lose()..    def 
+0000aca0: 7365 656b 6162 6c65 2873 656c 6629 3a0a  seekable(self):.
+0000acb0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0000acc0: 636c 6f73 6564 3a0a 2020 2020 2020 2020  closed:.        
+0000acd0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+0000ace0: 7272 6f72 2822 492f 4f20 6f70 6572 6174  rror("I/O operat
+0000acf0: 696f 6e20 6f6e 2063 6c6f 7365 6420 6669  ion on closed fi
+0000ad00: 6c65 2e22 290a 2020 2020 2020 2020 7265  le.").        re
+0000ad10: 7475 726e 2073 656c 662e 5f73 6565 6b61  turn self._seeka
+0000ad20: 626c 650a 0a20 2020 2064 6566 2073 6565  ble..    def see
+0000ad30: 6b28 7365 6c66 2c20 6f66 6673 6574 2c20  k(self, offset, 
+0000ad40: 7768 656e 6365 3d30 293a 0a20 2020 2020  whence=0):.     
+0000ad50: 2020 2069 6620 7365 6c66 2e63 6c6f 7365     if self.close
+0000ad60: 643a 0a20 2020 2020 2020 2020 2020 2072  d:.            r
+0000ad70: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+0000ad80: 2273 6565 6b20 6f6e 2063 6c6f 7365 6420  "seek on closed 
+0000ad90: 6669 6c65 2e22 290a 2020 2020 2020 2020  file.").        
+0000ada0: 6966 206e 6f74 2073 656c 662e 5f73 6565  if not self._see
+0000adb0: 6b61 626c 653a 0a20 2020 2020 2020 2020  kable:.         
+0000adc0: 2020 2072 6169 7365 2069 6f2e 556e 7375     raise io.Unsu
+0000add0: 7070 6f72 7465 644f 7065 7261 7469 6f6e  pportedOperation
+0000ade0: 2822 756e 6465 726c 7969 6e67 2073 7472  ("underlying str
+0000adf0: 6561 6d20 6973 206e 6f74 2073 6565 6b61  eam is not seeka
+0000ae00: 626c 6522 290a 2020 2020 2020 2020 6375  ble").        cu
+0000ae10: 7272 5f70 6f73 203d 2073 656c 662e 7465  rr_pos = self.te
+0000ae20: 6c6c 2829 0a20 2020 2020 2020 2069 6620  ll().        if 
+0000ae30: 7768 656e 6365 203d 3d20 303a 2023 2053  whence == 0: # S
+0000ae40: 6565 6b20 6672 6f6d 2073 7461 7274 206f  eek from start o
+0000ae50: 6620 6669 6c65 0a20 2020 2020 2020 2020  f file.         
+0000ae60: 2020 206e 6577 5f70 6f73 203d 206f 6666     new_pos = off
+0000ae70: 7365 740a 2020 2020 2020 2020 656c 6966  set.        elif
+0000ae80: 2077 6865 6e63 6520 3d3d 2031 3a20 2320   whence == 1: # 
+0000ae90: 5365 656b 2066 726f 6d20 6375 7272 656e  Seek from curren
+0000aea0: 7420 706f 7369 7469 6f6e 0a20 2020 2020  t position.     
+0000aeb0: 2020 2020 2020 206e 6577 5f70 6f73 203d         new_pos =
+0000aec0: 2063 7572 725f 706f 7320 2b20 6f66 6673   curr_pos + offs
+0000aed0: 6574 0a20 2020 2020 2020 2065 6c69 6620  et.        elif 
+0000aee0: 7768 656e 6365 203d 3d20 323a 2023 2053  whence == 2: # S
+0000aef0: 6565 6b20 6672 6f6d 2045 4f46 0a20 2020  eek from EOF.   
+0000af00: 2020 2020 2020 2020 206e 6577 5f70 6f73           new_pos
+0000af10: 203d 2073 656c 662e 5f6f 7269 675f 6669   = self._orig_fi
+0000af20: 6c65 5f73 697a 6520 2b20 6f66 6673 6574  le_size + offset
+0000af30: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+0000af40: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0000af50: 2056 616c 7565 4572 726f 7228 2277 6865   ValueError("whe
+0000af60: 6e63 6520 6d75 7374 2062 6520 6f73 2e53  nce must be os.S
+0000af70: 4545 4b5f 5345 5420 2830 292c 2022 0a20  EEK_SET (0), ". 
+0000af80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000af90: 2020 2020 2020 2020 2020 2020 226f 732e              "os.
+0000afa0: 5345 454b 5f43 5552 2028 3129 2c20 6f72  SEEK_CUR (1), or
+0000afb0: 206f 732e 5345 454b 5f45 4e44 2028 3229   os.SEEK_END (2)
+0000afc0: 2229 0a0a 2020 2020 2020 2020 6966 206e  ")..        if n
+0000afd0: 6577 5f70 6f73 203e 2073 656c 662e 5f6f  ew_pos > self._o
+0000afe0: 7269 675f 6669 6c65 5f73 697a 653a 0a20  rig_file_size:. 
+0000aff0: 2020 2020 2020 2020 2020 206e 6577 5f70             new_p
+0000b000: 6f73 203d 2073 656c 662e 5f6f 7269 675f  os = self._orig_
+0000b010: 6669 6c65 5f73 697a 650a 0a20 2020 2020  file_size..     
+0000b020: 2020 2069 6620 6e65 775f 706f 7320 3c20     if new_pos < 
+0000b030: 303a 0a20 2020 2020 2020 2020 2020 206e  0:.            n
+0000b040: 6577 5f70 6f73 203d 2030 0a0a 2020 2020  ew_pos = 0..    
+0000b050: 2020 2020 7265 6164 5f6f 6666 7365 7420      read_offset 
+0000b060: 3d20 6e65 775f 706f 7320 2d20 6375 7272  = new_pos - curr
+0000b070: 5f70 6f73 0a20 2020 2020 2020 2062 7566  _pos.        buf
+0000b080: 665f 6f66 6673 6574 203d 2072 6561 645f  f_offset = read_
+0000b090: 6f66 6673 6574 202b 2073 656c 662e 5f6f  offset + self._o
+0000b0a0: 6666 7365 740a 0a20 2020 2020 2020 2069  ffset..        i
+0000b0b0: 6620 6275 6666 5f6f 6666 7365 7420 3e3d  f buff_offset >=
+0000b0c0: 2030 2061 6e64 2062 7566 665f 6f66 6673   0 and buff_offs
+0000b0d0: 6574 203c 206c 656e 2873 656c 662e 5f72  et < len(self._r
+0000b0e0: 6561 6462 7566 6665 7229 3a0a 2020 2020  eadbuffer):.    
+0000b0f0: 2020 2020 2020 2020 2320 4a75 7374 206d          # Just m
+0000b100: 6f76 6520 7468 6520 5f6f 6666 7365 7420  ove the _offset 
+0000b110: 696e 6465 7820 6966 2074 6865 206e 6577  index if the new
+0000b120: 2070 6f73 6974 696f 6e20 6973 2069 6e20   position is in 
+0000b130: 7468 6520 5f72 6561 6462 7566 6665 720a  the _readbuffer.
+0000b140: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000b150: 2e5f 6f66 6673 6574 203d 2062 7566 665f  ._offset = buff_
+0000b160: 6f66 6673 6574 0a20 2020 2020 2020 2020  offset.         
+0000b170: 2020 2072 6561 645f 6f66 6673 6574 203d     read_offset =
+0000b180: 2030 0a20 2020 2020 2020 2065 6c69 6620   0.        elif 
+0000b190: 7265 6164 5f6f 6666 7365 7420 3c20 303a  read_offset < 0:
+0000b1a0: 0a20 2020 2020 2020 2020 2020 2023 2050  .            # P
+0000b1b0: 6f73 6974 696f 6e20 6973 2062 6566 6f72  osition is befor
+0000b1c0: 6520 7468 6520 6375 7272 656e 7420 706f  e the current po
+0000b1d0: 7369 7469 6f6e 2e20 5265 7365 7420 7468  sition. Reset th
+0000b1e0: 6520 5a69 7045 7874 4669 6c65 0a20 2020  e ZipExtFile.   
+0000b1f0: 2020 2020 2020 2020 2073 656c 662e 5f66           self._f
+0000b200: 696c 656f 626a 2e73 6565 6b28 7365 6c66  ileobj.seek(self
+0000b210: 2e5f 6f72 6967 5f63 6f6d 7072 6573 735f  ._orig_compress_
+0000b220: 7374 6172 7429 0a20 2020 2020 2020 2020  start).         
+0000b230: 2020 2073 656c 662e 5f72 756e 6e69 6e67     self._running
+0000b240: 5f63 7263 203d 2073 656c 662e 5f6f 7269  _crc = self._ori
+0000b250: 675f 7374 6172 745f 6372 630a 2020 2020  g_start_crc.    
+0000b260: 2020 2020 2020 2020 7365 6c66 2e5f 636f          self._co
+0000b270: 6d70 7265 7373 5f6c 6566 7420 3d20 7365  mpress_left = se
+0000b280: 6c66 2e5f 6f72 6967 5f63 6f6d 7072 6573  lf._orig_compres
+0000b290: 735f 7369 7a65 0a20 2020 2020 2020 2020  s_size.         
+0000b2a0: 2020 2073 656c 662e 5f6c 6566 7420 3d20     self._left = 
+0000b2b0: 7365 6c66 2e5f 6f72 6967 5f66 696c 655f  self._orig_file_
+0000b2c0: 7369 7a65 0a20 2020 2020 2020 2020 2020  size.           
+0000b2d0: 2073 656c 662e 5f72 6561 6462 7566 6665   self._readbuffe
+0000b2e0: 7220 3d20 6227 270a 2020 2020 2020 2020  r = b''.        
+0000b2f0: 2020 2020 7365 6c66 2e5f 6f66 6673 6574      self._offset
+0000b300: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
+0000b310: 2073 656c 662e 5f64 6563 6f6d 7072 6573   self._decompres
+0000b320: 736f 7220 3d20 5f67 6574 5f64 6563 6f6d  sor = _get_decom
+0000b330: 7072 6573 736f 7228 7365 6c66 2e5f 636f  pressor(self._co
+0000b340: 6d70 7265 7373 5f74 7970 6529 0a20 2020  mpress_type).   
+0000b350: 2020 2020 2020 2020 2073 656c 662e 5f65           self._e
+0000b360: 6f66 203d 2046 616c 7365 0a20 2020 2020  of = False.     
+0000b370: 2020 2020 2020 2072 6561 645f 6f66 6673         read_offs
+0000b380: 6574 203d 206e 6577 5f70 6f73 0a20 2020  et = new_pos.   
+0000b390: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+0000b3a0: 2e5f 6465 6372 7970 7465 7220 6973 206e  ._decrypter is n
+0000b3b0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+0000b3c0: 2020 2020 2020 2020 2073 656c 662e 5f69           self._i
+0000b3d0: 6e69 745f 6465 6372 7970 7465 7228 290a  nit_decrypter().
+0000b3e0: 0a20 2020 2020 2020 2077 6869 6c65 2072  .        while r
+0000b3f0: 6561 645f 6f66 6673 6574 203e 2030 3a0a  ead_offset > 0:.
+0000b400: 2020 2020 2020 2020 2020 2020 7265 6164              read
+0000b410: 5f6c 656e 203d 206d 696e 2873 656c 662e  _len = min(self.
+0000b420: 4d41 585f 5345 454b 5f52 4541 442c 2072  MAX_SEEK_READ, r
+0000b430: 6561 645f 6f66 6673 6574 290a 2020 2020  ead_offset).    
+0000b440: 2020 2020 2020 2020 7365 6c66 2e72 6561          self.rea
+0000b450: 6428 7265 6164 5f6c 656e 290a 2020 2020  d(read_len).    
+0000b460: 2020 2020 2020 2020 7265 6164 5f6f 6666          read_off
+0000b470: 7365 7420 2d3d 2072 6561 645f 6c65 6e0a  set -= read_len.
+0000b480: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000b490: 7365 6c66 2e74 656c 6c28 290a 0a20 2020  self.tell()..   
+0000b4a0: 2064 6566 2074 656c 6c28 7365 6c66 293a   def tell(self):
+0000b4b0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+0000b4c0: 2e63 6c6f 7365 643a 0a20 2020 2020 2020  .closed:.       
+0000b4d0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+0000b4e0: 4572 726f 7228 2274 656c 6c20 6f6e 2063  Error("tell on c
+0000b4f0: 6c6f 7365 6420 6669 6c65 2e22 290a 2020  losed file.").  
+0000b500: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
+0000b510: 662e 5f73 6565 6b61 626c 653a 0a20 2020  f._seekable:.   
+0000b520: 2020 2020 2020 2020 2072 6169 7365 2069           raise i
+0000b530: 6f2e 556e 7375 7070 6f72 7465 644f 7065  o.UnsupportedOpe
+0000b540: 7261 7469 6f6e 2822 756e 6465 726c 7969  ration("underlyi
+0000b550: 6e67 2073 7472 6561 6d20 6973 206e 6f74  ng stream is not
+0000b560: 2073 6565 6b61 626c 6522 290a 2020 2020   seekable").    
+0000b570: 2020 2020 6669 6c65 706f 7320 3d20 7365      filepos = se
+0000b580: 6c66 2e5f 6f72 6967 5f66 696c 655f 7369  lf._orig_file_si
+0000b590: 7a65 202d 2073 656c 662e 5f6c 6566 7420  ze - self._left 
+0000b5a0: 2d20 6c65 6e28 7365 6c66 2e5f 7265 6164  - len(self._read
+0000b5b0: 6275 6666 6572 2920 2b20 7365 6c66 2e5f  buffer) + self._
+0000b5c0: 6f66 6673 6574 0a20 2020 2020 2020 2072  offset.        r
+0000b5d0: 6574 7572 6e20 6669 6c65 706f 730a 0a0a  eturn filepos...
+0000b5e0: 636c 6173 7320 5f5a 6970 5772 6974 6546  class _ZipWriteF
+0000b5f0: 696c 6528 696f 2e42 7566 6665 7265 6449  ile(io.BufferedI
+0000b600: 4f42 6173 6529 3a0a 2020 2020 6465 6620  OBase):.    def 
+0000b610: 5f5f 696e 6974 5f5f 2873 656c 662c 207a  __init__(self, z
+0000b620: 662c 207a 696e 666f 2c20 7a69 7036 3429  f, zinfo, zip64)
+0000b630: 3a0a 2020 2020 2020 2020 7365 6c66 2e5f  :.        self._
+0000b640: 7a69 6e66 6f20 3d20 7a69 6e66 6f0a 2020  zinfo = zinfo.  
+0000b650: 2020 2020 2020 7365 6c66 2e5f 7a69 7036        self._zip6
+0000b660: 3420 3d20 7a69 7036 340a 2020 2020 2020  4 = zip64.      
+0000b670: 2020 7365 6c66 2e5f 7a69 7066 696c 6520    self._zipfile 
+0000b680: 3d20 7a66 0a20 2020 2020 2020 2073 656c  = zf.        sel
+0000b690: 662e 5f63 6f6d 7072 6573 736f 7220 3d20  f._compressor = 
+0000b6a0: 5f67 6574 5f63 6f6d 7072 6573 736f 7228  _get_compressor(
+0000b6b0: 7a69 6e66 6f2e 636f 6d70 7265 7373 5f74  zinfo.compress_t
+0000b6c0: 7970 652c 0a20 2020 2020 2020 2020 2020  ype,.           
+0000b6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b6f0: 7a69 6e66 6f2e 5f63 6f6d 7072 6573 736c  zinfo._compressl
+0000b700: 6576 656c 290a 2020 2020 2020 2020 7365  evel).        se
+0000b710: 6c66 2e5f 6669 6c65 5f73 697a 6520 3d20  lf._file_size = 
+0000b720: 300a 2020 2020 2020 2020 7365 6c66 2e5f  0.        self._
+0000b730: 636f 6d70 7265 7373 5f73 697a 6520 3d20  compress_size = 
+0000b740: 300a 2020 2020 2020 2020 7365 6c66 2e5f  0.        self._
+0000b750: 6372 6320 3d20 300a 0a20 2020 2040 7072  crc = 0..    @pr
+0000b760: 6f70 6572 7479 0a20 2020 2064 6566 205f  operty.    def _
+0000b770: 6669 6c65 6f62 6a28 7365 6c66 293a 0a20  fileobj(self):. 
+0000b780: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0000b790: 6c66 2e5f 7a69 7066 696c 652e 6670 0a0a  lf._zipfile.fp..
+0000b7a0: 2020 2020 6465 6620 7772 6974 6162 6c65      def writable
+0000b7b0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+0000b7c0: 7265 7475 726e 2054 7275 650a 0a20 2020  return True..   
+0000b7d0: 2064 6566 2077 7269 7465 2873 656c 662c   def write(self,
+0000b7e0: 2064 6174 6129 3a0a 2020 2020 2020 2020   data):.        
+0000b7f0: 6966 2073 656c 662e 636c 6f73 6564 3a0a  if self.closed:.
+0000b800: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0000b810: 6520 5661 6c75 6545 7272 6f72 2827 492f  e ValueError('I/
+0000b820: 4f20 6f70 6572 6174 696f 6e20 6f6e 2063  O operation on c
+0000b830: 6c6f 7365 6420 6669 6c65 2e27 290a 2020  losed file.').  
+0000b840: 2020 2020 2020 6e62 7974 6573 203d 206c        nbytes = l
+0000b850: 656e 2864 6174 6129 0a20 2020 2020 2020  en(data).       
+0000b860: 2073 656c 662e 5f66 696c 655f 7369 7a65   self._file_size
+0000b870: 202b 3d20 6e62 7974 6573 0a20 2020 2020   += nbytes.     
+0000b880: 2020 2073 656c 662e 5f63 7263 203d 2063     self._crc = c
+0000b890: 7263 3332 2864 6174 612c 2073 656c 662e  rc32(data, self.
+0000b8a0: 5f63 7263 2920 2620 3078 6666 6666 6666  _crc) & 0xffffff
+0000b8b0: 6666 0a20 2020 2020 2020 2069 6620 7365  ff.        if se
+0000b8c0: 6c66 2e5f 636f 6d70 7265 7373 6f72 3a0a  lf._compressor:.
+0000b8d0: 2020 2020 2020 2020 2020 2020 6461 7461              data
+0000b8e0: 203d 2073 656c 662e 5f63 6f6d 7072 6573   = self._compres
+0000b8f0: 736f 722e 636f 6d70 7265 7373 2864 6174  sor.compress(dat
+0000b900: 6129 0a20 2020 2020 2020 2020 2020 2073  a).            s
+0000b910: 656c 662e 5f63 6f6d 7072 6573 735f 7369  elf._compress_si
+0000b920: 7a65 202b 3d20 6c65 6e28 6461 7461 290a  ze += len(data).
+0000b930: 2020 2020 2020 2020 7365 6c66 2e5f 6669          self._fi
+0000b940: 6c65 6f62 6a2e 7772 6974 6528 6461 7461  leobj.write(data
+0000b950: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+0000b960: 206e 6279 7465 730a 0a20 2020 2064 6566   nbytes..    def
+0000b970: 2063 6c6f 7365 2873 656c 6629 3a0a 2020   close(self):.  
+0000b980: 2020 2020 2020 6966 2073 656c 662e 636c        if self.cl
+0000b990: 6f73 6564 3a0a 2020 2020 2020 2020 2020  osed:.          
+0000b9a0: 2020 7265 7475 726e 0a20 2020 2020 2020    return.       
+0000b9b0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+0000b9c0: 2020 7375 7065 7228 5f5a 6970 5772 6974    super(_ZipWrit
+0000b9d0: 6546 696c 652c 2073 656c 6629 2e63 6c6f  eFile, self).clo
+0000b9e0: 7365 2829 0a20 2020 2020 2020 2020 2020  se().           
+0000b9f0: 2023 2046 6c75 7368 2061 6e79 2064 6174   # Flush any dat
+0000ba00: 6120 6672 6f6d 2074 6865 2063 6f6d 7072  a from the compr
+0000ba10: 6573 736f 722c 2061 6e64 2075 7064 6174  essor, and updat
+0000ba20: 6520 6865 6164 6572 2069 6e66 6f0a 2020  e header info.  
+0000ba30: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+0000ba40: 662e 5f63 6f6d 7072 6573 736f 723a 0a20  f._compressor:. 
+0000ba50: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+0000ba60: 7566 203d 2073 656c 662e 5f63 6f6d 7072  uf = self._compr
+0000ba70: 6573 736f 722e 666c 7573 6828 290a 2020  essor.flush().  
+0000ba80: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000ba90: 6c66 2e5f 636f 6d70 7265 7373 5f73 697a  lf._compress_siz
+0000baa0: 6520 2b3d 206c 656e 2862 7566 290a 2020  e += len(buf).  
+0000bab0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000bac0: 6c66 2e5f 6669 6c65 6f62 6a2e 7772 6974  lf._fileobj.writ
+0000bad0: 6528 6275 6629 0a20 2020 2020 2020 2020  e(buf).         
+0000bae0: 2020 2020 2020 2073 656c 662e 5f7a 696e         self._zin
+0000baf0: 666f 2e63 6f6d 7072 6573 735f 7369 7a65  fo.compress_size
+0000bb00: 203d 2073 656c 662e 5f63 6f6d 7072 6573   = self._compres
+0000bb10: 735f 7369 7a65 0a20 2020 2020 2020 2020  s_size.         
+0000bb20: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000bb30: 2020 2020 2020 2020 2073 656c 662e 5f7a           self._z
+0000bb40: 696e 666f 2e63 6f6d 7072 6573 735f 7369  info.compress_si
+0000bb50: 7a65 203d 2073 656c 662e 5f66 696c 655f  ze = self._file_
+0000bb60: 7369 7a65 0a20 2020 2020 2020 2020 2020  size.           
+0000bb70: 2073 656c 662e 5f7a 696e 666f 2e43 5243   self._zinfo.CRC
+0000bb80: 203d 2073 656c 662e 5f63 7263 0a20 2020   = self._crc.   
+0000bb90: 2020 2020 2020 2020 2073 656c 662e 5f7a           self._z
+0000bba0: 696e 666f 2e66 696c 655f 7369 7a65 203d  info.file_size =
+0000bbb0: 2073 656c 662e 5f66 696c 655f 7369 7a65   self._file_size
+0000bbc0: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+0000bbd0: 5772 6974 6520 7570 6461 7465 6420 6865  Write updated he
+0000bbe0: 6164 6572 2069 6e66 6f0a 2020 2020 2020  ader info.      
+0000bbf0: 2020 2020 2020 6966 2073 656c 662e 5f7a        if self._z
+0000bc00: 696e 666f 2e66 6c61 675f 6269 7473 2026  info.flag_bits &
+0000bc10: 2030 7830 383a 0a20 2020 2020 2020 2020   0x08:.         
+0000bc20: 2020 2020 2020 2023 2057 7269 7465 2043         # Write C
+0000bc30: 5243 2061 6e64 2066 696c 6520 7369 7a65  RC and file size
+0000bc40: 7320 6166 7465 7220 7468 6520 6669 6c65  s after the file
+0000bc50: 2064 6174 610a 2020 2020 2020 2020 2020   data.          
+0000bc60: 2020 2020 2020 666d 7420 3d20 273c 4c4c        fmt = '<LL
+0000bc70: 5151 2720 6966 2073 656c 662e 5f7a 6970  QQ' if self._zip
+0000bc80: 3634 2065 6c73 6520 273c 4c4c 4c4c 270a  64 else '<LLLL'.
+0000bc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bca0: 7365 6c66 2e5f 6669 6c65 6f62 6a2e 7772  self._fileobj.wr
+0000bcb0: 6974 6528 7374 7275 6374 2e70 6163 6b28  ite(struct.pack(
+0000bcc0: 666d 742c 205f 4444 5f53 4947 4e41 5455  fmt, _DD_SIGNATU
+0000bcd0: 5245 2c20 7365 6c66 2e5f 7a69 6e66 6f2e  RE, self._zinfo.
+0000bce0: 4352 432c 0a20 2020 2020 2020 2020 2020  CRC,.           
+0000bcf0: 2020 2020 2020 2020 2073 656c 662e 5f7a           self._z
+0000bd00: 696e 666f 2e63 6f6d 7072 6573 735f 7369  info.compress_si
+0000bd10: 7a65 2c20 7365 6c66 2e5f 7a69 6e66 6f2e  ze, self._zinfo.
+0000bd20: 6669 6c65 5f73 697a 6529 290a 2020 2020  file_size)).    
+0000bd30: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000bd40: 2e5f 7a69 7066 696c 652e 7374 6172 745f  ._zipfile.start_
+0000bd50: 6469 7220 3d20 7365 6c66 2e5f 6669 6c65  dir = self._file
+0000bd60: 6f62 6a2e 7465 6c6c 2829 0a20 2020 2020  obj.tell().     
+0000bd70: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0000bd80: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0000bd90: 6e6f 7420 7365 6c66 2e5f 7a69 7036 343a  not self._zip64:
+0000bda0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000bdb0: 2020 2020 2069 6620 7365 6c66 2e5f 6669       if self._fi
+0000bdc0: 6c65 5f73 697a 6520 3e20 5a49 5036 345f  le_size > ZIP64_
+0000bdd0: 4c49 4d49 543a 0a20 2020 2020 2020 2020  LIMIT:.         
+0000bde0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000bdf0: 6169 7365 2052 756e 7469 6d65 4572 726f  aise RuntimeErro
+0000be00: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+0000be10: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+0000be20: 4669 6c65 2073 697a 6520 756e 6578 7065  File size unexpe
+0000be30: 6374 6564 6c79 2065 7863 6565 6465 6420  ctedly exceeded 
+0000be40: 5a49 5036 3420 6c69 6d69 7427 290a 2020  ZIP64 limit').  
+0000be50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000be60: 2020 6966 2073 656c 662e 5f63 6f6d 7072    if self._compr
+0000be70: 6573 735f 7369 7a65 203e 205a 4950 3634  ess_size > ZIP64
+0000be80: 5f4c 494d 4954 3a0a 2020 2020 2020 2020  _LIMIT:.        
+0000be90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bea0: 7261 6973 6520 5275 6e74 696d 6545 7272  raise RuntimeErr
+0000beb0: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
+0000bec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bed0: 2743 6f6d 7072 6573 7365 6420 7369 7a65  'Compressed size
+0000bee0: 2075 6e65 7870 6563 7465 646c 7920 6578   unexpectedly ex
+0000bef0: 6365 6564 6564 205a 4950 3634 206c 696d  ceeded ZIP64 lim
+0000bf00: 6974 2729 0a20 2020 2020 2020 2020 2020  it').           
+0000bf10: 2020 2020 2023 2053 6565 6b20 6261 636b       # Seek back
+0000bf20: 7761 7264 7320 616e 6420 7772 6974 6520  wards and write 
+0000bf30: 6669 6c65 2068 6561 6465 7220 2877 6869  file header (whi
+0000bf40: 6368 2077 696c 6c20 6e6f 7720 696e 636c  ch will now incl
+0000bf50: 7564 650a 2020 2020 2020 2020 2020 2020  ude.            
+0000bf60: 2020 2020 2320 636f 7272 6563 7420 4352      # correct CR
+0000bf70: 4320 616e 6420 6669 6c65 2073 697a 6573  C and file sizes
+0000bf80: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+0000bf90: 2020 2023 2050 7265 7365 7276 6520 6375     # Preserve cu
+0000bfa0: 7272 656e 7420 706f 7369 7469 6f6e 2069  rrent position i
+0000bfb0: 6e20 6669 6c65 0a20 2020 2020 2020 2020  n file.         
+0000bfc0: 2020 2020 2020 2073 656c 662e 5f7a 6970         self._zip
+0000bfd0: 6669 6c65 2e73 7461 7274 5f64 6972 203d  file.start_dir =
+0000bfe0: 2073 656c 662e 5f66 696c 656f 626a 2e74   self._fileobj.t
+0000bff0: 656c 6c28 290a 2020 2020 2020 2020 2020  ell().          
+0000c000: 2020 2020 2020 7365 6c66 2e5f 6669 6c65        self._file
+0000c010: 6f62 6a2e 7365 656b 2873 656c 662e 5f7a  obj.seek(self._z
+0000c020: 696e 666f 2e68 6561 6465 725f 6f66 6673  info.header_offs
+0000c030: 6574 290a 2020 2020 2020 2020 2020 2020  et).            
+0000c040: 2020 2020 7365 6c66 2e5f 6669 6c65 6f62      self._fileob
+0000c050: 6a2e 7772 6974 6528 7365 6c66 2e5f 7a69  j.write(self._zi
+0000c060: 6e66 6f2e 4669 6c65 4865 6164 6572 2873  nfo.FileHeader(s
+0000c070: 656c 662e 5f7a 6970 3634 2929 0a20 2020  elf._zip64)).   
+0000c080: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0000c090: 662e 5f66 696c 656f 626a 2e73 6565 6b28  f._fileobj.seek(
+0000c0a0: 7365 6c66 2e5f 7a69 7066 696c 652e 7374  self._zipfile.st
+0000c0b0: 6172 745f 6469 7229 0a0a 2020 2020 2020  art_dir)..      
+0000c0c0: 2020 2020 2020 2320 5375 6363 6573 7366        # Successf
+0000c0d0: 756c 6c79 2077 7269 7474 656e 3a20 4164  ully written: Ad
+0000c0e0: 6420 6669 6c65 2074 6f20 6f75 7220 6361  d file to our ca
+0000c0f0: 6368 6573 0a20 2020 2020 2020 2020 2020  ches.           
+0000c100: 2073 656c 662e 5f7a 6970 6669 6c65 2e66   self._zipfile.f
+0000c110: 696c 656c 6973 742e 6170 7065 6e64 2873  ilelist.append(s
+0000c120: 656c 662e 5f7a 696e 666f 290a 2020 2020  elf._zinfo).    
+0000c130: 2020 2020 2020 2020 7365 6c66 2e5f 7a69          self._zi
+0000c140: 7066 696c 652e 4e61 6d65 546f 496e 666f  pfile.NameToInfo
+0000c150: 5b73 656c 662e 5f7a 696e 666f 2e66 696c  [self._zinfo.fil
+0000c160: 656e 616d 655d 203d 2073 656c 662e 5f7a  ename] = self._z
+0000c170: 696e 666f 0a20 2020 2020 2020 2066 696e  info.        fin
+0000c180: 616c 6c79 3a0a 2020 2020 2020 2020 2020  ally:.          
+0000c190: 2020 7365 6c66 2e5f 7a69 7066 696c 652e    self._zipfile.
+0000c1a0: 5f77 7269 7469 6e67 203d 2046 616c 7365  _writing = False
+0000c1b0: 0a0a 0a0a 636c 6173 7320 5a69 7046 696c  ....class ZipFil
+0000c1c0: 6528 6f62 6a65 6374 293a 0a20 2020 2022  e(object):.    "
+0000c1d0: 2222 2043 6c61 7373 2077 6974 6820 6d65  "" Class with me
+0000c1e0: 7468 6f64 7320 746f 206f 7065 6e2c 2072  thods to open, r
+0000c1f0: 6561 642c 2077 7269 7465 2c20 636c 6f73  ead, write, clos
+0000c200: 652c 206c 6973 7420 7a69 7020 6669 6c65  e, list zip file
+0000c210: 732e 0a0a 2020 2020 7a20 3d20 5a69 7046  s...    z = ZipF
+0000c220: 696c 6528 6669 6c65 2c20 6d6f 6465 3d22  ile(file, mode="
+0000c230: 7222 2c20 636f 6d70 7265 7373 696f 6e3d  r", compression=
+0000c240: 5a49 505f 5354 4f52 4544 2c20 616c 6c6f  ZIP_STORED, allo
+0000c250: 775a 6970 3634 3d54 7275 652c 0a20 2020  wZip64=True,.   
+0000c260: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
+0000c270: 7072 6573 736c 6576 656c 3d4e 6f6e 6529  presslevel=None)
+0000c280: 0a0a 2020 2020 6669 6c65 3a20 4569 7468  ..    file: Eith
+0000c290: 6572 2074 6865 2070 6174 6820 746f 2074  er the path to t
+0000c2a0: 6865 2066 696c 652c 206f 7220 6120 6669  he file, or a fi
+0000c2b0: 6c65 2d6c 696b 6520 6f62 6a65 6374 2e0a  le-like object..
+0000c2c0: 2020 2020 2020 2020 2020 4966 2069 7420            If it 
+0000c2d0: 6973 2061 2070 6174 682c 2074 6865 2066  is a path, the f
+0000c2e0: 696c 6520 7769 6c6c 2062 6520 6f70 656e  ile will be open
+0000c2f0: 6564 2061 6e64 2063 6c6f 7365 6420 6279  ed and closed by
+0000c300: 205a 6970 4669 6c65 2e0a 2020 2020 6d6f   ZipFile..    mo
+0000c310: 6465 3a20 5468 6520 6d6f 6465 2063 616e  de: The mode can
+0000c320: 2062 6520 6569 7468 6572 2072 6561 6420   be either read 
+0000c330: 2772 272c 2077 7269 7465 2027 7727 2c20  'r', write 'w', 
+0000c340: 6578 636c 7573 6976 6520 6372 6561 7465  exclusive create
+0000c350: 2027 7827 2c0a 2020 2020 2020 2020 2020   'x',.          
+0000c360: 6f72 2061 7070 656e 6420 2761 272e 0a20  or append 'a'.. 
+0000c370: 2020 2063 6f6d 7072 6573 7369 6f6e 3a20     compression: 
+0000c380: 5a49 505f 5354 4f52 4544 2028 6e6f 2063  ZIP_STORED (no c
+0000c390: 6f6d 7072 6573 7369 6f6e 292c 205a 4950  ompression), ZIP
+0000c3a0: 5f44 4546 4c41 5445 4420 2872 6571 7569  _DEFLATED (requi
+0000c3b0: 7265 7320 7a6c 6962 292c 0a20 2020 2020  res zlib),.     
+0000c3c0: 2020 2020 2020 2020 2020 2020 5a49 505f              ZIP_
+0000c3d0: 425a 4950 3220 2872 6571 7569 7265 7320  BZIP2 (requires 
+0000c3e0: 627a 3229 206f 7220 5a49 505f 4c5a 4d41  bz2) or ZIP_LZMA
+0000c3f0: 2028 7265 7175 6972 6573 206c 7a6d 6129   (requires lzma)
+0000c400: 2e0a 2020 2020 616c 6c6f 775a 6970 3634  ..    allowZip64
+0000c410: 3a20 6966 2054 7275 6520 5a69 7046 696c  : if True ZipFil
+0000c420: 6520 7769 6c6c 2063 7265 6174 6520 6669  e will create fi
+0000c430: 6c65 7320 7769 7468 205a 4950 3634 2065  les with ZIP64 e
+0000c440: 7874 656e 7369 6f6e 7320 7768 656e 0a20  xtensions when. 
+0000c450: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0000c460: 6565 6465 642c 206f 7468 6572 7769 7365  eeded, otherwise
+0000c470: 2069 7420 7769 6c6c 2072 6169 7365 2061   it will raise a
+0000c480: 6e20 6578 6365 7074 696f 6e20 7768 656e  n exception when
+0000c490: 2074 6869 7320 776f 756c 640a 2020 2020   this would.    
+0000c4a0: 2020 2020 2020 2020 2020 2020 6265 206e              be n
+0000c4b0: 6563 6573 7361 7279 2e0a 2020 2020 636f  ecessary..    co
+0000c4c0: 6d70 7265 7373 6c65 7665 6c3a 204e 6f6e  mpresslevel: Non
+0000c4d0: 6520 2864 6566 6175 6c74 2066 6f72 2074  e (default for t
+0000c4e0: 6865 2067 6976 656e 2063 6f6d 7072 6573  he given compres
+0000c4f0: 7369 6f6e 2074 7970 6529 206f 7220 616e  sion type) or an
+0000c500: 2069 6e74 6567 6572 0a20 2020 2020 2020   integer.       
+0000c510: 2020 2020 2020 2020 2020 2020 7370 6563              spec
+0000c520: 6966 7969 6e67 2074 6865 206c 6576 656c  ifying the level
+0000c530: 2074 6f20 7061 7373 2074 6f20 7468 6520   to pass to the 
+0000c540: 636f 6d70 7265 7373 6f72 2e0a 2020 2020  compressor..    
+0000c550: 2020 2020 2020 2020 2020 2020 2020 2057                 W
+0000c560: 6865 6e20 7573 696e 6720 5a49 505f 5354  hen using ZIP_ST
+0000c570: 4f52 4544 206f 7220 5a49 505f 4c5a 4d41  ORED or ZIP_LZMA
+0000c580: 2074 6869 7320 6b65 7977 6f72 6420 6861   this keyword ha
+0000c590: 7320 6e6f 2065 6666 6563 742e 0a20 2020  s no effect..   
+0000c5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c5b0: 5768 656e 2075 7369 6e67 205a 4950 5f44  When using ZIP_D
+0000c5c0: 4546 4c41 5445 4420 696e 7465 6765 7273  EFLATED integers
+0000c5d0: 2030 2074 6872 6f75 6768 2039 2061 7265   0 through 9 are
+0000c5e0: 2061 6363 6570 7465 642e 0a20 2020 2020   accepted..     
+0000c5f0: 2020 2020 2020 2020 2020 2020 2020 5768                Wh
+0000c600: 656e 2075 7369 6e67 205a 4950 5f42 5a49  en using ZIP_BZI
+0000c610: 5032 2069 6e74 6567 6572 7320 3120 7468  P2 integers 1 th
+0000c620: 726f 7567 6820 3920 6172 6520 6163 6365  rough 9 are acce
+0000c630: 7074 6564 2e0a 0a20 2020 2022 2222 0a0a  pted...    """..
+0000c640: 2020 2020 6670 203d 204e 6f6e 6520 2020      fp = None   
+0000c650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c660: 2320 5365 7420 6865 7265 2073 696e 6365  # Set here since
+0000c670: 205f 5f64 656c 5f5f 2063 6865 636b 7320   __del__ checks 
+0000c680: 6974 0a20 2020 205f 7769 6e64 6f77 735f  it.    _windows_
+0000c690: 696c 6c65 6761 6c5f 6e61 6d65 5f74 7261  illegal_name_tra
+0000c6a0: 6e73 5f74 6162 6c65 203d 204e 6f6e 650a  ns_table = None.
+0000c6b0: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
+0000c6c0: 5f28 7365 6c66 2c20 6669 6c65 2c20 6d6f  _(self, file, mo
+0000c6d0: 6465 3d22 7222 2c20 636f 6d70 7265 7373  de="r", compress
+0000c6e0: 696f 6e3d 5a49 505f 5354 4f52 4544 2c20  ion=ZIP_STORED, 
+0000c6f0: 616c 6c6f 775a 6970 3634 3d54 7275 652c  allowZip64=True,
+0000c700: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c710: 2020 636f 6d70 7265 7373 6c65 7665 6c3d    compresslevel=
+0000c720: 4e6f 6e65 2c20 7374 7269 6374 5f74 696d  None, strict_tim
+0000c730: 6573 7461 6d70 733d 5472 7565 293a 0a20  estamps=True):. 
+0000c740: 2020 2020 2020 2022 2222 4f70 656e 2074         """Open t
+0000c750: 6865 205a 4950 2066 696c 6520 7769 7468  he ZIP file with
+0000c760: 206d 6f64 6520 7265 6164 2027 7227 2c20   mode read 'r', 
+0000c770: 7772 6974 6520 2777 272c 2065 7863 6c75  write 'w', exclu
+0000c780: 7369 7665 2063 7265 6174 6520 2778 272c  sive create 'x',
+0000c790: 0a20 2020 2020 2020 206f 7220 6170 7065  .        or appe
+0000c7a0: 6e64 2027 6127 2e22 2222 0a20 2020 2020  nd 'a'.""".     
+0000c7b0: 2020 2069 6620 6d6f 6465 206e 6f74 2069     if mode not i
+0000c7c0: 6e20 2827 7227 2c20 2777 272c 2027 7827  n ('r', 'w', 'x'
+0000c7d0: 2c20 2761 2729 3a0a 2020 2020 2020 2020  , 'a'):.        
+0000c7e0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+0000c7f0: 7272 6f72 2822 5a69 7046 696c 6520 7265  rror("ZipFile re
+0000c800: 7175 6972 6573 206d 6f64 6520 2772 272c  quires mode 'r',
+0000c810: 2027 7727 2c20 2778 272c 206f 7220 2761   'w', 'x', or 'a
+0000c820: 2722 290a 0a20 2020 2020 2020 205f 6368  '")..        _ch
+0000c830: 6563 6b5f 636f 6d70 7265 7373 696f 6e28  eck_compression(
+0000c840: 636f 6d70 7265 7373 696f 6e29 0a0a 2020  compression)..  
+0000c850: 2020 2020 2020 7365 6c66 2e5f 616c 6c6f        self._allo
+0000c860: 775a 6970 3634 203d 2061 6c6c 6f77 5a69  wZip64 = allowZi
+0000c870: 7036 340a 2020 2020 2020 2020 7365 6c66  p64.        self
+0000c880: 2e5f 6469 644d 6f64 6966 7920 3d20 4661  ._didModify = Fa
+0000c890: 6c73 650a 2020 2020 2020 2020 7365 6c66  lse.        self
+0000c8a0: 2e64 6562 7567 203d 2030 2020 2320 4c65  .debug = 0  # Le
+0000c8b0: 7665 6c20 6f66 2070 7269 6e74 696e 673a  vel of printing:
+0000c8c0: 2030 2074 6872 6f75 6768 2033 0a20 2020   0 through 3.   
+0000c8d0: 2020 2020 2073 656c 662e 4e61 6d65 546f       self.NameTo
+0000c8e0: 496e 666f 203d 207b 7d20 2020 2023 2046  Info = {}    # F
+0000c8f0: 696e 6420 6669 6c65 2069 6e66 6f20 6769  ind file info gi
+0000c900: 7665 6e20 6e61 6d65 0a20 2020 2020 2020  ven name.       
+0000c910: 2073 656c 662e 6669 6c65 6c69 7374 203d   self.filelist =
+0000c920: 205b 5d20 2020 2020 2023 204c 6973 7420   []      # List 
+0000c930: 6f66 205a 6970 496e 666f 2069 6e73 7461  of ZipInfo insta
+0000c940: 6e63 6573 2066 6f72 2061 7263 6869 7665  nces for archive
+0000c950: 0a20 2020 2020 2020 2073 656c 662e 636f  .        self.co
+0000c960: 6d70 7265 7373 696f 6e20 3d20 636f 6d70  mpression = comp
+0000c970: 7265 7373 696f 6e20 2023 204d 6574 686f  ression  # Metho
+0000c980: 6420 6f66 2063 6f6d 7072 6573 7369 6f6e  d of compression
+0000c990: 0a20 2020 2020 2020 2073 656c 662e 636f  .        self.co
+0000c9a0: 6d70 7265 7373 6c65 7665 6c20 3d20 636f  mpresslevel = co
+0000c9b0: 6d70 7265 7373 6c65 7665 6c0a 2020 2020  mpresslevel.    
+0000c9c0: 2020 2020 7365 6c66 2e6d 6f64 6520 3d20      self.mode = 
+0000c9d0: 6d6f 6465 0a20 2020 2020 2020 2073 656c  mode.        sel
+0000c9e0: 662e 7077 6420 3d20 4e6f 6e65 0a20 2020  f.pwd = None.   
+0000c9f0: 2020 2020 2073 656c 662e 5f63 6f6d 6d65       self._comme
+0000ca00: 6e74 203d 2062 2727 0a20 2020 2020 2020  nt = b''.       
+0000ca10: 2073 656c 662e 5f73 7472 6963 745f 7469   self._strict_ti
+0000ca20: 6d65 7374 616d 7073 203d 2073 7472 6963  mestamps = stric
+0000ca30: 745f 7469 6d65 7374 616d 7073 0a0a 2020  t_timestamps..  
+0000ca40: 2020 2020 2020 2320 4368 6563 6b20 6966        # Check if
+0000ca50: 2077 6520 7765 7265 2070 6173 7365 6420   we were passed 
+0000ca60: 6120 6669 6c65 2d6c 696b 6520 6f62 6a65  a file-like obje
+0000ca70: 6374 0a20 2020 2020 2020 2069 6620 7379  ct.        if sy
+0000ca80: 732e 7665 7273 696f 6e5f 696e 666f 3e3d  s.version_info>=
+0000ca90: 2833 2c36 293a 0a20 2020 2020 2020 2020  (3,6):.         
+0000caa0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+0000cab0: 2866 696c 652c 206f 732e 5061 7468 4c69  (file, os.PathLi
+0000cac0: 6b65 293a 0a20 2020 2020 2020 2020 2020  ke):.           
+0000cad0: 2020 2020 2066 696c 6520 3d20 6f73 2e66       file = os.f
+0000cae0: 7370 6174 6828 6669 6c65 290a 2020 2020  spath(file).    
+0000caf0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+0000cb00: 6528 6669 6c65 2c20 6261 7365 7374 7269  e(file, basestri
+0000cb10: 6e67 293a 0a20 2020 2020 2020 2020 2020  ng):.           
+0000cb20: 2023 204e 6f2c 2069 7427 7320 6120 6669   # No, it's a fi
+0000cb30: 6c65 6e61 6d65 0a20 2020 2020 2020 2020  lename.         
+0000cb40: 2020 2073 656c 662e 5f66 696c 6550 6173     self._filePas
+0000cb50: 7365 6420 3d20 300a 2020 2020 2020 2020  sed = 0.        
+0000cb60: 2020 2020 7365 6c66 2e66 696c 656e 616d      self.filenam
+0000cb70: 6520 3d20 6669 6c65 0a20 2020 2020 2020  e = file.       
+0000cb80: 2020 2020 206d 6f64 6544 6963 7420 3d20       modeDict = 
+0000cb90: 7b27 7227 203a 2027 7262 272c 2027 7727  {'r' : 'rb', 'w'
+0000cba0: 3a20 2777 2b62 272c 2027 7827 3a20 2778  : 'w+b', 'x': 'x
+0000cbb0: 2b62 272c 2027 6127 203a 2027 722b 6227  +b', 'a' : 'r+b'
+0000cbc0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000cbd0: 2020 2020 2020 2020 2020 2772 2b62 273a            'r+b':
+0000cbe0: 2027 772b 6227 2c20 2777 2b62 273a 2027   'w+b', 'w+b': '
+0000cbf0: 7762 272c 2027 782b 6227 3a20 2778 6227  wb', 'x+b': 'xb'
+0000cc00: 7d0a 2020 2020 2020 2020 2020 2020 6669  }.            fi
+0000cc10: 6c65 6d6f 6465 203d 206d 6f64 6544 6963  lemode = modeDic
+0000cc20: 745b 6d6f 6465 5d0a 2020 2020 2020 2020  t[mode].        
+0000cc30: 2020 2020 7768 696c 6520 5472 7565 3a0a      while True:.
+0000cc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cc50: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+0000cc60: 2020 2020 2020 2020 2073 656c 662e 6670           self.fp
+0000cc70: 203d 2069 6f2e 6f70 656e 2866 696c 652c   = io.open(file,
+0000cc80: 2066 696c 656d 6f64 6529 0a20 2020 2020   filemode).     
+0000cc90: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+0000cca0: 7420 4f53 4572 726f 723a 0a20 2020 2020  t OSError:.     
+0000ccb0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000ccc0: 6620 6669 6c65 6d6f 6465 2069 6e20 6d6f  f filemode in mo
+0000ccd0: 6465 4469 6374 3a0a 2020 2020 2020 2020  deDict:.        
+0000cce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ccf0: 6669 6c65 6d6f 6465 203d 206d 6f64 6544  filemode = modeD
+0000cd00: 6963 745b 6669 6c65 6d6f 6465 5d0a 2020  ict[filemode].  
+0000cd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cd20: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
+0000cd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cd40: 2020 2072 6169 7365 0a20 2020 2020 2020     raise.       
+0000cd50: 2020 2020 2020 2020 2062 7265 616b 0a20           break. 
+0000cd60: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0000cd70: 2020 2020 2020 2020 2073 656c 662e 5f66           self._f
+0000cd80: 696c 6550 6173 7365 6420 3d20 310a 2020  ilePassed = 1.  
+0000cd90: 2020 2020 2020 2020 2020 7365 6c66 2e66            self.f
+0000cda0: 7020 3d20 6669 6c65 0a20 2020 2020 2020  p = file.       
+0000cdb0: 2020 2020 2073 656c 662e 6669 6c65 6e61       self.filena
+0000cdc0: 6d65 203d 2067 6574 6174 7472 2866 696c  me = getattr(fil
+0000cdd0: 652c 2027 6e61 6d65 272c 204e 6f6e 6529  e, 'name', None)
+0000cde0: 0a20 2020 2020 2020 2073 656c 662e 5f66  .        self._f
+0000cdf0: 696c 6552 6566 436e 7420 3d20 310a 2020  ileRefCnt = 1.  
+0000ce00: 2020 2020 2020 7365 6c66 2e5f 6c6f 636b        self._lock
+0000ce10: 203d 2074 6872 6561 6469 6e67 2e52 4c6f   = threading.RLo
+0000ce20: 636b 2829 0a20 2020 2020 2020 2073 656c  ck().        sel
+0000ce30: 662e 5f73 6565 6b61 626c 6520 3d20 5472  f._seekable = Tr
+0000ce40: 7565 0a20 2020 2020 2020 2073 656c 662e  ue.        self.
+0000ce50: 5f77 7269 7469 6e67 203d 2046 616c 7365  _writing = False
+0000ce60: 0a0a 2020 2020 2020 2020 7472 793a 0a20  ..        try:. 
+0000ce70: 2020 2020 2020 2020 2020 2069 6620 6d6f             if mo
+0000ce80: 6465 203d 3d20 2772 273a 0a20 2020 2020  de == 'r':.     
+0000ce90: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000cea0: 5f52 6561 6c47 6574 436f 6e74 656e 7473  _RealGetContents
+0000ceb0: 2829 0a20 2020 2020 2020 2020 2020 2065  ().            e
+0000cec0: 6c69 6620 6d6f 6465 2069 6e20 2827 7727  lif mode in ('w'
+0000ced0: 2c20 2778 2729 3a0a 2020 2020 2020 2020  , 'x'):.        
+0000cee0: 2020 2020 2020 2020 2320 7365 7420 7468          # set th
+0000cef0: 6520 6d6f 6469 6669 6564 2066 6c61 6720  e modified flag 
+0000cf00: 736f 2063 656e 7472 616c 2064 6972 6563  so central direc
+0000cf10: 746f 7279 2067 6574 7320 7772 6974 7465  tory gets writte
+0000cf20: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
+0000cf30: 2020 2320 6576 656e 2069 6620 6e6f 2066    # even if no f
+0000cf40: 696c 6573 2061 7265 2061 6464 6564 2074  iles are added t
+0000cf50: 6f20 7468 6520 6172 6368 6976 650a 2020  o the archive.  
+0000cf60: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000cf70: 6c66 2e5f 6469 644d 6f64 6966 7920 3d20  lf._didModify = 
+0000cf80: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+0000cf90: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+0000cfa0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000cfb0: 6c66 2e73 7461 7274 5f64 6972 203d 2073  lf.start_dir = s
+0000cfc0: 656c 662e 6670 2e74 656c 6c28 290a 2020  elf.fp.tell().  
+0000cfd0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+0000cfe0: 6365 7074 2028 4174 7472 6962 7574 6545  cept (AttributeE
+0000cff0: 7272 6f72 2c20 4f53 4572 726f 7229 3a0a  rror, OSError):.
+0000d000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d010: 2020 2020 7365 6c66 2e66 7020 3d20 5f54      self.fp = _T
+0000d020: 656c 6c61 626c 6528 7365 6c66 2e66 7029  ellable(self.fp)
+0000d030: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d040: 2020 2020 2073 656c 662e 7374 6172 745f       self.start_
+0000d050: 6469 7220 3d20 300a 2020 2020 2020 2020  dir = 0.        
+0000d060: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000d070: 2e5f 7365 656b 6162 6c65 203d 2046 616c  ._seekable = Fal
+0000d080: 7365 0a20 2020 2020 2020 2020 2020 2020  se.             
+0000d090: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000d0a0: 2020 2020 2020 2020 2020 2020 2023 2053               # S
+0000d0b0: 6f6d 6520 6669 6c65 2d6c 696b 6520 6f62  ome file-like ob
+0000d0c0: 6a65 6374 7320 6361 6e20 7072 6f76 6964  jects can provid
+0000d0d0: 6520 7465 6c6c 2829 2062 7574 206e 6f74  e tell() but not
+0000d0e0: 2073 6565 6b28 290a 2020 2020 2020 2020   seek().        
+0000d0f0: 2020 2020 2020 2020 2020 2020 7472 793a              try:
+0000d100: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d110: 2020 2020 2020 2020 2073 656c 662e 6670           self.fp
+0000d120: 2e73 6565 6b28 7365 6c66 2e73 7461 7274  .seek(self.start
+0000d130: 5f64 6972 290a 2020 2020 2020 2020 2020  _dir).          
+0000d140: 2020 2020 2020 2020 2020 6578 6365 7074            except
+0000d150: 2028 4174 7472 6962 7574 6545 7272 6f72   (AttributeError
+0000d160: 2c20 4f53 4572 726f 7229 3a0a 2020 2020  , OSError):.    
+0000d170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d180: 2020 2020 7365 6c66 2e5f 7365 656b 6162      self._seekab
+0000d190: 6c65 203d 2046 616c 7365 0a20 2020 2020  le = False.     
+0000d1a0: 2020 2020 2020 2065 6c69 6620 6d6f 6465         elif mode
+0000d1b0: 203d 3d20 2761 273a 0a20 2020 2020 2020   == 'a':.       
+0000d1c0: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
+0000d1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d1e0: 2020 2320 5365 6520 6966 2066 696c 6520    # See if file 
+0000d1f0: 6973 2061 207a 6970 2066 696c 650a 2020  is a zip file.  
+0000d200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d210: 2020 7365 6c66 2e5f 5265 616c 4765 7443    self._RealGetC
+0000d220: 6f6e 7465 6e74 7328 290a 2020 2020 2020  ontents().      
+0000d230: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0000d240: 7365 656b 2074 6f20 7374 6172 7420 6f66  seek to start of
+0000d250: 2064 6972 6563 746f 7279 2061 6e64 206f   directory and o
+0000d260: 7665 7277 7269 7465 0a20 2020 2020 2020  verwrite.       
+0000d270: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0000d280: 662e 6670 2e73 6565 6b28 7365 6c66 2e73  f.fp.seek(self.s
+0000d290: 7461 7274 5f64 6972 290a 2020 2020 2020  tart_dir).      
+0000d2a0: 2020 2020 2020 2020 2020 6578 6365 7074            except
+0000d2b0: 2042 6164 5a69 7046 696c 653a 0a20 2020   BadZipFile:.   
 0000d2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d2d0: 2020 7365 6c66 2e73 7461 7274 5f64 6972    self.start_dir
-0000d2e0: 203d 2073 656c 662e 6670 2e74 656c 6c28   = self.fp.tell(
-0000d2f0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-0000d300: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0000d310: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-0000d320: 7272 6f72 2822 4d6f 6465 206d 7573 7420  rror("Mode must 
-0000d330: 6265 2027 7227 2c20 2777 272c 2027 7827  be 'r', 'w', 'x'
-0000d340: 2c20 6f72 2027 6127 2229 0a20 2020 2020  , or 'a'").     
-0000d350: 2020 2065 7863 6570 743a 0a20 2020 2020     except:.     
-0000d360: 2020 2020 2020 2066 7020 3d20 7365 6c66         fp = self
-0000d370: 2e66 700a 2020 2020 2020 2020 2020 2020  .fp.            
-0000d380: 7365 6c66 2e66 7020 3d20 4e6f 6e65 0a20  self.fp = None. 
-0000d390: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000d3a0: 5f66 7063 6c6f 7365 2866 7029 0a20 2020  _fpclose(fp).   
-0000d3b0: 2020 2020 2020 2020 2072 6169 7365 0a0a           raise..
-0000d3c0: 2020 2020 6465 6620 5f5f 656e 7465 725f      def __enter_
-0000d3d0: 5f28 7365 6c66 293a 0a20 2020 2020 2020  _(self):.       
-0000d3e0: 2072 6574 7572 6e20 7365 6c66 0a0a 2020   return self..  
-0000d3f0: 2020 6465 6620 5f5f 6578 6974 5f5f 2873    def __exit__(s
-0000d400: 656c 662c 2074 7970 652c 2076 616c 7565  elf, type, value
-0000d410: 2c20 7472 6163 6562 6163 6b29 3a0a 2020  , traceback):.  
-0000d420: 2020 2020 2020 7365 6c66 2e63 6c6f 7365        self.close
-0000d430: 2829 0a0a 2020 2020 6465 6620 5f5f 7265  ()..    def __re
-0000d440: 7072 5f5f 2873 656c 6629 3a0a 2020 2020  pr__(self):.    
-0000d450: 2020 2020 7265 7375 6c74 203d 205b 273c      result = ['<
-0000d460: 2573 2e25 7327 2025 2028 7365 6c66 2e5f  %s.%s' % (self._
-0000d470: 5f63 6c61 7373 5f5f 2e5f 5f6d 6f64 756c  _class__.__modul
-0000d480: 655f 5f2c 0a20 2020 2020 2020 2020 2020  e__,.           
-0000d490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d4a0: 2020 2073 656c 662e 5f5f 636c 6173 735f     self.__class_
-0000d4b0: 5f2e 5f5f 7175 616c 6e61 6d65 5f5f 295d  _.__qualname__)]
-0000d4c0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-0000d4d0: 2e66 7020 6973 206e 6f74 204e 6f6e 653a  .fp is not None:
-0000d4e0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000d4f0: 7365 6c66 2e5f 6669 6c65 5061 7373 6564  self._filePassed
-0000d500: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000d510: 2020 7265 7375 6c74 2e61 7070 656e 6428    result.append(
-0000d520: 2720 6669 6c65 3d25 7227 2025 2073 656c  ' file=%r' % sel
-0000d530: 662e 6670 290a 2020 2020 2020 2020 2020  f.fp).          
-0000d540: 2020 656c 6966 2073 656c 662e 6669 6c65    elif self.file
-0000d550: 6e61 6d65 2069 7320 6e6f 7420 4e6f 6e65  name is not None
-0000d560: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000d570: 2020 7265 7375 6c74 2e61 7070 656e 6428    result.append(
-0000d580: 2720 6669 6c65 6e61 6d65 3d25 7227 2025  ' filename=%r' %
-0000d590: 2073 656c 662e 6669 6c65 6e61 6d65 290a   self.filename).
-0000d5a0: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-0000d5b0: 6c74 2e61 7070 656e 6428 2720 6d6f 6465  lt.append(' mode
-0000d5c0: 3d25 7227 2025 2073 656c 662e 6d6f 6465  =%r' % self.mode
-0000d5d0: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-0000d5e0: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-0000d5f0: 6c74 2e61 7070 656e 6428 2720 5b63 6c6f  lt.append(' [clo
-0000d600: 7365 645d 2729 0a20 2020 2020 2020 2072  sed]').        r
-0000d610: 6573 756c 742e 6170 7065 6e64 2827 3e27  esult.append('>'
-0000d620: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-0000d630: 2027 272e 6a6f 696e 2872 6573 756c 7429   ''.join(result)
-0000d640: 0a0a 2020 2020 6465 6620 5f52 6561 6c47  ..    def _RealG
-0000d650: 6574 436f 6e74 656e 7473 2873 656c 6629  etContents(self)
-0000d660: 3a0a 2020 2020 2020 2020 2222 2252 6561  :.        """Rea
-0000d670: 6420 696e 2074 6865 2074 6162 6c65 206f  d in the table o
-0000d680: 6620 636f 6e74 656e 7473 2066 6f72 2074  f contents for t
-0000d690: 6865 205a 4950 2066 696c 652e 2222 220a  he ZIP file.""".
-0000d6a0: 2020 2020 2020 2020 6670 203d 2073 656c          fp = sel
-0000d6b0: 662e 6670 0a20 2020 2020 2020 2074 7279  f.fp.        try
-0000d6c0: 3a0a 2020 2020 2020 2020 2020 2020 656e  :.            en
-0000d6d0: 6472 6563 203d 205f 456e 6452 6563 4461  drec = _EndRecDa
-0000d6e0: 7461 2866 7029 0a20 2020 2020 2020 2065  ta(fp).        e
-0000d6f0: 7863 6570 7420 4f53 4572 726f 723a 0a20  xcept OSError:. 
-0000d700: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0000d710: 2042 6164 5a69 7046 696c 6528 2246 696c   BadZipFile("Fil
-0000d720: 6520 6973 206e 6f74 2061 207a 6970 2066  e is not a zip f
-0000d730: 696c 6522 290a 2020 2020 2020 2020 6966  ile").        if
-0000d740: 206e 6f74 2065 6e64 7265 633a 0a20 2020   not endrec:.   
-0000d750: 2020 2020 2020 2020 2072 6169 7365 2042           raise B
-0000d760: 6164 5a69 7046 696c 6528 2246 696c 6520  adZipFile("File 
-0000d770: 6973 206e 6f74 2061 207a 6970 2066 696c  is not a zip fil
-0000d780: 6522 290a 2020 2020 2020 2020 6966 2073  e").        if s
-0000d790: 656c 662e 6465 6275 6720 3e20 313a 0a20  elf.debug > 1:. 
-0000d7a0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-0000d7b0: 2865 6e64 7265 6329 0a20 2020 2020 2020  (endrec).       
-0000d7c0: 2073 697a 655f 6364 203d 2065 6e64 7265   size_cd = endre
-0000d7d0: 635b 5f45 4344 5f53 495a 455d 2020 2020  c[_ECD_SIZE]    
-0000d7e0: 2020 2020 2020 2020 2023 2062 7974 6573           # bytes
-0000d7f0: 2069 6e20 6365 6e74 7261 6c20 6469 7265   in central dire
-0000d800: 6374 6f72 790a 2020 2020 2020 2020 6f66  ctory.        of
-0000d810: 6673 6574 5f63 6420 3d20 656e 6472 6563  fset_cd = endrec
-0000d820: 5b5f 4543 445f 4f46 4653 4554 5d20 2020  [_ECD_OFFSET]   
-0000d830: 2020 2020 2020 2320 6f66 6673 6574 206f        # offset o
-0000d840: 6620 6365 6e74 7261 6c20 6469 7265 6374  f central direct
-0000d850: 6f72 790a 2020 2020 2020 2020 7365 6c66  ory.        self
-0000d860: 2e5f 636f 6d6d 656e 7420 3d20 656e 6472  ._comment = endr
-0000d870: 6563 5b5f 4543 445f 434f 4d4d 454e 545d  ec[_ECD_COMMENT]
-0000d880: 2020 2020 2320 6172 6368 6976 6520 636f      # archive co
-0000d890: 6d6d 656e 740a 0a20 2020 2020 2020 2023  mment..        #
-0000d8a0: 2022 636f 6e63 6174 2220 6973 207a 6572   "concat" is zer
-0000d8b0: 6f2c 2075 6e6c 6573 7320 7a69 7020 7761  o, unless zip wa
-0000d8c0: 7320 636f 6e63 6174 656e 6174 6564 2074  s concatenated t
-0000d8d0: 6f20 616e 6f74 6865 7220 6669 6c65 0a20  o another file. 
-0000d8e0: 2020 2020 2020 2063 6f6e 6361 7420 3d20         concat = 
-0000d8f0: 656e 6472 6563 5b5f 4543 445f 4c4f 4341  endrec[_ECD_LOCA
-0000d900: 5449 4f4e 5d20 2d20 7369 7a65 5f63 6420  TION] - size_cd 
-0000d910: 2d20 6f66 6673 6574 5f63 640a 2020 2020  - offset_cd.    
-0000d920: 2020 2020 6966 2065 6e64 7265 635b 5f45      if endrec[_E
-0000d930: 4344 5f53 4947 4e41 5455 5245 5d20 3d3d  CD_SIGNATURE] ==
-0000d940: 2073 7472 696e 6745 6e64 4172 6368 6976   stringEndArchiv
-0000d950: 6536 343a 0a20 2020 2020 2020 2020 2020  e64:.           
-0000d960: 2023 2049 6620 5a69 7036 3420 6578 7465   # If Zip64 exte
-0000d970: 6e73 696f 6e20 7374 7275 6374 7572 6573  nsion structures
-0000d980: 2061 7265 2070 7265 7365 6e74 2c20 6163   are present, ac
-0000d990: 636f 756e 7420 666f 7220 7468 656d 0a20  count for them. 
-0000d9a0: 2020 2020 2020 2020 2020 2063 6f6e 6361             conca
-0000d9b0: 7420 2d3d 2028 7369 7a65 456e 6443 656e  t -= (sizeEndCen
-0000d9c0: 7444 6972 3634 202b 2073 697a 6545 6e64  tDir64 + sizeEnd
-0000d9d0: 4365 6e74 4469 7236 344c 6f63 6174 6f72  CentDir64Locator
-0000d9e0: 290a 0a20 2020 2020 2020 2069 6620 7365  )..        if se
-0000d9f0: 6c66 2e64 6562 7567 203e 2032 3a0a 2020  lf.debug > 2:.  
-0000da00: 2020 2020 2020 2020 2020 696e 6665 7272            inferr
-0000da10: 6564 203d 2063 6f6e 6361 7420 2b20 6f66  ed = concat + of
-0000da20: 6673 6574 5f63 640a 2020 2020 2020 2020  fset_cd.        
-0000da30: 2020 2020 7072 696e 7428 2267 6976 656e      print("given
-0000da40: 2c20 696e 6665 7272 6564 2c20 6f66 6673  , inferred, offs
-0000da50: 6574 222c 206f 6666 7365 745f 6364 2c20  et", offset_cd, 
-0000da60: 696e 6665 7272 6564 2c20 636f 6e63 6174  inferred, concat
-0000da70: 290a 2020 2020 2020 2020 2320 7365 6c66  ).        # self
-0000da80: 2e73 7461 7274 5f64 6972 3a20 2050 6f73  .start_dir:  Pos
-0000da90: 6974 696f 6e20 6f66 2073 7461 7274 206f  ition of start o
-0000daa0: 6620 6365 6e74 7261 6c20 6469 7265 6374  f central direct
-0000dab0: 6f72 790a 2020 2020 2020 2020 7365 6c66  ory.        self
-0000dac0: 2e73 7461 7274 5f64 6972 203d 206f 6666  .start_dir = off
-0000dad0: 7365 745f 6364 202b 2063 6f6e 6361 740a  set_cd + concat.
-0000dae0: 2020 2020 2020 2020 6670 2e73 6565 6b28          fp.seek(
-0000daf0: 7365 6c66 2e73 7461 7274 5f64 6972 2c20  self.start_dir, 
-0000db00: 3029 0a20 2020 2020 2020 2064 6174 6120  0).        data 
-0000db10: 3d20 6670 2e72 6561 6428 7369 7a65 5f63  = fp.read(size_c
-0000db20: 6429 0a20 2020 2020 2020 2066 7020 3d20  d).        fp = 
-0000db30: 696f 2e42 7974 6573 494f 2864 6174 6129  io.BytesIO(data)
-0000db40: 0a20 2020 2020 2020 2074 6f74 616c 203d  .        total =
-0000db50: 2030 0a20 2020 2020 2020 2077 6869 6c65   0.        while
-0000db60: 2074 6f74 616c 203c 2073 697a 655f 6364   total < size_cd
-0000db70: 3a0a 2020 2020 2020 2020 2020 2020 6365  :.            ce
-0000db80: 6e74 6469 7220 3d20 6670 2e72 6561 6428  ntdir = fp.read(
-0000db90: 7369 7a65 4365 6e74 7261 6c44 6972 290a  sizeCentralDir).
-0000dba0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-0000dbb0: 656e 2863 656e 7464 6972 2920 213d 2073  en(centdir) != s
-0000dbc0: 697a 6543 656e 7472 616c 4469 723a 0a20  izeCentralDir:. 
-0000dbd0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000dbe0: 6169 7365 2042 6164 5a69 7046 696c 6528  aise BadZipFile(
-0000dbf0: 2254 7275 6e63 6174 6564 2063 656e 7472  "Truncated centr
-0000dc00: 616c 2064 6972 6563 746f 7279 2229 0a20  al directory"). 
-0000dc10: 2020 2020 2020 2020 2020 2063 656e 7464             centd
-0000dc20: 6972 203d 2073 7472 7563 742e 756e 7061  ir = struct.unpa
-0000dc30: 636b 2873 7472 7563 7443 656e 7472 616c  ck(structCentral
-0000dc40: 4469 722c 2063 656e 7464 6972 290a 2020  Dir, centdir).  
-0000dc50: 2020 2020 2020 2020 2020 6966 2063 656e            if cen
-0000dc60: 7464 6972 5b5f 4344 5f53 4947 4e41 5455  tdir[_CD_SIGNATU
-0000dc70: 5245 5d20 213d 2073 7472 696e 6743 656e  RE] != stringCen
-0000dc80: 7472 616c 4469 723a 0a20 2020 2020 2020  tralDir:.       
-0000dc90: 2020 2020 2020 2020 2072 6169 7365 2042           raise B
-0000dca0: 6164 5a69 7046 696c 6528 2242 6164 206d  adZipFile("Bad m
-0000dcb0: 6167 6963 206e 756d 6265 7220 666f 7220  agic number for 
-0000dcc0: 6365 6e74 7261 6c20 6469 7265 6374 6f72  central director
-0000dcd0: 7922 290a 2020 2020 2020 2020 2020 2020  y").            
-0000dce0: 6966 2073 656c 662e 6465 6275 6720 3e20  if self.debug > 
-0000dcf0: 323a 0a20 2020 2020 2020 2020 2020 2020  2:.             
-0000dd00: 2020 2070 7269 6e74 2863 656e 7464 6972     print(centdir
-0000dd10: 290a 2020 2020 2020 2020 2020 2020 6669  ).            fi
-0000dd20: 6c65 6e61 6d65 203d 2066 702e 7265 6164  lename = fp.read
-0000dd30: 2863 656e 7464 6972 5b5f 4344 5f46 494c  (centdir[_CD_FIL
-0000dd40: 454e 414d 455f 4c45 4e47 5448 5d29 0a20  ENAME_LENGTH]). 
-0000dd50: 2020 2020 2020 2020 2020 2066 6c61 6773             flags
-0000dd60: 203d 2063 656e 7464 6972 5b35 5d0a 2020   = centdir[5].  
-0000dd70: 2020 2020 2020 2020 2020 6966 2066 6c61            if fla
-0000dd80: 6773 2026 2030 7838 3030 3a0a 2020 2020  gs & 0x800:.    
-0000dd90: 2020 2020 2020 2020 2020 2020 2320 5554              # UT
-0000dda0: 462d 3820 6669 6c65 206e 616d 6573 2065  F-8 file names e
-0000ddb0: 7874 656e 7369 6f6e 0a20 2020 2020 2020  xtension.       
-0000ddc0: 2020 2020 2020 2020 2066 696c 656e 616d           filenam
-0000ddd0: 6520 3d20 6669 6c65 6e61 6d65 2e64 6563  e = filename.dec
-0000dde0: 6f64 6528 2775 7466 2d38 2729 0a20 2020  ode('utf-8').   
-0000ddf0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0000de00: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0000de10: 2048 6973 746f 7269 6361 6c20 5a49 5020   Historical ZIP 
-0000de20: 6669 6c65 6e61 6d65 2065 6e63 6f64 696e  filename encodin
-0000de30: 670a 2020 2020 2020 2020 2020 2020 2020  g.              
-0000de40: 2020 6669 6c65 6e61 6d65 203d 2066 696c    filename = fil
-0000de50: 656e 616d 652e 6465 636f 6465 2827 6370  ename.decode('cp
-0000de60: 3433 3727 290a 2020 2020 2020 2020 2020  437').          
-0000de70: 2020 2320 4372 6561 7465 205a 6970 496e    # Create ZipIn
-0000de80: 666f 2069 6e73 7461 6e63 6520 746f 2073  fo instance to s
-0000de90: 746f 7265 2066 696c 6520 696e 666f 726d  tore file inform
-0000dea0: 6174 696f 6e0a 2020 2020 2020 2020 2020  ation.          
-0000deb0: 2020 7820 3d20 5a69 7049 6e66 6f28 6669    x = ZipInfo(fi
-0000dec0: 6c65 6e61 6d65 290a 2020 2020 2020 2020  lename).        
-0000ded0: 2020 2020 782e 6578 7472 6120 3d20 6670      x.extra = fp
-0000dee0: 2e72 6561 6428 6365 6e74 6469 725b 5f43  .read(centdir[_C
-0000def0: 445f 4558 5452 415f 4649 454c 445f 4c45  D_EXTRA_FIELD_LE
-0000df00: 4e47 5448 5d29 0a20 2020 2020 2020 2020  NGTH]).         
-0000df10: 2020 2078 2e63 6f6d 6d65 6e74 203d 2066     x.comment = f
-0000df20: 702e 7265 6164 2863 656e 7464 6972 5b5f  p.read(centdir[_
-0000df30: 4344 5f43 4f4d 4d45 4e54 5f4c 454e 4754  CD_COMMENT_LENGT
-0000df40: 485d 290a 2020 2020 2020 2020 2020 2020  H]).            
-0000df50: 782e 6865 6164 6572 5f6f 6666 7365 7420  x.header_offset 
-0000df60: 3d20 6365 6e74 6469 725b 5f43 445f 4c4f  = centdir[_CD_LO
-0000df70: 4341 4c5f 4845 4144 4552 5f4f 4646 5345  CAL_HEADER_OFFSE
-0000df80: 545d 0a20 2020 2020 2020 2020 2020 2028  T].            (
-0000df90: 782e 6372 6561 7465 5f76 6572 7369 6f6e  x.create_version
-0000dfa0: 2c20 782e 6372 6561 7465 5f73 7973 7465  , x.create_syste
-0000dfb0: 6d2c 2078 2e65 7874 7261 6374 5f76 6572  m, x.extract_ver
-0000dfc0: 7369 6f6e 2c20 782e 7265 7365 7276 6564  sion, x.reserved
-0000dfd0: 2c0a 2020 2020 2020 2020 2020 2020 2078  ,.             x
-0000dfe0: 2e66 6c61 675f 6269 7473 2c20 782e 636f  .flag_bits, x.co
-0000dff0: 6d70 7265 7373 5f74 7970 652c 2074 2c20  mpress_type, t, 
-0000e000: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
-0000e010: 782e 4352 432c 2078 2e63 6f6d 7072 6573  x.CRC, x.compres
-0000e020: 735f 7369 7a65 2c20 782e 6669 6c65 5f73  s_size, x.file_s
-0000e030: 697a 6529 203d 2063 656e 7464 6972 5b31  ize) = centdir[1
-0000e040: 3a31 325d 0a20 2020 2020 2020 2020 2020  :12].           
-0000e050: 2069 6620 782e 6578 7472 6163 745f 7665   if x.extract_ve
-0000e060: 7273 696f 6e20 3e20 4d41 585f 4558 5452  rsion > MAX_EXTR
-0000e070: 4143 545f 5645 5253 494f 4e3a 0a20 2020  ACT_VERSION:.   
-0000e080: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-0000e090: 7365 204e 6f74 496d 706c 656d 656e 7465  se NotImplemente
-0000e0a0: 6445 7272 6f72 2822 7a69 7020 6669 6c65  dError("zip file
-0000e0b0: 2076 6572 7369 6f6e 2025 2e31 6622 2025   version %.1f" %
-0000e0c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e0e0: 2020 2020 2020 2020 2020 2028 782e 6578             (x.ex
-0000e0f0: 7472 6163 745f 7665 7273 696f 6e20 2f20  tract_version / 
-0000e100: 3130 2929 0a20 2020 2020 2020 2020 2020  10)).           
-0000e110: 2078 2e76 6f6c 756d 652c 2078 2e69 6e74   x.volume, x.int
-0000e120: 6572 6e61 6c5f 6174 7472 2c20 782e 6578  ernal_attr, x.ex
-0000e130: 7465 726e 616c 5f61 7474 7220 3d20 6365  ternal_attr = ce
-0000e140: 6e74 6469 725b 3135 3a31 385d 0a20 2020  ntdir[15:18].   
-0000e150: 2020 2020 2020 2020 2023 2043 6f6e 7665           # Conve
-0000e160: 7274 2064 6174 652f 7469 6d65 2063 6f64  rt date/time cod
-0000e170: 6520 746f 2028 7965 6172 2c20 6d6f 6e74  e to (year, mont
-0000e180: 682c 2064 6179 2c20 686f 7572 2c20 6d69  h, day, hour, mi
-0000e190: 6e2c 2073 6563 290a 2020 2020 2020 2020  n, sec).        
-0000e1a0: 2020 2020 782e 5f72 6177 5f74 696d 6520      x._raw_time 
-0000e1b0: 3d20 740a 2020 2020 2020 2020 2020 2020  = t.            
-0000e1c0: 782e 6461 7465 5f74 696d 6520 3d20 2820  x.date_time = ( 
-0000e1d0: 2864 3e3e 3929 2b31 3938 302c 2028 643e  (d>>9)+1980, (d>
-0000e1e0: 3e35 2926 3078 462c 2064 2630 7831 462c  >5)&0xF, d&0x1F,
-0000e1f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e200: 2020 2020 2020 2020 2020 2020 2074 3e3e               t>>
-0000e210: 3131 2c20 2874 3e3e 3529 2630 7833 462c  11, (t>>5)&0x3F,
-0000e220: 2028 7426 3078 3146 2920 2a20 3220 290a   (t&0x1F) * 2 ).
-0000e230: 0a20 2020 2020 2020 2020 2020 2078 2e5f  .            x._
-0000e240: 6465 636f 6465 4578 7472 6128 290a 2020  decodeExtra().  
-0000e250: 2020 2020 2020 2020 2020 782e 6865 6164            x.head
-0000e260: 6572 5f6f 6666 7365 7420 3d20 782e 6865  er_offset = x.he
-0000e270: 6164 6572 5f6f 6666 7365 7420 2b20 636f  ader_offset + co
-0000e280: 6e63 6174 0a20 2020 2020 2020 2020 2020  ncat.           
-0000e290: 2073 656c 662e 6669 6c65 6c69 7374 2e61   self.filelist.a
-0000e2a0: 7070 656e 6428 7829 0a20 2020 2020 2020  ppend(x).       
-0000e2b0: 2020 2020 2073 656c 662e 4e61 6d65 546f       self.NameTo
-0000e2c0: 496e 666f 5b78 2e66 696c 656e 616d 655d  Info[x.filename]
-0000e2d0: 203d 2078 0a0a 2020 2020 2020 2020 2020   = x..          
-0000e2e0: 2020 2320 7570 6461 7465 2074 6f74 616c    # update total
-0000e2f0: 2062 7974 6573 2072 6561 6420 6672 6f6d   bytes read from
-0000e300: 2063 656e 7472 616c 2064 6972 6563 746f   central directo
-0000e310: 7279 0a20 2020 2020 2020 2020 2020 2074  ry.            t
-0000e320: 6f74 616c 203d 2028 746f 7461 6c20 2b20  otal = (total + 
-0000e330: 7369 7a65 4365 6e74 7261 6c44 6972 202b  sizeCentralDir +
-0000e340: 2063 656e 7464 6972 5b5f 4344 5f46 494c   centdir[_CD_FIL
-0000e350: 454e 414d 455f 4c45 4e47 5448 5d0a 2020  ENAME_LENGTH].  
-0000e360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e370: 2020 202b 2063 656e 7464 6972 5b5f 4344     + centdir[_CD
-0000e380: 5f45 5854 5241 5f46 4945 4c44 5f4c 454e  _EXTRA_FIELD_LEN
-0000e390: 4754 485d 0a20 2020 2020 2020 2020 2020  GTH].           
-0000e3a0: 2020 2020 2020 2020 2020 2b20 6365 6e74            + cent
-0000e3b0: 6469 725b 5f43 445f 434f 4d4d 454e 545f  dir[_CD_COMMENT_
-0000e3c0: 4c45 4e47 5448 5d29 0a0a 2020 2020 2020  LENGTH])..      
-0000e3d0: 2020 2020 2020 6966 2073 656c 662e 6465        if self.de
-0000e3e0: 6275 6720 3e20 323a 0a20 2020 2020 2020  bug > 2:.       
-0000e3f0: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
-0000e400: 746f 7461 6c22 2c20 746f 7461 6c29 0a0a  total", total)..
-0000e410: 0a20 2020 2064 6566 206e 616d 656c 6973  .    def namelis
-0000e420: 7428 7365 6c66 293a 0a20 2020 2020 2020  t(self):.       
-0000e430: 2022 2222 5265 7475 726e 2061 206c 6973   """Return a lis
-0000e440: 7420 6f66 2066 696c 6520 6e61 6d65 7320  t of file names 
-0000e450: 696e 2074 6865 2061 7263 6869 7665 2e22  in the archive."
-0000e460: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
-0000e470: 6e20 5b64 6174 612e 6669 6c65 6e61 6d65  n [data.filename
-0000e480: 2066 6f72 2064 6174 6120 696e 2073 656c   for data in sel
-0000e490: 662e 6669 6c65 6c69 7374 5d0a 0a20 2020  f.filelist]..   
-0000e4a0: 2064 6566 2069 6e66 6f6c 6973 7428 7365   def infolist(se
-0000e4b0: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
-0000e4c0: 5265 7475 726e 2061 206c 6973 7420 6f66  Return a list of
-0000e4d0: 2063 6c61 7373 205a 6970 496e 666f 2069   class ZipInfo i
-0000e4e0: 6e73 7461 6e63 6573 2066 6f72 2066 696c  nstances for fil
-0000e4f0: 6573 2069 6e20 7468 650a 2020 2020 2020  es in the.      
-0000e500: 2020 6172 6368 6976 652e 2222 220a 2020    archive.""".  
-0000e510: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0000e520: 662e 6669 6c65 6c69 7374 0a0a 2020 2020  f.filelist..    
-0000e530: 6465 6620 7072 696e 7464 6972 2873 656c  def printdir(sel
-0000e540: 662c 2066 696c 653d 4e6f 6e65 293a 0a20  f, file=None):. 
-0000e550: 2020 2020 2020 2022 2222 5072 696e 7420         """Print 
-0000e560: 6120 7461 626c 6520 6f66 2063 6f6e 7465  a table of conte
-0000e570: 6e74 7320 666f 7220 7468 6520 7a69 7020  nts for the zip 
-0000e580: 6669 6c65 2e22 2222 0a20 2020 2020 2020  file.""".       
-0000e590: 2070 7269 6e74 2822 252d 3436 7320 2531   print("%-46s %1
-0000e5a0: 3973 2025 3132 7322 2025 2028 2246 696c  9s %12s" % ("Fil
-0000e5b0: 6520 4e61 6d65 222c 2022 4d6f 6469 6669  e Name", "Modifi
-0000e5c0: 6564 2020 2020 222c 2022 5369 7a65 2229  ed    ", "Size")
-0000e5d0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000e5e0: 6669 6c65 3d66 696c 6529 0a20 2020 2020  file=file).     
-0000e5f0: 2020 2066 6f72 207a 696e 666f 2069 6e20     for zinfo in 
-0000e600: 7365 6c66 2e66 696c 656c 6973 743a 0a20  self.filelist:. 
-0000e610: 2020 2020 2020 2020 2020 2064 6174 6520             date 
-0000e620: 3d20 2225 642d 2530 3264 2d25 3032 6420  = "%d-%02d-%02d 
-0000e630: 2530 3264 3a25 3032 643a 2530 3264 2220  %02d:%02d:%02d" 
-0000e640: 2520 7a69 6e66 6f2e 6461 7465 5f74 696d  % zinfo.date_tim
-0000e650: 655b 3a36 5d0a 2020 2020 2020 2020 2020  e[:6].          
-0000e660: 2020 7072 696e 7428 2225 2d34 3673 2025    print("%-46s %
-0000e670: 7320 2531 3264 2220 2520 287a 696e 666f  s %12d" % (zinfo
-0000e680: 2e66 696c 656e 616d 652c 2064 6174 652c  .filename, date,
-0000e690: 207a 696e 666f 2e66 696c 655f 7369 7a65   zinfo.file_size
-0000e6a0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-0000e6b0: 2020 2020 2066 696c 653d 6669 6c65 290a       file=file).
-0000e6c0: 0a20 2020 2064 6566 2074 6573 747a 6970  .    def testzip
-0000e6d0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-0000e6e0: 2222 2252 6561 6420 616c 6c20 7468 6520  """Read all the 
-0000e6f0: 6669 6c65 7320 616e 6420 6368 6563 6b20  files and check 
-0000e700: 7468 6520 4352 432e 2222 220a 2020 2020  the CRC.""".    
-0000e710: 2020 2020 6368 756e 6b5f 7369 7a65 203d      chunk_size =
-0000e720: 2032 202a 2a20 3230 0a20 2020 2020 2020   2 ** 20.       
-0000e730: 2066 6f72 207a 696e 666f 2069 6e20 7365   for zinfo in se
-0000e740: 6c66 2e66 696c 656c 6973 743a 0a20 2020  lf.filelist:.   
-0000e750: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
-0000e760: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0000e770: 5265 6164 2062 7920 6368 756e 6b73 2c20  Read by chunks, 
-0000e780: 746f 2061 766f 6964 2061 6e20 4f76 6572  to avoid an Over
-0000e790: 666c 6f77 4572 726f 7220 6f72 2061 0a20  flowError or a. 
-0000e7a0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0000e7b0: 204d 656d 6f72 7945 7272 6f72 2077 6974   MemoryError wit
-0000e7c0: 6820 7665 7279 206c 6172 6765 2065 6d62  h very large emb
-0000e7d0: 6564 6465 6420 6669 6c65 732e 0a20 2020  edded files..   
-0000e7e0: 2020 2020 2020 2020 2020 2020 2077 6974               wit
-0000e7f0: 6820 7365 6c66 2e6f 7065 6e28 7a69 6e66  h self.open(zinf
-0000e800: 6f2e 6669 6c65 6e61 6d65 2c20 2272 2229  o.filename, "r")
-0000e810: 2061 7320 663a 0a20 2020 2020 2020 2020   as f:.         
-0000e820: 2020 2020 2020 2020 2020 2077 6869 6c65             while
-0000e830: 2066 2e72 6561 6428 6368 756e 6b5f 7369   f.read(chunk_si
-0000e840: 7a65 293a 2020 2020 2023 2043 6865 636b  ze):     # Check
-0000e850: 2043 5243 2d33 320a 2020 2020 2020 2020   CRC-32.        
-0000e860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e870: 7061 7373 0a20 2020 2020 2020 2020 2020  pass.           
-0000e880: 2065 7863 6570 7420 4261 645a 6970 4669   except BadZipFi
-0000e890: 6c65 3a0a 2020 2020 2020 2020 2020 2020  le:.            
-0000e8a0: 2020 2020 7265 7475 726e 207a 696e 666f      return zinfo
-0000e8b0: 2e66 696c 656e 616d 650a 0a20 2020 2064  .filename..    d
-0000e8c0: 6566 2067 6574 696e 666f 2873 656c 662c  ef getinfo(self,
-0000e8d0: 206e 616d 6529 3a0a 2020 2020 2020 2020   name):.        
-0000e8e0: 2222 2252 6574 7572 6e20 7468 6520 696e  """Return the in
-0000e8f0: 7374 616e 6365 206f 6620 5a69 7049 6e66  stance of ZipInf
-0000e900: 6f20 6769 7665 6e20 276e 616d 6527 2e22  o given 'name'."
-0000e910: 2222 0a20 2020 2020 2020 2069 6e66 6f20  "".        info 
-0000e920: 3d20 7365 6c66 2e4e 616d 6554 6f49 6e66  = self.NameToInf
-0000e930: 6f2e 6765 7428 6e61 6d65 290a 2020 2020  o.get(name).    
-0000e940: 2020 2020 6966 2069 6e66 6f20 6973 204e      if info is N
-0000e950: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0000e960: 2072 6169 7365 204b 6579 4572 726f 7228   raise KeyError(
-0000e970: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e980: 2027 5468 6572 6520 6973 206e 6f20 6974   'There is no it
-0000e990: 656d 206e 616d 6564 2025 7220 696e 2074  em named %r in t
-0000e9a0: 6865 2061 7263 6869 7665 2720 2520 6e61  he archive' % na
-0000e9b0: 6d65 290a 0a20 2020 2020 2020 2072 6574  me)..        ret
-0000e9c0: 7572 6e20 696e 666f 0a0a 2020 2020 6465  urn info..    de
-0000e9d0: 6620 7365 7470 6173 7377 6f72 6428 7365  f setpassword(se
-0000e9e0: 6c66 2c20 7077 6429 3a0a 2020 2020 2020  lf, pwd):.      
-0000e9f0: 2020 2222 2253 6574 2064 6566 6175 6c74    """Set default
-0000ea00: 2070 6173 7377 6f72 6420 666f 7220 656e   password for en
-0000ea10: 6372 7970 7465 6420 6669 6c65 732e 2222  crypted files.""
-0000ea20: 220a 2020 2020 2020 2020 6966 2070 7764  ".        if pwd
-0000ea30: 2061 6e64 206e 6f74 2069 7369 6e73 7461   and not isinsta
-0000ea40: 6e63 6528 7077 642c 2062 7974 6573 293a  nce(pwd, bytes):
-0000ea50: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0000ea60: 7365 2054 7970 6545 7272 6f72 2822 7077  se TypeError("pw
-0000ea70: 643a 2065 7870 6563 7465 6420 6279 7465  d: expected byte
-0000ea80: 732c 2067 6f74 2025 7322 2025 2074 7970  s, got %s" % typ
-0000ea90: 6528 7077 6429 2e5f 5f6e 616d 655f 5f29  e(pwd).__name__)
-0000eaa0: 0a20 2020 2020 2020 2069 6620 7077 643a  .        if pwd:
-0000eab0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000eac0: 662e 7077 6420 3d20 7077 640a 2020 2020  f.pwd = pwd.    
-0000ead0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0000eae0: 2020 2020 2020 7365 6c66 2e70 7764 203d        self.pwd =
-0000eaf0: 204e 6f6e 650a 0a20 2020 2040 7072 6f70   None..    @prop
-0000eb00: 6572 7479 0a20 2020 2064 6566 2063 6f6d  erty.    def com
-0000eb10: 6d65 6e74 2873 656c 6629 3a0a 2020 2020  ment(self):.    
-0000eb20: 2020 2020 2222 2254 6865 2063 6f6d 6d65      """The comme
-0000eb30: 6e74 2074 6578 7420 6173 736f 6369 6174  nt text associat
-0000eb40: 6564 2077 6974 6820 7468 6520 5a49 5020  ed with the ZIP 
-0000eb50: 6669 6c65 2e22 2222 0a20 2020 2020 2020  file.""".       
-0000eb60: 2072 6574 7572 6e20 7365 6c66 2e5f 636f   return self._co
-0000eb70: 6d6d 656e 740a 0a20 2020 2040 636f 6d6d  mment..    @comm
-0000eb80: 656e 742e 7365 7474 6572 0a20 2020 2064  ent.setter.    d
-0000eb90: 6566 2063 6f6d 6d65 6e74 2873 656c 662c  ef comment(self,
-0000eba0: 2063 6f6d 6d65 6e74 293a 0a20 2020 2020   comment):.     
-0000ebb0: 2020 2069 6620 6e6f 7420 6973 696e 7374     if not isinst
-0000ebc0: 616e 6365 2863 6f6d 6d65 6e74 2c20 6279  ance(comment, by
-0000ebd0: 7465 7329 3a0a 2020 2020 2020 2020 2020  tes):.          
-0000ebe0: 2020 7261 6973 6520 5479 7065 4572 726f    raise TypeErro
-0000ebf0: 7228 2263 6f6d 6d65 6e74 3a20 6578 7065  r("comment: expe
-0000ec00: 6374 6564 2062 7974 6573 2c20 676f 7420  cted bytes, got 
-0000ec10: 2573 2220 2520 7479 7065 2863 6f6d 6d65  %s" % type(comme
-0000ec20: 6e74 292e 5f5f 6e61 6d65 5f5f 290a 2020  nt).__name__).  
-0000ec30: 2020 2020 2020 2320 6368 6563 6b20 666f        # check fo
-0000ec40: 7220 7661 6c69 6420 636f 6d6d 656e 7420  r valid comment 
-0000ec50: 6c65 6e67 7468 0a20 2020 2020 2020 2069  length.        i
-0000ec60: 6620 6c65 6e28 636f 6d6d 656e 7429 203e  f len(comment) >
-0000ec70: 205a 4950 5f4d 4158 5f43 4f4d 4d45 4e54   ZIP_MAX_COMMENT
-0000ec80: 3a0a 2020 2020 2020 2020 2020 2020 696d  :.            im
-0000ec90: 706f 7274 2077 6172 6e69 6e67 730a 2020  port warnings.  
-0000eca0: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
-0000ecb0: 6773 2e77 6172 6e28 2741 7263 6869 7665  gs.warn('Archive
-0000ecc0: 2063 6f6d 6d65 6e74 2069 7320 746f 6f20   comment is too 
-0000ecd0: 6c6f 6e67 3b20 7472 756e 6361 7469 6e67  long; truncating
-0000ece0: 2074 6f20 2564 2062 7974 6573 270a 2020   to %d bytes'.  
-0000ecf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ed00: 2020 2020 2020 2020 2520 5a49 505f 4d41          % ZIP_MA
-0000ed10: 585f 434f 4d4d 454e 542c 2073 7461 636b  X_COMMENT, stack
-0000ed20: 6c65 7665 6c3d 3229 0a20 2020 2020 2020  level=2).       
-0000ed30: 2020 2020 2063 6f6d 6d65 6e74 203d 2063       comment = c
-0000ed40: 6f6d 6d65 6e74 5b3a 5a49 505f 4d41 585f  omment[:ZIP_MAX_
-0000ed50: 434f 4d4d 454e 545d 0a20 2020 2020 2020  COMMENT].       
-0000ed60: 2073 656c 662e 5f63 6f6d 6d65 6e74 203d   self._comment =
-0000ed70: 2063 6f6d 6d65 6e74 0a20 2020 2020 2020   comment.       
-0000ed80: 2073 656c 662e 5f64 6964 4d6f 6469 6679   self._didModify
-0000ed90: 203d 2054 7275 650a 0a20 2020 2064 6566   = True..    def
-0000eda0: 2072 6561 6428 7365 6c66 2c20 6e61 6d65   read(self, name
-0000edb0: 2c20 7077 643d 4e6f 6e65 293a 0a20 2020  , pwd=None):.   
-0000edc0: 2020 2020 2022 2222 5265 7475 726e 2066       """Return f
-0000edd0: 696c 6520 6279 7465 7320 666f 7220 6e61  ile bytes for na
-0000ede0: 6d65 2e22 2222 0a20 2020 2020 2020 2077  me.""".        w
-0000edf0: 6974 6820 7365 6c66 2e6f 7065 6e28 6e61  ith self.open(na
-0000ee00: 6d65 2c20 2272 222c 2070 7764 2920 6173  me, "r", pwd) as
-0000ee10: 2066 703a 0a20 2020 2020 2020 2020 2020   fp:.           
-0000ee20: 2072 6574 7572 6e20 6670 2e72 6561 6428   return fp.read(
-0000ee30: 290a 0a20 2020 2064 6566 206f 7065 6e28  )..    def open(
-0000ee40: 7365 6c66 2c20 6e61 6d65 2c20 6d6f 6465  self, name, mode
-0000ee50: 3d22 7222 2c20 7077 643d 4e6f 6e65 2c20  ="r", pwd=None, 
-0000ee60: 666f 7263 655f 7a69 7036 343d 4661 6c73  force_zip64=Fals
-0000ee70: 6529 3a0a 2020 2020 2020 2020 2222 2252  e):.        """R
-0000ee80: 6574 7572 6e20 6669 6c65 2d6c 696b 6520  eturn file-like 
-0000ee90: 6f62 6a65 6374 2066 6f72 2027 6e61 6d65  object for 'name
-0000eea0: 272e 0a0a 2020 2020 2020 2020 6e61 6d65  '...        name
-0000eeb0: 2069 7320 6120 7374 7269 6e67 2066 6f72   is a string for
-0000eec0: 2074 6865 2066 696c 6520 6e61 6d65 2077   the file name w
-0000eed0: 6974 6869 6e20 7468 6520 5a49 5020 6669  ithin the ZIP fi
-0000eee0: 6c65 2c20 6f72 2061 205a 6970 496e 666f  le, or a ZipInfo
-0000eef0: 0a20 2020 2020 2020 206f 626a 6563 742e  .        object.
-0000ef00: 0a0a 2020 2020 2020 2020 6d6f 6465 2073  ..        mode s
-0000ef10: 686f 756c 6420 6265 2027 7227 2074 6f20  hould be 'r' to 
-0000ef20: 7265 6164 2061 2066 696c 6520 616c 7265  read a file alre
-0000ef30: 6164 7920 696e 2074 6865 205a 4950 2066  ady in the ZIP f
-0000ef40: 696c 652c 206f 7220 2777 2720 746f 0a20  ile, or 'w' to. 
-0000ef50: 2020 2020 2020 2077 7269 7465 2074 6f20         write to 
-0000ef60: 6120 6669 6c65 206e 6577 6c79 2061 6464  a file newly add
-0000ef70: 6564 2074 6f20 7468 6520 6172 6368 6976  ed to the archiv
-0000ef80: 652e 0a0a 2020 2020 2020 2020 7077 6420  e...        pwd 
-0000ef90: 6973 2074 6865 2070 6173 7377 6f72 6420  is the password 
-0000efa0: 746f 2064 6563 7279 7074 2066 696c 6573  to decrypt files
-0000efb0: 2028 6f6e 6c79 2075 7365 6420 666f 7220   (only used for 
-0000efc0: 7265 6164 696e 6729 2e0a 0a20 2020 2020  reading)...     
-0000efd0: 2020 2057 6865 6e20 7772 6974 696e 672c     When writing,
-0000efe0: 2069 6620 7468 6520 6669 6c65 2073 697a   if the file siz
-0000eff0: 6520 6973 206e 6f74 206b 6e6f 776e 2069  e is not known i
-0000f000: 6e20 6164 7661 6e63 6520 6275 7420 6d61  n advance but ma
-0000f010: 7920 6578 6365 6564 0a20 2020 2020 2020  y exceed.       
-0000f020: 2032 2047 6942 2c20 7061 7373 2066 6f72   2 GiB, pass for
-0000f030: 6365 5f7a 6970 3634 2074 6f20 7573 6520  ce_zip64 to use 
-0000f040: 7468 6520 5a49 5036 3420 666f 726d 6174  the ZIP64 format
-0000f050: 2c20 7768 6963 6820 6361 6e20 6861 6e64  , which can hand
-0000f060: 6c65 206c 6172 6765 0a20 2020 2020 2020  le large.       
-0000f070: 2066 696c 6573 2e20 2049 6620 7468 6520   files.  If the 
-0000f080: 7369 7a65 2069 7320 6b6e 6f77 6e20 696e  size is known in
-0000f090: 2061 6476 616e 6365 2c20 6974 2069 7320   advance, it is 
-0000f0a0: 6265 7374 2074 6f20 7061 7373 2061 205a  best to pass a Z
-0000f0b0: 6970 496e 666f 0a20 2020 2020 2020 2069  ipInfo.        i
-0000f0c0: 6e73 7461 6e63 6520 666f 7220 6e61 6d65  nstance for name
-0000f0d0: 2c20 7769 7468 207a 696e 666f 2e66 696c  , with zinfo.fil
-0000f0e0: 655f 7369 7a65 2073 6574 2e0a 2020 2020  e_size set..    
-0000f0f0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000f100: 6966 206d 6f64 6520 6e6f 7420 696e 207b  if mode not in {
-0000f110: 2272 222c 2022 7722 7d3a 0a20 2020 2020  "r", "w"}:.     
-0000f120: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-0000f130: 7565 4572 726f 7228 276f 7065 6e28 2920  ueError('open() 
-0000f140: 7265 7175 6972 6573 206d 6f64 6520 2272  requires mode "r
-0000f150: 2220 6f72 2022 7722 2729 0a20 2020 2020  " or "w"').     
-0000f160: 2020 2069 6620 7077 6420 616e 6420 6e6f     if pwd and no
-0000f170: 7420 6973 696e 7374 616e 6365 2870 7764  t isinstance(pwd
-0000f180: 2c20 6279 7465 7329 3a0a 2020 2020 2020  , bytes):.      
-0000f190: 2020 2020 2020 7261 6973 6520 5479 7065        raise Type
-0000f1a0: 4572 726f 7228 2270 7764 3a20 6578 7065  Error("pwd: expe
-0000f1b0: 6374 6564 2062 7974 6573 2c20 676f 7420  cted bytes, got 
-0000f1c0: 2573 2220 2520 7479 7065 2870 7764 292e  %s" % type(pwd).
-0000f1d0: 5f5f 6e61 6d65 5f5f 290a 2020 2020 2020  __name__).      
-0000f1e0: 2020 6966 2070 7764 2061 6e64 2028 6d6f    if pwd and (mo
-0000f1f0: 6465 203d 3d20 2277 2229 3a0a 2020 2020  de == "w"):.    
-0000f200: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-0000f210: 6c75 6545 7272 6f72 2822 7077 6420 6973  lueError("pwd is
-0000f220: 206f 6e6c 7920 7375 7070 6f72 7465 6420   only supported 
-0000f230: 666f 7220 7265 6164 696e 6720 6669 6c65  for reading file
-0000f240: 7322 290a 2020 2020 2020 2020 6966 206e  s").        if n
-0000f250: 6f74 2073 656c 662e 6670 3a0a 2020 2020  ot self.fp:.    
-0000f260: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-0000f270: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
-0000f280: 2020 2020 2020 2020 2020 2241 7474 656d            "Attem
-0000f290: 7074 2074 6f20 7573 6520 5a49 5020 6172  pt to use ZIP ar
-0000f2a0: 6368 6976 6520 7468 6174 2077 6173 2061  chive that was a
-0000f2b0: 6c72 6561 6479 2063 6c6f 7365 6422 290a  lready closed").
-0000f2c0: 0a20 2020 2020 2020 2023 204d 616b 6520  .        # Make 
-0000f2d0: 7375 7265 2077 6520 6861 7665 2061 6e20  sure we have an 
-0000f2e0: 696e 666f 206f 626a 6563 740a 2020 2020  info object.    
-0000f2f0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-0000f300: 6528 6e61 6d65 2c20 5a69 7049 6e66 6f29  e(name, ZipInfo)
-0000f310: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-0000f320: 276e 616d 6527 2069 7320 616c 7265 6164  'name' is alread
-0000f330: 7920 616e 2069 6e66 6f20 6f62 6a65 6374  y an info object
-0000f340: 0a20 2020 2020 2020 2020 2020 207a 696e  .            zin
-0000f350: 666f 203d 206e 616d 650a 2020 2020 2020  fo = name.      
-0000f360: 2020 656c 6966 206d 6f64 6520 3d3d 2027    elif mode == '
-0000f370: 7727 3a0a 2020 2020 2020 2020 2020 2020  w':.            
-0000f380: 7a69 6e66 6f20 3d20 5a69 7049 6e66 6f28  zinfo = ZipInfo(
-0000f390: 6e61 6d65 290a 2020 2020 2020 2020 2020  name).          
-0000f3a0: 2020 7a69 6e66 6f2e 636f 6d70 7265 7373    zinfo.compress
-0000f3b0: 5f74 7970 6520 3d20 7365 6c66 2e63 6f6d  _type = self.com
-0000f3c0: 7072 6573 7369 6f6e 0a20 2020 2020 2020  pression.       
-0000f3d0: 2020 2020 207a 696e 666f 2e5f 636f 6d70       zinfo._comp
-0000f3e0: 7265 7373 6c65 7665 6c20 3d20 7365 6c66  resslevel = self
-0000f3f0: 2e63 6f6d 7072 6573 736c 6576 656c 0a20  .compresslevel. 
-0000f400: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000f410: 2020 2020 2020 2020 2023 2047 6574 2069           # Get i
-0000f420: 6e66 6f20 6f62 6a65 6374 2066 6f72 206e  nfo object for n
-0000f430: 616d 650a 2020 2020 2020 2020 2020 2020  ame.            
-0000f440: 7a69 6e66 6f20 3d20 7365 6c66 2e67 6574  zinfo = self.get
-0000f450: 696e 666f 286e 616d 6529 0a0a 2020 2020  info(name)..    
-0000f460: 2020 2020 6966 206d 6f64 6520 3d3d 2027      if mode == '
-0000f470: 7727 3a0a 2020 2020 2020 2020 2020 2020  w':.            
-0000f480: 7265 7475 726e 2073 656c 662e 5f6f 7065  return self._ope
-0000f490: 6e5f 746f 5f77 7269 7465 287a 696e 666f  n_to_write(zinfo
-0000f4a0: 2c20 666f 7263 655f 7a69 7036 343d 666f  , force_zip64=fo
-0000f4b0: 7263 655f 7a69 7036 3429 0a0a 2020 2020  rce_zip64)..    
-0000f4c0: 2020 2020 6966 2073 656c 662e 5f77 7269      if self._wri
-0000f4d0: 7469 6e67 3a0a 2020 2020 2020 2020 2020  ting:.          
-0000f4e0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-0000f4f0: 6f72 2822 4361 6e27 7420 7265 6164 2066  or("Can't read f
-0000f500: 726f 6d20 7468 6520 5a49 5020 6669 6c65  rom the ZIP file
-0000f510: 2077 6869 6c65 2074 6865 7265 2022 0a20   while there ". 
-0000f520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f530: 2020 2022 6973 2061 6e20 6f70 656e 2077     "is an open w
-0000f540: 7269 7469 6e67 2068 616e 646c 6520 6f6e  riting handle on
-0000f550: 2069 742e 2022 0a20 2020 2020 2020 2020   it. ".         
-0000f560: 2020 2020 2020 2020 2020 2022 436c 6f73             "Clos
-0000f570: 6520 7468 6520 7772 6974 696e 6720 6861  e the writing ha
-0000f580: 6e64 6c65 2062 6566 6f72 6520 7472 7969  ndle before tryi
-0000f590: 6e67 2074 6f20 7265 6164 2e22 290a 0a20  ng to read.").. 
-0000f5a0: 2020 2020 2020 2023 204f 7065 6e20 666f         # Open fo
-0000f5b0: 7220 7265 6164 696e 673a 0a20 2020 2020  r reading:.     
-0000f5c0: 2020 2073 656c 662e 5f66 696c 6552 6566     self._fileRef
-0000f5d0: 436e 7420 2b3d 2031 0a20 2020 2020 2020  Cnt += 1.       
-0000f5e0: 207a 6566 5f66 696c 6520 3d20 5f53 6861   zef_file = _Sha
-0000f5f0: 7265 6446 696c 6528 7365 6c66 2e66 702c  redFile(self.fp,
-0000f600: 207a 696e 666f 2e68 6561 6465 725f 6f66   zinfo.header_of
-0000f610: 6673 6574 2c0a 2020 2020 2020 2020 2020  fset,.          
-0000f620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f630: 2020 2020 2073 656c 662e 5f66 7063 6c6f       self._fpclo
-0000f640: 7365 2c20 7365 6c66 2e5f 6c6f 636b 2c20  se, self._lock, 
-0000f650: 6c61 6d62 6461 3a20 7365 6c66 2e5f 7772  lambda: self._wr
-0000f660: 6974 696e 6729 0a20 2020 2020 2020 2074  iting).        t
-0000f670: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-0000f680: 2320 536b 6970 2074 6865 2066 696c 6520  # Skip the file 
-0000f690: 6865 6164 6572 3a0a 2020 2020 2020 2020  header:.        
-0000f6a0: 2020 2020 6668 6561 6465 7220 3d20 7a65      fheader = ze
-0000f6b0: 665f 6669 6c65 2e72 6561 6428 7369 7a65  f_file.read(size
-0000f6c0: 4669 6c65 4865 6164 6572 290a 2020 2020  FileHeader).    
-0000f6d0: 2020 2020 2020 2020 6966 206c 656e 2866          if len(f
-0000f6e0: 6865 6164 6572 2920 213d 2073 697a 6546  header) != sizeF
-0000f6f0: 696c 6548 6561 6465 723a 0a20 2020 2020  ileHeader:.     
-0000f700: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0000f710: 2042 6164 5a69 7046 696c 6528 2254 7275   BadZipFile("Tru
-0000f720: 6e63 6174 6564 2066 696c 6520 6865 6164  ncated file head
-0000f730: 6572 2229 0a20 2020 2020 2020 2020 2020  er").           
-0000f740: 2066 6865 6164 6572 203d 2073 7472 7563   fheader = struc
-0000f750: 742e 756e 7061 636b 2873 7472 7563 7446  t.unpack(structF
-0000f760: 696c 6548 6561 6465 722c 2066 6865 6164  ileHeader, fhead
-0000f770: 6572 290a 2020 2020 2020 2020 2020 2020  er).            
-0000f780: 6966 2066 6865 6164 6572 5b5f 4648 5f53  if fheader[_FH_S
-0000f790: 4947 4e41 5455 5245 5d20 213d 2073 7472  IGNATURE] != str
-0000f7a0: 696e 6746 696c 6548 6561 6465 723a 0a20  ingFileHeader:. 
-0000f7b0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000f7c0: 6169 7365 2042 6164 5a69 7046 696c 6528  aise BadZipFile(
-0000f7d0: 2242 6164 206d 6167 6963 206e 756d 6265  "Bad magic numbe
-0000f7e0: 7220 666f 7220 6669 6c65 2068 6561 6465  r for file heade
-0000f7f0: 7222 290a 0a20 2020 2020 2020 2020 2020  r")..           
-0000f800: 2066 6e61 6d65 203d 207a 6566 5f66 696c   fname = zef_fil
-0000f810: 652e 7265 6164 2866 6865 6164 6572 5b5f  e.read(fheader[_
-0000f820: 4648 5f46 494c 454e 414d 455f 4c45 4e47  FH_FILENAME_LENG
-0000f830: 5448 5d29 0a20 2020 2020 2020 2020 2020  TH]).           
-0000f840: 2069 6620 6668 6561 6465 725b 5f46 485f   if fheader[_FH_
-0000f850: 4558 5452 415f 4649 454c 445f 4c45 4e47  EXTRA_FIELD_LENG
-0000f860: 5448 5d3a 0a20 2020 2020 2020 2020 2020  TH]:.           
-0000f870: 2020 2020 207a 6566 5f66 696c 652e 7265       zef_file.re
-0000f880: 6164 2866 6865 6164 6572 5b5f 4648 5f45  ad(fheader[_FH_E
-0000f890: 5854 5241 5f46 4945 4c44 5f4c 454e 4754  XTRA_FIELD_LENGT
-0000f8a0: 485d 290a 0a20 2020 2020 2020 2020 2020  H])..           
-0000f8b0: 2069 6620 7a69 6e66 6f2e 666c 6167 5f62   if zinfo.flag_b
-0000f8c0: 6974 7320 2620 3078 3230 3a0a 2020 2020  its & 0x20:.    
-0000f8d0: 2020 2020 2020 2020 2020 2020 2320 5a69              # Zi
-0000f8e0: 7020 322e 373a 2063 6f6d 7072 6573 7365  p 2.7: compresse
-0000f8f0: 6420 7061 7463 6865 6420 6461 7461 0a20  d patched data. 
-0000f900: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000f910: 6169 7365 204e 6f74 496d 706c 656d 656e  aise NotImplemen
-0000f920: 7465 6445 7272 6f72 2822 636f 6d70 7265  tedError("compre
-0000f930: 7373 6564 2070 6174 6368 6564 2064 6174  ssed patched dat
-0000f940: 6120 2866 6c61 6720 6269 7420 3529 2229  a (flag bit 5)")
-0000f950: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-0000f960: 207a 696e 666f 2e66 6c61 675f 6269 7473   zinfo.flag_bits
-0000f970: 2026 2030 7834 303a 0a20 2020 2020 2020   & 0x40:.       
-0000f980: 2020 2020 2020 2020 2023 2073 7472 6f6e           # stron
-0000f990: 6720 656e 6372 7970 7469 6f6e 0a20 2020  g encryption.   
-0000f9a0: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-0000f9b0: 7365 204e 6f74 496d 706c 656d 656e 7465  se NotImplemente
-0000f9c0: 6445 7272 6f72 2822 7374 726f 6e67 2065  dError("strong e
-0000f9d0: 6e63 7279 7074 696f 6e20 2866 6c61 6720  ncryption (flag 
-0000f9e0: 6269 7420 3629 2229 0a0a 2020 2020 2020  bit 6)")..      
-0000f9f0: 2020 2020 2020 6966 2066 6865 6164 6572        if fheader
-0000fa00: 5b5f 4648 5f47 454e 4552 414c 5f50 5552  [_FH_GENERAL_PUR
-0000fa10: 504f 5345 5f46 4c41 475f 4249 5453 5d20  POSE_FLAG_BITS] 
-0000fa20: 2620 3078 3830 303a 0a20 2020 2020 2020  & 0x800:.       
-0000fa30: 2020 2020 2020 2020 2023 2055 5446 2d38           # UTF-8
-0000fa40: 2066 696c 656e 616d 650a 2020 2020 2020   filename.      
-0000fa50: 2020 2020 2020 2020 2020 666e 616d 655f            fname_
-0000fa60: 7374 7220 3d20 666e 616d 652e 6465 636f  str = fname.deco
-0000fa70: 6465 2822 7574 662d 3822 290a 2020 2020  de("utf-8").    
-0000fa80: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0000fa90: 2020 2020 2020 2020 2020 2020 2020 666e                fn
-0000faa0: 616d 655f 7374 7220 3d20 666e 616d 652e  ame_str = fname.
-0000fab0: 6465 636f 6465 2822 6370 3433 3722 290a  decode("cp437").
-0000fac0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000fad0: 666e 616d 655f 7374 7220 213d 207a 696e  fname_str != zin
-0000fae0: 666f 2e6f 7269 675f 6669 6c65 6e61 6d65  fo.orig_filename
-0000faf0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000fb00: 2020 7261 6973 6520 4261 645a 6970 4669    raise BadZipFi
-0000fb10: 6c65 280a 2020 2020 2020 2020 2020 2020  le(.            
-0000fb20: 2020 2020 2020 2020 2746 696c 6520 6e61          'File na
-0000fb30: 6d65 2069 6e20 6469 7265 6374 6f72 7920  me in directory 
-0000fb40: 2572 2061 6e64 2068 6561 6465 7220 2572  %r and header %r
-0000fb50: 2064 6966 6665 722e 270a 2020 2020 2020   differ.'.      
-0000fb60: 2020 2020 2020 2020 2020 2020 2020 2520                % 
-0000fb70: 287a 696e 666f 2e6f 7269 675f 6669 6c65  (zinfo.orig_file
-0000fb80: 6e61 6d65 2c20 666e 616d 6529 290a 0a20  name, fname)).. 
-0000fb90: 2020 2020 2020 2020 2020 2023 2063 6865             # che
-0000fba0: 636b 2066 6f72 2065 6e63 7279 7074 6564  ck for encrypted
-0000fbb0: 2066 6c61 6720 2620 6861 6e64 6c65 2070   flag & handle p
-0000fbc0: 6173 7377 6f72 640a 2020 2020 2020 2020  assword.        
-0000fbd0: 2020 2020 6973 5f65 6e63 7279 7074 6564      is_encrypted
-0000fbe0: 203d 207a 696e 666f 2e66 6c61 675f 6269   = zinfo.flag_bi
-0000fbf0: 7473 2026 2030 7831 0a20 2020 2020 2020  ts & 0x1.       
-0000fc00: 2020 2020 2069 6620 6973 5f65 6e63 7279       if is_encry
-0000fc10: 7074 6564 3a0a 2020 2020 2020 2020 2020  pted:.          
-0000fc20: 2020 2020 2020 6966 206e 6f74 2070 7764        if not pwd
-0000fc30: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000fc40: 2020 2020 2020 7077 6420 3d20 7365 6c66        pwd = self
-0000fc50: 2e70 7764 0a20 2020 2020 2020 2020 2020  .pwd.           
-0000fc60: 2020 2020 2069 6620 6e6f 7420 7077 643a       if not pwd:
-0000fc70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000fc80: 2020 2020 2072 6169 7365 2052 756e 7469       raise Runti
-0000fc90: 6d65 4572 726f 7228 2246 696c 6520 2572  meError("File %r
-0000fca0: 2069 7320 656e 6372 7970 7465 642c 2070   is encrypted, p
-0000fcb0: 6173 7377 6f72 6420 220a 2020 2020 2020  assword ".      
-0000fcc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fce0: 2022 7265 7175 6972 6564 2066 6f72 2065   "required for e
-0000fcf0: 7874 7261 6374 696f 6e22 2025 206e 616d  xtraction" % nam
-0000fd00: 6529 0a20 2020 2020 2020 2020 2020 2065  e).            e
-0000fd10: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0000fd20: 2020 2020 2070 7764 203d 204e 6f6e 650a       pwd = None.
-0000fd30: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0000fd40: 7572 6e20 5a69 7045 7874 4669 6c65 287a  urn ZipExtFile(z
-0000fd50: 6566 5f66 696c 652c 206d 6f64 652c 207a  ef_file, mode, z
-0000fd60: 696e 666f 2c20 7077 642c 2054 7275 6529  info, pwd, True)
-0000fd70: 0a20 2020 2020 2020 2065 7863 6570 743a  .        except:
-0000fd80: 0a20 2020 2020 2020 2020 2020 207a 6566  .            zef
-0000fd90: 5f66 696c 652e 636c 6f73 6528 290a 2020  _file.close().  
-0000fda0: 2020 2020 2020 2020 2020 7261 6973 650a            raise.
-0000fdb0: 0a20 2020 2064 6566 205f 6f70 656e 5f74  .    def _open_t
-0000fdc0: 6f5f 7772 6974 6528 7365 6c66 2c20 7a69  o_write(self, zi
-0000fdd0: 6e66 6f2c 2066 6f72 6365 5f7a 6970 3634  nfo, force_zip64
-0000fde0: 3d46 616c 7365 293a 0a20 2020 2020 2020  =False):.       
-0000fdf0: 2069 6620 666f 7263 655f 7a69 7036 3420   if force_zip64 
-0000fe00: 616e 6420 6e6f 7420 7365 6c66 2e5f 616c  and not self._al
-0000fe10: 6c6f 775a 6970 3634 3a0a 2020 2020 2020  lowZip64:.      
-0000fe20: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-0000fe30: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
-0000fe40: 2020 2020 2020 2020 2266 6f72 6365 5f7a          "force_z
-0000fe50: 6970 3634 2069 7320 5472 7565 2c20 6275  ip64 is True, bu
-0000fe60: 7420 616c 6c6f 775a 6970 3634 2077 6173  t allowZip64 was
-0000fe70: 2046 616c 7365 2077 6865 6e20 6f70 656e   False when open
-0000fe80: 696e 6720 220a 2020 2020 2020 2020 2020  ing ".          
-0000fe90: 2020 2020 2020 2274 6865 205a 4950 2066        "the ZIP f
-0000fea0: 696c 652e 220a 2020 2020 2020 2020 2020  ile.".          
-0000feb0: 2020 290a 2020 2020 2020 2020 6966 2073    ).        if s
-0000fec0: 656c 662e 5f77 7269 7469 6e67 3a0a 2020  elf._writing:.  
-0000fed0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0000fee0: 5661 6c75 6545 7272 6f72 2822 4361 6e27  ValueError("Can'
-0000fef0: 7420 7772 6974 6520 746f 2074 6865 205a  t write to the Z
-0000ff00: 4950 2066 696c 6520 7768 696c 6520 7468  IP file while th
-0000ff10: 6572 6520 6973 2022 0a20 2020 2020 2020  ere is ".       
-0000ff20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ff30: 2020 2020 2020 2261 6e6f 7468 6572 2077        "another w
-0000ff40: 7269 7465 2068 616e 646c 6520 6f70 656e  rite handle open
-0000ff50: 206f 6e20 6974 2e20 220a 2020 2020 2020   on it. ".      
-0000ff60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ff70: 2020 2020 2020 2022 436c 6f73 6520 7468         "Close th
-0000ff80: 6520 6669 7273 7420 6861 6e64 6c65 2062  e first handle b
-0000ff90: 6566 6f72 6520 6f70 656e 696e 6720 616e  efore opening an
-0000ffa0: 6f74 6865 722e 2229 0a0a 2020 2020 2020  other.")..      
-0000ffb0: 2020 2320 5369 7a65 2061 6e64 2043 5243    # Size and CRC
-0000ffc0: 2061 7265 206f 7665 7277 7269 7474 656e   are overwritten
-0000ffd0: 2077 6974 6820 636f 7272 6563 7420 6461   with correct da
-0000ffe0: 7461 2061 6674 6572 2070 726f 6365 7373  ta after process
-0000fff0: 696e 6720 7468 6520 6669 6c65 0a20 2020  ing the file.   
-00010000: 2020 2020 207a 696e 666f 2e63 6f6d 7072       zinfo.compr
-00010010: 6573 735f 7369 7a65 203d 2030 0a20 2020  ess_size = 0.   
-00010020: 2020 2020 207a 696e 666f 2e43 5243 203d       zinfo.CRC =
-00010030: 2030 0a0a 2020 2020 2020 2020 7a69 6e66   0..        zinf
-00010040: 6f2e 666c 6167 5f62 6974 7320 3d20 3078  o.flag_bits = 0x
-00010050: 3030 0a20 2020 2020 2020 2069 6620 7a69  00.        if zi
-00010060: 6e66 6f2e 636f 6d70 7265 7373 5f74 7970  nfo.compress_typ
-00010070: 6520 3d3d 205a 4950 5f4c 5a4d 413a 0a20  e == ZIP_LZMA:. 
-00010080: 2020 2020 2020 2020 2020 2023 2043 6f6d             # Com
-00010090: 7072 6573 7365 6420 6461 7461 2069 6e63  pressed data inc
-000100a0: 6c75 6465 7320 616e 2065 6e64 2d6f 662d  ludes an end-of-
-000100b0: 7374 7265 616d 2028 454f 5329 206d 6172  stream (EOS) mar
-000100c0: 6b65 720a 2020 2020 2020 2020 2020 2020  ker.            
-000100d0: 7a69 6e66 6f2e 666c 6167 5f62 6974 7320  zinfo.flag_bits 
-000100e0: 7c3d 2030 7830 320a 2020 2020 2020 2020  |= 0x02.        
-000100f0: 6966 206e 6f74 2073 656c 662e 5f73 6565  if not self._see
-00010100: 6b61 626c 653a 0a20 2020 2020 2020 2020  kable:.         
-00010110: 2020 207a 696e 666f 2e66 6c61 675f 6269     zinfo.flag_bi
-00010120: 7473 207c 3d20 3078 3038 0a0a 2020 2020  ts |= 0x08..    
-00010130: 2020 2020 6966 206e 6f74 207a 696e 666f      if not zinfo
-00010140: 2e65 7874 6572 6e61 6c5f 6174 7472 3a0a  .external_attr:.
-00010150: 2020 2020 2020 2020 2020 2020 7a69 6e66              zinf
-00010160: 6f2e 6578 7465 726e 616c 5f61 7474 7220  o.external_attr 
-00010170: 3d20 306f 3630 3020 3c3c 2031 3620 2023  = 0o600 << 16  #
-00010180: 2070 6572 6d69 7373 696f 6e73 3a20 3f72   permissions: ?r
-00010190: 772d 2d2d 2d2d 2d2d 0a0a 2020 2020 2020  w-------..      
-000101a0: 2020 2320 436f 6d70 7265 7373 6564 2073    # Compressed s
-000101b0: 697a 6520 6361 6e20 6265 206c 6172 6765  ize can be large
-000101c0: 7220 7468 616e 2075 6e63 6f6d 7072 6573  r than uncompres
-000101d0: 7365 6420 7369 7a65 0a20 2020 2020 2020  sed size.       
-000101e0: 207a 6970 3634 203d 2073 656c 662e 5f61   zip64 = self._a
-000101f0: 6c6c 6f77 5a69 7036 3420 616e 6420 5c0a  llowZip64 and \.
-00010200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010210: 2866 6f72 6365 5f7a 6970 3634 206f 7220  (force_zip64 or 
-00010220: 7a69 6e66 6f2e 6669 6c65 5f73 697a 6520  zinfo.file_size 
-00010230: 2a20 312e 3035 203e 205a 4950 3634 5f4c  * 1.05 > ZIP64_L
-00010240: 494d 4954 290a 0a20 2020 2020 2020 2069  IMIT)..        i
-00010250: 6620 7365 6c66 2e5f 7365 656b 6162 6c65  f self._seekable
-00010260: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-00010270: 6c66 2e66 702e 7365 656b 2873 656c 662e  lf.fp.seek(self.
-00010280: 7374 6172 745f 6469 7229 0a20 2020 2020  start_dir).     
-00010290: 2020 207a 696e 666f 2e68 6561 6465 725f     zinfo.header_
-000102a0: 6f66 6673 6574 203d 2073 656c 662e 6670  offset = self.fp
-000102b0: 2e74 656c 6c28 290a 0a20 2020 2020 2020  .tell()..       
-000102c0: 2073 656c 662e 5f77 7269 7465 6368 6563   self._writechec
-000102d0: 6b28 7a69 6e66 6f29 0a20 2020 2020 2020  k(zinfo).       
-000102e0: 2073 656c 662e 5f64 6964 4d6f 6469 6679   self._didModify
-000102f0: 203d 2054 7275 650a 0a20 2020 2020 2020   = True..       
-00010300: 2073 656c 662e 6670 2e77 7269 7465 287a   self.fp.write(z
-00010310: 696e 666f 2e46 696c 6548 6561 6465 7228  info.FileHeader(
-00010320: 7a69 7036 3429 290a 0a20 2020 2020 2020  zip64))..       
-00010330: 2073 656c 662e 5f77 7269 7469 6e67 203d   self._writing =
-00010340: 2054 7275 650a 2020 2020 2020 2020 7265   True.        re
-00010350: 7475 726e 205f 5a69 7057 7269 7465 4669  turn _ZipWriteFi
-00010360: 6c65 2873 656c 662c 207a 696e 666f 2c20  le(self, zinfo, 
-00010370: 7a69 7036 3429 0a0a 2020 2020 6465 6620  zip64)..    def 
-00010380: 6578 7472 6163 7428 7365 6c66 2c20 6d65  extract(self, me
-00010390: 6d62 6572 2c20 7061 7468 3d4e 6f6e 652c  mber, path=None,
-000103a0: 2070 7764 3d4e 6f6e 6529 3a0a 2020 2020   pwd=None):.    
-000103b0: 2020 2020 2222 2245 7874 7261 6374 2061      """Extract a
-000103c0: 206d 656d 6265 7220 6672 6f6d 2074 6865   member from the
-000103d0: 2061 7263 6869 7665 2074 6f20 7468 6520   archive to the 
-000103e0: 6375 7272 656e 7420 776f 726b 696e 6720  current working 
-000103f0: 6469 7265 6374 6f72 792c 0a20 2020 2020  directory,.     
-00010400: 2020 2020 2020 7573 696e 6720 6974 7320        using its 
-00010410: 6675 6c6c 206e 616d 652e 2049 7473 2066  full name. Its f
-00010420: 696c 6520 696e 666f 726d 6174 696f 6e20  ile information 
-00010430: 6973 2065 7874 7261 6374 6564 2061 7320  is extracted as 
-00010440: 6163 6375 7261 7465 6c79 0a20 2020 2020  accurately.     
-00010450: 2020 2020 2020 6173 2070 6f73 7369 626c        as possibl
-00010460: 652e 2060 6d65 6d62 6572 2720 6d61 7920  e. `member' may 
-00010470: 6265 2061 2066 696c 656e 616d 6520 6f72  be a filename or
-00010480: 2061 205a 6970 496e 666f 206f 626a 6563   a ZipInfo objec
-00010490: 742e 2059 6f75 2063 616e 0a20 2020 2020  t. You can.     
-000104a0: 2020 2020 2020 7370 6563 6966 7920 6120        specify a 
-000104b0: 6469 6666 6572 656e 7420 6469 7265 6374  different direct
-000104c0: 6f72 7920 7573 696e 6720 6070 6174 6827  ory using `path'
-000104d0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-000104e0: 2020 2020 2020 6966 2070 6174 6820 6973        if path is
-000104f0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00010500: 2020 2070 6174 6820 3d20 6f73 2e67 6574     path = os.get
-00010510: 6377 6428 290a 2020 2020 2020 2020 656c  cwd().        el
-00010520: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00010530: 6966 2073 7973 2e76 6572 7369 6f6e 5f69  if sys.version_i
-00010540: 6e66 6f3e 3d28 332c 3629 3a0a 2020 2020  nfo>=(3,6):.    
-00010550: 2020 2020 2020 2020 2020 2020 7061 7468              path
-00010560: 203d 206f 732e 6673 7061 7468 2870 6174   = os.fspath(pat
-00010570: 6829 0a0a 2020 2020 2020 2020 7265 7475  h)..        retu
-00010580: 726e 2073 656c 662e 5f65 7874 7261 6374  rn self._extract
-00010590: 5f6d 656d 6265 7228 6d65 6d62 6572 2c20  _member(member, 
-000105a0: 7061 7468 2c20 7077 6429 0a0a 2020 2020  path, pwd)..    
-000105b0: 6465 6620 6578 7472 6163 7461 6c6c 2873  def extractall(s
-000105c0: 656c 662c 2070 6174 683d 4e6f 6e65 2c20  elf, path=None, 
-000105d0: 6d65 6d62 6572 733d 4e6f 6e65 2c20 7077  members=None, pw
-000105e0: 643d 4e6f 6e65 293a 0a20 2020 2020 2020  d=None):.       
-000105f0: 2022 2222 4578 7472 6163 7420 616c 6c20   """Extract all 
-00010600: 6d65 6d62 6572 7320 6672 6f6d 2074 6865  members from the
-00010610: 2061 7263 6869 7665 2074 6f20 7468 6520   archive to the 
-00010620: 6375 7272 656e 7420 776f 726b 696e 670a  current working.
-00010630: 2020 2020 2020 2020 2020 2064 6972 6563             direc
-00010640: 746f 7279 2e20 6070 6174 6827 2073 7065  tory. `path' spe
-00010650: 6369 6669 6573 2061 2064 6966 6665 7265  cifies a differe
-00010660: 6e74 2064 6972 6563 746f 7279 2074 6f20  nt directory to 
-00010670: 6578 7472 6163 7420 746f 2e0a 2020 2020  extract to..    
-00010680: 2020 2020 2020 2060 6d65 6d62 6572 7327         `members'
-00010690: 2069 7320 6f70 7469 6f6e 616c 2061 6e64   is optional and
-000106a0: 206d 7573 7420 6265 2061 2073 7562 7365   must be a subse
-000106b0: 7420 6f66 2074 6865 206c 6973 7420 7265  t of the list re
-000106c0: 7475 726e 6564 0a20 2020 2020 2020 2020  turned.         
-000106d0: 2020 6279 206e 616d 656c 6973 7428 292e    by namelist().
-000106e0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000106f0: 2020 2020 2069 6620 6d65 6d62 6572 7320       if members 
-00010700: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00010710: 2020 2020 206d 656d 6265 7273 203d 2073       members = s
-00010720: 656c 662e 6e61 6d65 6c69 7374 2829 0a0a  elf.namelist()..
-00010730: 2020 2020 2020 2020 6966 2070 6174 6820          if path 
-00010740: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00010750: 2020 2020 2070 6174 6820 3d20 6f73 2e67       path = os.g
-00010760: 6574 6377 6428 290a 2020 2020 2020 2020  etcwd().        
-00010770: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00010780: 2020 6966 2073 7973 2e76 6572 7369 6f6e    if sys.version
-00010790: 5f69 6e66 6f3e 3d28 332c 3629 3a0a 2020  _info>=(3,6):.  
-000107a0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-000107b0: 7468 203d 206f 732e 6673 7061 7468 2870  th = os.fspath(p
-000107c0: 6174 6829 0a0a 2020 2020 2020 2020 666f  ath)..        fo
-000107d0: 7220 7a69 7069 6e66 6f20 696e 206d 656d  r zipinfo in mem
-000107e0: 6265 7273 3a0a 2020 2020 2020 2020 2020  bers:.          
-000107f0: 2020 7365 6c66 2e5f 6578 7472 6163 745f    self._extract_
-00010800: 6d65 6d62 6572 287a 6970 696e 666f 2c20  member(zipinfo, 
-00010810: 7061 7468 2c20 7077 6429 0a0a 2020 2020  path, pwd)..    
-00010820: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
-00010830: 2064 6566 205f 7361 6e69 7469 7a65 5f77   def _sanitize_w
-00010840: 696e 646f 7773 5f6e 616d 6528 636c 732c  indows_name(cls,
-00010850: 2061 7263 6e61 6d65 2c20 7061 7468 7365   arcname, pathse
-00010860: 7029 3a0a 2020 2020 2020 2020 2222 2252  p):.        """R
-00010870: 6570 6c61 6365 2062 6164 2063 6861 7261  eplace bad chara
-00010880: 6374 6572 7320 616e 6420 7265 6d6f 7665  cters and remove
-00010890: 2074 7261 696c 696e 6720 646f 7473 2066   trailing dots f
-000108a0: 726f 6d20 7061 7274 732e 2222 220a 2020  rom parts.""".  
-000108b0: 2020 2020 2020 7461 626c 6520 3d20 636c        table = cl
-000108c0: 732e 5f77 696e 646f 7773 5f69 6c6c 6567  s._windows_illeg
-000108d0: 616c 5f6e 616d 655f 7472 616e 735f 7461  al_name_trans_ta
-000108e0: 626c 650a 2020 2020 2020 2020 6966 206e  ble.        if n
-000108f0: 6f74 2074 6162 6c65 3a0a 2020 2020 2020  ot table:.      
-00010900: 2020 2020 2020 696c 6c65 6761 6c20 3d20        illegal = 
-00010910: 273a 3c3e 7c22 3f2a 270a 2020 2020 2020  ':<>|"?*'.      
-00010920: 2020 2020 2020 7461 626c 6520 3d20 7374        table = st
-00010930: 722e 6d61 6b65 7472 616e 7328 696c 6c65  r.maketrans(ille
-00010940: 6761 6c2c 2027 5f27 202a 206c 656e 2869  gal, '_' * len(i
-00010950: 6c6c 6567 616c 2929 0a20 2020 2020 2020  llegal)).       
-00010960: 2020 2020 2063 6c73 2e5f 7769 6e64 6f77       cls._window
-00010970: 735f 696c 6c65 6761 6c5f 6e61 6d65 5f74  s_illegal_name_t
-00010980: 7261 6e73 5f74 6162 6c65 203d 2074 6162  rans_table = tab
-00010990: 6c65 0a20 2020 2020 2020 2061 7263 6e61  le.        arcna
-000109a0: 6d65 203d 2061 7263 6e61 6d65 2e74 7261  me = arcname.tra
-000109b0: 6e73 6c61 7465 2874 6162 6c65 290a 2020  nslate(table).  
-000109c0: 2020 2020 2020 2320 7265 6d6f 7665 2074        # remove t
-000109d0: 7261 696c 696e 6720 646f 7473 0a20 2020  railing dots.   
-000109e0: 2020 2020 2061 7263 6e61 6d65 203d 2028       arcname = (
-000109f0: 782e 7273 7472 6970 2827 2e27 2920 666f  x.rstrip('.') fo
-00010a00: 7220 7820 696e 2061 7263 6e61 6d65 2e73  r x in arcname.s
-00010a10: 706c 6974 2870 6174 6873 6570 2929 0a20  plit(pathsep)). 
-00010a20: 2020 2020 2020 2023 2072 656a 6f69 6e2c         # rejoin,
-00010a30: 2072 656d 6f76 696e 6720 656d 7074 7920   removing empty 
-00010a40: 7061 7274 732e 0a20 2020 2020 2020 2061  parts..        a
-00010a50: 7263 6e61 6d65 203d 2070 6174 6873 6570  rcname = pathsep
-00010a60: 2e6a 6f69 6e28 7820 666f 7220 7820 696e  .join(x for x in
-00010a70: 2061 7263 6e61 6d65 2069 6620 7829 0a20   arcname if x). 
-00010a80: 2020 2020 2020 2072 6574 7572 6e20 6172         return ar
-00010a90: 636e 616d 650a 0a20 2020 2064 6566 205f  cname..    def _
-00010aa0: 6578 7472 6163 745f 6d65 6d62 6572 2873  extract_member(s
-00010ab0: 656c 662c 206d 656d 6265 722c 2074 6172  elf, member, tar
-00010ac0: 6765 7470 6174 682c 2070 7764 293a 0a20  getpath, pwd):. 
-00010ad0: 2020 2020 2020 2022 2222 4578 7472 6163         """Extrac
-00010ae0: 7420 7468 6520 5a69 7049 6e66 6f20 6f62  t the ZipInfo ob
-00010af0: 6a65 6374 2027 6d65 6d62 6572 2720 746f  ject 'member' to
-00010b00: 2061 2070 6879 7369 6361 6c0a 2020 2020   a physical.    
-00010b10: 2020 2020 2020 2066 696c 6520 6f6e 2074         file on t
-00010b20: 6865 2070 6174 6820 7461 7267 6574 7061  he path targetpa
-00010b30: 7468 2e0a 2020 2020 2020 2020 2222 220a  th..        """.
-00010b40: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
-00010b50: 7369 6e73 7461 6e63 6528 6d65 6d62 6572  sinstance(member
-00010b60: 2c20 5a69 7049 6e66 6f29 3a0a 2020 2020  , ZipInfo):.    
-00010b70: 2020 2020 2020 2020 6d65 6d62 6572 203d          member =
-00010b80: 2073 656c 662e 6765 7469 6e66 6f28 6d65   self.getinfo(me
-00010b90: 6d62 6572 290a 0a20 2020 2020 2020 2023  mber)..        #
-00010ba0: 2062 7569 6c64 2074 6865 2064 6573 7469   build the desti
-00010bb0: 6e61 7469 6f6e 2070 6174 686e 616d 652c  nation pathname,
-00010bc0: 2072 6570 6c61 6369 6e67 0a20 2020 2020   replacing.     
-00010bd0: 2020 2023 2066 6f72 7761 7264 2073 6c61     # forward sla
-00010be0: 7368 6573 2074 6f20 706c 6174 666f 726d  shes to platform
-00010bf0: 2073 7065 6369 6669 6320 7365 7061 7261   specific separa
-00010c00: 746f 7273 2e0a 2020 2020 2020 2020 6172  tors..        ar
-00010c10: 636e 616d 6520 3d20 6d65 6d62 6572 2e66  cname = member.f
-00010c20: 696c 656e 616d 652e 7265 706c 6163 6528  ilename.replace(
-00010c30: 272f 272c 206f 732e 7061 7468 2e73 6570  '/', os.path.sep
-00010c40: 290a 0a20 2020 2020 2020 2069 6620 6f73  )..        if os
-00010c50: 2e70 6174 682e 616c 7473 6570 3a0a 2020  .path.altsep:.  
-00010c60: 2020 2020 2020 2020 2020 6172 636e 616d            arcnam
-00010c70: 6520 3d20 6172 636e 616d 652e 7265 706c  e = arcname.repl
-00010c80: 6163 6528 6f73 2e70 6174 682e 616c 7473  ace(os.path.alts
-00010c90: 6570 2c20 6f73 2e70 6174 682e 7365 7029  ep, os.path.sep)
-00010ca0: 0a20 2020 2020 2020 2023 2069 6e74 6572  .        # inter
-00010cb0: 7072 6574 2061 6273 6f6c 7574 6520 7061  pret absolute pa
-00010cc0: 7468 6e61 6d65 2061 7320 7265 6c61 7469  thname as relati
-00010cd0: 7665 2c20 7265 6d6f 7665 2064 7269 7665  ve, remove drive
-00010ce0: 206c 6574 7465 7220 6f72 0a20 2020 2020   letter or.     
-00010cf0: 2020 2023 2055 4e43 2070 6174 682c 2072     # UNC path, r
-00010d00: 6564 756e 6461 6e74 2073 6570 6172 6174  edundant separat
-00010d10: 6f72 732c 2022 2e22 2061 6e64 2022 2e2e  ors, "." and "..
-00010d20: 2220 636f 6d70 6f6e 656e 7473 2e0a 2020  " components..  
-00010d30: 2020 2020 2020 6172 636e 616d 6520 3d20        arcname = 
-00010d40: 6f73 2e70 6174 682e 7370 6c69 7464 7269  os.path.splitdri
-00010d50: 7665 2861 7263 6e61 6d65 295b 315d 0a20  ve(arcname)[1]. 
-00010d60: 2020 2020 2020 2069 6e76 616c 6964 5f70         invalid_p
-00010d70: 6174 685f 7061 7274 7320 3d20 2827 272c  ath_parts = ('',
-00010d80: 206f 732e 7061 7468 2e63 7572 6469 722c   os.path.curdir,
-00010d90: 206f 732e 7061 7468 2e70 6172 6469 7229   os.path.pardir)
-00010da0: 0a20 2020 2020 2020 2061 7263 6e61 6d65  .        arcname
-00010db0: 203d 206f 732e 7061 7468 2e73 6570 2e6a   = os.path.sep.j
-00010dc0: 6f69 6e28 7820 666f 7220 7820 696e 2061  oin(x for x in a
-00010dd0: 7263 6e61 6d65 2e73 706c 6974 286f 732e  rcname.split(os.
-00010de0: 7061 7468 2e73 6570 290a 2020 2020 2020  path.sep).      
-00010df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010e00: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00010e10: 7820 6e6f 7420 696e 2069 6e76 616c 6964  x not in invalid
-00010e20: 5f70 6174 685f 7061 7274 7329 0a20 2020  _path_parts).   
-00010e30: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
-00010e40: 7365 7020 3d3d 2027 5c5c 273a 0a20 2020  sep == '\\':.   
-00010e50: 2020 2020 2020 2020 2023 2066 696c 7465           # filte
-00010e60: 7220 696c 6c65 6761 6c20 6368 6172 6163  r illegal charac
-00010e70: 7465 7273 206f 6e20 5769 6e64 6f77 730a  ters on Windows.
-00010e80: 2020 2020 2020 2020 2020 2020 6172 636e              arcn
-00010e90: 616d 6520 3d20 7365 6c66 2e5f 7361 6e69  ame = self._sani
-00010ea0: 7469 7a65 5f77 696e 646f 7773 5f6e 616d  tize_windows_nam
-00010eb0: 6528 6172 636e 616d 652c 206f 732e 7061  e(arcname, os.pa
-00010ec0: 7468 2e73 6570 290a 0a20 2020 2020 2020  th.sep)..       
-00010ed0: 2074 6172 6765 7470 6174 6820 3d20 6f73   targetpath = os
-00010ee0: 2e70 6174 682e 6a6f 696e 2874 6172 6765  .path.join(targe
-00010ef0: 7470 6174 682c 2061 7263 6e61 6d65 290a  tpath, arcname).
-00010f00: 2020 2020 2020 2020 7461 7267 6574 7061          targetpa
-00010f10: 7468 203d 206f 732e 7061 7468 2e6e 6f72  th = os.path.nor
-00010f20: 6d70 6174 6828 7461 7267 6574 7061 7468  mpath(targetpath
-00010f30: 290a 0a20 2020 2020 2020 2023 2043 7265  )..        # Cre
-00010f40: 6174 6520 616c 6c20 7570 7065 7220 6469  ate all upper di
-00010f50: 7265 6374 6f72 6965 7320 6966 206e 6563  rectories if nec
-00010f60: 6573 7361 7279 2e0a 2020 2020 2020 2020  essary..        
-00010f70: 7570 7065 7264 6972 7320 3d20 6f73 2e70  upperdirs = os.p
-00010f80: 6174 682e 6469 726e 616d 6528 7461 7267  ath.dirname(targ
-00010f90: 6574 7061 7468 290a 2020 2020 2020 2020  etpath).        
-00010fa0: 6966 2075 7070 6572 6469 7273 2061 6e64  if upperdirs and
-00010fb0: 206e 6f74 206f 732e 7061 7468 2e65 7869   not os.path.exi
-00010fc0: 7374 7328 7570 7065 7264 6972 7329 3a0a  sts(upperdirs):.
-00010fd0: 2020 2020 2020 2020 2020 2020 6f73 2e6d              os.m
-00010fe0: 616b 6564 6972 7328 7570 7065 7264 6972  akedirs(upperdir
-00010ff0: 7329 0a0a 2020 2020 2020 2020 6966 206d  s)..        if m
-00011000: 656d 6265 722e 6973 5f64 6972 2829 3a0a  ember.is_dir():.
-00011010: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-00011020: 6f74 206f 732e 7061 7468 2e69 7364 6972  ot os.path.isdir
-00011030: 2874 6172 6765 7470 6174 6829 3a0a 2020  (targetpath):.  
-00011040: 2020 2020 2020 2020 2020 2020 2020 6f73                os
-00011050: 2e6d 6b64 6972 2874 6172 6765 7470 6174  .mkdir(targetpat
-00011060: 6829 0a20 2020 2020 2020 2020 2020 2072  h).            r
-00011070: 6574 7572 6e20 7461 7267 6574 7061 7468  eturn targetpath
-00011080: 0a0a 2020 2020 2020 2020 7769 7468 2073  ..        with s
-00011090: 656c 662e 6f70 656e 286d 656d 6265 722c  elf.open(member,
-000110a0: 2070 7764 3d70 7764 2920 6173 2073 6f75   pwd=pwd) as sou
-000110b0: 7263 652c 205c 0a20 2020 2020 2020 2020  rce, \.         
-000110c0: 2020 2020 6f70 656e 2874 6172 6765 7470      open(targetp
-000110d0: 6174 682c 2022 7762 2229 2061 7320 7461  ath, "wb") as ta
-000110e0: 7267 6574 3a0a 2020 2020 2020 2020 2020  rget:.          
-000110f0: 2020 7368 7574 696c 2e63 6f70 7966 696c    shutil.copyfil
-00011100: 656f 626a 2873 6f75 7263 652c 2074 6172  eobj(source, tar
-00011110: 6765 7429 0a0a 2020 2020 2020 2020 7265  get)..        re
-00011120: 7475 726e 2074 6172 6765 7470 6174 680a  turn targetpath.
-00011130: 0a20 2020 2064 6566 205f 7772 6974 6563  .    def _writec
-00011140: 6865 636b 2873 656c 662c 207a 696e 666f  heck(self, zinfo
-00011150: 293a 0a20 2020 2020 2020 2022 2222 4368  ):.        """Ch
-00011160: 6563 6b20 666f 7220 6572 726f 7273 2062  eck for errors b
-00011170: 6566 6f72 6520 7772 6974 696e 6720 6120  efore writing a 
-00011180: 6669 6c65 2074 6f20 7468 6520 6172 6368  file to the arch
-00011190: 6976 652e 2222 220a 2020 2020 2020 2020  ive.""".        
-000111a0: 6966 207a 696e 666f 2e66 696c 656e 616d  if zinfo.filenam
-000111b0: 6520 696e 2073 656c 662e 4e61 6d65 546f  e in self.NameTo
-000111c0: 496e 666f 3a0a 2020 2020 2020 2020 2020  Info:.          
-000111d0: 2020 696d 706f 7274 2077 6172 6e69 6e67    import warning
-000111e0: 730a 2020 2020 2020 2020 2020 2020 7761  s.            wa
-000111f0: 726e 696e 6773 2e77 6172 6e28 2744 7570  rnings.warn('Dup
-00011200: 6c69 6361 7465 206e 616d 653a 2025 7227  licate name: %r'
-00011210: 2025 207a 696e 666f 2e66 696c 656e 616d   % zinfo.filenam
-00011220: 652c 2073 7461 636b 6c65 7665 6c3d 3329  e, stacklevel=3)
-00011230: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00011240: 2e6d 6f64 6520 6e6f 7420 696e 2028 2777  .mode not in ('w
-00011250: 272c 2027 7827 2c20 2761 2729 3a0a 2020  ', 'x', 'a'):.  
-00011260: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00011270: 5661 6c75 6545 7272 6f72 2822 7772 6974  ValueError("writ
-00011280: 6528 2920 7265 7175 6972 6573 206d 6f64  e() requires mod
-00011290: 6520 2777 272c 2027 7827 2c20 6f72 2027  e 'w', 'x', or '
-000112a0: 6127 2229 0a20 2020 2020 2020 2069 6620  a'").        if 
-000112b0: 6e6f 7420 7365 6c66 2e66 703a 0a20 2020  not self.fp:.   
-000112c0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-000112d0: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
-000112e0: 2020 2020 2020 2020 2020 2022 4174 7465             "Atte
-000112f0: 6d70 7420 746f 2077 7269 7465 205a 4950  mpt to write ZIP
-00011300: 2061 7263 6869 7665 2074 6861 7420 7761   archive that wa
-00011310: 7320 616c 7265 6164 7920 636c 6f73 6564  s already closed
-00011320: 2229 0a20 2020 2020 2020 205f 6368 6563  ").        _chec
-00011330: 6b5f 636f 6d70 7265 7373 696f 6e28 7a69  k_compression(zi
-00011340: 6e66 6f2e 636f 6d70 7265 7373 5f74 7970  nfo.compress_typ
-00011350: 6529 0a20 2020 2020 2020 2069 6620 6e6f  e).        if no
-00011360: 7420 7365 6c66 2e5f 616c 6c6f 775a 6970  t self._allowZip
-00011370: 3634 3a0a 2020 2020 2020 2020 2020 2020  64:.            
-00011380: 7265 7175 6972 6573 5f7a 6970 3634 203d  requires_zip64 =
-00011390: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
-000113a0: 2020 6966 206c 656e 2873 656c 662e 6669    if len(self.fi
-000113b0: 6c65 6c69 7374 2920 3e3d 205a 4950 5f46  lelist) >= ZIP_F
-000113c0: 494c 4543 4f55 4e54 5f4c 494d 4954 3a0a  ILECOUNT_LIMIT:.
-000113d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000113e0: 7265 7175 6972 6573 5f7a 6970 3634 203d  requires_zip64 =
-000113f0: 2022 4669 6c65 7320 636f 756e 7422 0a20   "Files count". 
-00011400: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00011410: 7a69 6e66 6f2e 6669 6c65 5f73 697a 6520  zinfo.file_size 
-00011420: 3e20 5a49 5036 345f 4c49 4d49 543a 0a20  > ZIP64_LIMIT:. 
-00011430: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00011440: 6571 7569 7265 735f 7a69 7036 3420 3d20  equires_zip64 = 
-00011450: 2246 696c 6573 697a 6522 0a20 2020 2020  "Filesize".     
-00011460: 2020 2020 2020 2065 6c69 6620 7a69 6e66         elif zinf
-00011470: 6f2e 6865 6164 6572 5f6f 6666 7365 7420  o.header_offset 
-00011480: 3e20 5a49 5036 345f 4c49 4d49 543a 0a20  > ZIP64_LIMIT:. 
-00011490: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000114a0: 6571 7569 7265 735f 7a69 7036 3420 3d20  equires_zip64 = 
-000114b0: 225a 6970 6669 6c65 2073 697a 6522 0a20  "Zipfile size". 
-000114c0: 2020 2020 2020 2020 2020 2069 6620 7265             if re
-000114d0: 7175 6972 6573 5f7a 6970 3634 3a0a 2020  quires_zip64:.  
-000114e0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-000114f0: 6973 6520 4c61 7267 655a 6970 4669 6c65  ise LargeZipFile
-00011500: 2872 6571 7569 7265 735f 7a69 7036 3420  (requires_zip64 
-00011510: 2b0a 2020 2020 2020 2020 2020 2020 2020  +.              
-00011520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011530: 2020 2020 2022 2077 6f75 6c64 2072 6571       " would req
-00011540: 7569 7265 205a 4950 3634 2065 7874 656e  uire ZIP64 exten
-00011550: 7369 6f6e 7322 290a 0a20 2020 2064 6566  sions")..    def
-00011560: 2077 7269 7465 2873 656c 662c 2066 696c   write(self, fil
-00011570: 656e 616d 652c 2061 7263 6e61 6d65 3d4e  ename, arcname=N
-00011580: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
-00011590: 2020 2063 6f6d 7072 6573 735f 7479 7065     compress_type
-000115a0: 3d4e 6f6e 652c 2063 6f6d 7072 6573 736c  =None, compressl
-000115b0: 6576 656c 3d4e 6f6e 6529 3a0a 2020 2020  evel=None):.    
-000115c0: 2020 2020 2222 2250 7574 2074 6865 2062      """Put the b
-000115d0: 7974 6573 2066 726f 6d20 6669 6c65 6e61  ytes from filena
-000115e0: 6d65 2069 6e74 6f20 7468 6520 6172 6368  me into the arch
-000115f0: 6976 6520 756e 6465 7220 7468 6520 6e61  ive under the na
-00011600: 6d65 0a20 2020 2020 2020 2061 7263 6e61  me.        arcna
-00011610: 6d65 2e22 2222 0a20 2020 2020 2020 2069  me.""".        i
-00011620: 6620 6e6f 7420 7365 6c66 2e66 703a 0a20  f not self.fp:. 
-00011630: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00011640: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
-00011650: 2020 2020 2020 2020 2020 2020 2022 4174               "At
-00011660: 7465 6d70 7420 746f 2077 7269 7465 2074  tempt to write t
-00011670: 6f20 5a49 5020 6172 6368 6976 6520 7468  o ZIP archive th
-00011680: 6174 2077 6173 2061 6c72 6561 6479 2063  at was already c
-00011690: 6c6f 7365 6422 290a 2020 2020 2020 2020  losed").        
-000116a0: 6966 2073 656c 662e 5f77 7269 7469 6e67  if self._writing
-000116b0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-000116c0: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
-000116d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000116e0: 2243 616e 2774 2077 7269 7465 2074 6f20  "Can't write to 
-000116f0: 5a49 5020 6172 6368 6976 6520 7768 696c  ZIP archive whil
-00011700: 6520 616e 206f 7065 6e20 7772 6974 696e  e an open writin
-00011710: 6720 6861 6e64 6c65 2065 7869 7374 7322  g handle exists"
-00011720: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
-00011730: 2020 2020 2020 2020 7a69 6e66 6f20 3d20          zinfo = 
-00011740: 5a69 7049 6e66 6f2e 6672 6f6d 5f66 696c  ZipInfo.from_fil
-00011750: 6528 6669 6c65 6e61 6d65 2c20 6172 636e  e(filename, arcn
-00011760: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
-00011770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011780: 2020 2020 2020 2073 7472 6963 745f 7469         strict_ti
-00011790: 6d65 7374 616d 7073 3d73 656c 662e 5f73  mestamps=self._s
-000117a0: 7472 6963 745f 7469 6d65 7374 616d 7073  trict_timestamps
-000117b0: 290a 0a20 2020 2020 2020 2069 6620 7a69  )..        if zi
-000117c0: 6e66 6f2e 6973 5f64 6972 2829 3a0a 2020  nfo.is_dir():.  
-000117d0: 2020 2020 2020 2020 2020 7a69 6e66 6f2e            zinfo.
-000117e0: 636f 6d70 7265 7373 5f73 697a 6520 3d20  compress_size = 
-000117f0: 300a 2020 2020 2020 2020 2020 2020 7a69  0.            zi
-00011800: 6e66 6f2e 4352 4320 3d20 300a 2020 2020  nfo.CRC = 0.    
-00011810: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00011820: 2020 2020 2020 6966 2063 6f6d 7072 6573        if compres
-00011830: 735f 7479 7065 2069 7320 6e6f 7420 4e6f  s_type is not No
-00011840: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00011850: 2020 2020 7a69 6e66 6f2e 636f 6d70 7265      zinfo.compre
-00011860: 7373 5f74 7970 6520 3d20 636f 6d70 7265  ss_type = compre
-00011870: 7373 5f74 7970 650a 2020 2020 2020 2020  ss_type.        
-00011880: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00011890: 2020 2020 2020 2020 2020 7a69 6e66 6f2e            zinfo.
-000118a0: 636f 6d70 7265 7373 5f74 7970 6520 3d20  compress_type = 
-000118b0: 7365 6c66 2e63 6f6d 7072 6573 7369 6f6e  self.compression
-000118c0: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-000118d0: 2063 6f6d 7072 6573 736c 6576 656c 2069   compresslevel i
-000118e0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-000118f0: 2020 2020 2020 2020 2020 2020 7a69 6e66              zinf
-00011900: 6f2e 5f63 6f6d 7072 6573 736c 6576 656c  o._compresslevel
-00011910: 203d 2063 6f6d 7072 6573 736c 6576 656c   = compresslevel
-00011920: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00011930: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00011940: 2020 207a 696e 666f 2e5f 636f 6d70 7265     zinfo._compre
-00011950: 7373 6c65 7665 6c20 3d20 7365 6c66 2e63  sslevel = self.c
-00011960: 6f6d 7072 6573 736c 6576 656c 0a0a 2020  ompresslevel..  
-00011970: 2020 2020 2020 6966 207a 696e 666f 2e69        if zinfo.i
-00011980: 735f 6469 7228 293a 0a20 2020 2020 2020  s_dir():.       
-00011990: 2020 2020 2077 6974 6820 7365 6c66 2e5f       with self._
-000119a0: 6c6f 636b 3a0a 2020 2020 2020 2020 2020  lock:.          
-000119b0: 2020 2020 2020 6966 2073 656c 662e 5f73        if self._s
-000119c0: 6565 6b61 626c 653a 0a20 2020 2020 2020  eekable:.       
-000119d0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-000119e0: 662e 6670 2e73 6565 6b28 7365 6c66 2e73  f.fp.seek(self.s
-000119f0: 7461 7274 5f64 6972 290a 2020 2020 2020  tart_dir).      
-00011a00: 2020 2020 2020 2020 2020 7a69 6e66 6f2e            zinfo.
-00011a10: 6865 6164 6572 5f6f 6666 7365 7420 3d20  header_offset = 
-00011a20: 7365 6c66 2e66 702e 7465 6c6c 2829 2020  self.fp.tell()  
-00011a30: 2320 5374 6172 7420 6f66 2068 6561 6465  # Start of heade
-00011a40: 7220 6279 7465 730a 2020 2020 2020 2020  r bytes.        
-00011a50: 2020 2020 2020 2020 6966 207a 696e 666f          if zinfo
-00011a60: 2e63 6f6d 7072 6573 735f 7479 7065 203d  .compress_type =
-00011a70: 3d20 5a49 505f 4c5a 4d41 3a0a 2020 2020  = ZIP_LZMA:.    
-00011a80: 2020 2020 2020 2020 2020 2020 2320 436f              # Co
-00011a90: 6d70 7265 7373 6564 2064 6174 6120 696e  mpressed data in
-00011aa0: 636c 7564 6573 2061 6e20 656e 642d 6f66  cludes an end-of
-00011ab0: 2d73 7472 6561 6d20 2845 4f53 2920 6d61  -stream (EOS) ma
-00011ac0: 726b 6572 0a20 2020 2020 2020 2020 2020  rker.           
-00011ad0: 2020 2020 2020 2020 207a 696e 666f 2e66           zinfo.f
-00011ae0: 6c61 675f 6269 7473 207c 3d20 3078 3032  lag_bits |= 0x02
-00011af0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00011b00: 2020 7365 6c66 2e5f 7772 6974 6563 6865    self._writeche
-00011b10: 636b 287a 696e 666f 290a 2020 2020 2020  ck(zinfo).      
-00011b20: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00011b30: 6469 644d 6f64 6966 7920 3d20 5472 7565  didModify = True
-00011b40: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00011b50: 2020 7365 6c66 2e66 696c 656c 6973 742e    self.filelist.
-00011b60: 6170 7065 6e64 287a 696e 666f 290a 2020  append(zinfo).  
-00011b70: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00011b80: 6c66 2e4e 616d 6554 6f49 6e66 6f5b 7a69  lf.NameToInfo[zi
-00011b90: 6e66 6f2e 6669 6c65 6e61 6d65 5d20 3d20  nfo.filename] = 
-00011ba0: 7a69 6e66 6f0a 2020 2020 2020 2020 2020  zinfo.          
-00011bb0: 2020 2020 2020 7365 6c66 2e66 702e 7772        self.fp.wr
-00011bc0: 6974 6528 7a69 6e66 6f2e 4669 6c65 4865  ite(zinfo.FileHe
-00011bd0: 6164 6572 2846 616c 7365 2929 0a20 2020  ader(False)).   
-00011be0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00011bf0: 662e 7374 6172 745f 6469 7220 3d20 7365  f.start_dir = se
-00011c00: 6c66 2e66 702e 7465 6c6c 2829 0a20 2020  lf.fp.tell().   
-00011c10: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00011c20: 2020 2020 2020 2077 6974 6820 6f70 656e         with open
-00011c30: 2866 696c 656e 616d 652c 2022 7262 2229  (filename, "rb")
-00011c40: 2061 7320 7372 632c 2073 656c 662e 6f70   as src, self.op
-00011c50: 656e 287a 696e 666f 2c20 2777 2729 2061  en(zinfo, 'w') a
-00011c60: 7320 6465 7374 3a0a 2020 2020 2020 2020  s dest:.        
-00011c70: 2020 2020 2020 2020 7368 7574 696c 2e63          shutil.c
-00011c80: 6f70 7966 696c 656f 626a 2873 7263 2c20  opyfileobj(src, 
-00011c90: 6465 7374 2c20 3130 3234 2a38 290a 0a20  dest, 1024*8).. 
-00011ca0: 2020 2064 6566 2077 7269 7465 7374 7228     def writestr(
-00011cb0: 7365 6c66 2c20 7a69 6e66 6f5f 6f72 5f61  self, zinfo_or_a
-00011cc0: 7263 6e61 6d65 2c20 6461 7461 2c0a 2020  rcname, data,.  
-00011cd0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00011ce0: 6f6d 7072 6573 735f 7479 7065 3d4e 6f6e  ompress_type=Non
-00011cf0: 652c 2063 6f6d 7072 6573 736c 6576 656c  e, compresslevel
-00011d00: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-00011d10: 2222 2257 7269 7465 2061 2066 696c 6520  """Write a file 
-00011d20: 696e 746f 2074 6865 2061 7263 6869 7665  into the archive
-00011d30: 2e20 2054 6865 2063 6f6e 7465 6e74 7320  .  The contents 
-00011d40: 6973 2027 6461 7461 272c 2077 6869 6368  is 'data', which
-00011d50: 0a20 2020 2020 2020 206d 6179 2062 6520  .        may be 
-00011d60: 6569 7468 6572 2061 2027 7374 7227 206f  either a 'str' o
-00011d70: 7220 6120 2762 7974 6573 2720 696e 7374  r a 'bytes' inst
-00011d80: 616e 6365 3b20 6966 2069 7420 6973 2061  ance; if it is a
-00011d90: 2027 7374 7227 2c0a 2020 2020 2020 2020   'str',.        
-00011da0: 6974 2069 7320 656e 636f 6465 6420 6173  it is encoded as
-00011db0: 2055 5446 2d38 2066 6972 7374 2e0a 2020   UTF-8 first..  
-00011dc0: 2020 2020 2020 277a 696e 666f 5f6f 725f        'zinfo_or_
-00011dd0: 6172 636e 616d 6527 2069 7320 6569 7468  arcname' is eith
-00011de0: 6572 2061 205a 6970 496e 666f 2069 6e73  er a ZipInfo ins
-00011df0: 7461 6e63 6520 6f72 0a20 2020 2020 2020  tance or.       
-00011e00: 2074 6865 206e 616d 6520 6f66 2074 6865   the name of the
-00011e10: 2066 696c 6520 696e 2074 6865 2061 7263   file in the arc
-00011e20: 6869 7665 2e22 2222 0a20 2020 2020 2020  hive.""".       
-00011e30: 2069 6620 7379 732e 7665 7273 696f 6e5f   if sys.version_
-00011e40: 696e 666f 5b30 5d3e 3d33 3a0a 2020 2020  info[0]>=3:.    
-00011e50: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-00011e60: 7461 6e63 6528 6461 7461 2c20 7374 7229  tance(data, str)
-00011e70: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00011e80: 2020 6461 7461 203d 2064 6174 612e 656e    data = data.en
-00011e90: 636f 6465 2822 7574 662d 3822 290a 2020  code("utf-8").  
-00011ea0: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
-00011eb0: 6e73 7461 6e63 6528 7a69 6e66 6f5f 6f72  nstance(zinfo_or
-00011ec0: 5f61 7263 6e61 6d65 2c20 5a69 7049 6e66  _arcname, ZipInf
-00011ed0: 6f29 3a0a 2020 2020 2020 2020 2020 2020  o):.            
-00011ee0: 7a69 6e66 6f20 3d20 5a69 7049 6e66 6f28  zinfo = ZipInfo(
-00011ef0: 6669 6c65 6e61 6d65 3d7a 696e 666f 5f6f  filename=zinfo_o
-00011f00: 725f 6172 636e 616d 652c 0a20 2020 2020  r_arcname,.     
-00011f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011f20: 2020 2020 2020 2064 6174 655f 7469 6d65         date_time
-00011f30: 3d74 696d 652e 6c6f 6361 6c74 696d 6528  =time.localtime(
-00011f40: 7469 6d65 2e74 696d 6528 2929 5b3a 365d  time.time())[:6]
-00011f50: 290a 2020 2020 2020 2020 2020 2020 7a69  ).            zi
-00011f60: 6e66 6f2e 636f 6d70 7265 7373 5f74 7970  nfo.compress_typ
-00011f70: 6520 3d20 7365 6c66 2e63 6f6d 7072 6573  e = self.compres
-00011f80: 7369 6f6e 0a20 2020 2020 2020 2020 2020  sion.           
-00011f90: 207a 696e 666f 2e5f 636f 6d70 7265 7373   zinfo._compress
-00011fa0: 6c65 7665 6c20 3d20 7365 6c66 2e63 6f6d  level = self.com
-00011fb0: 7072 6573 736c 6576 656c 0a20 2020 2020  presslevel.     
-00011fc0: 2020 2020 2020 2069 6620 7a69 6e66 6f2e         if zinfo.
-00011fd0: 6669 6c65 6e61 6d65 5b2d 315d 203d 3d20  filename[-1] == 
-00011fe0: 272f 273a 0a20 2020 2020 2020 2020 2020  '/':.           
-00011ff0: 2020 2020 207a 696e 666f 2e65 7874 6572       zinfo.exter
-00012000: 6e61 6c5f 6174 7472 203d 2030 6f34 3037  nal_attr = 0o407
-00012010: 3735 203c 3c20 3136 2020 2023 2064 7277  75 << 16   # drw
-00012020: 7872 7778 722d 780a 2020 2020 2020 2020  xrwxr-x.        
-00012030: 2020 2020 2020 2020 7a69 6e66 6f2e 6578          zinfo.ex
-00012040: 7465 726e 616c 5f61 7474 7220 7c3d 2030  ternal_attr |= 0
-00012050: 7831 3020 2020 2020 2020 2020 2020 2320  x10           # 
-00012060: 4d53 2d44 4f53 2064 6972 6563 746f 7279  MS-DOS directory
-00012070: 2066 6c61 670a 2020 2020 2020 2020 2020   flag.          
-00012080: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00012090: 2020 2020 2020 2020 7a69 6e66 6f2e 6578          zinfo.ex
-000120a0: 7465 726e 616c 5f61 7474 7220 3d20 306f  ternal_attr = 0o
-000120b0: 3630 3020 3c3c 2031 3620 2020 2020 2320  600 << 16     # 
-000120c0: 3f72 772d 2d2d 2d2d 2d2d 0a20 2020 2020  ?rw-------.     
-000120d0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-000120e0: 2020 2020 207a 696e 666f 203d 207a 696e       zinfo = zin
-000120f0: 666f 5f6f 725f 6172 636e 616d 650a 0a20  fo_or_arcname.. 
-00012100: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
-00012110: 6c66 2e66 703a 0a20 2020 2020 2020 2020  lf.fp:.         
-00012120: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-00012130: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-00012140: 2020 2020 2022 4174 7465 6d70 7420 746f       "Attempt to
-00012150: 2077 7269 7465 2074 6f20 5a49 5020 6172   write to ZIP ar
-00012160: 6368 6976 6520 7468 6174 2077 6173 2061  chive that was a
-00012170: 6c72 6561 6479 2063 6c6f 7365 6422 290a  lready closed").
-00012180: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00012190: 5f77 7269 7469 6e67 3a0a 2020 2020 2020  _writing:.      
-000121a0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-000121b0: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
-000121c0: 2020 2020 2020 2020 2243 616e 2774 2077          "Can't w
-000121d0: 7269 7465 2074 6f20 5a49 5020 6172 6368  rite to ZIP arch
-000121e0: 6976 6520 7768 696c 6520 616e 206f 7065  ive while an ope
-000121f0: 6e20 7772 6974 696e 6720 6861 6e64 6c65  n writing handle
-00012200: 2065 7869 7374 732e 220a 2020 2020 2020   exists.".      
-00012210: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-00012220: 2069 6620 636f 6d70 7265 7373 5f74 7970   if compress_typ
-00012230: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
-00012240: 2020 2020 2020 2020 2020 207a 696e 666f             zinfo
-00012250: 2e63 6f6d 7072 6573 735f 7479 7065 203d  .compress_type =
-00012260: 2063 6f6d 7072 6573 735f 7479 7065 0a0a   compress_type..
-00012270: 2020 2020 2020 2020 6966 2063 6f6d 7072          if compr
-00012280: 6573 736c 6576 656c 2069 7320 6e6f 7420  esslevel is not 
-00012290: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-000122a0: 2020 7a69 6e66 6f2e 5f63 6f6d 7072 6573    zinfo._compres
-000122b0: 736c 6576 656c 203d 2063 6f6d 7072 6573  slevel = compres
-000122c0: 736c 6576 656c 0a0a 2020 2020 2020 2020  slevel..        
-000122d0: 7a69 6e66 6f2e 6669 6c65 5f73 697a 6520  zinfo.file_size 
-000122e0: 3d20 6c65 6e28 6461 7461 2920 2020 2020  = len(data)     
-000122f0: 2020 2020 2020 2023 2055 6e63 6f6d 7072         # Uncompr
-00012300: 6573 7365 6420 7369 7a65 0a20 2020 2020  essed size.     
-00012310: 2020 2077 6974 6820 7365 6c66 2e5f 6c6f     with self._lo
-00012320: 636b 3a0a 2020 2020 2020 2020 2020 2020  ck:.            
-00012330: 7769 7468 2073 656c 662e 6f70 656e 287a  with self.open(z
-00012340: 696e 666f 2c20 6d6f 6465 3d27 7727 2920  info, mode='w') 
-00012350: 6173 2064 6573 743a 0a20 2020 2020 2020  as dest:.       
-00012360: 2020 2020 2020 2020 2064 6573 742e 7772           dest.wr
-00012370: 6974 6528 6461 7461 290a 0a20 2020 2064  ite(data)..    d
-00012380: 6566 205f 5f64 656c 5f5f 2873 656c 6629  ef __del__(self)
-00012390: 3a0a 2020 2020 2020 2020 2222 2243 616c  :.        """Cal
-000123a0: 6c20 7468 6520 2263 6c6f 7365 2829 2220  l the "close()" 
-000123b0: 6d65 7468 6f64 2069 6e20 6361 7365 2074  method in case t
-000123c0: 6865 2075 7365 7220 666f 7267 6f74 2e22  he user forgot."
-000123d0: 2222 0a20 2020 2020 2020 2073 656c 662e  "".        self.
-000123e0: 636c 6f73 6528 290a 0a20 2020 2064 6566  close()..    def
-000123f0: 2063 6c6f 7365 2873 656c 6629 3a0a 2020   close(self):.  
-00012400: 2020 2020 2020 2222 2243 6c6f 7365 2074        """Close t
-00012410: 6865 2066 696c 652c 2061 6e64 2066 6f72  he file, and for
-00012420: 206d 6f64 6520 2777 272c 2027 7827 2061   mode 'w', 'x' a
-00012430: 6e64 2027 6127 2077 7269 7465 2074 6865  nd 'a' write the
-00012440: 2065 6e64 696e 670a 2020 2020 2020 2020   ending.        
-00012450: 7265 636f 7264 732e 2222 220a 2020 2020  records.""".    
-00012460: 2020 2020 6966 2073 656c 662e 6670 2069      if self.fp i
-00012470: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00012480: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
-00012490: 2020 2020 6966 2073 656c 662e 5f77 7269      if self._wri
-000124a0: 7469 6e67 3a0a 2020 2020 2020 2020 2020  ting:.          
-000124b0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-000124c0: 6f72 2822 4361 6e27 7420 636c 6f73 6520  or("Can't close 
-000124d0: 7468 6520 5a49 5020 6669 6c65 2077 6869  the ZIP file whi
-000124e0: 6c65 2074 6865 7265 2069 7320 220a 2020  le there is ".  
-000124f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012500: 2020 2020 2020 2020 2020 2022 616e 206f             "an o
-00012510: 7065 6e20 7772 6974 696e 6720 6861 6e64  pen writing hand
-00012520: 6c65 206f 6e20 6974 2e20 220a 2020 2020  le on it. ".    
-00012530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012540: 2020 2020 2020 2020 2022 436c 6f73 6520           "Close 
-00012550: 7468 6520 7772 6974 696e 6720 6861 6e64  the writing hand
-00012560: 6c65 2062 6566 6f72 6520 636c 6f73 696e  le before closin
-00012570: 6720 7468 6520 7a69 702e 2229 0a0a 2020  g the zip.")..  
-00012580: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-00012590: 2020 2020 2020 2069 6620 7365 6c66 2e6d         if self.m
-000125a0: 6f64 6520 696e 2028 2777 272c 2027 7827  ode in ('w', 'x'
-000125b0: 2c20 2761 2729 2061 6e64 2073 656c 662e  , 'a') and self.
-000125c0: 5f64 6964 4d6f 6469 6679 3a20 2320 7772  _didModify: # wr
-000125d0: 6974 6520 656e 6469 6e67 2072 6563 6f72  ite ending recor
-000125e0: 6473 0a20 2020 2020 2020 2020 2020 2020  ds.             
-000125f0: 2020 2077 6974 6820 7365 6c66 2e5f 6c6f     with self._lo
-00012600: 636b 3a0a 2020 2020 2020 2020 2020 2020  ck:.            
-00012610: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00012620: 5f73 6565 6b61 626c 653a 0a20 2020 2020  _seekable:.     
-00012630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012640: 2020 2073 656c 662e 6670 2e73 6565 6b28     self.fp.seek(
-00012650: 7365 6c66 2e73 7461 7274 5f64 6972 290a  self.start_dir).
-00012660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012670: 2020 2020 7365 6c66 2e5f 7772 6974 655f      self._write_
-00012680: 656e 645f 7265 636f 7264 2829 0a20 2020  end_record().   
-00012690: 2020 2020 2066 696e 616c 6c79 3a0a 2020       finally:.  
-000126a0: 2020 2020 2020 2020 2020 6670 203d 2073            fp = s
-000126b0: 656c 662e 6670 0a20 2020 2020 2020 2020  elf.fp.         
-000126c0: 2020 2073 656c 662e 6670 203d 204e 6f6e     self.fp = Non
-000126d0: 650a 2020 2020 2020 2020 2020 2020 7365  e.            se
-000126e0: 6c66 2e5f 6670 636c 6f73 6528 6670 290a  lf._fpclose(fp).
-000126f0: 0a20 2020 2064 6566 205f 7772 6974 655f  .    def _write_
-00012700: 656e 645f 7265 636f 7264 2873 656c 6629  end_record(self)
-00012710: 3a0a 2020 2020 2020 2020 666f 7220 7a69  :.        for zi
-00012720: 6e66 6f20 696e 2073 656c 662e 6669 6c65  nfo in self.file
-00012730: 6c69 7374 3a20 2020 2020 2020 2020 2320  list:         # 
-00012740: 7772 6974 6520 6365 6e74 7261 6c20 6469  write central di
-00012750: 7265 6374 6f72 790a 2020 2020 2020 2020  rectory.        
-00012760: 2020 2020 6474 203d 207a 696e 666f 2e64      dt = zinfo.d
-00012770: 6174 655f 7469 6d65 0a20 2020 2020 2020  ate_time.       
-00012780: 2020 2020 2064 6f73 6461 7465 203d 2028       dosdate = (
-00012790: 6474 5b30 5d20 2d20 3139 3830 2920 3c3c  dt[0] - 1980) <<
-000127a0: 2039 207c 2064 745b 315d 203c 3c20 3520   9 | dt[1] << 5 
-000127b0: 7c20 6474 5b32 5d0a 2020 2020 2020 2020  | dt[2].        
-000127c0: 2020 2020 646f 7374 696d 6520 3d20 6474      dostime = dt
-000127d0: 5b33 5d20 3c3c 2031 3120 7c20 6474 5b34  [3] << 11 | dt[4
-000127e0: 5d20 3c3c 2035 207c 2028 6474 5b35 5d20  ] << 5 | (dt[5] 
-000127f0: 2f2f 2032 290a 2020 2020 2020 2020 2020  // 2).          
-00012800: 2020 6578 7472 6120 3d20 5b5d 0a20 2020    extra = [].   
-00012810: 2020 2020 2020 2020 2069 6620 7a69 6e66           if zinf
-00012820: 6f2e 6669 6c65 5f73 697a 6520 3e20 5a49  o.file_size > ZI
-00012830: 5036 345f 4c49 4d49 5420 5c0a 2020 2020  P64_LIMIT \.    
-00012840: 2020 2020 2020 2020 2020 206f 7220 7a69             or zi
-00012850: 6e66 6f2e 636f 6d70 7265 7373 5f73 697a  nfo.compress_siz
-00012860: 6520 3e20 5a49 5036 345f 4c49 4d49 543a  e > ZIP64_LIMIT:
-00012870: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012880: 2065 7874 7261 2e61 7070 656e 6428 7a69   extra.append(zi
-00012890: 6e66 6f2e 6669 6c65 5f73 697a 6529 0a20  nfo.file_size). 
-000128a0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-000128b0: 7874 7261 2e61 7070 656e 6428 7a69 6e66  xtra.append(zinf
-000128c0: 6f2e 636f 6d70 7265 7373 5f73 697a 6529  o.compress_size)
-000128d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000128e0: 2066 696c 655f 7369 7a65 203d 2030 7866   file_size = 0xf
-000128f0: 6666 6666 6666 660a 2020 2020 2020 2020  fffffff.        
-00012900: 2020 2020 2020 2020 636f 6d70 7265 7373          compress
-00012910: 5f73 697a 6520 3d20 3078 6666 6666 6666  _size = 0xffffff
-00012920: 6666 0a20 2020 2020 2020 2020 2020 2065  ff.            e
-00012930: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00012940: 2020 2020 2066 696c 655f 7369 7a65 203d       file_size =
-00012950: 207a 696e 666f 2e66 696c 655f 7369 7a65   zinfo.file_size
-00012960: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012970: 2063 6f6d 7072 6573 735f 7369 7a65 203d   compress_size =
-00012980: 207a 696e 666f 2e63 6f6d 7072 6573 735f   zinfo.compress_
-00012990: 7369 7a65 0a0a 2020 2020 2020 2020 2020  size..          
-000129a0: 2020 6966 207a 696e 666f 2e68 6561 6465    if zinfo.heade
-000129b0: 725f 6f66 6673 6574 203e 205a 4950 3634  r_offset > ZIP64
-000129c0: 5f4c 494d 4954 3a0a 2020 2020 2020 2020  _LIMIT:.        
-000129d0: 2020 2020 2020 2020 6578 7472 612e 6170          extra.ap
-000129e0: 7065 6e64 287a 696e 666f 2e68 6561 6465  pend(zinfo.heade
-000129f0: 725f 6f66 6673 6574 290a 2020 2020 2020  r_offset).      
-00012a00: 2020 2020 2020 2020 2020 6865 6164 6572            header
-00012a10: 5f6f 6666 7365 7420 3d20 3078 6666 6666  _offset = 0xffff
-00012a20: 6666 6666 0a20 2020 2020 2020 2020 2020  ffff.           
-00012a30: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00012a40: 2020 2020 2020 2068 6561 6465 725f 6f66         header_of
-00012a50: 6673 6574 203d 207a 696e 666f 2e68 6561  fset = zinfo.hea
-00012a60: 6465 725f 6f66 6673 6574 0a0a 2020 2020  der_offset..    
-00012a70: 2020 2020 2020 2020 6578 7472 615f 6461          extra_da
-00012a80: 7461 203d 207a 696e 666f 2e65 7874 7261  ta = zinfo.extra
-00012a90: 0a20 2020 2020 2020 2020 2020 206d 696e  .            min
-00012aa0: 5f76 6572 7369 6f6e 203d 2030 0a20 2020  _version = 0.   
-00012ab0: 2020 2020 2020 2020 2069 6620 6578 7472           if extr
-00012ac0: 613a 0a20 2020 2020 2020 2020 2020 2020  a:.             
-00012ad0: 2020 2023 2041 7070 656e 6420 6120 5a49     # Append a ZI
-00012ae0: 5036 3420 6669 656c 6420 746f 2074 6865  P64 field to the
-00012af0: 2065 7874 7261 2773 0a20 2020 2020 2020   extra's.       
-00012b00: 2020 2020 2020 2020 2065 7874 7261 5f64           extra_d
-00012b10: 6174 6120 3d20 5f73 7472 6970 5f65 7874  ata = _strip_ext
-00012b20: 7261 2865 7874 7261 5f64 6174 612c 2028  ra(extra_data, (
-00012b30: 312c 2929 0a20 2020 2020 2020 2020 2020  1,)).           
-00012b40: 2020 2020 2065 7874 7261 5f64 6174 6120       extra_data 
-00012b50: 3d20 7374 7275 6374 2e70 6163 6b28 0a20  = struct.pack(. 
-00012b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012b70: 2020 2027 3c48 4827 202b 2027 5127 2a6c     '<HH' + 'Q'*l
-00012b80: 656e 2865 7874 7261 292c 0a20 2020 2020  en(extra),.     
-00012b90: 2020 2020 2020 2020 2020 2020 2020 2031                 1
-00012ba0: 2c20 382a 6c65 6e28 6578 7472 6129 2c20  , 8*len(extra), 
-00012bb0: 2a65 7874 7261 2920 2b20 6578 7472 615f  *extra) + extra_
-00012bc0: 6461 7461 0a0a 2020 2020 2020 2020 2020  data..          
-00012bd0: 2020 2020 2020 6d69 6e5f 7665 7273 696f        min_versio
-00012be0: 6e20 3d20 5a49 5036 345f 5645 5253 494f  n = ZIP64_VERSIO
-00012bf0: 4e0a 0a20 2020 2020 2020 2020 2020 2069  N..            i
-00012c00: 6620 7a69 6e66 6f2e 636f 6d70 7265 7373  f zinfo.compress
-00012c10: 5f74 7970 6520 3d3d 205a 4950 5f42 5a49  _type == ZIP_BZI
-00012c20: 5032 3a0a 2020 2020 2020 2020 2020 2020  P2:.            
-00012c30: 2020 2020 6d69 6e5f 7665 7273 696f 6e20      min_version 
-00012c40: 3d20 6d61 7828 425a 4950 325f 5645 5253  = max(BZIP2_VERS
-00012c50: 494f 4e2c 206d 696e 5f76 6572 7369 6f6e  ION, min_version
-00012c60: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-00012c70: 6966 207a 696e 666f 2e63 6f6d 7072 6573  if zinfo.compres
-00012c80: 735f 7479 7065 203d 3d20 5a49 505f 4c5a  s_type == ZIP_LZ
-00012c90: 4d41 3a0a 2020 2020 2020 2020 2020 2020  MA:.            
-00012ca0: 2020 2020 6d69 6e5f 7665 7273 696f 6e20      min_version 
-00012cb0: 3d20 6d61 7828 4c5a 4d41 5f56 4552 5349  = max(LZMA_VERSI
-00012cc0: 4f4e 2c20 6d69 6e5f 7665 7273 696f 6e29  ON, min_version)
-00012cd0: 0a0a 2020 2020 2020 2020 2020 2020 6578  ..            ex
-00012ce0: 7472 6163 745f 7665 7273 696f 6e20 3d20  tract_version = 
-00012cf0: 6d61 7828 6d69 6e5f 7665 7273 696f 6e2c  max(min_version,
-00012d00: 207a 696e 666f 2e65 7874 7261 6374 5f76   zinfo.extract_v
-00012d10: 6572 7369 6f6e 290a 2020 2020 2020 2020  ersion).        
-00012d20: 2020 2020 6372 6561 7465 5f76 6572 7369      create_versi
-00012d30: 6f6e 203d 206d 6178 286d 696e 5f76 6572  on = max(min_ver
-00012d40: 7369 6f6e 2c20 7a69 6e66 6f2e 6372 6561  sion, zinfo.crea
-00012d50: 7465 5f76 6572 7369 6f6e 290a 2020 2020  te_version).    
-00012d60: 2020 2020 2020 2020 6669 6c65 6e61 6d65          filename
-00012d70: 2c20 666c 6167 5f62 6974 7320 3d20 7a69  , flag_bits = zi
-00012d80: 6e66 6f2e 5f65 6e63 6f64 6546 696c 656e  nfo._encodeFilen
-00012d90: 616d 6546 6c61 6773 2829 0a20 2020 2020  ameFlags().     
-00012da0: 2020 2020 2020 2063 656e 7464 6972 203d         centdir =
-00012db0: 2073 7472 7563 742e 7061 636b 2873 7472   struct.pack(str
-00012dc0: 7563 7443 656e 7472 616c 4469 722c 0a20  uctCentralDir,. 
-00012dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012df0: 2073 7472 696e 6743 656e 7472 616c 4469   stringCentralDi
-00012e00: 722c 2063 7265 6174 655f 7665 7273 696f  r, create_versio
-00012e10: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
-00012e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012e30: 2020 2020 207a 696e 666f 2e63 7265 6174       zinfo.creat
-00012e40: 655f 7379 7374 656d 2c20 6578 7472 6163  e_system, extrac
-00012e50: 745f 7665 7273 696f 6e2c 207a 696e 666f  t_version, zinfo
-00012e60: 2e72 6573 6572 7665 642c 0a20 2020 2020  .reserved,.     
-00012e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012e80: 2020 2020 2020 2020 2020 2020 2066 6c61               fla
-00012e90: 675f 6269 7473 2c20 7a69 6e66 6f2e 636f  g_bits, zinfo.co
-00012ea0: 6d70 7265 7373 5f74 7970 652c 2064 6f73  mpress_type, dos
-00012eb0: 7469 6d65 2c20 646f 7364 6174 652c 0a20  time, dosdate,. 
-00012ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012ee0: 207a 696e 666f 2e43 5243 2c20 636f 6d70   zinfo.CRC, comp
-00012ef0: 7265 7373 5f73 697a 652c 2066 696c 655f  ress_size, file_
-00012f00: 7369 7a65 2c0a 2020 2020 2020 2020 2020  size,.          
-00012f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012f20: 2020 2020 2020 2020 6c65 6e28 6669 6c65          len(file
-00012f30: 6e61 6d65 292c 206c 656e 2865 7874 7261  name), len(extra
-00012f40: 5f64 6174 6129 2c20 6c65 6e28 7a69 6e66  _data), len(zinf
-00012f50: 6f2e 636f 6d6d 656e 7429 2c0a 2020 2020  o.comment),.    
-00012f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012f70: 2020 2020 2020 2020 2020 2020 2020 302c                0,
-00012f80: 207a 696e 666f 2e69 6e74 6572 6e61 6c5f   zinfo.internal_
-00012f90: 6174 7472 2c20 7a69 6e66 6f2e 6578 7465  attr, zinfo.exte
-00012fa0: 726e 616c 5f61 7474 722c 0a20 2020 2020  rnal_attr,.     
-00012fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012fc0: 2020 2020 2020 2020 2020 2020 2068 6561               hea
-00012fd0: 6465 725f 6f66 6673 6574 290a 2020 2020  der_offset).    
-00012fe0: 2020 2020 2020 2020 7365 6c66 2e66 702e          self.fp.
-00012ff0: 7772 6974 6528 6365 6e74 6469 7229 0a20  write(centdir). 
-00013000: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00013010: 6670 2e77 7269 7465 2866 696c 656e 616d  fp.write(filenam
-00013020: 6529 0a20 2020 2020 2020 2020 2020 2073  e).            s
-00013030: 656c 662e 6670 2e77 7269 7465 2865 7874  elf.fp.write(ext
-00013040: 7261 5f64 6174 6129 0a20 2020 2020 2020  ra_data).       
-00013050: 2020 2020 2073 656c 662e 6670 2e77 7269       self.fp.wri
-00013060: 7465 287a 696e 666f 2e63 6f6d 6d65 6e74  te(zinfo.comment
-00013070: 290a 0a20 2020 2020 2020 2070 6f73 3220  )..        pos2 
-00013080: 3d20 7365 6c66 2e66 702e 7465 6c6c 2829  = self.fp.tell()
-00013090: 0a20 2020 2020 2020 2023 2057 7269 7465  .        # Write
-000130a0: 2065 6e64 2d6f 662d 7a69 702d 6172 6368   end-of-zip-arch
-000130b0: 6976 6520 7265 636f 7264 0a20 2020 2020  ive record.     
-000130c0: 2020 2063 656e 7444 6972 436f 756e 7420     centDirCount 
-000130d0: 3d20 6c65 6e28 7365 6c66 2e66 696c 656c  = len(self.filel
-000130e0: 6973 7429 0a20 2020 2020 2020 2063 656e  ist).        cen
-000130f0: 7444 6972 5369 7a65 203d 2070 6f73 3220  tDirSize = pos2 
-00013100: 2d20 7365 6c66 2e73 7461 7274 5f64 6972  - self.start_dir
-00013110: 0a20 2020 2020 2020 2063 656e 7444 6972  .        centDir
-00013120: 4f66 6673 6574 203d 2073 656c 662e 7374  Offset = self.st
-00013130: 6172 745f 6469 720a 2020 2020 2020 2020  art_dir.        
-00013140: 7265 7175 6972 6573 5f7a 6970 3634 203d  requires_zip64 =
-00013150: 204e 6f6e 650a 2020 2020 2020 2020 6966   None.        if
-00013160: 2063 656e 7444 6972 436f 756e 7420 3e20   centDirCount > 
-00013170: 5a49 505f 4649 4c45 434f 554e 545f 4c49  ZIP_FILECOUNT_LI
-00013180: 4d49 543a 0a20 2020 2020 2020 2020 2020  MIT:.           
-00013190: 2072 6571 7569 7265 735f 7a69 7036 3420   requires_zip64 
-000131a0: 3d20 2246 696c 6573 2063 6f75 6e74 220a  = "Files count".
-000131b0: 2020 2020 2020 2020 656c 6966 2063 656e          elif cen
-000131c0: 7444 6972 4f66 6673 6574 203e 205a 4950  tDirOffset > ZIP
-000131d0: 3634 5f4c 494d 4954 3a0a 2020 2020 2020  64_LIMIT:.      
-000131e0: 2020 2020 2020 7265 7175 6972 6573 5f7a        requires_z
-000131f0: 6970 3634 203d 2022 4365 6e74 7261 6c20  ip64 = "Central 
-00013200: 6469 7265 6374 6f72 7920 6f66 6673 6574  directory offset
-00013210: 220a 2020 2020 2020 2020 656c 6966 2063  ".        elif c
-00013220: 656e 7444 6972 5369 7a65 203e 205a 4950  entDirSize > ZIP
-00013230: 3634 5f4c 494d 4954 3a0a 2020 2020 2020  64_LIMIT:.      
-00013240: 2020 2020 2020 7265 7175 6972 6573 5f7a        requires_z
-00013250: 6970 3634 203d 2022 4365 6e74 7261 6c20  ip64 = "Central 
-00013260: 6469 7265 6374 6f72 7920 7369 7a65 220a  directory size".
-00013270: 2020 2020 2020 2020 6966 2072 6571 7569          if requi
-00013280: 7265 735f 7a69 7036 343a 0a20 2020 2020  res_zip64:.     
-00013290: 2020 2020 2020 2023 204e 6565 6420 746f         # Need to
-000132a0: 2077 7269 7465 2074 6865 205a 4950 3634   write the ZIP64
-000132b0: 2065 6e64 2d6f 662d 6172 6368 6976 6520   end-of-archive 
-000132c0: 7265 636f 7264 730a 2020 2020 2020 2020  records.        
-000132d0: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
-000132e0: 5f61 6c6c 6f77 5a69 7036 343a 0a20 2020  _allowZip64:.   
-000132f0: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-00013300: 7365 204c 6172 6765 5a69 7046 696c 6528  se LargeZipFile(
-00013310: 7265 7175 6972 6573 5f7a 6970 3634 202b  requires_zip64 +
-00013320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013340: 2020 2020 2220 776f 756c 6420 7265 7175      " would requ
-00013350: 6972 6520 5a49 5036 3420 6578 7465 6e73  ire ZIP64 extens
-00013360: 696f 6e73 2229 0a20 2020 2020 2020 2020  ions").         
-00013370: 2020 207a 6970 3634 656e 6472 6563 203d     zip64endrec =
-00013380: 2073 7472 7563 742e 7061 636b 280a 2020   struct.pack(.  
-00013390: 2020 2020 2020 2020 2020 2020 2020 7374                st
-000133a0: 7275 6374 456e 6441 7263 6869 7665 3634  ructEndArchive64
-000133b0: 2c20 7374 7269 6e67 456e 6441 7263 6869  , stringEndArchi
-000133c0: 7665 3634 2c0a 2020 2020 2020 2020 2020  ve64,.          
-000133d0: 2020 2020 2020 3434 2c20 3435 2c20 3435        44, 45, 45
-000133e0: 2c20 302c 2030 2c20 6365 6e74 4469 7243  , 0, 0, centDirC
-000133f0: 6f75 6e74 2c20 6365 6e74 4469 7243 6f75  ount, centDirCou
-00013400: 6e74 2c0a 2020 2020 2020 2020 2020 2020  nt,.            
-00013410: 2020 2020 6365 6e74 4469 7253 697a 652c      centDirSize,
-00013420: 2063 656e 7444 6972 4f66 6673 6574 290a   centDirOffset).
-00013430: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00013440: 2e66 702e 7772 6974 6528 7a69 7036 3465  .fp.write(zip64e
-00013450: 6e64 7265 6329 0a0a 2020 2020 2020 2020  ndrec)..        
-00013460: 2020 2020 7a69 7036 346c 6f63 7265 6320      zip64locrec 
-00013470: 3d20 7374 7275 6374 2e70 6163 6b28 0a20  = struct.pack(. 
-00013480: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00013490: 7472 7563 7445 6e64 4172 6368 6976 6536  tructEndArchive6
-000134a0: 344c 6f63 6174 6f72 2c0a 2020 2020 2020  4Locator,.      
-000134b0: 2020 2020 2020 2020 2020 7374 7269 6e67            string
-000134c0: 456e 6441 7263 6869 7665 3634 4c6f 6361  EndArchive64Loca
-000134d0: 746f 722c 2030 2c20 706f 7332 2c20 3129  tor, 0, pos2, 1)
-000134e0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000134f0: 662e 6670 2e77 7269 7465 287a 6970 3634  f.fp.write(zip64
-00013500: 6c6f 6372 6563 290a 2020 2020 2020 2020  locrec).        
-00013510: 2020 2020 6365 6e74 4469 7243 6f75 6e74      centDirCount
-00013520: 203d 206d 696e 2863 656e 7444 6972 436f   = min(centDirCo
-00013530: 756e 742c 2030 7846 4646 4629 0a20 2020  unt, 0xFFFF).   
-00013540: 2020 2020 2020 2020 2063 656e 7444 6972           centDir
-00013550: 5369 7a65 203d 206d 696e 2863 656e 7444  Size = min(centD
-00013560: 6972 5369 7a65 2c20 3078 4646 4646 4646  irSize, 0xFFFFFF
-00013570: 4646 290a 2020 2020 2020 2020 2020 2020  FF).            
-00013580: 6365 6e74 4469 724f 6666 7365 7420 3d20  centDirOffset = 
-00013590: 6d69 6e28 6365 6e74 4469 724f 6666 7365  min(centDirOffse
-000135a0: 742c 2030 7846 4646 4646 4646 4629 0a0a  t, 0xFFFFFFFF)..
-000135b0: 2020 2020 2020 2020 656e 6472 6563 203d          endrec =
-000135c0: 2073 7472 7563 742e 7061 636b 2873 7472   struct.pack(str
-000135d0: 7563 7445 6e64 4172 6368 6976 652c 2073  uctEndArchive, s
-000135e0: 7472 696e 6745 6e64 4172 6368 6976 652c  tringEndArchive,
-000135f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013600: 2020 2020 2020 2020 2020 2020 2020 302c                0,
-00013610: 2030 2c20 6365 6e74 4469 7243 6f75 6e74   0, centDirCount
-00013620: 2c20 6365 6e74 4469 7243 6f75 6e74 2c0a  , centDirCount,.
-00013630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013640: 2020 2020 2020 2020 2020 2020 2063 656e               cen
-00013650: 7444 6972 5369 7a65 2c20 6365 6e74 4469  tDirSize, centDi
-00013660: 724f 6666 7365 742c 206c 656e 2873 656c  rOffset, len(sel
-00013670: 662e 5f63 6f6d 6d65 6e74 2929 0a20 2020  f._comment)).   
-00013680: 2020 2020 2073 656c 662e 6670 2e77 7269       self.fp.wri
-00013690: 7465 2865 6e64 7265 6329 0a20 2020 2020  te(endrec).     
-000136a0: 2020 2073 656c 662e 6670 2e77 7269 7465     self.fp.write
-000136b0: 2873 656c 662e 5f63 6f6d 6d65 6e74 290a  (self._comment).
-000136c0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-000136d0: 6d6f 6465 203d 3d20 2261 223a 0a20 2020  mode == "a":.   
-000136e0: 2020 2020 2020 2020 2073 656c 662e 6670           self.fp
-000136f0: 2e74 7275 6e63 6174 6528 290a 2020 2020  .truncate().    
-00013700: 2020 2020 7365 6c66 2e66 702e 666c 7573      self.fp.flus
-00013710: 6828 290a 0a20 2020 2064 6566 205f 6670  h()..    def _fp
-00013720: 636c 6f73 6528 7365 6c66 2c20 6670 293a  close(self, fp):
-00013730: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
-00013740: 7365 6c66 2e5f 6669 6c65 5265 6643 6e74  self._fileRefCnt
-00013750: 203e 2030 0a20 2020 2020 2020 2073 656c   > 0.        sel
-00013760: 662e 5f66 696c 6552 6566 436e 7420 2d3d  f._fileRefCnt -=
-00013770: 2031 0a20 2020 2020 2020 2069 6620 6e6f   1.        if no
-00013780: 7420 7365 6c66 2e5f 6669 6c65 5265 6643  t self._fileRefC
-00013790: 6e74 2061 6e64 206e 6f74 2073 656c 662e  nt and not self.
-000137a0: 5f66 696c 6550 6173 7365 643a 0a20 2020  _filePassed:.   
-000137b0: 2020 2020 2020 2020 2066 702e 636c 6f73           fp.clos
-000137c0: 6528 290a 0a0a 636c 6173 7320 5079 5a69  e()...class PyZi
-000137d0: 7046 696c 6528 5a69 7046 696c 6529 3a0a  pFile(ZipFile):.
-000137e0: 2020 2020 2222 2243 6c61 7373 2074 6f20      """Class to 
-000137f0: 6372 6561 7465 205a 4950 2061 7263 6869  create ZIP archi
-00013800: 7665 7320 7769 7468 2050 7974 686f 6e20  ves with Python 
-00013810: 6c69 6272 6172 7920 6669 6c65 7320 616e  library files an
-00013820: 6420 7061 636b 6167 6573 2e22 2222 0a0a  d packages."""..
-00013830: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
-00013840: 2873 656c 662c 2066 696c 652c 206d 6f64  (self, file, mod
-00013850: 653d 2272 222c 2063 6f6d 7072 6573 7369  e="r", compressi
-00013860: 6f6e 3d5a 4950 5f53 544f 5245 442c 0a20  on=ZIP_STORED,. 
-00013870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013880: 616c 6c6f 775a 6970 3634 3d54 7275 652c  allowZip64=True,
-00013890: 206f 7074 696d 697a 653d 2d31 293a 0a20   optimize=-1):. 
-000138a0: 2020 2020 2020 205a 6970 4669 6c65 2e5f         ZipFile._
-000138b0: 5f69 6e69 745f 5f28 7365 6c66 2c20 6669  _init__(self, fi
-000138c0: 6c65 2c20 6d6f 6465 3d6d 6f64 652c 2063  le, mode=mode, c
-000138d0: 6f6d 7072 6573 7369 6f6e 3d63 6f6d 7072  ompression=compr
-000138e0: 6573 7369 6f6e 2c0a 2020 2020 2020 2020  ession,.        
-000138f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013900: 2061 6c6c 6f77 5a69 7036 343d 616c 6c6f   allowZip64=allo
-00013910: 775a 6970 3634 290a 2020 2020 2020 2020  wZip64).        
-00013920: 7365 6c66 2e5f 6f70 7469 6d69 7a65 203d  self._optimize =
-00013930: 206f 7074 696d 697a 650a 0a20 2020 2064   optimize..    d
-00013940: 6566 2077 7269 7465 7079 2873 656c 662c  ef writepy(self,
-00013950: 2070 6174 686e 616d 652c 2062 6173 656e   pathname, basen
-00013960: 616d 653d 2222 2c20 6669 6c74 6572 6675  ame="", filterfu
-00013970: 6e63 3d4e 6f6e 6529 3a0a 2020 2020 2020  nc=None):.      
-00013980: 2020 2222 2241 6464 2061 6c6c 2066 696c    """Add all fil
-00013990: 6573 2066 726f 6d20 2270 6174 686e 616d  es from "pathnam
-000139a0: 6522 2074 6f20 7468 6520 5a49 5020 6172  e" to the ZIP ar
-000139b0: 6368 6976 652e 0a0a 2020 2020 2020 2020  chive...        
-000139c0: 4966 2070 6174 686e 616d 6520 6973 2061  If pathname is a
-000139d0: 2070 6163 6b61 6765 2064 6972 6563 746f   package directo
-000139e0: 7279 2c20 7365 6172 6368 2074 6865 2064  ry, search the d
-000139f0: 6972 6563 746f 7279 2061 6e64 0a20 2020  irectory and.   
-00013a00: 2020 2020 2061 6c6c 2070 6163 6b61 6765       all package
-00013a10: 2073 7562 6469 7265 6374 6f72 6965 7320   subdirectories 
-00013a20: 7265 6375 7273 6976 656c 7920 666f 7220  recursively for 
-00013a30: 616c 6c20 2a2e 7079 2061 6e64 2065 6e74  all *.py and ent
-00013a40: 6572 0a20 2020 2020 2020 2074 6865 206d  er.        the m
-00013a50: 6f64 756c 6573 2069 6e74 6f20 7468 6520  odules into the 
-00013a60: 6172 6368 6976 652e 2020 4966 2070 6174  archive.  If pat
-00013a70: 686e 616d 6520 6973 2061 2070 6c61 696e  hname is a plain
-00013a80: 0a20 2020 2020 2020 2064 6972 6563 746f  .        directo
-00013a90: 7279 2c20 6c69 7374 6469 7220 2a2e 7079  ry, listdir *.py
-00013aa0: 2061 6e64 2065 6e74 6572 2061 6c6c 206d   and enter all m
-00013ab0: 6f64 756c 6573 2e20 2045 6c73 652c 2070  odules.  Else, p
-00013ac0: 6174 686e 616d 650a 2020 2020 2020 2020  athname.        
-00013ad0: 6d75 7374 2062 6520 6120 5079 7468 6f6e  must be a Python
-00013ae0: 202a 2e70 7920 6669 6c65 2061 6e64 2074   *.py file and t
-00013af0: 6865 206d 6f64 756c 6520 7769 6c6c 2062  he module will b
-00013b00: 6520 7075 7420 696e 746f 2074 6865 0a20  e put into the. 
-00013b10: 2020 2020 2020 2061 7263 6869 7665 2e20         archive. 
-00013b20: 2041 6464 6564 206d 6f64 756c 6573 2061   Added modules a
-00013b30: 7265 2061 6c77 6179 7320 6d6f 6475 6c65  re always module
-00013b40: 2e70 7963 2e0a 2020 2020 2020 2020 5468  .pyc..        Th
-00013b50: 6973 206d 6574 686f 6420 7769 6c6c 2063  is method will c
-00013b60: 6f6d 7069 6c65 2074 6865 206d 6f64 756c  ompile the modul
-00013b70: 652e 7079 2069 6e74 6f20 6d6f 6475 6c65  e.py into module
-00013b80: 2e70 7963 2069 660a 2020 2020 2020 2020  .pyc if.        
-00013b90: 6e65 6365 7373 6172 792e 0a20 2020 2020  necessary..     
-00013ba0: 2020 2049 6620 6669 6c74 6572 6675 6e63     If filterfunc
-00013bb0: 2870 6174 686e 616d 6529 2069 7320 6769  (pathname) is gi
-00013bc0: 7665 6e2c 2069 7420 6973 2063 616c 6c65  ven, it is calle
-00013bd0: 6420 7769 7468 2065 7665 7279 2061 7267  d with every arg
-00013be0: 756d 656e 742e 0a20 2020 2020 2020 2057  ument..        W
-00013bf0: 6865 6e20 6974 2069 7320 4661 6c73 652c  hen it is False,
-00013c00: 2074 6865 2066 696c 6520 6f72 2064 6972   the file or dir
-00013c10: 6563 746f 7279 2069 7320 736b 6970 7065  ectory is skippe
-00013c20: 642e 0a20 2020 2020 2020 2022 2222 0a20  d..        """. 
-00013c30: 2020 2020 2020 2069 6620 7379 732e 7665         if sys.ve
-00013c40: 7273 696f 6e5f 696e 666f 3e3d 2833 2c36  rsion_info>=(3,6
-00013c50: 293a 0a20 2020 2020 2020 2020 2020 2070  ):.            p
-00013c60: 6174 686e 616d 6520 3d20 6f73 2e66 7370  athname = os.fsp
-00013c70: 6174 6828 7061 7468 6e61 6d65 290a 2020  ath(pathname).  
-00013c80: 2020 2020 2020 6966 2066 696c 7465 7266        if filterf
-00013c90: 756e 6320 616e 6420 6e6f 7420 6669 6c74  unc and not filt
-00013ca0: 6572 6675 6e63 2870 6174 686e 616d 6529  erfunc(pathname)
-00013cb0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00013cc0: 2073 656c 662e 6465 6275 673a 0a20 2020   self.debug:.   
-00013cd0: 2020 2020 2020 2020 2020 2020 206c 6162               lab
-00013ce0: 656c 203d 2027 7061 7468 2720 6966 206f  el = 'path' if o
-00013cf0: 732e 7061 7468 2e69 7364 6972 2870 6174  s.path.isdir(pat
-00013d00: 686e 616d 6529 2065 6c73 6520 2766 696c  hname) else 'fil
-00013d10: 6527 0a20 2020 2020 2020 2020 2020 2020  e'.             
-00013d20: 2020 2070 7269 6e74 2827 2573 2025 7220     print('%s %r 
-00013d30: 736b 6970 7065 6420 6279 2066 696c 7465  skipped by filte
-00013d40: 7266 756e 6327 2025 2028 6c61 6265 6c2c  rfunc' % (label,
-00013d50: 2070 6174 686e 616d 6529 290a 2020 2020   pathname)).    
-00013d60: 2020 2020 2020 2020 7265 7475 726e 0a20          return. 
-00013d70: 2020 2020 2020 2064 6972 2c20 6e61 6d65         dir, name
-00013d80: 203d 206f 732e 7061 7468 2e73 706c 6974   = os.path.split
-00013d90: 2870 6174 686e 616d 6529 0a20 2020 2020  (pathname).     
-00013da0: 2020 2069 6620 6f73 2e70 6174 682e 6973     if os.path.is
-00013db0: 6469 7228 7061 7468 6e61 6d65 293a 0a20  dir(pathname):. 
-00013dc0: 2020 2020 2020 2020 2020 2069 6e69 746e             initn
-00013dd0: 616d 6520 3d20 6f73 2e70 6174 682e 6a6f  ame = os.path.jo
-00013de0: 696e 2870 6174 686e 616d 652c 2022 5f5f  in(pathname, "__
-00013df0: 696e 6974 5f5f 2e70 7922 290a 2020 2020  init__.py").    
-00013e00: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
-00013e10: 7468 2e69 7366 696c 6528 696e 6974 6e61  th.isfile(initna
-00013e20: 6d65 293a 0a20 2020 2020 2020 2020 2020  me):.           
-00013e30: 2020 2020 2023 2054 6869 7320 6973 2061       # This is a
-00013e40: 2070 6163 6b61 6765 2064 6972 6563 746f   package directo
-00013e50: 7279 2c20 6164 6420 6974 0a20 2020 2020  ry, add it.     
-00013e60: 2020 2020 2020 2020 2020 2069 6620 6261             if ba
-00013e70: 7365 6e61 6d65 3a0a 2020 2020 2020 2020  sename:.        
-00013e80: 2020 2020 2020 2020 2020 2020 6261 7365              base
-00013e90: 6e61 6d65 203d 2022 2573 2f25 7322 2025  name = "%s/%s" %
-00013ea0: 2028 6261 7365 6e61 6d65 2c20 6e61 6d65   (basename, name
-00013eb0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00013ec0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00013ed0: 2020 2020 2020 2020 2020 2020 6261 7365              base
-00013ee0: 6e61 6d65 203d 206e 616d 650a 2020 2020  name = name.    
-00013ef0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-00013f00: 656c 662e 6465 6275 673a 0a20 2020 2020  elf.debug:.     
-00013f10: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00013f20: 7269 6e74 2822 4164 6469 6e67 2070 6163  rint("Adding pac
-00013f30: 6b61 6765 2069 6e22 2c20 7061 7468 6e61  kage in", pathna
-00013f40: 6d65 2c20 2261 7322 2c20 6261 7365 6e61  me, "as", basena
-00013f50: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
-00013f60: 2020 2020 666e 616d 652c 2061 7263 6e61      fname, arcna
-00013f70: 6d65 203d 2073 656c 662e 5f67 6574 5f63  me = self._get_c
-00013f80: 6f64 656e 616d 6528 696e 6974 6e61 6d65  odename(initname
-00013f90: 5b30 3a2d 335d 2c20 6261 7365 6e61 6d65  [0:-3], basename
-00013fa0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00013fb0: 2020 6966 2073 656c 662e 6465 6275 673a    if self.debug:
-00013fc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013fd0: 2020 2020 2070 7269 6e74 2822 4164 6469       print("Addi
-00013fe0: 6e67 222c 2061 7263 6e61 6d65 290a 2020  ng", arcname).  
-00013ff0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00014000: 6c66 2e77 7269 7465 2866 6e61 6d65 2c20  lf.write(fname, 
-00014010: 6172 636e 616d 6529 0a20 2020 2020 2020  arcname).       
-00014020: 2020 2020 2020 2020 2064 6972 6c69 7374           dirlist
-00014030: 203d 2073 6f72 7465 6428 6f73 2e6c 6973   = sorted(os.lis
-00014040: 7464 6972 2870 6174 686e 616d 6529 290a  tdir(pathname)).
-00014050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014060: 6469 726c 6973 742e 7265 6d6f 7665 2822  dirlist.remove("
-00014070: 5f5f 696e 6974 5f5f 2e70 7922 290a 2020  __init__.py").  
-00014080: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00014090: 4164 6420 616c 6c20 2a2e 7079 2066 696c  Add all *.py fil
-000140a0: 6573 2061 6e64 2070 6163 6b61 6765 2073  es and package s
-000140b0: 7562 6469 7265 6374 6f72 6965 730a 2020  ubdirectories.  
-000140c0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-000140d0: 7220 6669 6c65 6e61 6d65 2069 6e20 6469  r filename in di
-000140e0: 726c 6973 743a 0a20 2020 2020 2020 2020  rlist:.         
-000140f0: 2020 2020 2020 2020 2020 2070 6174 6820             path 
-00014100: 3d20 6f73 2e70 6174 682e 6a6f 696e 2870  = os.path.join(p
-00014110: 6174 686e 616d 652c 2066 696c 656e 616d  athname, filenam
-00014120: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-00014130: 2020 2020 2020 2072 6f6f 742c 2065 7874         root, ext
-00014140: 203d 206f 732e 7061 7468 2e73 706c 6974   = os.path.split
-00014150: 6578 7428 6669 6c65 6e61 6d65 290a 2020  ext(filename).  
-00014160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014170: 2020 6966 206f 732e 7061 7468 2e69 7364    if os.path.isd
-00014180: 6972 2870 6174 6829 3a0a 2020 2020 2020  ir(path):.      
-00014190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000141a0: 2020 6966 206f 732e 7061 7468 2e69 7366    if os.path.isf
-000141b0: 696c 6528 6f73 2e70 6174 682e 6a6f 696e  ile(os.path.join
-000141c0: 2870 6174 682c 2022 5f5f 696e 6974 5f5f  (path, "__init__
-000141d0: 2e70 7922 2929 3a0a 2020 2020 2020 2020  .py")):.        
-000141e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000141f0: 2020 2020 2320 5468 6973 2069 7320 6120      # This is a 
-00014200: 7061 636b 6167 6520 6469 7265 6374 6f72  package director
-00014210: 792c 2061 6464 2069 740a 2020 2020 2020  y, add it.      
-00014220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014230: 2020 2020 2020 7365 6c66 2e77 7269 7465        self.write
-00014240: 7079 2870 6174 682c 2062 6173 656e 616d  py(path, basenam
-00014250: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-00014260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014270: 2020 2020 2020 2020 2020 2020 6669 6c74              filt
-00014280: 6572 6675 6e63 3d66 696c 7465 7266 756e  erfunc=filterfun
-00014290: 6329 2020 2320 5265 6375 7273 6976 6520  c)  # Recursive 
-000142a0: 6361 6c6c 0a20 2020 2020 2020 2020 2020  call.           
-000142b0: 2020 2020 2020 2020 2065 6c69 6620 6578           elif ex
-000142c0: 7420 3d3d 2022 2e70 7922 3a0a 2020 2020  t == ".py":.    
-000142d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000142e0: 2020 2020 6966 2066 696c 7465 7266 756e      if filterfun
-000142f0: 6320 616e 6420 6e6f 7420 6669 6c74 6572  c and not filter
-00014300: 6675 6e63 2870 6174 6829 3a0a 2020 2020  func(path):.    
-00014310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014320: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00014330: 6465 6275 673a 0a20 2020 2020 2020 2020  debug:.         
+0000d2d0: 2023 2066 696c 6520 6973 206e 6f74 2061   # file is not a
+0000d2e0: 207a 6970 2066 696c 652c 206a 7573 7420   zip file, just 
+0000d2f0: 6170 7065 6e64 0a20 2020 2020 2020 2020  append.         
+0000d300: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000d310: 6670 2e73 6565 6b28 302c 2032 290a 0a20  fp.seek(0, 2).. 
+0000d320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d330: 2020 2023 2073 6574 2074 6865 206d 6f64     # set the mod
+0000d340: 6966 6965 6420 666c 6167 2073 6f20 6365  ified flag so ce
+0000d350: 6e74 7261 6c20 6469 7265 6374 6f72 7920  ntral directory 
+0000d360: 6765 7473 2077 7269 7474 656e 0a20 2020  gets written.   
+0000d370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d380: 2023 2065 7665 6e20 6966 206e 6f20 6669   # even if no fi
+0000d390: 6c65 7320 6172 6520 6164 6465 6420 746f  les are added to
+0000d3a0: 2074 6865 2061 7263 6869 7665 0a20 2020   the archive.   
+0000d3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d3c0: 2073 656c 662e 5f64 6964 4d6f 6469 6679   self._didModify
+0000d3d0: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
+0000d3e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000d3f0: 2e73 7461 7274 5f64 6972 203d 2073 656c  .start_dir = sel
+0000d400: 662e 6670 2e74 656c 6c28 290a 2020 2020  f.fp.tell().    
+0000d410: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0000d420: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+0000d430: 6973 6520 5661 6c75 6545 7272 6f72 2822  ise ValueError("
+0000d440: 4d6f 6465 206d 7573 7420 6265 2027 7227  Mode must be 'r'
+0000d450: 2c20 2777 272c 2027 7827 2c20 6f72 2027  , 'w', 'x', or '
+0000d460: 6127 2229 0a20 2020 2020 2020 2065 7863  a'").        exc
+0000d470: 6570 743a 0a20 2020 2020 2020 2020 2020  ept:.           
+0000d480: 2066 7020 3d20 7365 6c66 2e66 700a 2020   fp = self.fp.  
+0000d490: 2020 2020 2020 2020 2020 7365 6c66 2e66            self.f
+0000d4a0: 7020 3d20 4e6f 6e65 0a20 2020 2020 2020  p = None.       
+0000d4b0: 2020 2020 2073 656c 662e 5f66 7063 6c6f       self._fpclo
+0000d4c0: 7365 2866 7029 0a20 2020 2020 2020 2020  se(fp).         
+0000d4d0: 2020 2072 6169 7365 0a0a 2020 2020 6465     raise..    de
+0000d4e0: 6620 5f5f 656e 7465 725f 5f28 7365 6c66  f __enter__(self
+0000d4f0: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
+0000d500: 6e20 7365 6c66 0a0a 2020 2020 6465 6620  n self..    def 
+0000d510: 5f5f 6578 6974 5f5f 2873 656c 662c 2074  __exit__(self, t
+0000d520: 7970 652c 2076 616c 7565 2c20 7472 6163  ype, value, trac
+0000d530: 6562 6163 6b29 3a0a 2020 2020 2020 2020  eback):.        
+0000d540: 7365 6c66 2e63 6c6f 7365 2829 0a0a 2020  self.close()..  
+0000d550: 2020 6465 6620 5f5f 7265 7072 5f5f 2873    def __repr__(s
+0000d560: 656c 6629 3a0a 2020 2020 2020 2020 7265  elf):.        re
+0000d570: 7375 6c74 203d 205b 273c 2573 2e25 7327  sult = ['<%s.%s'
+0000d580: 2025 2028 7365 6c66 2e5f 5f63 6c61 7373   % (self.__class
+0000d590: 5f5f 2e5f 5f6d 6f64 756c 655f 5f2c 0a20  __.__module__,. 
+0000d5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d5b0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0000d5c0: 662e 5f5f 636c 6173 735f 5f2e 5f5f 7175  f.__class__.__qu
+0000d5d0: 616c 6e61 6d65 5f5f 295d 0a20 2020 2020  alname__)].     
+0000d5e0: 2020 2069 6620 7365 6c66 2e66 7020 6973     if self.fp is
+0000d5f0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+0000d600: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
+0000d610: 6669 6c65 5061 7373 6564 3a0a 2020 2020  filePassed:.    
+0000d620: 2020 2020 2020 2020 2020 2020 7265 7375              resu
+0000d630: 6c74 2e61 7070 656e 6428 2720 6669 6c65  lt.append(' file
+0000d640: 3d25 7227 2025 2073 656c 662e 6670 290a  =%r' % self.fp).
+0000d650: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+0000d660: 2073 656c 662e 6669 6c65 6e61 6d65 2069   self.filename i
+0000d670: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+0000d680: 2020 2020 2020 2020 2020 2020 7265 7375              resu
+0000d690: 6c74 2e61 7070 656e 6428 2720 6669 6c65  lt.append(' file
+0000d6a0: 6e61 6d65 3d25 7227 2025 2073 656c 662e  name=%r' % self.
+0000d6b0: 6669 6c65 6e61 6d65 290a 2020 2020 2020  filename).      
+0000d6c0: 2020 2020 2020 7265 7375 6c74 2e61 7070        result.app
+0000d6d0: 656e 6428 2720 6d6f 6465 3d25 7227 2025  end(' mode=%r' %
+0000d6e0: 2073 656c 662e 6d6f 6465 290a 2020 2020   self.mode).    
+0000d6f0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0000d700: 2020 2020 2020 7265 7375 6c74 2e61 7070        result.app
+0000d710: 656e 6428 2720 5b63 6c6f 7365 645d 2729  end(' [closed]')
+0000d720: 0a20 2020 2020 2020 2072 6573 756c 742e  .        result.
+0000d730: 6170 7065 6e64 2827 3e27 290a 2020 2020  append('>').    
+0000d740: 2020 2020 7265 7475 726e 2027 272e 6a6f      return ''.jo
+0000d750: 696e 2872 6573 756c 7429 0a0a 2020 2020  in(result)..    
+0000d760: 6465 6620 5f52 6561 6c47 6574 436f 6e74  def _RealGetCont
+0000d770: 656e 7473 2873 656c 6629 3a0a 2020 2020  ents(self):.    
+0000d780: 2020 2020 2222 2252 6561 6420 696e 2074      """Read in t
+0000d790: 6865 2074 6162 6c65 206f 6620 636f 6e74  he table of cont
+0000d7a0: 656e 7473 2066 6f72 2074 6865 205a 4950  ents for the ZIP
+0000d7b0: 2066 696c 652e 2222 220a 2020 2020 2020   file.""".      
+0000d7c0: 2020 6670 203d 2073 656c 662e 6670 0a20    fp = self.fp. 
+0000d7d0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+0000d7e0: 2020 2020 2020 2020 656e 6472 6563 203d          endrec =
+0000d7f0: 205f 456e 6452 6563 4461 7461 2866 7029   _EndRecData(fp)
+0000d800: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+0000d810: 4f53 4572 726f 723a 0a20 2020 2020 2020  OSError:.       
+0000d820: 2020 2020 2072 6169 7365 2042 6164 5a69       raise BadZi
+0000d830: 7046 696c 6528 2246 696c 6520 6973 206e  pFile("File is n
+0000d840: 6f74 2061 207a 6970 2066 696c 6522 290a  ot a zip file").
+0000d850: 2020 2020 2020 2020 6966 206e 6f74 2065          if not e
+0000d860: 6e64 7265 633a 0a20 2020 2020 2020 2020  ndrec:.         
+0000d870: 2020 2072 6169 7365 2042 6164 5a69 7046     raise BadZipF
+0000d880: 696c 6528 2246 696c 6520 6973 206e 6f74  ile("File is not
+0000d890: 2061 207a 6970 2066 696c 6522 290a 2020   a zip file").  
+0000d8a0: 2020 2020 2020 6966 2073 656c 662e 6465        if self.de
+0000d8b0: 6275 6720 3e20 313a 0a20 2020 2020 2020  bug > 1:.       
+0000d8c0: 2020 2020 2070 7269 6e74 2865 6e64 7265       print(endre
+0000d8d0: 6329 0a20 2020 2020 2020 2073 697a 655f  c).        size_
+0000d8e0: 6364 203d 2065 6e64 7265 635b 5f45 4344  cd = endrec[_ECD
+0000d8f0: 5f53 495a 455d 2020 2020 2020 2020 2020  _SIZE]          
+0000d900: 2020 2023 2062 7974 6573 2069 6e20 6365     # bytes in ce
+0000d910: 6e74 7261 6c20 6469 7265 6374 6f72 790a  ntral directory.
+0000d920: 2020 2020 2020 2020 6f66 6673 6574 5f63          offset_c
+0000d930: 6420 3d20 656e 6472 6563 5b5f 4543 445f  d = endrec[_ECD_
+0000d940: 4f46 4653 4554 5d20 2020 2020 2020 2020  OFFSET]         
+0000d950: 2320 6f66 6673 6574 206f 6620 6365 6e74  # offset of cent
+0000d960: 7261 6c20 6469 7265 6374 6f72 790a 2020  ral directory.  
+0000d970: 2020 2020 2020 7365 6c66 2e5f 636f 6d6d        self._comm
+0000d980: 656e 7420 3d20 656e 6472 6563 5b5f 4543  ent = endrec[_EC
+0000d990: 445f 434f 4d4d 454e 545d 2020 2020 2320  D_COMMENT]    # 
+0000d9a0: 6172 6368 6976 6520 636f 6d6d 656e 740a  archive comment.
+0000d9b0: 0a20 2020 2020 2020 2023 2022 636f 6e63  .        # "conc
+0000d9c0: 6174 2220 6973 207a 6572 6f2c 2075 6e6c  at" is zero, unl
+0000d9d0: 6573 7320 7a69 7020 7761 7320 636f 6e63  ess zip was conc
+0000d9e0: 6174 656e 6174 6564 2074 6f20 616e 6f74  atenated to anot
+0000d9f0: 6865 7220 6669 6c65 0a20 2020 2020 2020  her file.       
+0000da00: 2063 6f6e 6361 7420 3d20 656e 6472 6563   concat = endrec
+0000da10: 5b5f 4543 445f 4c4f 4341 5449 4f4e 5d20  [_ECD_LOCATION] 
+0000da20: 2d20 7369 7a65 5f63 6420 2d20 6f66 6673  - size_cd - offs
+0000da30: 6574 5f63 640a 2020 2020 2020 2020 6966  et_cd.        if
+0000da40: 2065 6e64 7265 635b 5f45 4344 5f53 4947   endrec[_ECD_SIG
+0000da50: 4e41 5455 5245 5d20 3d3d 2073 7472 696e  NATURE] == strin
+0000da60: 6745 6e64 4172 6368 6976 6536 343a 0a20  gEndArchive64:. 
+0000da70: 2020 2020 2020 2020 2020 2023 2049 6620             # If 
+0000da80: 5a69 7036 3420 6578 7465 6e73 696f 6e20  Zip64 extension 
+0000da90: 7374 7275 6374 7572 6573 2061 7265 2070  structures are p
+0000daa0: 7265 7365 6e74 2c20 6163 636f 756e 7420  resent, account 
+0000dab0: 666f 7220 7468 656d 0a20 2020 2020 2020  for them.       
+0000dac0: 2020 2020 2063 6f6e 6361 7420 2d3d 2028       concat -= (
+0000dad0: 7369 7a65 456e 6443 656e 7444 6972 3634  sizeEndCentDir64
+0000dae0: 202b 2073 697a 6545 6e64 4365 6e74 4469   + sizeEndCentDi
+0000daf0: 7236 344c 6f63 6174 6f72 290a 0a20 2020  r64Locator)..   
+0000db00: 2020 2020 2069 6620 7365 6c66 2e64 6562       if self.deb
+0000db10: 7567 203e 2032 3a0a 2020 2020 2020 2020  ug > 2:.        
+0000db20: 2020 2020 696e 6665 7272 6564 203d 2063      inferred = c
+0000db30: 6f6e 6361 7420 2b20 6f66 6673 6574 5f63  oncat + offset_c
+0000db40: 640a 2020 2020 2020 2020 2020 2020 7072  d.            pr
+0000db50: 696e 7428 2267 6976 656e 2c20 696e 6665  int("given, infe
+0000db60: 7272 6564 2c20 6f66 6673 6574 222c 206f  rred, offset", o
+0000db70: 6666 7365 745f 6364 2c20 696e 6665 7272  ffset_cd, inferr
+0000db80: 6564 2c20 636f 6e63 6174 290a 2020 2020  ed, concat).    
+0000db90: 2020 2020 2320 7365 6c66 2e73 7461 7274      # self.start
+0000dba0: 5f64 6972 3a20 2050 6f73 6974 696f 6e20  _dir:  Position 
+0000dbb0: 6f66 2073 7461 7274 206f 6620 6365 6e74  of start of cent
+0000dbc0: 7261 6c20 6469 7265 6374 6f72 790a 2020  ral directory.  
+0000dbd0: 2020 2020 2020 7365 6c66 2e73 7461 7274        self.start
+0000dbe0: 5f64 6972 203d 206f 6666 7365 745f 6364  _dir = offset_cd
+0000dbf0: 202b 2063 6f6e 6361 740a 2020 2020 2020   + concat.      
+0000dc00: 2020 6670 2e73 6565 6b28 7365 6c66 2e73    fp.seek(self.s
+0000dc10: 7461 7274 5f64 6972 2c20 3029 0a20 2020  tart_dir, 0).   
+0000dc20: 2020 2020 2064 6174 6120 3d20 6670 2e72       data = fp.r
+0000dc30: 6561 6428 7369 7a65 5f63 6429 0a20 2020  ead(size_cd).   
+0000dc40: 2020 2020 2066 7020 3d20 696f 2e42 7974       fp = io.Byt
+0000dc50: 6573 494f 2864 6174 6129 0a20 2020 2020  esIO(data).     
+0000dc60: 2020 2074 6f74 616c 203d 2030 0a20 2020     total = 0.   
+0000dc70: 2020 2020 2077 6869 6c65 2074 6f74 616c       while total
+0000dc80: 203c 2073 697a 655f 6364 3a0a 2020 2020   < size_cd:.    
+0000dc90: 2020 2020 2020 2020 6365 6e74 6469 7220          centdir 
+0000dca0: 3d20 6670 2e72 6561 6428 7369 7a65 4365  = fp.read(sizeCe
+0000dcb0: 6e74 7261 6c44 6972 290a 2020 2020 2020  ntralDir).      
+0000dcc0: 2020 2020 2020 6966 206c 656e 2863 656e        if len(cen
+0000dcd0: 7464 6972 2920 213d 2073 697a 6543 656e  tdir) != sizeCen
+0000dce0: 7472 616c 4469 723a 0a20 2020 2020 2020  tralDir:.       
+0000dcf0: 2020 2020 2020 2020 2072 6169 7365 2042           raise B
+0000dd00: 6164 5a69 7046 696c 6528 2254 7275 6e63  adZipFile("Trunc
+0000dd10: 6174 6564 2063 656e 7472 616c 2064 6972  ated central dir
+0000dd20: 6563 746f 7279 2229 0a20 2020 2020 2020  ectory").       
+0000dd30: 2020 2020 2063 656e 7464 6972 203d 2073       centdir = s
+0000dd40: 7472 7563 742e 756e 7061 636b 2873 7472  truct.unpack(str
+0000dd50: 7563 7443 656e 7472 616c 4469 722c 2063  uctCentralDir, c
+0000dd60: 656e 7464 6972 290a 2020 2020 2020 2020  entdir).        
+0000dd70: 2020 2020 6966 2063 656e 7464 6972 5b5f      if centdir[_
+0000dd80: 4344 5f53 4947 4e41 5455 5245 5d20 213d  CD_SIGNATURE] !=
+0000dd90: 2073 7472 696e 6743 656e 7472 616c 4469   stringCentralDi
+0000dda0: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
+0000ddb0: 2020 2072 6169 7365 2042 6164 5a69 7046     raise BadZipF
+0000ddc0: 696c 6528 2242 6164 206d 6167 6963 206e  ile("Bad magic n
+0000ddd0: 756d 6265 7220 666f 7220 6365 6e74 7261  umber for centra
+0000dde0: 6c20 6469 7265 6374 6f72 7922 290a 2020  l directory").  
+0000ddf0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+0000de00: 662e 6465 6275 6720 3e20 323a 0a20 2020  f.debug > 2:.   
+0000de10: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+0000de20: 6e74 2863 656e 7464 6972 290a 2020 2020  nt(centdir).    
+0000de30: 2020 2020 2020 2020 6669 6c65 6e61 6d65          filename
+0000de40: 203d 2066 702e 7265 6164 2863 656e 7464   = fp.read(centd
+0000de50: 6972 5b5f 4344 5f46 494c 454e 414d 455f  ir[_CD_FILENAME_
+0000de60: 4c45 4e47 5448 5d29 0a20 2020 2020 2020  LENGTH]).       
+0000de70: 2020 2020 2066 6c61 6773 203d 2063 656e       flags = cen
+0000de80: 7464 6972 5b35 5d0a 2020 2020 2020 2020  tdir[5].        
+0000de90: 2020 2020 6966 2066 6c61 6773 2026 2030      if flags & 0
+0000dea0: 7838 3030 3a0a 2020 2020 2020 2020 2020  x800:.          
+0000deb0: 2020 2020 2020 2320 5554 462d 3820 6669        # UTF-8 fi
+0000dec0: 6c65 206e 616d 6573 2065 7874 656e 7369  le names extensi
+0000ded0: 6f6e 0a20 2020 2020 2020 2020 2020 2020  on.             
+0000dee0: 2020 2066 696c 656e 616d 6520 3d20 6669     filename = fi
+0000def0: 6c65 6e61 6d65 2e64 6563 6f64 6528 2775  lename.decode('u
+0000df00: 7466 2d38 2729 0a20 2020 2020 2020 2020  tf-8').         
+0000df10: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000df20: 2020 2020 2020 2020 2023 2048 6973 746f           # Histo
+0000df30: 7269 6361 6c20 5a49 5020 6669 6c65 6e61  rical ZIP filena
+0000df40: 6d65 2065 6e63 6f64 696e 670a 2020 2020  me encoding.    
+0000df50: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+0000df60: 6e61 6d65 203d 2066 696c 656e 616d 652e  name = filename.
+0000df70: 6465 636f 6465 2827 6370 3433 3727 290a  decode('cp437').
+0000df80: 2020 2020 2020 2020 2020 2020 2320 4372              # Cr
+0000df90: 6561 7465 205a 6970 496e 666f 2069 6e73  eate ZipInfo ins
+0000dfa0: 7461 6e63 6520 746f 2073 746f 7265 2066  tance to store f
+0000dfb0: 696c 6520 696e 666f 726d 6174 696f 6e0a  ile information.
+0000dfc0: 2020 2020 2020 2020 2020 2020 7820 3d20              x = 
+0000dfd0: 5a69 7049 6e66 6f28 6669 6c65 6e61 6d65  ZipInfo(filename
+0000dfe0: 290a 2020 2020 2020 2020 2020 2020 782e  ).            x.
+0000dff0: 6578 7472 6120 3d20 6670 2e72 6561 6428  extra = fp.read(
+0000e000: 6365 6e74 6469 725b 5f43 445f 4558 5452  centdir[_CD_EXTR
+0000e010: 415f 4649 454c 445f 4c45 4e47 5448 5d29  A_FIELD_LENGTH])
+0000e020: 0a20 2020 2020 2020 2020 2020 2078 2e63  .            x.c
+0000e030: 6f6d 6d65 6e74 203d 2066 702e 7265 6164  omment = fp.read
+0000e040: 2863 656e 7464 6972 5b5f 4344 5f43 4f4d  (centdir[_CD_COM
+0000e050: 4d45 4e54 5f4c 454e 4754 485d 290a 2020  MENT_LENGTH]).  
+0000e060: 2020 2020 2020 2020 2020 782e 6865 6164            x.head
+0000e070: 6572 5f6f 6666 7365 7420 3d20 6365 6e74  er_offset = cent
+0000e080: 6469 725b 5f43 445f 4c4f 4341 4c5f 4845  dir[_CD_LOCAL_HE
+0000e090: 4144 4552 5f4f 4646 5345 545d 0a20 2020  ADER_OFFSET].   
+0000e0a0: 2020 2020 2020 2020 2028 782e 6372 6561           (x.crea
+0000e0b0: 7465 5f76 6572 7369 6f6e 2c20 782e 6372  te_version, x.cr
+0000e0c0: 6561 7465 5f73 7973 7465 6d2c 2078 2e65  eate_system, x.e
+0000e0d0: 7874 7261 6374 5f76 6572 7369 6f6e 2c20  xtract_version, 
+0000e0e0: 782e 7265 7365 7276 6564 2c0a 2020 2020  x.reserved,.    
+0000e0f0: 2020 2020 2020 2020 2078 2e66 6c61 675f           x.flag_
+0000e100: 6269 7473 2c20 782e 636f 6d70 7265 7373  bits, x.compress
+0000e110: 5f74 7970 652c 2074 2c20 642c 0a20 2020  _type, t, d,.   
+0000e120: 2020 2020 2020 2020 2020 782e 4352 432c            x.CRC,
+0000e130: 2078 2e63 6f6d 7072 6573 735f 7369 7a65   x.compress_size
+0000e140: 2c20 782e 6669 6c65 5f73 697a 6529 203d  , x.file_size) =
+0000e150: 2063 656e 7464 6972 5b31 3a31 325d 0a20   centdir[1:12]. 
+0000e160: 2020 2020 2020 2020 2020 2069 6620 782e             if x.
+0000e170: 6578 7472 6163 745f 7665 7273 696f 6e20  extract_version 
+0000e180: 3e20 4d41 585f 4558 5452 4143 545f 5645  > MAX_EXTRACT_VE
+0000e190: 5253 494f 4e3a 0a20 2020 2020 2020 2020  RSION:.         
+0000e1a0: 2020 2020 2020 2072 6169 7365 204e 6f74         raise Not
+0000e1b0: 496d 706c 656d 656e 7465 6445 7272 6f72  ImplementedError
+0000e1c0: 2822 7a69 7020 6669 6c65 2076 6572 7369  ("zip file versi
+0000e1d0: 6f6e 2025 2e31 6622 2025 0a20 2020 2020  on %.1f" %.     
+0000e1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e200: 2020 2020 2028 782e 6578 7472 6163 745f       (x.extract_
+0000e210: 7665 7273 696f 6e20 2f20 3130 2929 0a20  version / 10)). 
+0000e220: 2020 2020 2020 2020 2020 2078 2e76 6f6c             x.vol
+0000e230: 756d 652c 2078 2e69 6e74 6572 6e61 6c5f  ume, x.internal_
+0000e240: 6174 7472 2c20 782e 6578 7465 726e 616c  attr, x.external
+0000e250: 5f61 7474 7220 3d20 6365 6e74 6469 725b  _attr = centdir[
+0000e260: 3135 3a31 385d 0a20 2020 2020 2020 2020  15:18].         
+0000e270: 2020 2023 2043 6f6e 7665 7274 2064 6174     # Convert dat
+0000e280: 652f 7469 6d65 2063 6f64 6520 746f 2028  e/time code to (
+0000e290: 7965 6172 2c20 6d6f 6e74 682c 2064 6179  year, month, day
+0000e2a0: 2c20 686f 7572 2c20 6d69 6e2c 2073 6563  , hour, min, sec
+0000e2b0: 290a 2020 2020 2020 2020 2020 2020 782e  ).            x.
+0000e2c0: 5f72 6177 5f74 696d 6520 3d20 740a 2020  _raw_time = t.  
+0000e2d0: 2020 2020 2020 2020 2020 782e 6461 7465            x.date
+0000e2e0: 5f74 696d 6520 3d20 2820 2864 3e3e 3929  _time = ( (d>>9)
+0000e2f0: 2b31 3938 302c 2028 643e 3e35 2926 3078  +1980, (d>>5)&0x
+0000e300: 462c 2064 2630 7831 462c 0a20 2020 2020  F, d&0x1F,.     
+0000e310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e320: 2020 2020 2020 2074 3e3e 3131 2c20 2874         t>>11, (t
+0000e330: 3e3e 3529 2630 7833 462c 2028 7426 3078  >>5)&0x3F, (t&0x
+0000e340: 3146 2920 2a20 3220 290a 0a20 2020 2020  1F) * 2 )..     
+0000e350: 2020 2020 2020 2078 2e5f 6465 636f 6465         x._decode
+0000e360: 4578 7472 6128 290a 2020 2020 2020 2020  Extra().        
+0000e370: 2020 2020 782e 6865 6164 6572 5f6f 6666      x.header_off
+0000e380: 7365 7420 3d20 782e 6865 6164 6572 5f6f  set = x.header_o
+0000e390: 6666 7365 7420 2b20 636f 6e63 6174 0a20  ffset + concat. 
+0000e3a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000e3b0: 6669 6c65 6c69 7374 2e61 7070 656e 6428  filelist.append(
+0000e3c0: 7829 0a20 2020 2020 2020 2020 2020 2073  x).            s
+0000e3d0: 656c 662e 4e61 6d65 546f 496e 666f 5b78  elf.NameToInfo[x
+0000e3e0: 2e66 696c 656e 616d 655d 203d 2078 0a0a  .filename] = x..
+0000e3f0: 2020 2020 2020 2020 2020 2020 2320 7570              # up
+0000e400: 6461 7465 2074 6f74 616c 2062 7974 6573  date total bytes
+0000e410: 2072 6561 6420 6672 6f6d 2063 656e 7472   read from centr
+0000e420: 616c 2064 6972 6563 746f 7279 0a20 2020  al directory.   
+0000e430: 2020 2020 2020 2020 2074 6f74 616c 203d           total =
+0000e440: 2028 746f 7461 6c20 2b20 7369 7a65 4365   (total + sizeCe
+0000e450: 6e74 7261 6c44 6972 202b 2063 656e 7464  ntralDir + centd
+0000e460: 6972 5b5f 4344 5f46 494c 454e 414d 455f  ir[_CD_FILENAME_
+0000e470: 4c45 4e47 5448 5d0a 2020 2020 2020 2020  LENGTH].        
+0000e480: 2020 2020 2020 2020 2020 2020 202b 2063               + c
+0000e490: 656e 7464 6972 5b5f 4344 5f45 5854 5241  entdir[_CD_EXTRA
+0000e4a0: 5f46 4945 4c44 5f4c 454e 4754 485d 0a20  _FIELD_LENGTH]. 
+0000e4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e4c0: 2020 2020 2b20 6365 6e74 6469 725b 5f43      + centdir[_C
+0000e4d0: 445f 434f 4d4d 454e 545f 4c45 4e47 5448  D_COMMENT_LENGTH
+0000e4e0: 5d29 0a0a 2020 2020 2020 2020 2020 2020  ])..            
+0000e4f0: 6966 2073 656c 662e 6465 6275 6720 3e20  if self.debug > 
+0000e500: 323a 0a20 2020 2020 2020 2020 2020 2020  2:.             
+0000e510: 2020 2070 7269 6e74 2822 746f 7461 6c22     print("total"
+0000e520: 2c20 746f 7461 6c29 0a0a 0a20 2020 2064  , total)...    d
+0000e530: 6566 206e 616d 656c 6973 7428 7365 6c66  ef namelist(self
+0000e540: 293a 0a20 2020 2020 2020 2022 2222 5265  ):.        """Re
+0000e550: 7475 726e 2061 206c 6973 7420 6f66 2066  turn a list of f
+0000e560: 696c 6520 6e61 6d65 7320 696e 2074 6865  ile names in the
+0000e570: 2061 7263 6869 7665 2e22 2222 0a20 2020   archive.""".   
+0000e580: 2020 2020 2072 6574 7572 6e20 5b64 6174       return [dat
+0000e590: 612e 6669 6c65 6e61 6d65 2066 6f72 2064  a.filename for d
+0000e5a0: 6174 6120 696e 2073 656c 662e 6669 6c65  ata in self.file
+0000e5b0: 6c69 7374 5d0a 0a20 2020 2064 6566 2069  list]..    def i
+0000e5c0: 6e66 6f6c 6973 7428 7365 6c66 293a 0a20  nfolist(self):. 
+0000e5d0: 2020 2020 2020 2022 2222 5265 7475 726e         """Return
+0000e5e0: 2061 206c 6973 7420 6f66 2063 6c61 7373   a list of class
+0000e5f0: 205a 6970 496e 666f 2069 6e73 7461 6e63   ZipInfo instanc
+0000e600: 6573 2066 6f72 2066 696c 6573 2069 6e20  es for files in 
+0000e610: 7468 650a 2020 2020 2020 2020 6172 6368  the.        arch
+0000e620: 6976 652e 2222 220a 2020 2020 2020 2020  ive.""".        
+0000e630: 7265 7475 726e 2073 656c 662e 6669 6c65  return self.file
+0000e640: 6c69 7374 0a0a 2020 2020 6465 6620 7072  list..    def pr
+0000e650: 696e 7464 6972 2873 656c 662c 2066 696c  intdir(self, fil
+0000e660: 653d 4e6f 6e65 293a 0a20 2020 2020 2020  e=None):.       
+0000e670: 2022 2222 5072 696e 7420 6120 7461 626c   """Print a tabl
+0000e680: 6520 6f66 2063 6f6e 7465 6e74 7320 666f  e of contents fo
+0000e690: 7220 7468 6520 7a69 7020 6669 6c65 2e22  r the zip file."
+0000e6a0: 2222 0a20 2020 2020 2020 2070 7269 6e74  "".        print
+0000e6b0: 2822 252d 3436 7320 2531 3973 2025 3132  ("%-46s %19s %12
+0000e6c0: 7322 2025 2028 2246 696c 6520 4e61 6d65  s" % ("File Name
+0000e6d0: 222c 2022 4d6f 6469 6669 6564 2020 2020  ", "Modified    
+0000e6e0: 222c 2022 5369 7a65 2229 2c0a 2020 2020  ", "Size"),.    
+0000e6f0: 2020 2020 2020 2020 2020 6669 6c65 3d66            file=f
+0000e700: 696c 6529 0a20 2020 2020 2020 2066 6f72  ile).        for
+0000e710: 207a 696e 666f 2069 6e20 7365 6c66 2e66   zinfo in self.f
+0000e720: 696c 656c 6973 743a 0a20 2020 2020 2020  ilelist:.       
+0000e730: 2020 2020 2064 6174 6520 3d20 2225 642d       date = "%d-
+0000e740: 2530 3264 2d25 3032 6420 2530 3264 3a25  %02d-%02d %02d:%
+0000e750: 3032 643a 2530 3264 2220 2520 7a69 6e66  02d:%02d" % zinf
+0000e760: 6f2e 6461 7465 5f74 696d 655b 3a36 5d0a  o.date_time[:6].
+0000e770: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+0000e780: 7428 2225 2d34 3673 2025 7320 2531 3264  t("%-46s %s %12d
+0000e790: 2220 2520 287a 696e 666f 2e66 696c 656e  " % (zinfo.filen
+0000e7a0: 616d 652c 2064 6174 652c 207a 696e 666f  ame, date, zinfo
+0000e7b0: 2e66 696c 655f 7369 7a65 292c 0a20 2020  .file_size),.   
+0000e7c0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000e7d0: 696c 653d 6669 6c65 290a 0a20 2020 2064  ile=file)..    d
+0000e7e0: 6566 2074 6573 747a 6970 2873 656c 6629  ef testzip(self)
+0000e7f0: 3a0a 2020 2020 2020 2020 2222 2252 6561  :.        """Rea
+0000e800: 6420 616c 6c20 7468 6520 6669 6c65 7320  d all the files 
+0000e810: 616e 6420 6368 6563 6b20 7468 6520 4352  and check the CR
+0000e820: 432e 2222 220a 2020 2020 2020 2020 6368  C.""".        ch
+0000e830: 756e 6b5f 7369 7a65 203d 2032 202a 2a20  unk_size = 2 ** 
+0000e840: 3230 0a20 2020 2020 2020 2066 6f72 207a  20.        for z
+0000e850: 696e 666f 2069 6e20 7365 6c66 2e66 696c  info in self.fil
+0000e860: 656c 6973 743a 0a20 2020 2020 2020 2020  elist:.         
+0000e870: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0000e880: 2020 2020 2020 2020 2320 5265 6164 2062          # Read b
+0000e890: 7920 6368 756e 6b73 2c20 746f 2061 766f  y chunks, to avo
+0000e8a0: 6964 2061 6e20 4f76 6572 666c 6f77 4572  id an OverflowEr
+0000e8b0: 726f 7220 6f72 2061 0a20 2020 2020 2020  ror or a.       
+0000e8c0: 2020 2020 2020 2020 2023 204d 656d 6f72           # Memor
+0000e8d0: 7945 7272 6f72 2077 6974 6820 7665 7279  yError with very
+0000e8e0: 206c 6172 6765 2065 6d62 6564 6465 6420   large embedded 
+0000e8f0: 6669 6c65 732e 0a20 2020 2020 2020 2020  files..         
+0000e900: 2020 2020 2020 2077 6974 6820 7365 6c66         with self
+0000e910: 2e6f 7065 6e28 7a69 6e66 6f2e 6669 6c65  .open(zinfo.file
+0000e920: 6e61 6d65 2c20 2272 2229 2061 7320 663a  name, "r") as f:
+0000e930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e940: 2020 2020 2077 6869 6c65 2066 2e72 6561       while f.rea
+0000e950: 6428 6368 756e 6b5f 7369 7a65 293a 2020  d(chunk_size):  
+0000e960: 2020 2023 2043 6865 636b 2043 5243 2d33     # Check CRC-3
+0000e970: 320a 2020 2020 2020 2020 2020 2020 2020  2.              
+0000e980: 2020 2020 2020 2020 2020 7061 7373 0a20            pass. 
+0000e990: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+0000e9a0: 7420 4261 645a 6970 4669 6c65 3a0a 2020  t BadZipFile:.  
+0000e9b0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000e9c0: 7475 726e 207a 696e 666f 2e66 696c 656e  turn zinfo.filen
+0000e9d0: 616d 650a 0a20 2020 2064 6566 2067 6574  ame..    def get
+0000e9e0: 696e 666f 2873 656c 662c 206e 616d 6529  info(self, name)
+0000e9f0: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
+0000ea00: 7572 6e20 7468 6520 696e 7374 616e 6365  urn the instance
+0000ea10: 206f 6620 5a69 7049 6e66 6f20 6769 7665   of ZipInfo give
+0000ea20: 6e20 276e 616d 6527 2e22 2222 0a20 2020  n 'name'.""".   
+0000ea30: 2020 2020 2069 6e66 6f20 3d20 7365 6c66       info = self
+0000ea40: 2e4e 616d 6554 6f49 6e66 6f2e 6765 7428  .NameToInfo.get(
+0000ea50: 6e61 6d65 290a 2020 2020 2020 2020 6966  name).        if
+0000ea60: 2069 6e66 6f20 6973 204e 6f6e 653a 0a20   info is None:. 
+0000ea70: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0000ea80: 204b 6579 4572 726f 7228 0a20 2020 2020   KeyError(.     
+0000ea90: 2020 2020 2020 2020 2020 2027 5468 6572             'Ther
+0000eaa0: 6520 6973 206e 6f20 6974 656d 206e 616d  e is no item nam
+0000eab0: 6564 2025 7220 696e 2074 6865 2061 7263  ed %r in the arc
+0000eac0: 6869 7665 2720 2520 6e61 6d65 290a 0a20  hive' % name).. 
+0000ead0: 2020 2020 2020 2072 6574 7572 6e20 696e         return in
+0000eae0: 666f 0a0a 2020 2020 6465 6620 7365 7470  fo..    def setp
+0000eaf0: 6173 7377 6f72 6428 7365 6c66 2c20 7077  assword(self, pw
+0000eb00: 6429 3a0a 2020 2020 2020 2020 2222 2253  d):.        """S
+0000eb10: 6574 2064 6566 6175 6c74 2070 6173 7377  et default passw
+0000eb20: 6f72 6420 666f 7220 656e 6372 7970 7465  ord for encrypte
+0000eb30: 6420 6669 6c65 732e 2222 220a 2020 2020  d files.""".    
+0000eb40: 2020 2020 6966 2070 7764 2061 6e64 206e      if pwd and n
+0000eb50: 6f74 2069 7369 6e73 7461 6e63 6528 7077  ot isinstance(pw
+0000eb60: 642c 2062 7974 6573 293a 0a20 2020 2020  d, bytes):.     
+0000eb70: 2020 2020 2020 2072 6169 7365 2054 7970         raise Typ
+0000eb80: 6545 7272 6f72 2822 7077 643a 2065 7870  eError("pwd: exp
+0000eb90: 6563 7465 6420 6279 7465 732c 2067 6f74  ected bytes, got
+0000eba0: 2025 7322 2025 2074 7970 6528 7077 6429   %s" % type(pwd)
+0000ebb0: 2e5f 5f6e 616d 655f 5f29 0a20 2020 2020  .__name__).     
+0000ebc0: 2020 2069 6620 7077 643a 0a20 2020 2020     if pwd:.     
+0000ebd0: 2020 2020 2020 2073 656c 662e 7077 6420         self.pwd 
+0000ebe0: 3d20 7077 640a 2020 2020 2020 2020 656c  = pwd.        el
+0000ebf0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000ec00: 7365 6c66 2e70 7764 203d 204e 6f6e 650a  self.pwd = None.
+0000ec10: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
+0000ec20: 2020 2064 6566 2063 6f6d 6d65 6e74 2873     def comment(s
+0000ec30: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
+0000ec40: 2254 6865 2063 6f6d 6d65 6e74 2074 6578  "The comment tex
+0000ec50: 7420 6173 736f 6369 6174 6564 2077 6974  t associated wit
+0000ec60: 6820 7468 6520 5a49 5020 6669 6c65 2e22  h the ZIP file."
+0000ec70: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
+0000ec80: 6e20 7365 6c66 2e5f 636f 6d6d 656e 740a  n self._comment.
+0000ec90: 0a20 2020 2040 636f 6d6d 656e 742e 7365  .    @comment.se
+0000eca0: 7474 6572 0a20 2020 2064 6566 2063 6f6d  tter.    def com
+0000ecb0: 6d65 6e74 2873 656c 662c 2063 6f6d 6d65  ment(self, comme
+0000ecc0: 6e74 293a 0a20 2020 2020 2020 2069 6620  nt):.        if 
+0000ecd0: 6e6f 7420 6973 696e 7374 616e 6365 2863  not isinstance(c
+0000ece0: 6f6d 6d65 6e74 2c20 6279 7465 7329 3a0a  omment, bytes):.
+0000ecf0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0000ed00: 6520 5479 7065 4572 726f 7228 2263 6f6d  e TypeError("com
+0000ed10: 6d65 6e74 3a20 6578 7065 6374 6564 2062  ment: expected b
+0000ed20: 7974 6573 2c20 676f 7420 2573 2220 2520  ytes, got %s" % 
+0000ed30: 7479 7065 2863 6f6d 6d65 6e74 292e 5f5f  type(comment).__
+0000ed40: 6e61 6d65 5f5f 290a 2020 2020 2020 2020  name__).        
+0000ed50: 2320 6368 6563 6b20 666f 7220 7661 6c69  # check for vali
+0000ed60: 6420 636f 6d6d 656e 7420 6c65 6e67 7468  d comment length
+0000ed70: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
+0000ed80: 636f 6d6d 656e 7429 203e 205a 4950 5f4d  comment) > ZIP_M
+0000ed90: 4158 5f43 4f4d 4d45 4e54 3a0a 2020 2020  AX_COMMENT:.    
+0000eda0: 2020 2020 2020 2020 696d 706f 7274 2077          import w
+0000edb0: 6172 6e69 6e67 730a 2020 2020 2020 2020  arnings.        
+0000edc0: 2020 2020 7761 726e 696e 6773 2e77 6172      warnings.war
+0000edd0: 6e28 2741 7263 6869 7665 2063 6f6d 6d65  n('Archive comme
+0000ede0: 6e74 2069 7320 746f 6f20 6c6f 6e67 3b20  nt is too long; 
+0000edf0: 7472 756e 6361 7469 6e67 2074 6f20 2564  truncating to %d
+0000ee00: 2062 7974 6573 270a 2020 2020 2020 2020   bytes'.        
+0000ee10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ee20: 2020 2520 5a49 505f 4d41 585f 434f 4d4d    % ZIP_MAX_COMM
+0000ee30: 454e 542c 2073 7461 636b 6c65 7665 6c3d  ENT, stacklevel=
+0000ee40: 3229 0a20 2020 2020 2020 2020 2020 2063  2).            c
+0000ee50: 6f6d 6d65 6e74 203d 2063 6f6d 6d65 6e74  omment = comment
+0000ee60: 5b3a 5a49 505f 4d41 585f 434f 4d4d 454e  [:ZIP_MAX_COMMEN
+0000ee70: 545d 0a20 2020 2020 2020 2073 656c 662e  T].        self.
+0000ee80: 5f63 6f6d 6d65 6e74 203d 2063 6f6d 6d65  _comment = comme
+0000ee90: 6e74 0a20 2020 2020 2020 2073 656c 662e  nt.        self.
+0000eea0: 5f64 6964 4d6f 6469 6679 203d 2054 7275  _didModify = Tru
+0000eeb0: 650a 0a20 2020 2064 6566 2072 6561 6428  e..    def read(
+0000eec0: 7365 6c66 2c20 6e61 6d65 2c20 7077 643d  self, name, pwd=
+0000eed0: 4e6f 6e65 293a 0a20 2020 2020 2020 2022  None):.        "
+0000eee0: 2222 5265 7475 726e 2066 696c 6520 6279  ""Return file by
+0000eef0: 7465 7320 666f 7220 6e61 6d65 2e22 2222  tes for name."""
+0000ef00: 0a20 2020 2020 2020 2077 6974 6820 7365  .        with se
+0000ef10: 6c66 2e6f 7065 6e28 6e61 6d65 2c20 2272  lf.open(name, "r
+0000ef20: 222c 2070 7764 2920 6173 2066 703a 0a20  ", pwd) as fp:. 
+0000ef30: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000ef40: 6e20 6670 2e72 6561 6428 290a 0a20 2020  n fp.read()..   
+0000ef50: 2064 6566 206f 7065 6e28 7365 6c66 2c20   def open(self, 
+0000ef60: 6e61 6d65 2c20 6d6f 6465 3d22 7222 2c20  name, mode="r", 
+0000ef70: 7077 643d 4e6f 6e65 2c20 666f 7263 655f  pwd=None, force_
+0000ef80: 7a69 7036 343d 4661 6c73 6529 3a0a 2020  zip64=False):.  
+0000ef90: 2020 2020 2020 2222 2252 6574 7572 6e20        """Return 
+0000efa0: 6669 6c65 2d6c 696b 6520 6f62 6a65 6374  file-like object
+0000efb0: 2066 6f72 2027 6e61 6d65 272e 0a0a 2020   for 'name'...  
+0000efc0: 2020 2020 2020 6e61 6d65 2069 7320 6120        name is a 
+0000efd0: 7374 7269 6e67 2066 6f72 2074 6865 2066  string for the f
+0000efe0: 696c 6520 6e61 6d65 2077 6974 6869 6e20  ile name within 
+0000eff0: 7468 6520 5a49 5020 6669 6c65 2c20 6f72  the ZIP file, or
+0000f000: 2061 205a 6970 496e 666f 0a20 2020 2020   a ZipInfo.     
+0000f010: 2020 206f 626a 6563 742e 0a0a 2020 2020     object...    
+0000f020: 2020 2020 6d6f 6465 2073 686f 756c 6420      mode should 
+0000f030: 6265 2027 7227 2074 6f20 7265 6164 2061  be 'r' to read a
+0000f040: 2066 696c 6520 616c 7265 6164 7920 696e   file already in
+0000f050: 2074 6865 205a 4950 2066 696c 652c 206f   the ZIP file, o
+0000f060: 7220 2777 2720 746f 0a20 2020 2020 2020  r 'w' to.       
+0000f070: 2077 7269 7465 2074 6f20 6120 6669 6c65   write to a file
+0000f080: 206e 6577 6c79 2061 6464 6564 2074 6f20   newly added to 
+0000f090: 7468 6520 6172 6368 6976 652e 0a0a 2020  the archive...  
+0000f0a0: 2020 2020 2020 7077 6420 6973 2074 6865        pwd is the
+0000f0b0: 2070 6173 7377 6f72 6420 746f 2064 6563   password to dec
+0000f0c0: 7279 7074 2066 696c 6573 2028 6f6e 6c79  rypt files (only
+0000f0d0: 2075 7365 6420 666f 7220 7265 6164 696e   used for readin
+0000f0e0: 6729 2e0a 0a20 2020 2020 2020 2057 6865  g)...        Whe
+0000f0f0: 6e20 7772 6974 696e 672c 2069 6620 7468  n writing, if th
+0000f100: 6520 6669 6c65 2073 697a 6520 6973 206e  e file size is n
+0000f110: 6f74 206b 6e6f 776e 2069 6e20 6164 7661  ot known in adva
+0000f120: 6e63 6520 6275 7420 6d61 7920 6578 6365  nce but may exce
+0000f130: 6564 0a20 2020 2020 2020 2032 2047 6942  ed.        2 GiB
+0000f140: 2c20 7061 7373 2066 6f72 6365 5f7a 6970  , pass force_zip
+0000f150: 3634 2074 6f20 7573 6520 7468 6520 5a49  64 to use the ZI
+0000f160: 5036 3420 666f 726d 6174 2c20 7768 6963  P64 format, whic
+0000f170: 6820 6361 6e20 6861 6e64 6c65 206c 6172  h can handle lar
+0000f180: 6765 0a20 2020 2020 2020 2066 696c 6573  ge.        files
+0000f190: 2e20 2049 6620 7468 6520 7369 7a65 2069  .  If the size i
+0000f1a0: 7320 6b6e 6f77 6e20 696e 2061 6476 616e  s known in advan
+0000f1b0: 6365 2c20 6974 2069 7320 6265 7374 2074  ce, it is best t
+0000f1c0: 6f20 7061 7373 2061 205a 6970 496e 666f  o pass a ZipInfo
+0000f1d0: 0a20 2020 2020 2020 2069 6e73 7461 6e63  .        instanc
+0000f1e0: 6520 666f 7220 6e61 6d65 2c20 7769 7468  e for name, with
+0000f1f0: 207a 696e 666f 2e66 696c 655f 7369 7a65   zinfo.file_size
+0000f200: 2073 6574 2e0a 2020 2020 2020 2020 2222   set..        ""
+0000f210: 220a 2020 2020 2020 2020 6966 206d 6f64  ".        if mod
+0000f220: 6520 6e6f 7420 696e 207b 2272 222c 2022  e not in {"r", "
+0000f230: 7722 7d3a 0a20 2020 2020 2020 2020 2020  w"}:.           
+0000f240: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+0000f250: 7228 276f 7065 6e28 2920 7265 7175 6972  r('open() requir
+0000f260: 6573 206d 6f64 6520 2272 2220 6f72 2022  es mode "r" or "
+0000f270: 7722 2729 0a20 2020 2020 2020 2069 6620  w"').        if 
+0000f280: 7077 6420 616e 6420 6e6f 7420 6973 696e  pwd and not isin
+0000f290: 7374 616e 6365 2870 7764 2c20 6279 7465  stance(pwd, byte
+0000f2a0: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
+0000f2b0: 7261 6973 6520 5479 7065 4572 726f 7228  raise TypeError(
+0000f2c0: 2270 7764 3a20 6578 7065 6374 6564 2062  "pwd: expected b
+0000f2d0: 7974 6573 2c20 676f 7420 2573 2220 2520  ytes, got %s" % 
+0000f2e0: 7479 7065 2870 7764 292e 5f5f 6e61 6d65  type(pwd).__name
+0000f2f0: 5f5f 290a 2020 2020 2020 2020 6966 2070  __).        if p
+0000f300: 7764 2061 6e64 2028 6d6f 6465 203d 3d20  wd and (mode == 
+0000f310: 2277 2229 3a0a 2020 2020 2020 2020 2020  "w"):.          
+0000f320: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+0000f330: 6f72 2822 7077 6420 6973 206f 6e6c 7920  or("pwd is only 
+0000f340: 7375 7070 6f72 7465 6420 666f 7220 7265  supported for re
+0000f350: 6164 696e 6720 6669 6c65 7322 290a 2020  ading files").  
+0000f360: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
+0000f370: 662e 6670 3a0a 2020 2020 2020 2020 2020  f.fp:.          
+0000f380: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+0000f390: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
+0000f3a0: 2020 2020 2241 7474 656d 7074 2074 6f20      "Attempt to 
+0000f3b0: 7573 6520 5a49 5020 6172 6368 6976 6520  use ZIP archive 
+0000f3c0: 7468 6174 2077 6173 2061 6c72 6561 6479  that was already
+0000f3d0: 2063 6c6f 7365 6422 290a 0a20 2020 2020   closed")..     
+0000f3e0: 2020 2023 204d 616b 6520 7375 7265 2077     # Make sure w
+0000f3f0: 6520 6861 7665 2061 6e20 696e 666f 206f  e have an info o
+0000f400: 626a 6563 740a 2020 2020 2020 2020 6966  bject.        if
+0000f410: 2069 7369 6e73 7461 6e63 6528 6e61 6d65   isinstance(name
+0000f420: 2c20 5a69 7049 6e66 6f29 3a0a 2020 2020  , ZipInfo):.    
+0000f430: 2020 2020 2020 2020 2320 276e 616d 6527          # 'name'
+0000f440: 2069 7320 616c 7265 6164 7920 616e 2069   is already an i
+0000f450: 6e66 6f20 6f62 6a65 6374 0a20 2020 2020  nfo object.     
+0000f460: 2020 2020 2020 207a 696e 666f 203d 206e         zinfo = n
+0000f470: 616d 650a 2020 2020 2020 2020 656c 6966  ame.        elif
+0000f480: 206d 6f64 6520 3d3d 2027 7727 3a0a 2020   mode == 'w':.  
+0000f490: 2020 2020 2020 2020 2020 7a69 6e66 6f20            zinfo 
+0000f4a0: 3d20 5a69 7049 6e66 6f28 6e61 6d65 290a  = ZipInfo(name).
+0000f4b0: 2020 2020 2020 2020 2020 2020 7a69 6e66              zinf
+0000f4c0: 6f2e 636f 6d70 7265 7373 5f74 7970 6520  o.compress_type 
+0000f4d0: 3d20 7365 6c66 2e63 6f6d 7072 6573 7369  = self.compressi
+0000f4e0: 6f6e 0a20 2020 2020 2020 2020 2020 207a  on.            z
+0000f4f0: 696e 666f 2e5f 636f 6d70 7265 7373 6c65  info._compressle
+0000f500: 7665 6c20 3d20 7365 6c66 2e63 6f6d 7072  vel = self.compr
+0000f510: 6573 736c 6576 656c 0a20 2020 2020 2020  esslevel.       
+0000f520: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0000f530: 2020 2023 2047 6574 2069 6e66 6f20 6f62     # Get info ob
+0000f540: 6a65 6374 2066 6f72 206e 616d 650a 2020  ject for name.  
+0000f550: 2020 2020 2020 2020 2020 7a69 6e66 6f20            zinfo 
+0000f560: 3d20 7365 6c66 2e67 6574 696e 666f 286e  = self.getinfo(n
+0000f570: 616d 6529 0a0a 2020 2020 2020 2020 6966  ame)..        if
+0000f580: 206d 6f64 6520 3d3d 2027 7727 3a0a 2020   mode == 'w':.  
+0000f590: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000f5a0: 2073 656c 662e 5f6f 7065 6e5f 746f 5f77   self._open_to_w
+0000f5b0: 7269 7465 287a 696e 666f 2c20 666f 7263  rite(zinfo, forc
+0000f5c0: 655f 7a69 7036 343d 666f 7263 655f 7a69  e_zip64=force_zi
+0000f5d0: 7036 3429 0a0a 2020 2020 2020 2020 6966  p64)..        if
+0000f5e0: 2073 656c 662e 5f77 7269 7469 6e67 3a0a   self._writing:.
+0000f5f0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0000f600: 6520 5661 6c75 6545 7272 6f72 2822 4361  e ValueError("Ca
+0000f610: 6e27 7420 7265 6164 2066 726f 6d20 7468  n't read from th
+0000f620: 6520 5a49 5020 6669 6c65 2077 6869 6c65  e ZIP file while
+0000f630: 2074 6865 7265 2022 0a20 2020 2020 2020   there ".       
+0000f640: 2020 2020 2020 2020 2020 2020 2022 6973               "is
+0000f650: 2061 6e20 6f70 656e 2077 7269 7469 6e67   an open writing
+0000f660: 2068 616e 646c 6520 6f6e 2069 742e 2022   handle on it. "
+0000f670: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f680: 2020 2020 2022 436c 6f73 6520 7468 6520       "Close the 
+0000f690: 7772 6974 696e 6720 6861 6e64 6c65 2062  writing handle b
+0000f6a0: 6566 6f72 6520 7472 7969 6e67 2074 6f20  efore trying to 
+0000f6b0: 7265 6164 2e22 290a 0a20 2020 2020 2020  read.")..       
+0000f6c0: 2023 204f 7065 6e20 666f 7220 7265 6164   # Open for read
+0000f6d0: 696e 673a 0a20 2020 2020 2020 2073 656c  ing:.        sel
+0000f6e0: 662e 5f66 696c 6552 6566 436e 7420 2b3d  f._fileRefCnt +=
+0000f6f0: 2031 0a20 2020 2020 2020 207a 6566 5f66   1.        zef_f
+0000f700: 696c 6520 3d20 5f53 6861 7265 6446 696c  ile = _SharedFil
+0000f710: 6528 7365 6c66 2e66 702c 207a 696e 666f  e(self.fp, zinfo
+0000f720: 2e68 6561 6465 725f 6f66 6673 6574 2c0a  .header_offset,.
+0000f730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f740: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000f750: 656c 662e 5f66 7063 6c6f 7365 2c20 7365  elf._fpclose, se
+0000f760: 6c66 2e5f 6c6f 636b 2c20 6c61 6d62 6461  lf._lock, lambda
+0000f770: 3a20 7365 6c66 2e5f 7772 6974 696e 6729  : self._writing)
+0000f780: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+0000f790: 2020 2020 2020 2020 2020 2320 536b 6970            # Skip
+0000f7a0: 2074 6865 2066 696c 6520 6865 6164 6572   the file header
+0000f7b0: 3a0a 2020 2020 2020 2020 2020 2020 6668  :.            fh
+0000f7c0: 6561 6465 7220 3d20 7a65 665f 6669 6c65  eader = zef_file
+0000f7d0: 2e72 6561 6428 7369 7a65 4669 6c65 4865  .read(sizeFileHe
+0000f7e0: 6164 6572 290a 2020 2020 2020 2020 2020  ader).          
+0000f7f0: 2020 6966 206c 656e 2866 6865 6164 6572    if len(fheader
+0000f800: 2920 213d 2073 697a 6546 696c 6548 6561  ) != sizeFileHea
+0000f810: 6465 723a 0a20 2020 2020 2020 2020 2020  der:.           
+0000f820: 2020 2020 2072 6169 7365 2042 6164 5a69       raise BadZi
+0000f830: 7046 696c 6528 2254 7275 6e63 6174 6564  pFile("Truncated
+0000f840: 2066 696c 6520 6865 6164 6572 2229 0a20   file header"). 
+0000f850: 2020 2020 2020 2020 2020 2066 6865 6164             fhead
+0000f860: 6572 203d 2073 7472 7563 742e 756e 7061  er = struct.unpa
+0000f870: 636b 2873 7472 7563 7446 696c 6548 6561  ck(structFileHea
+0000f880: 6465 722c 2066 6865 6164 6572 290a 2020  der, fheader).  
+0000f890: 2020 2020 2020 2020 2020 6966 2066 6865            if fhe
+0000f8a0: 6164 6572 5b5f 4648 5f53 4947 4e41 5455  ader[_FH_SIGNATU
+0000f8b0: 5245 5d20 213d 2073 7472 696e 6746 696c  RE] != stringFil
+0000f8c0: 6548 6561 6465 723a 0a20 2020 2020 2020  eHeader:.       
+0000f8d0: 2020 2020 2020 2020 2072 6169 7365 2042           raise B
+0000f8e0: 6164 5a69 7046 696c 6528 2242 6164 206d  adZipFile("Bad m
+0000f8f0: 6167 6963 206e 756d 6265 7220 666f 7220  agic number for 
+0000f900: 6669 6c65 2068 6561 6465 7222 290a 0a20  file header").. 
+0000f910: 2020 2020 2020 2020 2020 2066 6e61 6d65             fname
+0000f920: 203d 207a 6566 5f66 696c 652e 7265 6164   = zef_file.read
+0000f930: 2866 6865 6164 6572 5b5f 4648 5f46 494c  (fheader[_FH_FIL
+0000f940: 454e 414d 455f 4c45 4e47 5448 5d29 0a20  ENAME_LENGTH]). 
+0000f950: 2020 2020 2020 2020 2020 2069 6620 6668             if fh
+0000f960: 6561 6465 725b 5f46 485f 4558 5452 415f  eader[_FH_EXTRA_
+0000f970: 4649 454c 445f 4c45 4e47 5448 5d3a 0a20  FIELD_LENGTH]:. 
+0000f980: 2020 2020 2020 2020 2020 2020 2020 207a                 z
+0000f990: 6566 5f66 696c 652e 7265 6164 2866 6865  ef_file.read(fhe
+0000f9a0: 6164 6572 5b5f 4648 5f45 5854 5241 5f46  ader[_FH_EXTRA_F
+0000f9b0: 4945 4c44 5f4c 454e 4754 485d 290a 0a20  IELD_LENGTH]).. 
+0000f9c0: 2020 2020 2020 2020 2020 2069 6620 7a69             if zi
+0000f9d0: 6e66 6f2e 666c 6167 5f62 6974 7320 2620  nfo.flag_bits & 
+0000f9e0: 3078 3230 3a0a 2020 2020 2020 2020 2020  0x20:.          
+0000f9f0: 2020 2020 2020 2320 5a69 7020 322e 373a        # Zip 2.7:
+0000fa00: 2063 6f6d 7072 6573 7365 6420 7061 7463   compressed patc
+0000fa10: 6865 6420 6461 7461 0a20 2020 2020 2020  hed data.       
+0000fa20: 2020 2020 2020 2020 2072 6169 7365 204e           raise N
+0000fa30: 6f74 496d 706c 656d 656e 7465 6445 7272  otImplementedErr
+0000fa40: 6f72 2822 636f 6d70 7265 7373 6564 2070  or("compressed p
+0000fa50: 6174 6368 6564 2064 6174 6120 2866 6c61  atched data (fla
+0000fa60: 6720 6269 7420 3529 2229 0a0a 2020 2020  g bit 5)")..    
+0000fa70: 2020 2020 2020 2020 6966 207a 696e 666f          if zinfo
+0000fa80: 2e66 6c61 675f 6269 7473 2026 2030 7834  .flag_bits & 0x4
+0000fa90: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+0000faa0: 2020 2023 2073 7472 6f6e 6720 656e 6372     # strong encr
+0000fab0: 7970 7469 6f6e 0a20 2020 2020 2020 2020  yption.         
+0000fac0: 2020 2020 2020 2072 6169 7365 204e 6f74         raise Not
+0000fad0: 496d 706c 656d 656e 7465 6445 7272 6f72  ImplementedError
+0000fae0: 2822 7374 726f 6e67 2065 6e63 7279 7074  ("strong encrypt
+0000faf0: 696f 6e20 2866 6c61 6720 6269 7420 3629  ion (flag bit 6)
+0000fb00: 2229 0a0a 2020 2020 2020 2020 2020 2020  ")..            
+0000fb10: 6966 2066 6865 6164 6572 5b5f 4648 5f47  if fheader[_FH_G
+0000fb20: 454e 4552 414c 5f50 5552 504f 5345 5f46  ENERAL_PURPOSE_F
+0000fb30: 4c41 475f 4249 5453 5d20 2620 3078 3830  LAG_BITS] & 0x80
+0000fb40: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+0000fb50: 2020 2023 2055 5446 2d38 2066 696c 656e     # UTF-8 filen
+0000fb60: 616d 650a 2020 2020 2020 2020 2020 2020  ame.            
+0000fb70: 2020 2020 666e 616d 655f 7374 7220 3d20      fname_str = 
+0000fb80: 666e 616d 652e 6465 636f 6465 2822 7574  fname.decode("ut
+0000fb90: 662d 3822 290a 2020 2020 2020 2020 2020  f-8").          
+0000fba0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000fbb0: 2020 2020 2020 2020 666e 616d 655f 7374          fname_st
+0000fbc0: 7220 3d20 666e 616d 652e 6465 636f 6465  r = fname.decode
+0000fbd0: 2822 6370 3433 3722 290a 0a20 2020 2020  ("cp437")..     
+0000fbe0: 2020 2020 2020 2069 6620 666e 616d 655f         if fname_
+0000fbf0: 7374 7220 213d 207a 696e 666f 2e6f 7269  str != zinfo.ori
+0000fc00: 675f 6669 6c65 6e61 6d65 3a0a 2020 2020  g_filename:.    
+0000fc10: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0000fc20: 6520 4261 645a 6970 4669 6c65 280a 2020  e BadZipFile(.  
+0000fc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fc40: 2020 2746 696c 6520 6e61 6d65 2069 6e20    'File name in 
+0000fc50: 6469 7265 6374 6f72 7920 2572 2061 6e64  directory %r and
+0000fc60: 2068 6561 6465 7220 2572 2064 6966 6665   header %r diffe
+0000fc70: 722e 270a 2020 2020 2020 2020 2020 2020  r.'.            
+0000fc80: 2020 2020 2020 2020 2520 287a 696e 666f          % (zinfo
+0000fc90: 2e6f 7269 675f 6669 6c65 6e61 6d65 2c20  .orig_filename, 
+0000fca0: 666e 616d 6529 290a 0a20 2020 2020 2020  fname))..       
+0000fcb0: 2020 2020 2023 2063 6865 636b 2066 6f72       # check for
+0000fcc0: 2065 6e63 7279 7074 6564 2066 6c61 6720   encrypted flag 
+0000fcd0: 2620 6861 6e64 6c65 2070 6173 7377 6f72  & handle passwor
+0000fce0: 640a 2020 2020 2020 2020 2020 2020 6973  d.            is
+0000fcf0: 5f65 6e63 7279 7074 6564 203d 207a 696e  _encrypted = zin
+0000fd00: 666f 2e66 6c61 675f 6269 7473 2026 2030  fo.flag_bits & 0
+0000fd10: 7831 0a20 2020 2020 2020 2020 2020 2069  x1.            i
+0000fd20: 6620 6973 5f65 6e63 7279 7074 6564 3a0a  f is_encrypted:.
+0000fd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fd40: 6966 206e 6f74 2070 7764 3a0a 2020 2020  if not pwd:.    
+0000fd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fd60: 7077 6420 3d20 7365 6c66 2e70 7764 0a20  pwd = self.pwd. 
+0000fd70: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000fd80: 6620 6e6f 7420 7077 643a 0a20 2020 2020  f not pwd:.     
+0000fd90: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000fda0: 6169 7365 2052 756e 7469 6d65 4572 726f  aise RuntimeErro
+0000fdb0: 7228 2246 696c 6520 2572 2069 7320 656e  r("File %r is en
+0000fdc0: 6372 7970 7465 642c 2070 6173 7377 6f72  crypted, passwor
+0000fdd0: 6420 220a 2020 2020 2020 2020 2020 2020  d ".            
+0000fde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fdf0: 2020 2020 2020 2020 2020 2022 7265 7175             "requ
+0000fe00: 6972 6564 2066 6f72 2065 7874 7261 6374  ired for extract
+0000fe10: 696f 6e22 2025 206e 616d 6529 0a20 2020  ion" % name).   
+0000fe20: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0000fe30: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0000fe40: 7764 203d 204e 6f6e 650a 0a20 2020 2020  wd = None..     
+0000fe50: 2020 2020 2020 2072 6574 7572 6e20 5a69         return Zi
+0000fe60: 7045 7874 4669 6c65 287a 6566 5f66 696c  pExtFile(zef_fil
+0000fe70: 652c 206d 6f64 652c 207a 696e 666f 2c20  e, mode, zinfo, 
+0000fe80: 7077 642c 2054 7275 6529 0a20 2020 2020  pwd, True).     
+0000fe90: 2020 2065 7863 6570 743a 0a20 2020 2020     except:.     
+0000fea0: 2020 2020 2020 207a 6566 5f66 696c 652e         zef_file.
+0000feb0: 636c 6f73 6528 290a 2020 2020 2020 2020  close().        
+0000fec0: 2020 2020 7261 6973 650a 0a20 2020 2064      raise..    d
+0000fed0: 6566 205f 6f70 656e 5f74 6f5f 7772 6974  ef _open_to_writ
+0000fee0: 6528 7365 6c66 2c20 7a69 6e66 6f2c 2066  e(self, zinfo, f
+0000fef0: 6f72 6365 5f7a 6970 3634 3d46 616c 7365  orce_zip64=False
+0000ff00: 293a 0a20 2020 2020 2020 2069 6620 666f  ):.        if fo
+0000ff10: 7263 655f 7a69 7036 3420 616e 6420 6e6f  rce_zip64 and no
+0000ff20: 7420 7365 6c66 2e5f 616c 6c6f 775a 6970  t self._allowZip
+0000ff30: 3634 3a0a 2020 2020 2020 2020 2020 2020  64:.            
+0000ff40: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+0000ff50: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000ff60: 2020 2266 6f72 6365 5f7a 6970 3634 2069    "force_zip64 i
+0000ff70: 7320 5472 7565 2c20 6275 7420 616c 6c6f  s True, but allo
+0000ff80: 775a 6970 3634 2077 6173 2046 616c 7365  wZip64 was False
+0000ff90: 2077 6865 6e20 6f70 656e 696e 6720 220a   when opening ".
+0000ffa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ffb0: 2274 6865 205a 4950 2066 696c 652e 220a  "the ZIP file.".
+0000ffc0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0000ffd0: 2020 2020 2020 6966 2073 656c 662e 5f77        if self._w
+0000ffe0: 7269 7469 6e67 3a0a 2020 2020 2020 2020  riting:.        
+0000fff0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00010000: 7272 6f72 2822 4361 6e27 7420 7772 6974  rror("Can't writ
+00010010: 6520 746f 2074 6865 205a 4950 2066 696c  e to the ZIP fil
+00010020: 6520 7768 696c 6520 7468 6572 6520 6973  e while there is
+00010030: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+00010040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010050: 2261 6e6f 7468 6572 2077 7269 7465 2068  "another write h
+00010060: 616e 646c 6520 6f70 656e 206f 6e20 6974  andle open on it
+00010070: 2e20 220a 2020 2020 2020 2020 2020 2020  . ".            
+00010080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010090: 2022 436c 6f73 6520 7468 6520 6669 7273   "Close the firs
+000100a0: 7420 6861 6e64 6c65 2062 6566 6f72 6520  t handle before 
+000100b0: 6f70 656e 696e 6720 616e 6f74 6865 722e  opening another.
+000100c0: 2229 0a0a 2020 2020 2020 2020 2320 5369  ")..        # Si
+000100d0: 7a65 2061 6e64 2043 5243 2061 7265 206f  ze and CRC are o
+000100e0: 7665 7277 7269 7474 656e 2077 6974 6820  verwritten with 
+000100f0: 636f 7272 6563 7420 6461 7461 2061 6674  correct data aft
+00010100: 6572 2070 726f 6365 7373 696e 6720 7468  er processing th
+00010110: 6520 6669 6c65 0a20 2020 2020 2020 207a  e file.        z
+00010120: 696e 666f 2e63 6f6d 7072 6573 735f 7369  info.compress_si
+00010130: 7a65 203d 2030 0a20 2020 2020 2020 207a  ze = 0.        z
+00010140: 696e 666f 2e43 5243 203d 2030 0a0a 2020  info.CRC = 0..  
+00010150: 2020 2020 2020 7a69 6e66 6f2e 666c 6167        zinfo.flag
+00010160: 5f62 6974 7320 3d20 3078 3030 0a20 2020  _bits = 0x00.   
+00010170: 2020 2020 2069 6620 7a69 6e66 6f2e 636f       if zinfo.co
+00010180: 6d70 7265 7373 5f74 7970 6520 3d3d 205a  mpress_type == Z
+00010190: 4950 5f4c 5a4d 413a 0a20 2020 2020 2020  IP_LZMA:.       
+000101a0: 2020 2020 2023 2043 6f6d 7072 6573 7365       # Compresse
+000101b0: 6420 6461 7461 2069 6e63 6c75 6465 7320  d data includes 
+000101c0: 616e 2065 6e64 2d6f 662d 7374 7265 616d  an end-of-stream
+000101d0: 2028 454f 5329 206d 6172 6b65 720a 2020   (EOS) marker.  
+000101e0: 2020 2020 2020 2020 2020 7a69 6e66 6f2e            zinfo.
+000101f0: 666c 6167 5f62 6974 7320 7c3d 2030 7830  flag_bits |= 0x0
+00010200: 320a 2020 2020 2020 2020 6966 206e 6f74  2.        if not
+00010210: 2073 656c 662e 5f73 6565 6b61 626c 653a   self._seekable:
+00010220: 0a20 2020 2020 2020 2020 2020 207a 696e  .            zin
+00010230: 666f 2e66 6c61 675f 6269 7473 207c 3d20  fo.flag_bits |= 
+00010240: 3078 3038 0a0a 2020 2020 2020 2020 6966  0x08..        if
+00010250: 206e 6f74 207a 696e 666f 2e65 7874 6572   not zinfo.exter
+00010260: 6e61 6c5f 6174 7472 3a0a 2020 2020 2020  nal_attr:.      
+00010270: 2020 2020 2020 7a69 6e66 6f2e 6578 7465        zinfo.exte
+00010280: 726e 616c 5f61 7474 7220 3d20 306f 3630  rnal_attr = 0o60
+00010290: 3020 3c3c 2031 3620 2023 2070 6572 6d69  0 << 16  # permi
+000102a0: 7373 696f 6e73 3a20 3f72 772d 2d2d 2d2d  ssions: ?rw-----
+000102b0: 2d2d 0a0a 2020 2020 2020 2020 2320 436f  --..        # Co
+000102c0: 6d70 7265 7373 6564 2073 697a 6520 6361  mpressed size ca
+000102d0: 6e20 6265 206c 6172 6765 7220 7468 616e  n be larger than
+000102e0: 2075 6e63 6f6d 7072 6573 7365 6420 7369   uncompressed si
+000102f0: 7a65 0a20 2020 2020 2020 207a 6970 3634  ze.        zip64
+00010300: 203d 2073 656c 662e 5f61 6c6c 6f77 5a69   = self._allowZi
+00010310: 7036 3420 616e 6420 5c0a 2020 2020 2020  p64 and \.      
+00010320: 2020 2020 2020 2020 2020 2866 6f72 6365            (force
+00010330: 5f7a 6970 3634 206f 7220 7a69 6e66 6f2e  _zip64 or zinfo.
+00010340: 6669 6c65 5f73 697a 6520 2a20 312e 3035  file_size * 1.05
+00010350: 203e 205a 4950 3634 5f4c 494d 4954 290a   > ZIP64_LIMIT).
+00010360: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00010370: 2e5f 7365 656b 6162 6c65 3a0a 2020 2020  ._seekable:.    
+00010380: 2020 2020 2020 2020 7365 6c66 2e66 702e          self.fp.
+00010390: 7365 656b 2873 656c 662e 7374 6172 745f  seek(self.start_
+000103a0: 6469 7229 0a20 2020 2020 2020 207a 696e  dir).        zin
+000103b0: 666f 2e68 6561 6465 725f 6f66 6673 6574  fo.header_offset
+000103c0: 203d 2073 656c 662e 6670 2e74 656c 6c28   = self.fp.tell(
+000103d0: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+000103e0: 5f77 7269 7465 6368 6563 6b28 7a69 6e66  _writecheck(zinf
+000103f0: 6f29 0a20 2020 2020 2020 2073 656c 662e  o).        self.
+00010400: 5f64 6964 4d6f 6469 6679 203d 2054 7275  _didModify = Tru
+00010410: 650a 0a20 2020 2020 2020 2073 656c 662e  e..        self.
+00010420: 6670 2e77 7269 7465 287a 696e 666f 2e46  fp.write(zinfo.F
+00010430: 696c 6548 6561 6465 7228 7a69 7036 3429  ileHeader(zip64)
+00010440: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00010450: 5f77 7269 7469 6e67 203d 2054 7275 650a  _writing = True.
+00010460: 2020 2020 2020 2020 7265 7475 726e 205f          return _
+00010470: 5a69 7057 7269 7465 4669 6c65 2873 656c  ZipWriteFile(sel
+00010480: 662c 207a 696e 666f 2c20 7a69 7036 3429  f, zinfo, zip64)
+00010490: 0a0a 2020 2020 6465 6620 6578 7472 6163  ..    def extrac
+000104a0: 7428 7365 6c66 2c20 6d65 6d62 6572 2c20  t(self, member, 
+000104b0: 7061 7468 3d4e 6f6e 652c 2070 7764 3d4e  path=None, pwd=N
+000104c0: 6f6e 6529 3a0a 2020 2020 2020 2020 2222  one):.        ""
+000104d0: 2245 7874 7261 6374 2061 206d 656d 6265  "Extract a membe
+000104e0: 7220 6672 6f6d 2074 6865 2061 7263 6869  r from the archi
+000104f0: 7665 2074 6f20 7468 6520 6375 7272 656e  ve to the curren
+00010500: 7420 776f 726b 696e 6720 6469 7265 6374  t working direct
+00010510: 6f72 792c 0a20 2020 2020 2020 2020 2020  ory,.           
+00010520: 7573 696e 6720 6974 7320 6675 6c6c 206e  using its full n
+00010530: 616d 652e 2049 7473 2066 696c 6520 696e  ame. Its file in
+00010540: 666f 726d 6174 696f 6e20 6973 2065 7874  formation is ext
+00010550: 7261 6374 6564 2061 7320 6163 6375 7261  racted as accura
+00010560: 7465 6c79 0a20 2020 2020 2020 2020 2020  tely.           
+00010570: 6173 2070 6f73 7369 626c 652e 2060 6d65  as possible. `me
+00010580: 6d62 6572 2720 6d61 7920 6265 2061 2066  mber' may be a f
+00010590: 696c 656e 616d 6520 6f72 2061 205a 6970  ilename or a Zip
+000105a0: 496e 666f 206f 626a 6563 742e 2059 6f75  Info object. You
+000105b0: 2063 616e 0a20 2020 2020 2020 2020 2020   can.           
+000105c0: 7370 6563 6966 7920 6120 6469 6666 6572  specify a differ
+000105d0: 656e 7420 6469 7265 6374 6f72 7920 7573  ent directory us
+000105e0: 696e 6720 6070 6174 6827 2e0a 2020 2020  ing `path'..    
+000105f0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00010600: 6966 2070 6174 6820 6973 204e 6f6e 653a  if path is None:
+00010610: 0a20 2020 2020 2020 2020 2020 2070 6174  .            pat
+00010620: 6820 3d20 6f73 2e67 6574 6377 6428 290a  h = os.getcwd().
+00010630: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00010640: 2020 2020 2020 2020 2020 6966 2073 7973            if sys
+00010650: 2e76 6572 7369 6f6e 5f69 6e66 6f3e 3d28  .version_info>=(
+00010660: 332c 3629 3a0a 2020 2020 2020 2020 2020  3,6):.          
+00010670: 2020 2020 2020 7061 7468 203d 206f 732e        path = os.
+00010680: 6673 7061 7468 2870 6174 6829 0a0a 2020  fspath(path)..  
+00010690: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+000106a0: 662e 5f65 7874 7261 6374 5f6d 656d 6265  f._extract_membe
+000106b0: 7228 6d65 6d62 6572 2c20 7061 7468 2c20  r(member, path, 
+000106c0: 7077 6429 0a0a 2020 2020 6465 6620 6578  pwd)..    def ex
+000106d0: 7472 6163 7461 6c6c 2873 656c 662c 2070  tractall(self, p
+000106e0: 6174 683d 4e6f 6e65 2c20 6d65 6d62 6572  ath=None, member
+000106f0: 733d 4e6f 6e65 2c20 7077 643d 4e6f 6e65  s=None, pwd=None
+00010700: 293a 0a20 2020 2020 2020 2022 2222 4578  ):.        """Ex
+00010710: 7472 6163 7420 616c 6c20 6d65 6d62 6572  tract all member
+00010720: 7320 6672 6f6d 2074 6865 2061 7263 6869  s from the archi
+00010730: 7665 2074 6f20 7468 6520 6375 7272 656e  ve to the curren
+00010740: 7420 776f 726b 696e 670a 2020 2020 2020  t working.      
+00010750: 2020 2020 2064 6972 6563 746f 7279 2e20       directory. 
+00010760: 6070 6174 6827 2073 7065 6369 6669 6573  `path' specifies
+00010770: 2061 2064 6966 6665 7265 6e74 2064 6972   a different dir
+00010780: 6563 746f 7279 2074 6f20 6578 7472 6163  ectory to extrac
+00010790: 7420 746f 2e0a 2020 2020 2020 2020 2020  t to..          
+000107a0: 2060 6d65 6d62 6572 7327 2069 7320 6f70   `members' is op
+000107b0: 7469 6f6e 616c 2061 6e64 206d 7573 7420  tional and must 
+000107c0: 6265 2061 2073 7562 7365 7420 6f66 2074  be a subset of t
+000107d0: 6865 206c 6973 7420 7265 7475 726e 6564  he list returned
+000107e0: 0a20 2020 2020 2020 2020 2020 6279 206e  .           by n
+000107f0: 616d 656c 6973 7428 292e 0a20 2020 2020  amelist()..     
+00010800: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
+00010810: 6620 6d65 6d62 6572 7320 6973 204e 6f6e  f members is Non
+00010820: 653a 0a20 2020 2020 2020 2020 2020 206d  e:.            m
+00010830: 656d 6265 7273 203d 2073 656c 662e 6e61  embers = self.na
+00010840: 6d65 6c69 7374 2829 0a0a 2020 2020 2020  melist()..      
+00010850: 2020 6966 2070 6174 6820 6973 204e 6f6e    if path is Non
+00010860: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
+00010870: 6174 6820 3d20 6f73 2e67 6574 6377 6428  ath = os.getcwd(
+00010880: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+00010890: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+000108a0: 7973 2e76 6572 7369 6f6e 5f69 6e66 6f3e  ys.version_info>
+000108b0: 3d28 332c 3629 3a0a 2020 2020 2020 2020  =(3,6):.        
+000108c0: 2020 2020 2020 2020 7061 7468 203d 206f          path = o
+000108d0: 732e 6673 7061 7468 2870 6174 6829 0a0a  s.fspath(path)..
+000108e0: 2020 2020 2020 2020 666f 7220 7a69 7069          for zipi
+000108f0: 6e66 6f20 696e 206d 656d 6265 7273 3a0a  nfo in members:.
+00010900: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00010910: 2e5f 6578 7472 6163 745f 6d65 6d62 6572  ._extract_member
+00010920: 287a 6970 696e 666f 2c20 7061 7468 2c20  (zipinfo, path, 
+00010930: 7077 6429 0a0a 2020 2020 4063 6c61 7373  pwd)..    @class
+00010940: 6d65 7468 6f64 0a20 2020 2064 6566 205f  method.    def _
+00010950: 7361 6e69 7469 7a65 5f77 696e 646f 7773  sanitize_windows
+00010960: 5f6e 616d 6528 636c 732c 2061 7263 6e61  _name(cls, arcna
+00010970: 6d65 2c20 7061 7468 7365 7029 3a0a 2020  me, pathsep):.  
+00010980: 2020 2020 2020 2222 2252 6570 6c61 6365        """Replace
+00010990: 2062 6164 2063 6861 7261 6374 6572 7320   bad characters 
+000109a0: 616e 6420 7265 6d6f 7665 2074 7261 696c  and remove trail
+000109b0: 696e 6720 646f 7473 2066 726f 6d20 7061  ing dots from pa
+000109c0: 7274 732e 2222 220a 2020 2020 2020 2020  rts.""".        
+000109d0: 7461 626c 6520 3d20 636c 732e 5f77 696e  table = cls._win
+000109e0: 646f 7773 5f69 6c6c 6567 616c 5f6e 616d  dows_illegal_nam
+000109f0: 655f 7472 616e 735f 7461 626c 650a 2020  e_trans_table.  
+00010a00: 2020 2020 2020 6966 206e 6f74 2074 6162        if not tab
+00010a10: 6c65 3a0a 2020 2020 2020 2020 2020 2020  le:.            
+00010a20: 696c 6c65 6761 6c20 3d20 273a 3c3e 7c22  illegal = ':<>|"
+00010a30: 3f2a 270a 2020 2020 2020 2020 2020 2020  ?*'.            
+00010a40: 7461 626c 6520 3d20 7374 722e 6d61 6b65  table = str.make
+00010a50: 7472 616e 7328 696c 6c65 6761 6c2c 2027  trans(illegal, '
+00010a60: 5f27 202a 206c 656e 2869 6c6c 6567 616c  _' * len(illegal
+00010a70: 2929 0a20 2020 2020 2020 2020 2020 2063  )).            c
+00010a80: 6c73 2e5f 7769 6e64 6f77 735f 696c 6c65  ls._windows_ille
+00010a90: 6761 6c5f 6e61 6d65 5f74 7261 6e73 5f74  gal_name_trans_t
+00010aa0: 6162 6c65 203d 2074 6162 6c65 0a20 2020  able = table.   
+00010ab0: 2020 2020 2061 7263 6e61 6d65 203d 2061       arcname = a
+00010ac0: 7263 6e61 6d65 2e74 7261 6e73 6c61 7465  rcname.translate
+00010ad0: 2874 6162 6c65 290a 2020 2020 2020 2020  (table).        
+00010ae0: 2320 7265 6d6f 7665 2074 7261 696c 696e  # remove trailin
+00010af0: 6720 646f 7473 0a20 2020 2020 2020 2061  g dots.        a
+00010b00: 7263 6e61 6d65 203d 2028 782e 7273 7472  rcname = (x.rstr
+00010b10: 6970 2827 2e27 2920 666f 7220 7820 696e  ip('.') for x in
+00010b20: 2061 7263 6e61 6d65 2e73 706c 6974 2870   arcname.split(p
+00010b30: 6174 6873 6570 2929 0a20 2020 2020 2020  athsep)).       
+00010b40: 2023 2072 656a 6f69 6e2c 2072 656d 6f76   # rejoin, remov
+00010b50: 696e 6720 656d 7074 7920 7061 7274 732e  ing empty parts.
+00010b60: 0a20 2020 2020 2020 2061 7263 6e61 6d65  .        arcname
+00010b70: 203d 2070 6174 6873 6570 2e6a 6f69 6e28   = pathsep.join(
+00010b80: 7820 666f 7220 7820 696e 2061 7263 6e61  x for x in arcna
+00010b90: 6d65 2069 6620 7829 0a20 2020 2020 2020  me if x).       
+00010ba0: 2072 6574 7572 6e20 6172 636e 616d 650a   return arcname.
+00010bb0: 0a20 2020 2064 6566 205f 6578 7472 6163  .    def _extrac
+00010bc0: 745f 6d65 6d62 6572 2873 656c 662c 206d  t_member(self, m
+00010bd0: 656d 6265 722c 2074 6172 6765 7470 6174  ember, targetpat
+00010be0: 682c 2070 7764 293a 0a20 2020 2020 2020  h, pwd):.       
+00010bf0: 2022 2222 4578 7472 6163 7420 7468 6520   """Extract the 
+00010c00: 5a69 7049 6e66 6f20 6f62 6a65 6374 2027  ZipInfo object '
+00010c10: 6d65 6d62 6572 2720 746f 2061 2070 6879  member' to a phy
+00010c20: 7369 6361 6c0a 2020 2020 2020 2020 2020  sical.          
+00010c30: 2066 696c 6520 6f6e 2074 6865 2070 6174   file on the pat
+00010c40: 6820 7461 7267 6574 7061 7468 2e0a 2020  h targetpath..  
+00010c50: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00010c60: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
+00010c70: 6e63 6528 6d65 6d62 6572 2c20 5a69 7049  nce(member, ZipI
+00010c80: 6e66 6f29 3a0a 2020 2020 2020 2020 2020  nfo):.          
+00010c90: 2020 6d65 6d62 6572 203d 2073 656c 662e    member = self.
+00010ca0: 6765 7469 6e66 6f28 6d65 6d62 6572 290a  getinfo(member).
+00010cb0: 0a20 2020 2020 2020 2023 2062 7569 6c64  .        # build
+00010cc0: 2074 6865 2064 6573 7469 6e61 7469 6f6e   the destination
+00010cd0: 2070 6174 686e 616d 652c 2072 6570 6c61   pathname, repla
+00010ce0: 6369 6e67 0a20 2020 2020 2020 2023 2066  cing.        # f
+00010cf0: 6f72 7761 7264 2073 6c61 7368 6573 2074  orward slashes t
+00010d00: 6f20 706c 6174 666f 726d 2073 7065 6369  o platform speci
+00010d10: 6669 6320 7365 7061 7261 746f 7273 2e0a  fic separators..
+00010d20: 2020 2020 2020 2020 6172 636e 616d 6520          arcname 
+00010d30: 3d20 6d65 6d62 6572 2e66 696c 656e 616d  = member.filenam
+00010d40: 652e 7265 706c 6163 6528 272f 272c 206f  e.replace('/', o
+00010d50: 732e 7061 7468 2e73 6570 290a 0a20 2020  s.path.sep)..   
+00010d60: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
+00010d70: 616c 7473 6570 3a0a 2020 2020 2020 2020  altsep:.        
+00010d80: 2020 2020 6172 636e 616d 6520 3d20 6172      arcname = ar
+00010d90: 636e 616d 652e 7265 706c 6163 6528 6f73  cname.replace(os
+00010da0: 2e70 6174 682e 616c 7473 6570 2c20 6f73  .path.altsep, os
+00010db0: 2e70 6174 682e 7365 7029 0a20 2020 2020  .path.sep).     
+00010dc0: 2020 2023 2069 6e74 6572 7072 6574 2061     # interpret a
+00010dd0: 6273 6f6c 7574 6520 7061 7468 6e61 6d65  bsolute pathname
+00010de0: 2061 7320 7265 6c61 7469 7665 2c20 7265   as relative, re
+00010df0: 6d6f 7665 2064 7269 7665 206c 6574 7465  move drive lette
+00010e00: 7220 6f72 0a20 2020 2020 2020 2023 2055  r or.        # U
+00010e10: 4e43 2070 6174 682c 2072 6564 756e 6461  NC path, redunda
+00010e20: 6e74 2073 6570 6172 6174 6f72 732c 2022  nt separators, "
+00010e30: 2e22 2061 6e64 2022 2e2e 2220 636f 6d70  ." and ".." comp
+00010e40: 6f6e 656e 7473 2e0a 2020 2020 2020 2020  onents..        
+00010e50: 6172 636e 616d 6520 3d20 6f73 2e70 6174  arcname = os.pat
+00010e60: 682e 7370 6c69 7464 7269 7665 2861 7263  h.splitdrive(arc
+00010e70: 6e61 6d65 295b 315d 0a20 2020 2020 2020  name)[1].       
+00010e80: 2069 6e76 616c 6964 5f70 6174 685f 7061   invalid_path_pa
+00010e90: 7274 7320 3d20 2827 272c 206f 732e 7061  rts = ('', os.pa
+00010ea0: 7468 2e63 7572 6469 722c 206f 732e 7061  th.curdir, os.pa
+00010eb0: 7468 2e70 6172 6469 7229 0a20 2020 2020  th.pardir).     
+00010ec0: 2020 2061 7263 6e61 6d65 203d 206f 732e     arcname = os.
+00010ed0: 7061 7468 2e73 6570 2e6a 6f69 6e28 7820  path.sep.join(x 
+00010ee0: 666f 7220 7820 696e 2061 7263 6e61 6d65  for x in arcname
+00010ef0: 2e73 706c 6974 286f 732e 7061 7468 2e73  .split(os.path.s
+00010f00: 6570 290a 2020 2020 2020 2020 2020 2020  ep).            
+00010f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010f20: 2020 2020 2020 2069 6620 7820 6e6f 7420         if x not 
+00010f30: 696e 2069 6e76 616c 6964 5f70 6174 685f  in invalid_path_
+00010f40: 7061 7274 7329 0a20 2020 2020 2020 2069  parts).        i
+00010f50: 6620 6f73 2e70 6174 682e 7365 7020 3d3d  f os.path.sep ==
+00010f60: 2027 5c5c 273a 0a20 2020 2020 2020 2020   '\\':.         
+00010f70: 2020 2023 2066 696c 7465 7220 696c 6c65     # filter ille
+00010f80: 6761 6c20 6368 6172 6163 7465 7273 206f  gal characters o
+00010f90: 6e20 5769 6e64 6f77 730a 2020 2020 2020  n Windows.      
+00010fa0: 2020 2020 2020 6172 636e 616d 6520 3d20        arcname = 
+00010fb0: 7365 6c66 2e5f 7361 6e69 7469 7a65 5f77  self._sanitize_w
+00010fc0: 696e 646f 7773 5f6e 616d 6528 6172 636e  indows_name(arcn
+00010fd0: 616d 652c 206f 732e 7061 7468 2e73 6570  ame, os.path.sep
+00010fe0: 290a 0a20 2020 2020 2020 2074 6172 6765  )..        targe
+00010ff0: 7470 6174 6820 3d20 6f73 2e70 6174 682e  tpath = os.path.
+00011000: 6a6f 696e 2874 6172 6765 7470 6174 682c  join(targetpath,
+00011010: 2061 7263 6e61 6d65 290a 2020 2020 2020   arcname).      
+00011020: 2020 7461 7267 6574 7061 7468 203d 206f    targetpath = o
+00011030: 732e 7061 7468 2e6e 6f72 6d70 6174 6828  s.path.normpath(
+00011040: 7461 7267 6574 7061 7468 290a 0a20 2020  targetpath)..   
+00011050: 2020 2020 2023 2043 7265 6174 6520 616c       # Create al
+00011060: 6c20 7570 7065 7220 6469 7265 6374 6f72  l upper director
+00011070: 6965 7320 6966 206e 6563 6573 7361 7279  ies if necessary
+00011080: 2e0a 2020 2020 2020 2020 7570 7065 7264  ..        upperd
+00011090: 6972 7320 3d20 6f73 2e70 6174 682e 6469  irs = os.path.di
+000110a0: 726e 616d 6528 7461 7267 6574 7061 7468  rname(targetpath
+000110b0: 290a 2020 2020 2020 2020 6966 2075 7070  ).        if upp
+000110c0: 6572 6469 7273 2061 6e64 206e 6f74 206f  erdirs and not o
+000110d0: 732e 7061 7468 2e65 7869 7374 7328 7570  s.path.exists(up
+000110e0: 7065 7264 6972 7329 3a0a 2020 2020 2020  perdirs):.      
+000110f0: 2020 2020 2020 6f73 2e6d 616b 6564 6972        os.makedir
+00011100: 7328 7570 7065 7264 6972 7329 0a0a 2020  s(upperdirs)..  
+00011110: 2020 2020 2020 6966 206d 656d 6265 722e        if member.
+00011120: 6973 5f64 6972 2829 3a0a 2020 2020 2020  is_dir():.      
+00011130: 2020 2020 2020 6966 206e 6f74 206f 732e        if not os.
+00011140: 7061 7468 2e69 7364 6972 2874 6172 6765  path.isdir(targe
+00011150: 7470 6174 6829 3a0a 2020 2020 2020 2020  tpath):.        
+00011160: 2020 2020 2020 2020 6f73 2e6d 6b64 6972          os.mkdir
+00011170: 2874 6172 6765 7470 6174 6829 0a20 2020  (targetpath).   
+00011180: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00011190: 7461 7267 6574 7061 7468 0a0a 2020 2020  targetpath..    
+000111a0: 2020 2020 7769 7468 2073 656c 662e 6f70      with self.op
+000111b0: 656e 286d 656d 6265 722c 2070 7764 3d70  en(member, pwd=p
+000111c0: 7764 2920 6173 2073 6f75 7263 652c 205c  wd) as source, \
+000111d0: 0a20 2020 2020 2020 2020 2020 2020 6f70  .             op
+000111e0: 656e 2874 6172 6765 7470 6174 682c 2022  en(targetpath, "
+000111f0: 7762 2229 2061 7320 7461 7267 6574 3a0a  wb") as target:.
+00011200: 2020 2020 2020 2020 2020 2020 7368 7574              shut
+00011210: 696c 2e63 6f70 7966 696c 656f 626a 2873  il.copyfileobj(s
+00011220: 6f75 7263 652c 2074 6172 6765 7429 0a0a  ource, target)..
+00011230: 2020 2020 2020 2020 7265 7475 726e 2074          return t
+00011240: 6172 6765 7470 6174 680a 0a20 2020 2064  argetpath..    d
+00011250: 6566 205f 7772 6974 6563 6865 636b 2873  ef _writecheck(s
+00011260: 656c 662c 207a 696e 666f 293a 0a20 2020  elf, zinfo):.   
+00011270: 2020 2020 2022 2222 4368 6563 6b20 666f       """Check fo
+00011280: 7220 6572 726f 7273 2062 6566 6f72 6520  r errors before 
+00011290: 7772 6974 696e 6720 6120 6669 6c65 2074  writing a file t
+000112a0: 6f20 7468 6520 6172 6368 6976 652e 2222  o the archive.""
+000112b0: 220a 2020 2020 2020 2020 6966 207a 696e  ".        if zin
+000112c0: 666f 2e66 696c 656e 616d 6520 696e 2073  fo.filename in s
+000112d0: 656c 662e 4e61 6d65 546f 496e 666f 3a0a  elf.NameToInfo:.
+000112e0: 2020 2020 2020 2020 2020 2020 696d 706f              impo
+000112f0: 7274 2077 6172 6e69 6e67 730a 2020 2020  rt warnings.    
+00011300: 2020 2020 2020 2020 7761 726e 696e 6773          warnings
+00011310: 2e77 6172 6e28 2744 7570 6c69 6361 7465  .warn('Duplicate
+00011320: 206e 616d 653a 2025 7227 2025 207a 696e   name: %r' % zin
+00011330: 666f 2e66 696c 656e 616d 652c 2073 7461  fo.filename, sta
+00011340: 636b 6c65 7665 6c3d 3329 0a20 2020 2020  cklevel=3).     
+00011350: 2020 2069 6620 7365 6c66 2e6d 6f64 6520     if self.mode 
+00011360: 6e6f 7420 696e 2028 2777 272c 2027 7827  not in ('w', 'x'
+00011370: 2c20 2761 2729 3a0a 2020 2020 2020 2020  , 'a'):.        
+00011380: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00011390: 7272 6f72 2822 7772 6974 6528 2920 7265  rror("write() re
+000113a0: 7175 6972 6573 206d 6f64 6520 2777 272c  quires mode 'w',
+000113b0: 2027 7827 2c20 6f72 2027 6127 2229 0a20   'x', or 'a'"). 
+000113c0: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
+000113d0: 6c66 2e66 703a 0a20 2020 2020 2020 2020  lf.fp:.         
+000113e0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+000113f0: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
+00011400: 2020 2020 2022 4174 7465 6d70 7420 746f       "Attempt to
+00011410: 2077 7269 7465 205a 4950 2061 7263 6869   write ZIP archi
+00011420: 7665 2074 6861 7420 7761 7320 616c 7265  ve that was alre
+00011430: 6164 7920 636c 6f73 6564 2229 0a20 2020  ady closed").   
+00011440: 2020 2020 205f 6368 6563 6b5f 636f 6d70       _check_comp
+00011450: 7265 7373 696f 6e28 7a69 6e66 6f2e 636f  ression(zinfo.co
+00011460: 6d70 7265 7373 5f74 7970 6529 0a20 2020  mpress_type).   
+00011470: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
+00011480: 2e5f 616c 6c6f 775a 6970 3634 3a0a 2020  ._allowZip64:.  
+00011490: 2020 2020 2020 2020 2020 7265 7175 6972            requir
+000114a0: 6573 5f7a 6970 3634 203d 204e 6f6e 650a  es_zip64 = None.
+000114b0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+000114c0: 656e 2873 656c 662e 6669 6c65 6c69 7374  en(self.filelist
+000114d0: 2920 3e3d 205a 4950 5f46 494c 4543 4f55  ) >= ZIP_FILECOU
+000114e0: 4e54 5f4c 494d 4954 3a0a 2020 2020 2020  NT_LIMIT:.      
+000114f0: 2020 2020 2020 2020 2020 7265 7175 6972            requir
+00011500: 6573 5f7a 6970 3634 203d 2022 4669 6c65  es_zip64 = "File
+00011510: 7320 636f 756e 7422 0a20 2020 2020 2020  s count".       
+00011520: 2020 2020 2065 6c69 6620 7a69 6e66 6f2e       elif zinfo.
+00011530: 6669 6c65 5f73 697a 6520 3e20 5a49 5036  file_size > ZIP6
+00011540: 345f 4c49 4d49 543a 0a20 2020 2020 2020  4_LIMIT:.       
+00011550: 2020 2020 2020 2020 2072 6571 7569 7265           require
+00011560: 735f 7a69 7036 3420 3d20 2246 696c 6573  s_zip64 = "Files
+00011570: 697a 6522 0a20 2020 2020 2020 2020 2020  ize".           
+00011580: 2065 6c69 6620 7a69 6e66 6f2e 6865 6164   elif zinfo.head
+00011590: 6572 5f6f 6666 7365 7420 3e20 5a49 5036  er_offset > ZIP6
+000115a0: 345f 4c49 4d49 543a 0a20 2020 2020 2020  4_LIMIT:.       
+000115b0: 2020 2020 2020 2020 2072 6571 7569 7265           require
+000115c0: 735f 7a69 7036 3420 3d20 225a 6970 6669  s_zip64 = "Zipfi
+000115d0: 6c65 2073 697a 6522 0a20 2020 2020 2020  le size".       
+000115e0: 2020 2020 2069 6620 7265 7175 6972 6573       if requires
+000115f0: 5f7a 6970 3634 3a0a 2020 2020 2020 2020  _zip64:.        
+00011600: 2020 2020 2020 2020 7261 6973 6520 4c61          raise La
+00011610: 7267 655a 6970 4669 6c65 2872 6571 7569  rgeZipFile(requi
+00011620: 7265 735f 7a69 7036 3420 2b0a 2020 2020  res_zip64 +.    
+00011630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011640: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00011650: 2077 6f75 6c64 2072 6571 7569 7265 205a   would require Z
+00011660: 4950 3634 2065 7874 656e 7369 6f6e 7322  IP64 extensions"
+00011670: 290a 0a20 2020 2064 6566 2077 7269 7465  )..    def write
+00011680: 2873 656c 662c 2066 696c 656e 616d 652c  (self, filename,
+00011690: 2061 7263 6e61 6d65 3d4e 6f6e 652c 0a20   arcname=None,. 
+000116a0: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
+000116b0: 7072 6573 735f 7479 7065 3d4e 6f6e 652c  press_type=None,
+000116c0: 2063 6f6d 7072 6573 736c 6576 656c 3d4e   compresslevel=N
+000116d0: 6f6e 6529 3a0a 2020 2020 2020 2020 2222  one):.        ""
+000116e0: 2250 7574 2074 6865 2062 7974 6573 2066  "Put the bytes f
+000116f0: 726f 6d20 6669 6c65 6e61 6d65 2069 6e74  rom filename int
+00011700: 6f20 7468 6520 6172 6368 6976 6520 756e  o the archive un
+00011710: 6465 7220 7468 6520 6e61 6d65 0a20 2020  der the name.   
+00011720: 2020 2020 2061 7263 6e61 6d65 2e22 2222       arcname."""
+00011730: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+00011740: 7365 6c66 2e66 703a 0a20 2020 2020 2020  self.fp:.       
+00011750: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00011760: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
+00011770: 2020 2020 2020 2022 4174 7465 6d70 7420         "Attempt 
+00011780: 746f 2077 7269 7465 2074 6f20 5a49 5020  to write to ZIP 
+00011790: 6172 6368 6976 6520 7468 6174 2077 6173  archive that was
+000117a0: 2061 6c72 6561 6479 2063 6c6f 7365 6422   already closed"
+000117b0: 290a 2020 2020 2020 2020 6966 2073 656c  ).        if sel
+000117c0: 662e 5f77 7269 7469 6e67 3a0a 2020 2020  f._writing:.    
+000117d0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+000117e0: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
+000117f0: 2020 2020 2020 2020 2020 2243 616e 2774            "Can't
+00011800: 2077 7269 7465 2074 6f20 5a49 5020 6172   write to ZIP ar
+00011810: 6368 6976 6520 7768 696c 6520 616e 206f  chive while an o
+00011820: 7065 6e20 7772 6974 696e 6720 6861 6e64  pen writing hand
+00011830: 6c65 2065 7869 7374 7322 0a20 2020 2020  le exists".     
+00011840: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+00011850: 2020 7a69 6e66 6f20 3d20 5a69 7049 6e66    zinfo = ZipInf
+00011860: 6f2e 6672 6f6d 5f66 696c 6528 6669 6c65  o.from_file(file
+00011870: 6e61 6d65 2c20 6172 636e 616d 652c 0a20  name, arcname,. 
+00011880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000118a0: 2073 7472 6963 745f 7469 6d65 7374 616d   strict_timestam
+000118b0: 7073 3d73 656c 662e 5f73 7472 6963 745f  ps=self._strict_
+000118c0: 7469 6d65 7374 616d 7073 290a 0a20 2020  timestamps)..   
+000118d0: 2020 2020 2069 6620 7a69 6e66 6f2e 6973       if zinfo.is
+000118e0: 5f64 6972 2829 3a0a 2020 2020 2020 2020  _dir():.        
+000118f0: 2020 2020 7a69 6e66 6f2e 636f 6d70 7265      zinfo.compre
+00011900: 7373 5f73 697a 6520 3d20 300a 2020 2020  ss_size = 0.    
+00011910: 2020 2020 2020 2020 7a69 6e66 6f2e 4352          zinfo.CR
+00011920: 4320 3d20 300a 2020 2020 2020 2020 656c  C = 0.        el
+00011930: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00011940: 6966 2063 6f6d 7072 6573 735f 7479 7065  if compress_type
+00011950: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00011960: 2020 2020 2020 2020 2020 2020 2020 7a69                zi
+00011970: 6e66 6f2e 636f 6d70 7265 7373 5f74 7970  nfo.compress_typ
+00011980: 6520 3d20 636f 6d70 7265 7373 5f74 7970  e = compress_typ
+00011990: 650a 2020 2020 2020 2020 2020 2020 656c  e.            el
+000119a0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000119b0: 2020 2020 7a69 6e66 6f2e 636f 6d70 7265      zinfo.compre
+000119c0: 7373 5f74 7970 6520 3d20 7365 6c66 2e63  ss_type = self.c
+000119d0: 6f6d 7072 6573 7369 6f6e 0a0a 2020 2020  ompression..    
+000119e0: 2020 2020 2020 2020 6966 2063 6f6d 7072          if compr
+000119f0: 6573 736c 6576 656c 2069 7320 6e6f 7420  esslevel is not 
+00011a00: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00011a10: 2020 2020 2020 7a69 6e66 6f2e 5f63 6f6d        zinfo._com
+00011a20: 7072 6573 736c 6576 656c 203d 2063 6f6d  presslevel = com
+00011a30: 7072 6573 736c 6576 656c 0a20 2020 2020  presslevel.     
+00011a40: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00011a50: 2020 2020 2020 2020 2020 2020 207a 696e               zin
+00011a60: 666f 2e5f 636f 6d70 7265 7373 6c65 7665  fo._compressleve
+00011a70: 6c20 3d20 7365 6c66 2e63 6f6d 7072 6573  l = self.compres
+00011a80: 736c 6576 656c 0a0a 2020 2020 2020 2020  slevel..        
+00011a90: 6966 207a 696e 666f 2e69 735f 6469 7228  if zinfo.is_dir(
+00011aa0: 293a 0a20 2020 2020 2020 2020 2020 2077  ):.            w
+00011ab0: 6974 6820 7365 6c66 2e5f 6c6f 636b 3a0a  ith self._lock:.
+00011ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011ad0: 6966 2073 656c 662e 5f73 6565 6b61 626c  if self._seekabl
+00011ae0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00011af0: 2020 2020 2020 2073 656c 662e 6670 2e73         self.fp.s
+00011b00: 6565 6b28 7365 6c66 2e73 7461 7274 5f64  eek(self.start_d
+00011b10: 6972 290a 2020 2020 2020 2020 2020 2020  ir).            
+00011b20: 2020 2020 7a69 6e66 6f2e 6865 6164 6572      zinfo.header
+00011b30: 5f6f 6666 7365 7420 3d20 7365 6c66 2e66  _offset = self.f
+00011b40: 702e 7465 6c6c 2829 2020 2320 5374 6172  p.tell()  # Star
+00011b50: 7420 6f66 2068 6561 6465 7220 6279 7465  t of header byte
+00011b60: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+00011b70: 2020 6966 207a 696e 666f 2e63 6f6d 7072    if zinfo.compr
+00011b80: 6573 735f 7479 7065 203d 3d20 5a49 505f  ess_type == ZIP_
+00011b90: 4c5a 4d41 3a0a 2020 2020 2020 2020 2020  LZMA:.          
+00011ba0: 2020 2020 2020 2320 436f 6d70 7265 7373        # Compress
+00011bb0: 6564 2064 6174 6120 696e 636c 7564 6573  ed data includes
+00011bc0: 2061 6e20 656e 642d 6f66 2d73 7472 6561   an end-of-strea
+00011bd0: 6d20 2845 4f53 2920 6d61 726b 6572 0a20  m (EOS) marker. 
+00011be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011bf0: 2020 207a 696e 666f 2e66 6c61 675f 6269     zinfo.flag_bi
+00011c00: 7473 207c 3d20 3078 3032 0a0a 2020 2020  ts |= 0x02..    
+00011c10: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00011c20: 2e5f 7772 6974 6563 6865 636b 287a 696e  ._writecheck(zin
+00011c30: 666f 290a 2020 2020 2020 2020 2020 2020  fo).            
+00011c40: 2020 2020 7365 6c66 2e5f 6469 644d 6f64      self._didMod
+00011c50: 6966 7920 3d20 5472 7565 0a0a 2020 2020  ify = True..    
+00011c60: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00011c70: 2e66 696c 656c 6973 742e 6170 7065 6e64  .filelist.append
+00011c80: 287a 696e 666f 290a 2020 2020 2020 2020  (zinfo).        
+00011c90: 2020 2020 2020 2020 7365 6c66 2e4e 616d          self.Nam
+00011ca0: 6554 6f49 6e66 6f5b 7a69 6e66 6f2e 6669  eToInfo[zinfo.fi
+00011cb0: 6c65 6e61 6d65 5d20 3d20 7a69 6e66 6f0a  lename] = zinfo.
+00011cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011cd0: 7365 6c66 2e66 702e 7772 6974 6528 7a69  self.fp.write(zi
+00011ce0: 6e66 6f2e 4669 6c65 4865 6164 6572 2846  nfo.FileHeader(F
+00011cf0: 616c 7365 2929 0a20 2020 2020 2020 2020  alse)).         
+00011d00: 2020 2020 2020 2073 656c 662e 7374 6172         self.star
+00011d10: 745f 6469 7220 3d20 7365 6c66 2e66 702e  t_dir = self.fp.
+00011d20: 7465 6c6c 2829 0a20 2020 2020 2020 2065  tell().        e
+00011d30: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00011d40: 2077 6974 6820 6f70 656e 2866 696c 656e   with open(filen
+00011d50: 616d 652c 2022 7262 2229 2061 7320 7372  ame, "rb") as sr
+00011d60: 632c 2073 656c 662e 6f70 656e 287a 696e  c, self.open(zin
+00011d70: 666f 2c20 2777 2729 2061 7320 6465 7374  fo, 'w') as dest
+00011d80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00011d90: 2020 7368 7574 696c 2e63 6f70 7966 696c    shutil.copyfil
+00011da0: 656f 626a 2873 7263 2c20 6465 7374 2c20  eobj(src, dest, 
+00011db0: 3130 3234 2a38 290a 0a20 2020 2064 6566  1024*8)..    def
+00011dc0: 2077 7269 7465 7374 7228 7365 6c66 2c20   writestr(self, 
+00011dd0: 7a69 6e66 6f5f 6f72 5f61 7263 6e61 6d65  zinfo_or_arcname
+00011de0: 2c20 6461 7461 2c0a 2020 2020 2020 2020  , data,.        
+00011df0: 2020 2020 2020 2020 2063 6f6d 7072 6573           compres
+00011e00: 735f 7479 7065 3d4e 6f6e 652c 2063 6f6d  s_type=None, com
+00011e10: 7072 6573 736c 6576 656c 3d4e 6f6e 6529  presslevel=None)
+00011e20: 3a0a 2020 2020 2020 2020 2222 2257 7269  :.        """Wri
+00011e30: 7465 2061 2066 696c 6520 696e 746f 2074  te a file into t
+00011e40: 6865 2061 7263 6869 7665 2e20 2054 6865  he archive.  The
+00011e50: 2063 6f6e 7465 6e74 7320 6973 2027 6461   contents is 'da
+00011e60: 7461 272c 2077 6869 6368 0a20 2020 2020  ta', which.     
+00011e70: 2020 206d 6179 2062 6520 6569 7468 6572     may be either
+00011e80: 2061 2027 7374 7227 206f 7220 6120 2762   a 'str' or a 'b
+00011e90: 7974 6573 2720 696e 7374 616e 6365 3b20  ytes' instance; 
+00011ea0: 6966 2069 7420 6973 2061 2027 7374 7227  if it is a 'str'
+00011eb0: 2c0a 2020 2020 2020 2020 6974 2069 7320  ,.        it is 
+00011ec0: 656e 636f 6465 6420 6173 2055 5446 2d38  encoded as UTF-8
+00011ed0: 2066 6972 7374 2e0a 2020 2020 2020 2020   first..        
+00011ee0: 277a 696e 666f 5f6f 725f 6172 636e 616d  'zinfo_or_arcnam
+00011ef0: 6527 2069 7320 6569 7468 6572 2061 205a  e' is either a Z
+00011f00: 6970 496e 666f 2069 6e73 7461 6e63 6520  ipInfo instance 
+00011f10: 6f72 0a20 2020 2020 2020 2074 6865 206e  or.        the n
+00011f20: 616d 6520 6f66 2074 6865 2066 696c 6520  ame of the file 
+00011f30: 696e 2074 6865 2061 7263 6869 7665 2e22  in the archive."
+00011f40: 2222 0a20 2020 2020 2020 2069 6620 7379  "".        if sy
+00011f50: 732e 7665 7273 696f 6e5f 696e 666f 5b30  s.version_info[0
+00011f60: 5d3e 3d33 3a0a 2020 2020 2020 2020 2020  ]>=3:.          
+00011f70: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+00011f80: 6461 7461 2c20 7374 7229 3a0a 2020 2020  data, str):.    
+00011f90: 2020 2020 2020 2020 2020 2020 6461 7461              data
+00011fa0: 203d 2064 6174 612e 656e 636f 6465 2822   = data.encode("
+00011fb0: 7574 662d 3822 290a 2020 2020 2020 2020  utf-8").        
+00011fc0: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
+00011fd0: 6528 7a69 6e66 6f5f 6f72 5f61 7263 6e61  e(zinfo_or_arcna
+00011fe0: 6d65 2c20 5a69 7049 6e66 6f29 3a0a 2020  me, ZipInfo):.  
+00011ff0: 2020 2020 2020 2020 2020 7a69 6e66 6f20            zinfo 
+00012000: 3d20 5a69 7049 6e66 6f28 6669 6c65 6e61  = ZipInfo(filena
+00012010: 6d65 3d7a 696e 666f 5f6f 725f 6172 636e  me=zinfo_or_arcn
+00012020: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
+00012030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012040: 2064 6174 655f 7469 6d65 3d74 696d 652e   date_time=time.
+00012050: 6c6f 6361 6c74 696d 6528 7469 6d65 2e74  localtime(time.t
+00012060: 696d 6528 2929 5b3a 365d 290a 2020 2020  ime())[:6]).    
+00012070: 2020 2020 2020 2020 7a69 6e66 6f2e 636f          zinfo.co
+00012080: 6d70 7265 7373 5f74 7970 6520 3d20 7365  mpress_type = se
+00012090: 6c66 2e63 6f6d 7072 6573 7369 6f6e 0a20  lf.compression. 
+000120a0: 2020 2020 2020 2020 2020 207a 696e 666f             zinfo
+000120b0: 2e5f 636f 6d70 7265 7373 6c65 7665 6c20  ._compresslevel 
+000120c0: 3d20 7365 6c66 2e63 6f6d 7072 6573 736c  = self.compressl
+000120d0: 6576 656c 0a20 2020 2020 2020 2020 2020  evel.           
+000120e0: 2069 6620 7a69 6e66 6f2e 6669 6c65 6e61   if zinfo.filena
+000120f0: 6d65 5b2d 315d 203d 3d20 272f 273a 0a20  me[-1] == '/':. 
+00012100: 2020 2020 2020 2020 2020 2020 2020 207a                 z
+00012110: 696e 666f 2e65 7874 6572 6e61 6c5f 6174  info.external_at
+00012120: 7472 203d 2030 6f34 3037 3735 203c 3c20  tr = 0o40775 << 
+00012130: 3136 2020 2023 2064 7277 7872 7778 722d  16   # drwxrwxr-
+00012140: 780a 2020 2020 2020 2020 2020 2020 2020  x.              
+00012150: 2020 7a69 6e66 6f2e 6578 7465 726e 616c    zinfo.external
+00012160: 5f61 7474 7220 7c3d 2030 7831 3020 2020  _attr |= 0x10   
+00012170: 2020 2020 2020 2020 2320 4d53 2d44 4f53          # MS-DOS
+00012180: 2064 6972 6563 746f 7279 2066 6c61 670a   directory flag.
+00012190: 2020 2020 2020 2020 2020 2020 656c 7365              else
+000121a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000121b0: 2020 7a69 6e66 6f2e 6578 7465 726e 616c    zinfo.external
+000121c0: 5f61 7474 7220 3d20 306f 3630 3020 3c3c  _attr = 0o600 <<
+000121d0: 2031 3620 2020 2020 2320 3f72 772d 2d2d   16     # ?rw---
+000121e0: 2d2d 2d2d 0a20 2020 2020 2020 2065 6c73  ----.        els
+000121f0: 653a 0a20 2020 2020 2020 2020 2020 207a  e:.            z
+00012200: 696e 666f 203d 207a 696e 666f 5f6f 725f  info = zinfo_or_
+00012210: 6172 636e 616d 650a 0a20 2020 2020 2020  arcname..       
+00012220: 2069 6620 6e6f 7420 7365 6c66 2e66 703a   if not self.fp:
+00012230: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00012240: 7365 2056 616c 7565 4572 726f 7228 0a20  se ValueError(. 
+00012250: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00012260: 4174 7465 6d70 7420 746f 2077 7269 7465  Attempt to write
+00012270: 2074 6f20 5a49 5020 6172 6368 6976 6520   to ZIP archive 
+00012280: 7468 6174 2077 6173 2061 6c72 6561 6479  that was already
+00012290: 2063 6c6f 7365 6422 290a 2020 2020 2020   closed").      
+000122a0: 2020 6966 2073 656c 662e 5f77 7269 7469    if self._writi
+000122b0: 6e67 3a0a 2020 2020 2020 2020 2020 2020  ng:.            
+000122c0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+000122d0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+000122e0: 2020 2243 616e 2774 2077 7269 7465 2074    "Can't write t
+000122f0: 6f20 5a49 5020 6172 6368 6976 6520 7768  o ZIP archive wh
+00012300: 696c 6520 616e 206f 7065 6e20 7772 6974  ile an open writ
+00012310: 696e 6720 6861 6e64 6c65 2065 7869 7374  ing handle exist
+00012320: 732e 220a 2020 2020 2020 2020 2020 2020  s.".            
+00012330: 290a 0a20 2020 2020 2020 2069 6620 636f  )..        if co
+00012340: 6d70 7265 7373 5f74 7970 6520 6973 206e  mpress_type is n
+00012350: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00012360: 2020 2020 207a 696e 666f 2e63 6f6d 7072       zinfo.compr
+00012370: 6573 735f 7479 7065 203d 2063 6f6d 7072  ess_type = compr
+00012380: 6573 735f 7479 7065 0a0a 2020 2020 2020  ess_type..      
+00012390: 2020 6966 2063 6f6d 7072 6573 736c 6576    if compresslev
+000123a0: 656c 2069 7320 6e6f 7420 4e6f 6e65 3a0a  el is not None:.
+000123b0: 2020 2020 2020 2020 2020 2020 7a69 6e66              zinf
+000123c0: 6f2e 5f63 6f6d 7072 6573 736c 6576 656c  o._compresslevel
+000123d0: 203d 2063 6f6d 7072 6573 736c 6576 656c   = compresslevel
+000123e0: 0a0a 2020 2020 2020 2020 7a69 6e66 6f2e  ..        zinfo.
+000123f0: 6669 6c65 5f73 697a 6520 3d20 6c65 6e28  file_size = len(
+00012400: 6461 7461 2920 2020 2020 2020 2020 2020  data)           
+00012410: 2023 2055 6e63 6f6d 7072 6573 7365 6420   # Uncompressed 
+00012420: 7369 7a65 0a20 2020 2020 2020 2077 6974  size.        wit
+00012430: 6820 7365 6c66 2e5f 6c6f 636b 3a0a 2020  h self._lock:.  
+00012440: 2020 2020 2020 2020 2020 7769 7468 2073            with s
+00012450: 656c 662e 6f70 656e 287a 696e 666f 2c20  elf.open(zinfo, 
+00012460: 6d6f 6465 3d27 7727 2920 6173 2064 6573  mode='w') as des
+00012470: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+00012480: 2020 2064 6573 742e 7772 6974 6528 6461     dest.write(da
+00012490: 7461 290a 0a20 2020 2064 6566 205f 5f64  ta)..    def __d
+000124a0: 656c 5f5f 2873 656c 6629 3a0a 2020 2020  el__(self):.    
+000124b0: 2020 2020 2222 2243 616c 6c20 7468 6520      """Call the 
+000124c0: 2263 6c6f 7365 2829 2220 6d65 7468 6f64  "close()" method
+000124d0: 2069 6e20 6361 7365 2074 6865 2075 7365   in case the use
+000124e0: 7220 666f 7267 6f74 2e22 2222 0a20 2020  r forgot.""".   
+000124f0: 2020 2020 2073 656c 662e 636c 6f73 6528       self.close(
+00012500: 290a 0a20 2020 2064 6566 2063 6c6f 7365  )..    def close
+00012510: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00012520: 2222 2243 6c6f 7365 2074 6865 2066 696c  """Close the fil
+00012530: 652c 2061 6e64 2066 6f72 206d 6f64 6520  e, and for mode 
+00012540: 2777 272c 2027 7827 2061 6e64 2027 6127  'w', 'x' and 'a'
+00012550: 2077 7269 7465 2074 6865 2065 6e64 696e   write the endin
+00012560: 670a 2020 2020 2020 2020 7265 636f 7264  g.        record
+00012570: 732e 2222 220a 2020 2020 2020 2020 6966  s.""".        if
+00012580: 2073 656c 662e 6670 2069 7320 4e6f 6e65   self.fp is None
+00012590: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+000125a0: 7475 726e 0a0a 2020 2020 2020 2020 6966  turn..        if
+000125b0: 2073 656c 662e 5f77 7269 7469 6e67 3a0a   self._writing:.
+000125c0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+000125d0: 6520 5661 6c75 6545 7272 6f72 2822 4361  e ValueError("Ca
+000125e0: 6e27 7420 636c 6f73 6520 7468 6520 5a49  n't close the ZI
+000125f0: 5020 6669 6c65 2077 6869 6c65 2074 6865  P file while the
+00012600: 7265 2069 7320 220a 2020 2020 2020 2020  re is ".        
+00012610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012620: 2020 2020 2022 616e 206f 7065 6e20 7772       "an open wr
+00012630: 6974 696e 6720 6861 6e64 6c65 206f 6e20  iting handle on 
+00012640: 6974 2e20 220a 2020 2020 2020 2020 2020  it. ".          
+00012650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012660: 2020 2022 436c 6f73 6520 7468 6520 7772     "Close the wr
+00012670: 6974 696e 6720 6861 6e64 6c65 2062 6566  iting handle bef
+00012680: 6f72 6520 636c 6f73 696e 6720 7468 6520  ore closing the 
+00012690: 7a69 702e 2229 0a0a 2020 2020 2020 2020  zip.")..        
+000126a0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+000126b0: 2069 6620 7365 6c66 2e6d 6f64 6520 696e   if self.mode in
+000126c0: 2028 2777 272c 2027 7827 2c20 2761 2729   ('w', 'x', 'a')
+000126d0: 2061 6e64 2073 656c 662e 5f64 6964 4d6f   and self._didMo
+000126e0: 6469 6679 3a20 2320 7772 6974 6520 656e  dify: # write en
+000126f0: 6469 6e67 2072 6563 6f72 6473 0a20 2020  ding records.   
+00012700: 2020 2020 2020 2020 2020 2020 2077 6974               wit
+00012710: 6820 7365 6c66 2e5f 6c6f 636b 3a0a 2020  h self._lock:.  
+00012720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012730: 2020 6966 2073 656c 662e 5f73 6565 6b61    if self._seeka
+00012740: 626c 653a 0a20 2020 2020 2020 2020 2020  ble:.           
+00012750: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00012760: 662e 6670 2e73 6565 6b28 7365 6c66 2e73  f.fp.seek(self.s
+00012770: 7461 7274 5f64 6972 290a 2020 2020 2020  tart_dir).      
+00012780: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00012790: 6c66 2e5f 7772 6974 655f 656e 645f 7265  lf._write_end_re
+000127a0: 636f 7264 2829 0a20 2020 2020 2020 2066  cord().        f
+000127b0: 696e 616c 6c79 3a0a 2020 2020 2020 2020  inally:.        
+000127c0: 2020 2020 6670 203d 2073 656c 662e 6670      fp = self.fp
+000127d0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000127e0: 662e 6670 203d 204e 6f6e 650a 2020 2020  f.fp = None.    
+000127f0: 2020 2020 2020 2020 7365 6c66 2e5f 6670          self._fp
+00012800: 636c 6f73 6528 6670 290a 0a20 2020 2064  close(fp)..    d
+00012810: 6566 205f 7772 6974 655f 656e 645f 7265  ef _write_end_re
+00012820: 636f 7264 2873 656c 6629 3a0a 2020 2020  cord(self):.    
+00012830: 2020 2020 666f 7220 7a69 6e66 6f20 696e      for zinfo in
+00012840: 2073 656c 662e 6669 6c65 6c69 7374 3a20   self.filelist: 
+00012850: 2020 2020 2020 2020 2320 7772 6974 6520          # write 
+00012860: 6365 6e74 7261 6c20 6469 7265 6374 6f72  central director
+00012870: 790a 2020 2020 2020 2020 2020 2020 6474  y.            dt
+00012880: 203d 207a 696e 666f 2e64 6174 655f 7469   = zinfo.date_ti
+00012890: 6d65 0a20 2020 2020 2020 2020 2020 2064  me.            d
+000128a0: 6f73 6461 7465 203d 2028 6474 5b30 5d20  osdate = (dt[0] 
+000128b0: 2d20 3139 3830 2920 3c3c 2039 207c 2064  - 1980) << 9 | d
+000128c0: 745b 315d 203c 3c20 3520 7c20 6474 5b32  t[1] << 5 | dt[2
+000128d0: 5d0a 2020 2020 2020 2020 2020 2020 646f  ].            do
+000128e0: 7374 696d 6520 3d20 6474 5b33 5d20 3c3c  stime = dt[3] <<
+000128f0: 2031 3120 7c20 6474 5b34 5d20 3c3c 2035   11 | dt[4] << 5
+00012900: 207c 2028 6474 5b35 5d20 2f2f 2032 290a   | (dt[5] // 2).
+00012910: 2020 2020 2020 2020 2020 2020 6578 7472              extr
+00012920: 6120 3d20 5b5d 0a20 2020 2020 2020 2020  a = [].         
+00012930: 2020 2069 6620 7a69 6e66 6f2e 6669 6c65     if zinfo.file
+00012940: 5f73 697a 6520 3e20 5a49 5036 345f 4c49  _size > ZIP64_LI
+00012950: 4d49 5420 5c0a 2020 2020 2020 2020 2020  MIT \.          
+00012960: 2020 2020 206f 7220 7a69 6e66 6f2e 636f       or zinfo.co
+00012970: 6d70 7265 7373 5f73 697a 6520 3e20 5a49  mpress_size > ZI
+00012980: 5036 345f 4c49 4d49 543a 0a20 2020 2020  P64_LIMIT:.     
+00012990: 2020 2020 2020 2020 2020 2065 7874 7261             extra
+000129a0: 2e61 7070 656e 6428 7a69 6e66 6f2e 6669  .append(zinfo.fi
+000129b0: 6c65 5f73 697a 6529 0a20 2020 2020 2020  le_size).       
+000129c0: 2020 2020 2020 2020 2065 7874 7261 2e61           extra.a
+000129d0: 7070 656e 6428 7a69 6e66 6f2e 636f 6d70  ppend(zinfo.comp
+000129e0: 7265 7373 5f73 697a 6529 0a20 2020 2020  ress_size).     
+000129f0: 2020 2020 2020 2020 2020 2066 696c 655f             file_
+00012a00: 7369 7a65 203d 2030 7866 6666 6666 6666  size = 0xfffffff
+00012a10: 660a 2020 2020 2020 2020 2020 2020 2020  f.              
+00012a20: 2020 636f 6d70 7265 7373 5f73 697a 6520    compress_size 
+00012a30: 3d20 3078 6666 6666 6666 6666 0a20 2020  = 0xffffffff.   
+00012a40: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00012a50: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00012a60: 696c 655f 7369 7a65 203d 207a 696e 666f  ile_size = zinfo
+00012a70: 2e66 696c 655f 7369 7a65 0a20 2020 2020  .file_size.     
+00012a80: 2020 2020 2020 2020 2020 2063 6f6d 7072             compr
+00012a90: 6573 735f 7369 7a65 203d 207a 696e 666f  ess_size = zinfo
+00012aa0: 2e63 6f6d 7072 6573 735f 7369 7a65 0a0a  .compress_size..
+00012ab0: 2020 2020 2020 2020 2020 2020 6966 207a              if z
+00012ac0: 696e 666f 2e68 6561 6465 725f 6f66 6673  info.header_offs
+00012ad0: 6574 203e 205a 4950 3634 5f4c 494d 4954  et > ZIP64_LIMIT
+00012ae0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00012af0: 2020 6578 7472 612e 6170 7065 6e64 287a    extra.append(z
+00012b00: 696e 666f 2e68 6561 6465 725f 6f66 6673  info.header_offs
+00012b10: 6574 290a 2020 2020 2020 2020 2020 2020  et).            
+00012b20: 2020 2020 6865 6164 6572 5f6f 6666 7365      header_offse
+00012b30: 7420 3d20 3078 6666 6666 6666 6666 0a20  t = 0xffffffff. 
+00012b40: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00012b50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012b60: 2068 6561 6465 725f 6f66 6673 6574 203d   header_offset =
+00012b70: 207a 696e 666f 2e68 6561 6465 725f 6f66   zinfo.header_of
+00012b80: 6673 6574 0a0a 2020 2020 2020 2020 2020  fset..          
+00012b90: 2020 6578 7472 615f 6461 7461 203d 207a    extra_data = z
+00012ba0: 696e 666f 2e65 7874 7261 0a20 2020 2020  info.extra.     
+00012bb0: 2020 2020 2020 206d 696e 5f76 6572 7369         min_versi
+00012bc0: 6f6e 203d 2030 0a20 2020 2020 2020 2020  on = 0.         
+00012bd0: 2020 2069 6620 6578 7472 613a 0a20 2020     if extra:.   
+00012be0: 2020 2020 2020 2020 2020 2020 2023 2041               # A
+00012bf0: 7070 656e 6420 6120 5a49 5036 3420 6669  ppend a ZIP64 fi
+00012c00: 656c 6420 746f 2074 6865 2065 7874 7261  eld to the extra
+00012c10: 2773 0a20 2020 2020 2020 2020 2020 2020  's.             
+00012c20: 2020 2065 7874 7261 5f64 6174 6120 3d20     extra_data = 
+00012c30: 5f73 7472 6970 5f65 7874 7261 2865 7874  _strip_extra(ext
+00012c40: 7261 5f64 6174 612c 2028 312c 2929 0a20  ra_data, (1,)). 
+00012c50: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00012c60: 7874 7261 5f64 6174 6120 3d20 7374 7275  xtra_data = stru
+00012c70: 6374 2e70 6163 6b28 0a20 2020 2020 2020  ct.pack(.       
+00012c80: 2020 2020 2020 2020 2020 2020 2027 3c48               '<H
+00012c90: 4827 202b 2027 5127 2a6c 656e 2865 7874  H' + 'Q'*len(ext
+00012ca0: 7261 292c 0a20 2020 2020 2020 2020 2020  ra),.           
+00012cb0: 2020 2020 2020 2020 2031 2c20 382a 6c65           1, 8*le
+00012cc0: 6e28 6578 7472 6129 2c20 2a65 7874 7261  n(extra), *extra
+00012cd0: 2920 2b20 6578 7472 615f 6461 7461 0a0a  ) + extra_data..
+00012ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012cf0: 6d69 6e5f 7665 7273 696f 6e20 3d20 5a49  min_version = ZI
+00012d00: 5036 345f 5645 5253 494f 4e0a 0a20 2020  P64_VERSION..   
+00012d10: 2020 2020 2020 2020 2069 6620 7a69 6e66           if zinf
+00012d20: 6f2e 636f 6d70 7265 7373 5f74 7970 6520  o.compress_type 
+00012d30: 3d3d 205a 4950 5f42 5a49 5032 3a0a 2020  == ZIP_BZIP2:.  
+00012d40: 2020 2020 2020 2020 2020 2020 2020 6d69                mi
+00012d50: 6e5f 7665 7273 696f 6e20 3d20 6d61 7828  n_version = max(
+00012d60: 425a 4950 325f 5645 5253 494f 4e2c 206d  BZIP2_VERSION, m
+00012d70: 696e 5f76 6572 7369 6f6e 290a 2020 2020  in_version).    
+00012d80: 2020 2020 2020 2020 656c 6966 207a 696e          elif zin
+00012d90: 666f 2e63 6f6d 7072 6573 735f 7479 7065  fo.compress_type
+00012da0: 203d 3d20 5a49 505f 4c5a 4d41 3a0a 2020   == ZIP_LZMA:.  
+00012db0: 2020 2020 2020 2020 2020 2020 2020 6d69                mi
+00012dc0: 6e5f 7665 7273 696f 6e20 3d20 6d61 7828  n_version = max(
+00012dd0: 4c5a 4d41 5f56 4552 5349 4f4e 2c20 6d69  LZMA_VERSION, mi
+00012de0: 6e5f 7665 7273 696f 6e29 0a0a 2020 2020  n_version)..    
+00012df0: 2020 2020 2020 2020 6578 7472 6163 745f          extract_
+00012e00: 7665 7273 696f 6e20 3d20 6d61 7828 6d69  version = max(mi
+00012e10: 6e5f 7665 7273 696f 6e2c 207a 696e 666f  n_version, zinfo
+00012e20: 2e65 7874 7261 6374 5f76 6572 7369 6f6e  .extract_version
+00012e30: 290a 2020 2020 2020 2020 2020 2020 6372  ).            cr
+00012e40: 6561 7465 5f76 6572 7369 6f6e 203d 206d  eate_version = m
+00012e50: 6178 286d 696e 5f76 6572 7369 6f6e 2c20  ax(min_version, 
+00012e60: 7a69 6e66 6f2e 6372 6561 7465 5f76 6572  zinfo.create_ver
+00012e70: 7369 6f6e 290a 2020 2020 2020 2020 2020  sion).          
+00012e80: 2020 6669 6c65 6e61 6d65 2c20 666c 6167    filename, flag
+00012e90: 5f62 6974 7320 3d20 7a69 6e66 6f2e 5f65  _bits = zinfo._e
+00012ea0: 6e63 6f64 6546 696c 656e 616d 6546 6c61  ncodeFilenameFla
+00012eb0: 6773 2829 0a20 2020 2020 2020 2020 2020  gs().           
+00012ec0: 2063 656e 7464 6972 203d 2073 7472 7563   centdir = struc
+00012ed0: 742e 7061 636b 2873 7472 7563 7443 656e  t.pack(structCen
+00012ee0: 7472 616c 4469 722c 0a20 2020 2020 2020  tralDir,.       
+00012ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012f00: 2020 2020 2020 2020 2020 2073 7472 696e             strin
+00012f10: 6743 656e 7472 616c 4469 722c 2063 7265  gCentralDir, cre
+00012f20: 6174 655f 7665 7273 696f 6e2c 0a20 2020  ate_version,.   
+00012f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012f40: 2020 2020 2020 2020 2020 2020 2020 207a                 z
+00012f50: 696e 666f 2e63 7265 6174 655f 7379 7374  info.create_syst
+00012f60: 656d 2c20 6578 7472 6163 745f 7665 7273  em, extract_vers
+00012f70: 696f 6e2c 207a 696e 666f 2e72 6573 6572  ion, zinfo.reser
+00012f80: 7665 642c 0a20 2020 2020 2020 2020 2020  ved,.           
+00012f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012fa0: 2020 2020 2020 2066 6c61 675f 6269 7473         flag_bits
+00012fb0: 2c20 7a69 6e66 6f2e 636f 6d70 7265 7373  , zinfo.compress
+00012fc0: 5f74 7970 652c 2064 6f73 7469 6d65 2c20  _type, dostime, 
+00012fd0: 646f 7364 6174 652c 0a20 2020 2020 2020  dosdate,.       
+00012fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012ff0: 2020 2020 2020 2020 2020 207a 696e 666f             zinfo
+00013000: 2e43 5243 2c20 636f 6d70 7265 7373 5f73  .CRC, compress_s
+00013010: 697a 652c 2066 696c 655f 7369 7a65 2c0a  ize, file_size,.
+00013020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013040: 2020 6c65 6e28 6669 6c65 6e61 6d65 292c    len(filename),
+00013050: 206c 656e 2865 7874 7261 5f64 6174 6129   len(extra_data)
+00013060: 2c20 6c65 6e28 7a69 6e66 6f2e 636f 6d6d  , len(zinfo.comm
+00013070: 656e 7429 2c0a 2020 2020 2020 2020 2020  ent),.          
+00013080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013090: 2020 2020 2020 2020 302c 207a 696e 666f          0, zinfo
+000130a0: 2e69 6e74 6572 6e61 6c5f 6174 7472 2c20  .internal_attr, 
+000130b0: 7a69 6e66 6f2e 6578 7465 726e 616c 5f61  zinfo.external_a
+000130c0: 7474 722c 0a20 2020 2020 2020 2020 2020  ttr,.           
+000130d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000130e0: 2020 2020 2020 2068 6561 6465 725f 6f66         header_of
+000130f0: 6673 6574 290a 2020 2020 2020 2020 2020  fset).          
+00013100: 2020 7365 6c66 2e66 702e 7772 6974 6528    self.fp.write(
+00013110: 6365 6e74 6469 7229 0a20 2020 2020 2020  centdir).       
+00013120: 2020 2020 2073 656c 662e 6670 2e77 7269       self.fp.wri
+00013130: 7465 2866 696c 656e 616d 6529 0a20 2020  te(filename).   
+00013140: 2020 2020 2020 2020 2073 656c 662e 6670           self.fp
+00013150: 2e77 7269 7465 2865 7874 7261 5f64 6174  .write(extra_dat
+00013160: 6129 0a20 2020 2020 2020 2020 2020 2073  a).            s
+00013170: 656c 662e 6670 2e77 7269 7465 287a 696e  elf.fp.write(zin
+00013180: 666f 2e63 6f6d 6d65 6e74 290a 0a20 2020  fo.comment)..   
+00013190: 2020 2020 2070 6f73 3220 3d20 7365 6c66       pos2 = self
+000131a0: 2e66 702e 7465 6c6c 2829 0a20 2020 2020  .fp.tell().     
+000131b0: 2020 2023 2057 7269 7465 2065 6e64 2d6f     # Write end-o
+000131c0: 662d 7a69 702d 6172 6368 6976 6520 7265  f-zip-archive re
+000131d0: 636f 7264 0a20 2020 2020 2020 2063 656e  cord.        cen
+000131e0: 7444 6972 436f 756e 7420 3d20 6c65 6e28  tDirCount = len(
+000131f0: 7365 6c66 2e66 696c 656c 6973 7429 0a20  self.filelist). 
+00013200: 2020 2020 2020 2063 656e 7444 6972 5369         centDirSi
+00013210: 7a65 203d 2070 6f73 3220 2d20 7365 6c66  ze = pos2 - self
+00013220: 2e73 7461 7274 5f64 6972 0a20 2020 2020  .start_dir.     
+00013230: 2020 2063 656e 7444 6972 4f66 6673 6574     centDirOffset
+00013240: 203d 2073 656c 662e 7374 6172 745f 6469   = self.start_di
+00013250: 720a 2020 2020 2020 2020 7265 7175 6972  r.        requir
+00013260: 6573 5f7a 6970 3634 203d 204e 6f6e 650a  es_zip64 = None.
+00013270: 2020 2020 2020 2020 6966 2063 656e 7444          if centD
+00013280: 6972 436f 756e 7420 3e20 5a49 505f 4649  irCount > ZIP_FI
+00013290: 4c45 434f 554e 545f 4c49 4d49 543a 0a20  LECOUNT_LIMIT:. 
+000132a0: 2020 2020 2020 2020 2020 2072 6571 7569             requi
+000132b0: 7265 735f 7a69 7036 3420 3d20 2246 696c  res_zip64 = "Fil
+000132c0: 6573 2063 6f75 6e74 220a 2020 2020 2020  es count".      
+000132d0: 2020 656c 6966 2063 656e 7444 6972 4f66    elif centDirOf
+000132e0: 6673 6574 203e 205a 4950 3634 5f4c 494d  fset > ZIP64_LIM
+000132f0: 4954 3a0a 2020 2020 2020 2020 2020 2020  IT:.            
+00013300: 7265 7175 6972 6573 5f7a 6970 3634 203d  requires_zip64 =
+00013310: 2022 4365 6e74 7261 6c20 6469 7265 6374   "Central direct
+00013320: 6f72 7920 6f66 6673 6574 220a 2020 2020  ory offset".    
+00013330: 2020 2020 656c 6966 2063 656e 7444 6972      elif centDir
+00013340: 5369 7a65 203e 205a 4950 3634 5f4c 494d  Size > ZIP64_LIM
+00013350: 4954 3a0a 2020 2020 2020 2020 2020 2020  IT:.            
+00013360: 7265 7175 6972 6573 5f7a 6970 3634 203d  requires_zip64 =
+00013370: 2022 4365 6e74 7261 6c20 6469 7265 6374   "Central direct
+00013380: 6f72 7920 7369 7a65 220a 2020 2020 2020  ory size".      
+00013390: 2020 6966 2072 6571 7569 7265 735f 7a69    if requires_zi
+000133a0: 7036 343a 0a20 2020 2020 2020 2020 2020  p64:.           
+000133b0: 2023 204e 6565 6420 746f 2077 7269 7465   # Need to write
+000133c0: 2074 6865 205a 4950 3634 2065 6e64 2d6f   the ZIP64 end-o
+000133d0: 662d 6172 6368 6976 6520 7265 636f 7264  f-archive record
+000133e0: 730a 2020 2020 2020 2020 2020 2020 6966  s.            if
+000133f0: 206e 6f74 2073 656c 662e 5f61 6c6c 6f77   not self._allow
+00013400: 5a69 7036 343a 0a20 2020 2020 2020 2020  Zip64:.         
+00013410: 2020 2020 2020 2072 6169 7365 204c 6172         raise Lar
+00013420: 6765 5a69 7046 696c 6528 7265 7175 6972  geZipFile(requir
+00013430: 6573 5f7a 6970 3634 202b 0a20 2020 2020  es_zip64 +.     
+00013440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013450: 2020 2020 2020 2020 2020 2020 2020 2220                " 
+00013460: 776f 756c 6420 7265 7175 6972 6520 5a49  would require ZI
+00013470: 5036 3420 6578 7465 6e73 696f 6e73 2229  P64 extensions")
+00013480: 0a20 2020 2020 2020 2020 2020 207a 6970  .            zip
+00013490: 3634 656e 6472 6563 203d 2073 7472 7563  64endrec = struc
+000134a0: 742e 7061 636b 280a 2020 2020 2020 2020  t.pack(.        
+000134b0: 2020 2020 2020 2020 7374 7275 6374 456e          structEn
+000134c0: 6441 7263 6869 7665 3634 2c20 7374 7269  dArchive64, stri
+000134d0: 6e67 456e 6441 7263 6869 7665 3634 2c0a  ngEndArchive64,.
+000134e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000134f0: 3434 2c20 3435 2c20 3435 2c20 302c 2030  44, 45, 45, 0, 0
+00013500: 2c20 6365 6e74 4469 7243 6f75 6e74 2c20  , centDirCount, 
+00013510: 6365 6e74 4469 7243 6f75 6e74 2c0a 2020  centDirCount,.  
+00013520: 2020 2020 2020 2020 2020 2020 2020 6365                ce
+00013530: 6e74 4469 7253 697a 652c 2063 656e 7444  ntDirSize, centD
+00013540: 6972 4f66 6673 6574 290a 2020 2020 2020  irOffset).      
+00013550: 2020 2020 2020 7365 6c66 2e66 702e 7772        self.fp.wr
+00013560: 6974 6528 7a69 7036 3465 6e64 7265 6329  ite(zip64endrec)
+00013570: 0a0a 2020 2020 2020 2020 2020 2020 7a69  ..            zi
+00013580: 7036 346c 6f63 7265 6320 3d20 7374 7275  p64locrec = stru
+00013590: 6374 2e70 6163 6b28 0a20 2020 2020 2020  ct.pack(.       
+000135a0: 2020 2020 2020 2020 2073 7472 7563 7445           structE
+000135b0: 6e64 4172 6368 6976 6536 344c 6f63 6174  ndArchive64Locat
+000135c0: 6f72 2c0a 2020 2020 2020 2020 2020 2020  or,.            
+000135d0: 2020 2020 7374 7269 6e67 456e 6441 7263      stringEndArc
+000135e0: 6869 7665 3634 4c6f 6361 746f 722c 2030  hive64Locator, 0
+000135f0: 2c20 706f 7332 2c20 3129 0a20 2020 2020  , pos2, 1).     
+00013600: 2020 2020 2020 2073 656c 662e 6670 2e77         self.fp.w
+00013610: 7269 7465 287a 6970 3634 6c6f 6372 6563  rite(zip64locrec
+00013620: 290a 2020 2020 2020 2020 2020 2020 6365  ).            ce
+00013630: 6e74 4469 7243 6f75 6e74 203d 206d 696e  ntDirCount = min
+00013640: 2863 656e 7444 6972 436f 756e 742c 2030  (centDirCount, 0
+00013650: 7846 4646 4629 0a20 2020 2020 2020 2020  xFFFF).         
+00013660: 2020 2063 656e 7444 6972 5369 7a65 203d     centDirSize =
+00013670: 206d 696e 2863 656e 7444 6972 5369 7a65   min(centDirSize
+00013680: 2c20 3078 4646 4646 4646 4646 290a 2020  , 0xFFFFFFFF).  
+00013690: 2020 2020 2020 2020 2020 6365 6e74 4469            centDi
+000136a0: 724f 6666 7365 7420 3d20 6d69 6e28 6365  rOffset = min(ce
+000136b0: 6e74 4469 724f 6666 7365 742c 2030 7846  ntDirOffset, 0xF
+000136c0: 4646 4646 4646 4629 0a0a 2020 2020 2020  FFFFFFF)..      
+000136d0: 2020 656e 6472 6563 203d 2073 7472 7563    endrec = struc
+000136e0: 742e 7061 636b 2873 7472 7563 7445 6e64  t.pack(structEnd
+000136f0: 4172 6368 6976 652c 2073 7472 696e 6745  Archive, stringE
+00013700: 6e64 4172 6368 6976 652c 0a20 2020 2020  ndArchive,.     
+00013710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013720: 2020 2020 2020 2020 302c 2030 2c20 6365          0, 0, ce
+00013730: 6e74 4469 7243 6f75 6e74 2c20 6365 6e74  ntDirCount, cent
+00013740: 4469 7243 6f75 6e74 2c0a 2020 2020 2020  DirCount,.      
+00013750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013760: 2020 2020 2020 2063 656e 7444 6972 5369         centDirSi
+00013770: 7a65 2c20 6365 6e74 4469 724f 6666 7365  ze, centDirOffse
+00013780: 742c 206c 656e 2873 656c 662e 5f63 6f6d  t, len(self._com
+00013790: 6d65 6e74 2929 0a20 2020 2020 2020 2073  ment)).        s
+000137a0: 656c 662e 6670 2e77 7269 7465 2865 6e64  elf.fp.write(end
+000137b0: 7265 6329 0a20 2020 2020 2020 2073 656c  rec).        sel
+000137c0: 662e 6670 2e77 7269 7465 2873 656c 662e  f.fp.write(self.
+000137d0: 5f63 6f6d 6d65 6e74 290a 2020 2020 2020  _comment).      
+000137e0: 2020 6966 2073 656c 662e 6d6f 6465 203d    if self.mode =
+000137f0: 3d20 2261 223a 0a20 2020 2020 2020 2020  = "a":.         
+00013800: 2020 2073 656c 662e 6670 2e74 7275 6e63     self.fp.trunc
+00013810: 6174 6528 290a 2020 2020 2020 2020 7365  ate().        se
+00013820: 6c66 2e66 702e 666c 7573 6828 290a 0a20  lf.fp.flush().. 
+00013830: 2020 2064 6566 205f 6670 636c 6f73 6528     def _fpclose(
+00013840: 7365 6c66 2c20 6670 293a 0a20 2020 2020  self, fp):.     
+00013850: 2020 2061 7373 6572 7420 7365 6c66 2e5f     assert self._
+00013860: 6669 6c65 5265 6643 6e74 203e 2030 0a20  fileRefCnt > 0. 
+00013870: 2020 2020 2020 2073 656c 662e 5f66 696c         self._fil
+00013880: 6552 6566 436e 7420 2d3d 2031 0a20 2020  eRefCnt -= 1.   
+00013890: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
+000138a0: 2e5f 6669 6c65 5265 6643 6e74 2061 6e64  ._fileRefCnt and
+000138b0: 206e 6f74 2073 656c 662e 5f66 696c 6550   not self._fileP
+000138c0: 6173 7365 643a 0a20 2020 2020 2020 2020  assed:.         
+000138d0: 2020 2066 702e 636c 6f73 6528 290a 0a0a     fp.close()...
+000138e0: 636c 6173 7320 5079 5a69 7046 696c 6528  class PyZipFile(
+000138f0: 5a69 7046 696c 6529 3a0a 2020 2020 2222  ZipFile):.    ""
+00013900: 2243 6c61 7373 2074 6f20 6372 6561 7465  "Class to create
+00013910: 205a 4950 2061 7263 6869 7665 7320 7769   ZIP archives wi
+00013920: 7468 2050 7974 686f 6e20 6c69 6272 6172  th Python librar
+00013930: 7920 6669 6c65 7320 616e 6420 7061 636b  y files and pack
+00013940: 6167 6573 2e22 2222 0a0a 2020 2020 6465  ages."""..    de
+00013950: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
+00013960: 2066 696c 652c 206d 6f64 653d 2272 222c   file, mode="r",
+00013970: 2063 6f6d 7072 6573 7369 6f6e 3d5a 4950   compression=ZIP
+00013980: 5f53 544f 5245 442c 0a20 2020 2020 2020  _STORED,.       
+00013990: 2020 2020 2020 2020 2020 616c 6c6f 775a            allowZ
+000139a0: 6970 3634 3d54 7275 652c 206f 7074 696d  ip64=True, optim
+000139b0: 697a 653d 2d31 293a 0a20 2020 2020 2020  ize=-1):.       
+000139c0: 205a 6970 4669 6c65 2e5f 5f69 6e69 745f   ZipFile.__init_
+000139d0: 5f28 7365 6c66 2c20 6669 6c65 2c20 6d6f  _(self, file, mo
+000139e0: 6465 3d6d 6f64 652c 2063 6f6d 7072 6573  de=mode, compres
+000139f0: 7369 6f6e 3d63 6f6d 7072 6573 7369 6f6e  sion=compression
+00013a00: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00013a10: 2020 2020 2020 2020 2020 2061 6c6c 6f77             allow
+00013a20: 5a69 7036 343d 616c 6c6f 775a 6970 3634  Zip64=allowZip64
+00013a30: 290a 2020 2020 2020 2020 7365 6c66 2e5f  ).        self._
+00013a40: 6f70 7469 6d69 7a65 203d 206f 7074 696d  optimize = optim
+00013a50: 697a 650a 0a20 2020 2064 6566 2077 7269  ize..    def wri
+00013a60: 7465 7079 2873 656c 662c 2070 6174 686e  tepy(self, pathn
+00013a70: 616d 652c 2062 6173 656e 616d 653d 2222  ame, basename=""
+00013a80: 2c20 6669 6c74 6572 6675 6e63 3d4e 6f6e  , filterfunc=Non
+00013a90: 6529 3a0a 2020 2020 2020 2020 2222 2241  e):.        """A
+00013aa0: 6464 2061 6c6c 2066 696c 6573 2066 726f  dd all files fro
+00013ab0: 6d20 2270 6174 686e 616d 6522 2074 6f20  m "pathname" to 
+00013ac0: 7468 6520 5a49 5020 6172 6368 6976 652e  the ZIP archive.
+00013ad0: 0a0a 2020 2020 2020 2020 4966 2070 6174  ..        If pat
+00013ae0: 686e 616d 6520 6973 2061 2070 6163 6b61  hname is a packa
+00013af0: 6765 2064 6972 6563 746f 7279 2c20 7365  ge directory, se
+00013b00: 6172 6368 2074 6865 2064 6972 6563 746f  arch the directo
+00013b10: 7279 2061 6e64 0a20 2020 2020 2020 2061  ry and.        a
+00013b20: 6c6c 2070 6163 6b61 6765 2073 7562 6469  ll package subdi
+00013b30: 7265 6374 6f72 6965 7320 7265 6375 7273  rectories recurs
+00013b40: 6976 656c 7920 666f 7220 616c 6c20 2a2e  ively for all *.
+00013b50: 7079 2061 6e64 2065 6e74 6572 0a20 2020  py and enter.   
+00013b60: 2020 2020 2074 6865 206d 6f64 756c 6573       the modules
+00013b70: 2069 6e74 6f20 7468 6520 6172 6368 6976   into the archiv
+00013b80: 652e 2020 4966 2070 6174 686e 616d 6520  e.  If pathname 
+00013b90: 6973 2061 2070 6c61 696e 0a20 2020 2020  is a plain.     
+00013ba0: 2020 2064 6972 6563 746f 7279 2c20 6c69     directory, li
+00013bb0: 7374 6469 7220 2a2e 7079 2061 6e64 2065  stdir *.py and e
+00013bc0: 6e74 6572 2061 6c6c 206d 6f64 756c 6573  nter all modules
+00013bd0: 2e20 2045 6c73 652c 2070 6174 686e 616d  .  Else, pathnam
+00013be0: 650a 2020 2020 2020 2020 6d75 7374 2062  e.        must b
+00013bf0: 6520 6120 5079 7468 6f6e 202a 2e70 7920  e a Python *.py 
+00013c00: 6669 6c65 2061 6e64 2074 6865 206d 6f64  file and the mod
+00013c10: 756c 6520 7769 6c6c 2062 6520 7075 7420  ule will be put 
+00013c20: 696e 746f 2074 6865 0a20 2020 2020 2020  into the.       
+00013c30: 2061 7263 6869 7665 2e20 2041 6464 6564   archive.  Added
+00013c40: 206d 6f64 756c 6573 2061 7265 2061 6c77   modules are alw
+00013c50: 6179 7320 6d6f 6475 6c65 2e70 7963 2e0a  ays module.pyc..
+00013c60: 2020 2020 2020 2020 5468 6973 206d 6574          This met
+00013c70: 686f 6420 7769 6c6c 2063 6f6d 7069 6c65  hod will compile
+00013c80: 2074 6865 206d 6f64 756c 652e 7079 2069   the module.py i
+00013c90: 6e74 6f20 6d6f 6475 6c65 2e70 7963 2069  nto module.pyc i
+00013ca0: 660a 2020 2020 2020 2020 6e65 6365 7373  f.        necess
+00013cb0: 6172 792e 0a20 2020 2020 2020 2049 6620  ary..        If 
+00013cc0: 6669 6c74 6572 6675 6e63 2870 6174 686e  filterfunc(pathn
+00013cd0: 616d 6529 2069 7320 6769 7665 6e2c 2069  ame) is given, i
+00013ce0: 7420 6973 2063 616c 6c65 6420 7769 7468  t is called with
+00013cf0: 2065 7665 7279 2061 7267 756d 656e 742e   every argument.
+00013d00: 0a20 2020 2020 2020 2057 6865 6e20 6974  .        When it
+00013d10: 2069 7320 4661 6c73 652c 2074 6865 2066   is False, the f
+00013d20: 696c 6520 6f72 2064 6972 6563 746f 7279  ile or directory
+00013d30: 2069 7320 736b 6970 7065 642e 0a20 2020   is skipped..   
+00013d40: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00013d50: 2069 6620 7379 732e 7665 7273 696f 6e5f   if sys.version_
+00013d60: 696e 666f 3e3d 2833 2c36 293a 0a20 2020  info>=(3,6):.   
+00013d70: 2020 2020 2020 2020 2070 6174 686e 616d           pathnam
+00013d80: 6520 3d20 6f73 2e66 7370 6174 6828 7061  e = os.fspath(pa
+00013d90: 7468 6e61 6d65 290a 2020 2020 2020 2020  thname).        
+00013da0: 6966 2066 696c 7465 7266 756e 6320 616e  if filterfunc an
+00013db0: 6420 6e6f 7420 6669 6c74 6572 6675 6e63  d not filterfunc
+00013dc0: 2870 6174 686e 616d 6529 3a0a 2020 2020  (pathname):.    
+00013dd0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00013de0: 6465 6275 673a 0a20 2020 2020 2020 2020  debug:.         
+00013df0: 2020 2020 2020 206c 6162 656c 203d 2027         label = '
+00013e00: 7061 7468 2720 6966 206f 732e 7061 7468  path' if os.path
+00013e10: 2e69 7364 6972 2870 6174 686e 616d 6529  .isdir(pathname)
+00013e20: 2065 6c73 6520 2766 696c 6527 0a20 2020   else 'file'.   
+00013e30: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+00013e40: 6e74 2827 2573 2025 7220 736b 6970 7065  nt('%s %r skippe
+00013e50: 6420 6279 2066 696c 7465 7266 756e 6327  d by filterfunc'
+00013e60: 2025 2028 6c61 6265 6c2c 2070 6174 686e   % (label, pathn
+00013e70: 616d 6529 290a 2020 2020 2020 2020 2020  ame)).          
+00013e80: 2020 7265 7475 726e 0a20 2020 2020 2020    return.       
+00013e90: 2064 6972 2c20 6e61 6d65 203d 206f 732e   dir, name = os.
+00013ea0: 7061 7468 2e73 706c 6974 2870 6174 686e  path.split(pathn
+00013eb0: 616d 6529 0a20 2020 2020 2020 2069 6620  ame).        if 
+00013ec0: 6f73 2e70 6174 682e 6973 6469 7228 7061  os.path.isdir(pa
+00013ed0: 7468 6e61 6d65 293a 0a20 2020 2020 2020  thname):.       
+00013ee0: 2020 2020 2069 6e69 746e 616d 6520 3d20       initname = 
+00013ef0: 6f73 2e70 6174 682e 6a6f 696e 2870 6174  os.path.join(pat
+00013f00: 686e 616d 652c 2022 5f5f 696e 6974 5f5f  hname, "__init__
+00013f10: 2e70 7922 290a 2020 2020 2020 2020 2020  .py").          
+00013f20: 2020 6966 206f 732e 7061 7468 2e69 7366    if os.path.isf
+00013f30: 696c 6528 696e 6974 6e61 6d65 293a 0a20  ile(initname):. 
+00013f40: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00013f50: 2054 6869 7320 6973 2061 2070 6163 6b61   This is a packa
+00013f60: 6765 2064 6972 6563 746f 7279 2c20 6164  ge directory, ad
+00013f70: 6420 6974 0a20 2020 2020 2020 2020 2020  d it.           
+00013f80: 2020 2020 2069 6620 6261 7365 6e61 6d65       if basename
+00013f90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00013fa0: 2020 2020 2020 6261 7365 6e61 6d65 203d        basename =
+00013fb0: 2022 2573 2f25 7322 2025 2028 6261 7365   "%s/%s" % (base
+00013fc0: 6e61 6d65 2c20 6e61 6d65 290a 2020 2020  name, name).    
+00013fd0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00013fe0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00013ff0: 2020 2020 2020 6261 7365 6e61 6d65 203d        basename =
+00014000: 206e 616d 650a 2020 2020 2020 2020 2020   name.          
+00014010: 2020 2020 2020 6966 2073 656c 662e 6465        if self.de
+00014020: 6275 673a 0a20 2020 2020 2020 2020 2020  bug:.           
+00014030: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
+00014040: 4164 6469 6e67 2070 6163 6b61 6765 2069  Adding package i
+00014050: 6e22 2c20 7061 7468 6e61 6d65 2c20 2261  n", pathname, "a
+00014060: 7322 2c20 6261 7365 6e61 6d65 290a 2020  s", basename).  
+00014070: 2020 2020 2020 2020 2020 2020 2020 666e                fn
+00014080: 616d 652c 2061 7263 6e61 6d65 203d 2073  ame, arcname = s
+00014090: 656c 662e 5f67 6574 5f63 6f64 656e 616d  elf._get_codenam
+000140a0: 6528 696e 6974 6e61 6d65 5b30 3a2d 335d  e(initname[0:-3]
+000140b0: 2c20 6261 7365 6e61 6d65 290a 2020 2020  , basename).    
+000140c0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+000140d0: 656c 662e 6465 6275 673a 0a20 2020 2020  elf.debug:.     
+000140e0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000140f0: 7269 6e74 2822 4164 6469 6e67 222c 2061  rint("Adding", a
+00014100: 7263 6e61 6d65 290a 2020 2020 2020 2020  rcname).        
+00014110: 2020 2020 2020 2020 7365 6c66 2e77 7269          self.wri
+00014120: 7465 2866 6e61 6d65 2c20 6172 636e 616d  te(fname, arcnam
+00014130: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+00014140: 2020 2064 6972 6c69 7374 203d 2073 6f72     dirlist = sor
+00014150: 7465 6428 6f73 2e6c 6973 7464 6972 2870  ted(os.listdir(p
+00014160: 6174 686e 616d 6529 290a 2020 2020 2020  athname)).      
+00014170: 2020 2020 2020 2020 2020 6469 726c 6973            dirlis
+00014180: 742e 7265 6d6f 7665 2822 5f5f 696e 6974  t.remove("__init
+00014190: 5f5f 2e70 7922 290a 2020 2020 2020 2020  __.py").        
+000141a0: 2020 2020 2020 2020 2320 4164 6420 616c          # Add al
+000141b0: 6c20 2a2e 7079 2066 696c 6573 2061 6e64  l *.py files and
+000141c0: 2070 6163 6b61 6765 2073 7562 6469 7265   package subdire
+000141d0: 6374 6f72 6965 730a 2020 2020 2020 2020  ctories.        
+000141e0: 2020 2020 2020 2020 666f 7220 6669 6c65          for file
+000141f0: 6e61 6d65 2069 6e20 6469 726c 6973 743a  name in dirlist:
+00014200: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014210: 2020 2020 2070 6174 6820 3d20 6f73 2e70       path = os.p
+00014220: 6174 682e 6a6f 696e 2870 6174 686e 616d  ath.join(pathnam
+00014230: 652c 2066 696c 656e 616d 6529 0a20 2020  e, filename).   
+00014240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014250: 2072 6f6f 742c 2065 7874 203d 206f 732e   root, ext = os.
+00014260: 7061 7468 2e73 706c 6974 6578 7428 6669  path.splitext(fi
+00014270: 6c65 6e61 6d65 290a 2020 2020 2020 2020  lename).        
+00014280: 2020 2020 2020 2020 2020 2020 6966 206f              if o
+00014290: 732e 7061 7468 2e69 7364 6972 2870 6174  s.path.isdir(pat
+000142a0: 6829 3a0a 2020 2020 2020 2020 2020 2020  h):.            
+000142b0: 2020 2020 2020 2020 2020 2020 6966 206f              if o
+000142c0: 732e 7061 7468 2e69 7366 696c 6528 6f73  s.path.isfile(os
+000142d0: 2e70 6174 682e 6a6f 696e 2870 6174 682c  .path.join(path,
+000142e0: 2022 5f5f 696e 6974 5f5f 2e70 7922 2929   "__init__.py"))
+000142f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00014300: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00014310: 5468 6973 2069 7320 6120 7061 636b 6167  This is a packag
+00014320: 6520 6469 7265 6374 6f72 792c 2061 6464  e directory, add
+00014330: 2069 740a 2020 2020 2020 2020 2020 2020   it.            
 00014340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014350: 2020 2020 2020 2070 7269 6e74 2827 6669         print('fi
-00014360: 6c65 2025 7220 736b 6970 7065 6420 6279  le %r skipped by
-00014370: 2066 696c 7465 7266 756e 6327 2025 2070   filterfunc' % p
-00014380: 6174 6829 0a20 2020 2020 2020 2020 2020  ath).           
-00014390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000143a0: 2063 6f6e 7469 6e75 650a 2020 2020 2020   continue.      
-000143b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000143c0: 2020 666e 616d 652c 2061 7263 6e61 6d65    fname, arcname
-000143d0: 203d 2073 656c 662e 5f67 6574 5f63 6f64   = self._get_cod
-000143e0: 656e 616d 6528 7061 7468 5b30 3a2d 335d  ename(path[0:-3]
-000143f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00014400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014420: 2020 2020 2020 2020 2020 2020 2020 6261                ba
-00014430: 7365 6e61 6d65 290a 2020 2020 2020 2020  sename).        
-00014440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014450: 6966 2073 656c 662e 6465 6275 673a 0a20  if self.debug:. 
+00014350: 7365 6c66 2e77 7269 7465 7079 2870 6174  self.writepy(pat
+00014360: 682c 2062 6173 656e 616d 652c 0a20 2020  h, basename,.   
+00014370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014390: 2020 2020 2020 6669 6c74 6572 6675 6e63        filterfunc
+000143a0: 3d66 696c 7465 7266 756e 6329 2020 2320  =filterfunc)  # 
+000143b0: 5265 6375 7273 6976 6520 6361 6c6c 0a20  Recursive call. 
+000143c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000143d0: 2020 2065 6c69 6620 6578 7420 3d3d 2022     elif ext == "
+000143e0: 2e70 7922 3a0a 2020 2020 2020 2020 2020  .py":.          
+000143f0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00014400: 2066 696c 7465 7266 756e 6320 616e 6420   filterfunc and 
+00014410: 6e6f 7420 6669 6c74 6572 6675 6e63 2870  not filterfunc(p
+00014420: 6174 6829 3a0a 2020 2020 2020 2020 2020  ath):.          
+00014430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014440: 2020 6966 2073 656c 662e 6465 6275 673a    if self.debug:
+00014450: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 00014460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014470: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00014480: 2822 4164 6469 6e67 222c 2061 7263 6e61  ("Adding", arcna
-00014490: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
-000144a0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000144b0: 2e77 7269 7465 2866 6e61 6d65 2c20 6172  .write(fname, ar
-000144c0: 636e 616d 6529 0a20 2020 2020 2020 2020  cname).         
-000144d0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-000144e0: 2020 2020 2020 2020 2023 2054 6869 7320           # This 
-000144f0: 6973 204e 4f54 2061 2070 6163 6b61 6765  is NOT a package
-00014500: 2064 6972 6563 746f 7279 2c20 6164 6420   directory, add 
-00014510: 6974 7320 6669 6c65 7320 6174 2074 6f70  its files at top
-00014520: 206c 6576 656c 0a20 2020 2020 2020 2020   level.         
-00014530: 2020 2020 2020 2069 6620 7365 6c66 2e64         if self.d
-00014540: 6562 7567 3a0a 2020 2020 2020 2020 2020  ebug:.          
-00014550: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00014560: 2241 6464 696e 6720 6669 6c65 7320 6672  "Adding files fr
-00014570: 6f6d 2064 6972 6563 746f 7279 222c 2070  om directory", p
-00014580: 6174 686e 616d 6529 0a20 2020 2020 2020  athname).       
-00014590: 2020 2020 2020 2020 2066 6f72 2066 696c           for fil
-000145a0: 656e 616d 6520 696e 2073 6f72 7465 6428  ename in sorted(
-000145b0: 6f73 2e6c 6973 7464 6972 2870 6174 686e  os.listdir(pathn
-000145c0: 616d 6529 293a 0a20 2020 2020 2020 2020  ame)):.         
-000145d0: 2020 2020 2020 2020 2020 2070 6174 6820             path 
-000145e0: 3d20 6f73 2e70 6174 682e 6a6f 696e 2870  = os.path.join(p
-000145f0: 6174 686e 616d 652c 2066 696c 656e 616d  athname, filenam
-00014600: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-00014610: 2020 2020 2020 2072 6f6f 742c 2065 7874         root, ext
-00014620: 203d 206f 732e 7061 7468 2e73 706c 6974   = os.path.split
-00014630: 6578 7428 6669 6c65 6e61 6d65 290a 2020  ext(filename).  
-00014640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014650: 2020 6966 2065 7874 203d 3d20 222e 7079    if ext == ".py
-00014660: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
-00014670: 2020 2020 2020 2020 2020 2069 6620 6669             if fi
-00014680: 6c74 6572 6675 6e63 2061 6e64 206e 6f74  lterfunc and not
-00014690: 2066 696c 7465 7266 756e 6328 7061 7468   filterfunc(path
-000146a0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-000146b0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000146c0: 6620 7365 6c66 2e64 6562 7567 3a0a 2020  f self.debug:.  
-000146d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000146e0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-000146f0: 696e 7428 2766 696c 6520 2572 2073 6b69  int('file %r ski
-00014700: 7070 6564 2062 7920 6669 6c74 6572 6675  pped by filterfu
-00014710: 6e63 2720 2520 7061 7468 290a 2020 2020  nc' % path).    
+00014470: 2070 7269 6e74 2827 6669 6c65 2025 7220   print('file %r 
+00014480: 736b 6970 7065 6420 6279 2066 696c 7465  skipped by filte
+00014490: 7266 756e 6327 2025 2070 6174 6829 0a20  rfunc' % path). 
+000144a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000144b0: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
+000144c0: 6e75 650a 2020 2020 2020 2020 2020 2020  nue.            
+000144d0: 2020 2020 2020 2020 2020 2020 666e 616d              fnam
+000144e0: 652c 2061 7263 6e61 6d65 203d 2073 656c  e, arcname = sel
+000144f0: 662e 5f67 6574 5f63 6f64 656e 616d 6528  f._get_codename(
+00014500: 7061 7468 5b30 3a2d 335d 2c0a 2020 2020  path[0:-3],.    
+00014510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014540: 2020 2020 2020 2020 6261 7365 6e61 6d65          basename
+00014550: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00014560: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+00014570: 662e 6465 6275 673a 0a20 2020 2020 2020  f.debug:.       
+00014580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014590: 2020 2020 2070 7269 6e74 2822 4164 6469       print("Addi
+000145a0: 6e67 222c 2061 7263 6e61 6d65 290a 2020  ng", arcname).  
+000145b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000145c0: 2020 2020 2020 7365 6c66 2e77 7269 7465        self.write
+000145d0: 2866 6e61 6d65 2c20 6172 636e 616d 6529  (fname, arcname)
+000145e0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+000145f0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00014600: 2020 2023 2054 6869 7320 6973 204e 4f54     # This is NOT
+00014610: 2061 2070 6163 6b61 6765 2064 6972 6563   a package direc
+00014620: 746f 7279 2c20 6164 6420 6974 7320 6669  tory, add its fi
+00014630: 6c65 7320 6174 2074 6f70 206c 6576 656c  les at top level
+00014640: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014650: 2069 6620 7365 6c66 2e64 6562 7567 3a0a   if self.debug:.
+00014660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014670: 2020 2020 7072 696e 7428 2241 6464 696e      print("Addin
+00014680: 6720 6669 6c65 7320 6672 6f6d 2064 6972  g files from dir
+00014690: 6563 746f 7279 222c 2070 6174 686e 616d  ectory", pathnam
+000146a0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+000146b0: 2020 2066 6f72 2066 696c 656e 616d 6520     for filename 
+000146c0: 696e 2073 6f72 7465 6428 6f73 2e6c 6973  in sorted(os.lis
+000146d0: 7464 6972 2870 6174 686e 616d 6529 293a  tdir(pathname)):
+000146e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000146f0: 2020 2020 2070 6174 6820 3d20 6f73 2e70       path = os.p
+00014700: 6174 682e 6a6f 696e 2870 6174 686e 616d  ath.join(pathnam
+00014710: 652c 2066 696c 656e 616d 6529 0a20 2020  e, filename).   
 00014720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014730: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
-00014740: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014750: 2020 2020 2020 2020 2066 6e61 6d65 2c20           fname, 
-00014760: 6172 636e 616d 6520 3d20 7365 6c66 2e5f  arcname = self._
-00014770: 6765 745f 636f 6465 6e61 6d65 2870 6174  get_codename(pat
-00014780: 685b 303a 2d33 5d2c 0a20 2020 2020 2020  h[0:-3],.       
-00014790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000147a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000147b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000147c0: 2020 2020 2062 6173 656e 616d 6529 0a20       basename). 
-000147d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000147e0: 2020 2020 2020 2069 6620 7365 6c66 2e64         if self.d
-000147f0: 6562 7567 3a0a 2020 2020 2020 2020 2020  ebug:.          
-00014800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014810: 2020 7072 696e 7428 2241 6464 696e 6722    print("Adding"
-00014820: 2c20 6172 636e 616d 6529 0a20 2020 2020  , arcname).     
-00014830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014840: 2020 2073 656c 662e 7772 6974 6528 666e     self.write(fn
-00014850: 616d 652c 2061 7263 6e61 6d65 290a 2020  ame, arcname).  
-00014860: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00014870: 2020 2020 2020 2020 6966 2070 6174 686e          if pathn
-00014880: 616d 655b 2d33 3a5d 2021 3d20 222e 7079  ame[-3:] != ".py
-00014890: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
-000148a0: 2020 2072 6169 7365 2052 756e 7469 6d65     raise Runtime
-000148b0: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
-000148c0: 2020 2020 2020 2020 2020 2027 4669 6c65             'File
-000148d0: 7320 6164 6465 6420 7769 7468 2077 7269  s added with wri
-000148e0: 7465 7079 2829 206d 7573 7420 656e 6420  tepy() must end 
-000148f0: 7769 7468 2022 2e70 7922 2729 0a20 2020  with ".py"').   
-00014900: 2020 2020 2020 2020 2066 6e61 6d65 2c20           fname, 
-00014910: 6172 636e 616d 6520 3d20 7365 6c66 2e5f  arcname = self._
-00014920: 6765 745f 636f 6465 6e61 6d65 2870 6174  get_codename(pat
-00014930: 686e 616d 655b 303a 2d33 5d2c 2062 6173  hname[0:-3], bas
-00014940: 656e 616d 6529 0a20 2020 2020 2020 2020  ename).         
-00014950: 2020 2069 6620 7365 6c66 2e64 6562 7567     if self.debug
-00014960: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00014970: 2020 7072 696e 7428 2241 6464 696e 6720    print("Adding 
-00014980: 6669 6c65 222c 2061 7263 6e61 6d65 290a  file", arcname).
-00014990: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000149a0: 2e77 7269 7465 2866 6e61 6d65 2c20 6172  .write(fname, ar
-000149b0: 636e 616d 6529 0a0a 2020 2020 6465 6620  cname)..    def 
-000149c0: 5f67 6574 5f63 6f64 656e 616d 6528 7365  _get_codename(se
-000149d0: 6c66 2c20 7061 7468 6e61 6d65 2c20 6261  lf, pathname, ba
-000149e0: 7365 6e61 6d65 293a 0a20 2020 2020 2020  sename):.       
-000149f0: 2022 2222 5265 7475 726e 2028 6669 6c65   """Return (file
-00014a00: 6e61 6d65 2c20 6172 6368 6976 656e 616d  name, archivenam
-00014a10: 6529 2066 6f72 2074 6865 2070 6174 682e  e) for the path.
-00014a20: 0a0a 2020 2020 2020 2020 4769 7665 6e20  ..        Given 
-00014a30: 6120 6d6f 6475 6c65 206e 616d 6520 7061  a module name pa
-00014a40: 7468 2c20 7265 7475 726e 2074 6865 2063  th, return the c
-00014a50: 6f72 7265 6374 2066 696c 6520 7061 7468  orrect file path
-00014a60: 2061 6e64 0a20 2020 2020 2020 2061 7263   and.        arc
-00014a70: 6869 7665 206e 616d 652c 2063 6f6d 7069  hive name, compi
-00014a80: 6c69 6e67 2069 6620 6e65 6365 7373 6172  ling if necessar
-00014a90: 792e 2020 466f 7220 6578 616d 706c 652c  y.  For example,
-00014aa0: 2067 6976 656e 0a20 2020 2020 2020 202f   given.        /
-00014ab0: 7079 7468 6f6e 2f6c 6962 2f73 7472 696e  python/lib/strin
-00014ac0: 672c 2072 6574 7572 6e20 282f 7079 7468  g, return (/pyth
-00014ad0: 6f6e 2f6c 6962 2f73 7472 696e 672e 7079  on/lib/string.py
-00014ae0: 632c 2073 7472 696e 6729 2e0a 2020 2020  c, string)..    
-00014af0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00014b00: 6465 6620 5f63 6f6d 7069 6c65 2866 696c  def _compile(fil
-00014b10: 652c 206f 7074 696d 697a 653d 2d31 293a  e, optimize=-1):
-00014b20: 0a20 2020 2020 2020 2020 2020 2069 6d70  .            imp
-00014b30: 6f72 7420 7079 5f63 6f6d 7069 6c65 0a20  ort py_compile. 
-00014b40: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-00014b50: 6c66 2e64 6562 7567 3a0a 2020 2020 2020  lf.debug:.      
-00014b60: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00014b70: 2243 6f6d 7069 6c69 6e67 222c 2066 696c  "Compiling", fil
-00014b80: 6529 0a20 2020 2020 2020 2020 2020 2074  e).            t
-00014b90: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-00014ba0: 2020 2020 7079 5f63 6f6d 7069 6c65 2e63      py_compile.c
-00014bb0: 6f6d 7069 6c65 2866 696c 652c 2064 6f72  ompile(file, dor
-00014bc0: 6169 7365 3d54 7275 652c 206f 7074 696d  aise=True, optim
-00014bd0: 697a 653d 6f70 7469 6d69 7a65 290a 2020  ize=optimize).  
-00014be0: 2020 2020 2020 2020 2020 6578 6365 7074            except
-00014bf0: 2070 795f 636f 6d70 696c 652e 5079 436f   py_compile.PyCo
-00014c00: 6d70 696c 6545 7272 6f72 2061 7320 6572  mpileError as er
-00014c10: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
-00014c20: 2020 2070 7269 6e74 2865 7272 2e6d 7367     print(err.msg
-00014c30: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00014c40: 2020 7265 7475 726e 2046 616c 7365 0a20    return False. 
-00014c50: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00014c60: 6e20 5472 7565 0a0a 2020 2020 2020 2020  n True..        
-00014c70: 6669 6c65 5f70 7920 203d 2070 6174 686e  file_py  = pathn
-00014c80: 616d 6520 2b20 222e 7079 220a 2020 2020  ame + ".py".    
-00014c90: 2020 2020 6669 6c65 5f70 7963 203d 2070      file_pyc = p
-00014ca0: 6174 686e 616d 6520 2b20 222e 7079 6322  athname + ".pyc"
-00014cb0: 0a20 2020 2020 2020 2066 696c 655f 7079  .        file_py
-00014cc0: 6f20 3d20 7061 7468 6e61 6d65 202b 2022  o = pathname + "
-00014cd0: 2e70 796f 220a 2020 2020 2020 2020 6966  .pyo".        if
-00014ce0: 2069 6d70 6f72 746c 6962 5f75 7469 6c20   importlib_util 
-00014cf0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-00014d00: 2020 2020 2020 2020 2070 7963 6163 6865           pycache
-00014d10: 5f6f 7074 3020 3d20 696d 706f 7274 6c69  _opt0 = importli
-00014d20: 625f 7574 696c 2e63 6163 6865 5f66 726f  b_util.cache_fro
-00014d30: 6d5f 736f 7572 6365 2866 696c 655f 7079  m_source(file_py
-00014d40: 2c20 6f70 7469 6d69 7a61 7469 6f6e 3d27  , optimization='
-00014d50: 2729 0a20 2020 2020 2020 2020 2020 2070  ').            p
-00014d60: 7963 6163 6865 5f6f 7074 3120 3d20 696d  ycache_opt1 = im
-00014d70: 706f 7274 6c69 625f 7574 696c 2e63 6163  portlib_util.cac
-00014d80: 6865 5f66 726f 6d5f 736f 7572 6365 2866  he_from_source(f
-00014d90: 696c 655f 7079 2c20 6f70 7469 6d69 7a61  ile_py, optimiza
-00014da0: 7469 6f6e 3d31 290a 2020 2020 2020 2020  tion=1).        
-00014db0: 2020 2020 7079 6361 6368 655f 6f70 7432      pycache_opt2
-00014dc0: 203d 2069 6d70 6f72 746c 6962 5f75 7469   = importlib_uti
-00014dd0: 6c2e 6361 6368 655f 6672 6f6d 5f73 6f75  l.cache_from_sou
-00014de0: 7263 6528 6669 6c65 5f70 792c 206f 7074  rce(file_py, opt
-00014df0: 696d 697a 6174 696f 6e3d 3229 0a20 2020  imization=2).   
-00014e00: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00014e10: 2020 2020 2020 2070 7963 6163 6865 5f6f         pycache_o
-00014e20: 7074 3020 3d20 6669 6c65 5f70 7963 0a20  pt0 = file_pyc. 
-00014e30: 2020 2020 2020 2020 2020 2070 7963 6163             pycac
-00014e40: 6865 5f6f 7074 3120 3d20 6669 6c65 5f70  he_opt1 = file_p
-00014e50: 796f 0a20 2020 2020 2020 2020 2020 2070  yo.            p
-00014e60: 7963 6163 6865 5f6f 7074 3220 3d20 6669  ycache_opt2 = fi
-00014e70: 6c65 5f70 796f 0a20 2020 2020 2020 2069  le_pyo.        i
-00014e80: 6620 7365 6c66 2e5f 6f70 7469 6d69 7a65  f self._optimize
-00014e90: 203d 3d20 2d31 3a0a 2020 2020 2020 2020   == -1:.        
-00014ea0: 2020 2020 2320 6c65 6761 6379 206d 6f64      # legacy mod
-00014eb0: 653a 2075 7365 2077 6861 7465 7665 7220  e: use whatever 
-00014ec0: 6669 6c65 2069 7320 7072 6573 656e 740a  file is present.
-00014ed0: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-00014ee0: 6f73 2e70 6174 682e 6973 6669 6c65 2866  os.path.isfile(f
-00014ef0: 696c 655f 7079 6329 2061 6e64 0a20 2020  ile_pyc) and.   
-00014f00: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00014f10: 732e 7374 6174 2866 696c 655f 7079 6329  s.stat(file_pyc)
-00014f20: 2e73 745f 6d74 696d 6520 3e3d 206f 732e  .st_mtime >= os.
-00014f30: 7374 6174 2866 696c 655f 7079 292e 7374  stat(file_py).st
-00014f40: 5f6d 7469 6d65 293a 0a20 2020 2020 2020  _mtime):.       
-00014f50: 2020 2020 2020 2020 2023 2055 7365 202e           # Use .
-00014f60: 7079 6320 6669 6c65 2e0a 2020 2020 2020  pyc file..      
-00014f70: 2020 2020 2020 2020 2020 6172 636e 616d            arcnam
-00014f80: 6520 3d20 666e 616d 6520 3d20 6669 6c65  e = fname = file
-00014f90: 5f70 7963 0a20 2020 2020 2020 2020 2020  _pyc.           
-00014fa0: 2065 6c69 6620 286f 732e 7061 7468 2e69   elif (os.path.i
-00014fb0: 7366 696c 6528 7079 6361 6368 655f 6f70  sfile(pycache_op
-00014fc0: 7430 2920 616e 640a 2020 2020 2020 2020  t0) and.        
-00014fd0: 2020 2020 2020 2020 2020 6f73 2e73 7461            os.sta
-00014fe0: 7428 7079 6361 6368 655f 6f70 7430 292e  t(pycache_opt0).
-00014ff0: 7374 5f6d 7469 6d65 203e 3d20 6f73 2e73  st_mtime >= os.s
-00015000: 7461 7428 6669 6c65 5f70 7929 2e73 745f  tat(file_py).st_
-00015010: 6d74 696d 6529 3a0a 2020 2020 2020 2020  mtime):.        
-00015020: 2020 2020 2020 2020 2320 5573 6520 7468          # Use th
-00015030: 6520 5f5f 7079 6361 6368 655f 5f2f 2a2e  e __pycache__/*.
-00015040: 7079 6320 6669 6c65 2c20 6275 7420 7772  pyc file, but wr
-00015050: 6974 6520 6974 2074 6f20 7468 6520 6c65  ite it to the le
-00015060: 6761 6379 2070 7963 0a20 2020 2020 2020  gacy pyc.       
-00015070: 2020 2020 2020 2020 2023 2066 696c 6520           # file 
-00015080: 6e61 6d65 2069 6e20 7468 6520 6172 6368  name in the arch
-00015090: 6976 652e 0a20 2020 2020 2020 2020 2020  ive..           
-000150a0: 2020 2020 2066 6e61 6d65 203d 2070 7963       fname = pyc
-000150b0: 6163 6865 5f6f 7074 300a 2020 2020 2020  ache_opt0.      
-000150c0: 2020 2020 2020 2020 2020 6172 636e 616d            arcnam
-000150d0: 6520 3d20 6669 6c65 5f70 7963 0a20 2020  e = file_pyc.   
-000150e0: 2020 2020 2020 2020 2065 6c69 6620 286f           elif (o
-000150f0: 732e 7061 7468 2e69 7366 696c 6528 7079  s.path.isfile(py
-00015100: 6361 6368 655f 6f70 7431 2920 616e 640a  cache_opt1) and.
-00015110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015120: 2020 6f73 2e73 7461 7428 7079 6361 6368    os.stat(pycach
-00015130: 655f 6f70 7431 292e 7374 5f6d 7469 6d65  e_opt1).st_mtime
-00015140: 203e 3d20 6f73 2e73 7461 7428 6669 6c65   >= os.stat(file
-00015150: 5f70 7929 2e73 745f 6d74 696d 6529 3a0a  _py).st_mtime):.
-00015160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015170: 2320 5573 6520 7468 6520 5f5f 7079 6361  # Use the __pyca
-00015180: 6368 655f 5f2f 2a2e 7079 6320 6669 6c65  che__/*.pyc file
-00015190: 2c20 6275 7420 7772 6974 6520 6974 2074  , but write it t
-000151a0: 6f20 7468 6520 6c65 6761 6379 2070 7963  o the legacy pyc
-000151b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000151c0: 2023 2066 696c 6520 6e61 6d65 2069 6e20   # file name in 
-000151d0: 7468 6520 6172 6368 6976 652e 0a20 2020  the archive..   
-000151e0: 2020 2020 2020 2020 2020 2020 2066 6e61               fna
-000151f0: 6d65 203d 2070 7963 6163 6865 5f6f 7074  me = pycache_opt
-00015200: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
-00015210: 2020 6172 636e 616d 6520 3d20 6669 6c65    arcname = file
-00015220: 5f70 7963 0a20 2020 2020 2020 2020 2020  _pyc.           
-00015230: 2065 6c69 6620 286f 732e 7061 7468 2e69   elif (os.path.i
-00015240: 7366 696c 6528 7079 6361 6368 655f 6f70  sfile(pycache_op
-00015250: 7432 2920 616e 640a 2020 2020 2020 2020  t2) and.        
-00015260: 2020 2020 2020 2020 2020 6f73 2e73 7461            os.sta
-00015270: 7428 7079 6361 6368 655f 6f70 7432 292e  t(pycache_opt2).
-00015280: 7374 5f6d 7469 6d65 203e 3d20 6f73 2e73  st_mtime >= os.s
-00015290: 7461 7428 6669 6c65 5f70 7929 2e73 745f  tat(file_py).st_
-000152a0: 6d74 696d 6529 3a0a 2020 2020 2020 2020  mtime):.        
-000152b0: 2020 2020 2020 2020 2320 5573 6520 7468          # Use th
-000152c0: 6520 5f5f 7079 6361 6368 655f 5f2f 2a2e  e __pycache__/*.
-000152d0: 7079 6320 6669 6c65 2c20 6275 7420 7772  pyc file, but wr
-000152e0: 6974 6520 6974 2074 6f20 7468 6520 6c65  ite it to the le
-000152f0: 6761 6379 2070 7963 0a20 2020 2020 2020  gacy pyc.       
-00015300: 2020 2020 2020 2020 2023 2066 696c 6520           # file 
-00015310: 6e61 6d65 2069 6e20 7468 6520 6172 6368  name in the arch
-00015320: 6976 652e 0a20 2020 2020 2020 2020 2020  ive..           
-00015330: 2020 2020 2066 6e61 6d65 203d 2070 7963       fname = pyc
-00015340: 6163 6865 5f6f 7074 320a 2020 2020 2020  ache_opt2.      
-00015350: 2020 2020 2020 2020 2020 6172 636e 616d            arcnam
-00015360: 6520 3d20 6669 6c65 5f70 7963 0a20 2020  e = file_pyc.   
-00015370: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00015380: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00015390: 2043 6f6d 7069 6c65 2070 7920 696e 746f   Compile py into
-000153a0: 2050 4550 2033 3134 3720 7079 6320 6669   PEP 3147 pyc fi
-000153b0: 6c65 2e0a 2020 2020 2020 2020 2020 2020  le..            
-000153c0: 2020 2020 6966 205f 636f 6d70 696c 6528      if _compile(
-000153d0: 6669 6c65 5f70 7929 3a0a 2020 2020 2020  file_py):.      
-000153e0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000153f0: 2073 7973 2e66 6c61 6773 2e6f 7074 696d   sys.flags.optim
-00015400: 697a 6520 3d3d 2030 3a0a 2020 2020 2020  ize == 0:.      
-00015410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015420: 2020 666e 616d 6520 3d20 7079 6361 6368    fname = pycach
-00015430: 655f 6f70 7430 0a20 2020 2020 2020 2020  e_opt0.         
-00015440: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00015450: 7379 732e 666c 6167 732e 6f70 7469 6d69  sys.flags.optimi
-00015460: 7a65 203d 3d20 313a 0a20 2020 2020 2020  ze == 1:.       
-00015470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015480: 2066 6e61 6d65 203d 2070 7963 6163 6865   fname = pycache
-00015490: 5f6f 7074 310a 2020 2020 2020 2020 2020  _opt1.          
-000154a0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-000154b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000154c0: 2020 2020 2020 2020 666e 616d 6520 3d20          fname = 
-000154d0: 7079 6361 6368 655f 6f70 7432 0a20 2020  pycache_opt2.   
-000154e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000154f0: 2061 7263 6e61 6d65 203d 2066 696c 655f   arcname = file_
-00015500: 7079 630a 2020 2020 2020 2020 2020 2020  pyc.            
-00015510: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00015520: 2020 2020 2020 2020 2020 2020 2020 666e                fn
-00015530: 616d 6520 3d20 6172 636e 616d 6520 3d20  ame = arcname = 
-00015540: 6669 6c65 5f70 790a 2020 2020 2020 2020  file_py.        
-00015550: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00015560: 2020 2320 6e65 7720 6d6f 6465 3a20 7573    # new mode: us
-00015570: 6520 6769 7665 6e20 6f70 7469 6d69 7a61  e given optimiza
-00015580: 7469 6f6e 206c 6576 656c 0a20 2020 2020  tion level.     
-00015590: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
-000155a0: 6f70 7469 6d69 7a65 203d 3d20 303a 0a20  optimize == 0:. 
-000155b0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-000155c0: 6e61 6d65 203d 2070 7963 6163 6865 5f6f  name = pycache_o
-000155d0: 7074 300a 2020 2020 2020 2020 2020 2020  pt0.            
-000155e0: 2020 2020 6172 636e 616d 6520 3d20 6669      arcname = fi
-000155f0: 6c65 5f70 7963 0a20 2020 2020 2020 2020  le_pyc.         
-00015600: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00015610: 2020 2020 2020 2020 2061 7263 6e61 6d65           arcname
-00015620: 203d 2066 696c 655f 7079 630a 2020 2020   = file_pyc.    
-00015630: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-00015640: 656c 662e 5f6f 7074 696d 697a 6520 3d3d  elf._optimize ==
-00015650: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
-00015660: 2020 2020 2020 2020 666e 616d 6520 3d20          fname = 
-00015670: 7079 6361 6368 655f 6f70 7431 0a20 2020  pycache_opt1.   
-00015680: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
-00015690: 6620 7365 6c66 2e5f 6f70 7469 6d69 7a65  f self._optimize
-000156a0: 203d 3d20 323a 0a20 2020 2020 2020 2020   == 2:.         
-000156b0: 2020 2020 2020 2020 2020 2066 6e61 6d65             fname
-000156c0: 203d 2070 7963 6163 6865 5f6f 7074 320a   = pycache_opt2.
-000156d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000156e0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-000156f0: 2020 2020 2020 2020 2020 6d73 6720 3d20            msg = 
-00015700: 2269 6e76 616c 6964 2076 616c 7565 2066  "invalid value f
-00015710: 6f72 2027 6f70 7469 6d69 7a65 273a 207b  or 'optimize': {
-00015720: 2172 7d22 2e66 6f72 6d61 7428 7365 6c66  !r}".format(self
-00015730: 2e5f 6f70 7469 6d69 7a65 290a 2020 2020  ._optimize).    
-00015740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015750: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-00015760: 286d 7367 290a 2020 2020 2020 2020 2020  (msg).          
-00015770: 2020 6966 206e 6f74 2028 6f73 2e70 6174    if not (os.pat
-00015780: 682e 6973 6669 6c65 2866 6e61 6d65 2920  h.isfile(fname) 
-00015790: 616e 640a 2020 2020 2020 2020 2020 2020  and.            
-000157a0: 2020 2020 2020 2020 6f73 2e73 7461 7428          os.stat(
-000157b0: 666e 616d 6529 2e73 745f 6d74 696d 6520  fname).st_mtime 
-000157c0: 3e3d 206f 732e 7374 6174 2866 696c 655f  >= os.stat(file_
-000157d0: 7079 292e 7374 5f6d 7469 6d65 293a 0a20  py).st_mtime):. 
-000157e0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000157f0: 6620 6e6f 7420 5f63 6f6d 7069 6c65 2866  f not _compile(f
-00015800: 696c 655f 7079 2c20 6f70 7469 6d69 7a65  ile_py, optimize
-00015810: 3d73 656c 662e 5f6f 7074 696d 697a 6529  =self._optimize)
-00015820: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00015830: 2020 2020 2020 666e 616d 6520 3d20 6172        fname = ar
-00015840: 636e 616d 6520 3d20 6669 6c65 5f70 790a  cname = file_py.
-00015850: 2020 2020 2020 2020 6172 6368 6976 656e          archiven
-00015860: 616d 6520 3d20 6f73 2e70 6174 682e 7370  ame = os.path.sp
-00015870: 6c69 7428 6172 636e 616d 6529 5b31 5d0a  lit(arcname)[1].
-00015880: 2020 2020 2020 2020 6966 2062 6173 656e          if basen
-00015890: 616d 653a 0a20 2020 2020 2020 2020 2020  ame:.           
-000158a0: 2061 7263 6869 7665 6e61 6d65 203d 2022   archivename = "
-000158b0: 2573 2f25 7322 2025 2028 6261 7365 6e61  %s/%s" % (basena
-000158c0: 6d65 2c20 6172 6368 6976 656e 616d 6529  me, archivename)
-000158d0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000158e0: 2866 6e61 6d65 2c20 6172 6368 6976 656e  (fname, archiven
-000158f0: 616d 6529 0a0a 0a64 6566 205f 7061 7265  ame)...def _pare
-00015900: 6e74 7328 7061 7468 293a 0a20 2020 2022  nts(path):.    "
-00015910: 2222 0a20 2020 2047 6976 656e 2061 2070  "".    Given a p
-00015920: 6174 6820 7769 7468 2065 6c65 6d65 6e74  ath with element
-00015930: 7320 7365 7061 7261 7465 6420 6279 0a20  s separated by. 
-00015940: 2020 2070 6f73 6978 7061 7468 2e73 6570     posixpath.sep
-00015950: 2c20 6765 6e65 7261 7465 2061 6c6c 2070  , generate all p
-00015960: 6172 656e 7473 206f 6620 7468 6174 2070  arents of that p
-00015970: 6174 682e 0a0a 2020 2020 3e3e 3e20 6c69  ath...    >>> li
-00015980: 7374 285f 7061 7265 6e74 7328 2762 2f64  st(_parents('b/d
-00015990: 2729 290a 2020 2020 5b27 6227 5d0a 2020  ')).    ['b'].  
-000159a0: 2020 3e3e 3e20 6c69 7374 285f 7061 7265    >>> list(_pare
-000159b0: 6e74 7328 272f 622f 642f 2729 290a 2020  nts('/b/d/')).  
-000159c0: 2020 5b27 2f62 275d 0a20 2020 203e 3e3e    ['/b'].    >>>
-000159d0: 206c 6973 7428 5f70 6172 656e 7473 2827   list(_parents('
-000159e0: 622f 642f 662f 2729 290a 2020 2020 5b27  b/d/f/')).    ['
-000159f0: 622f 6427 2c20 2762 275d 0a20 2020 203e  b/d', 'b'].    >
-00015a00: 3e3e 206c 6973 7428 5f70 6172 656e 7473  >> list(_parents
-00015a10: 2827 6227 2929 0a20 2020 205b 5d0a 2020  ('b')).    [].  
-00015a20: 2020 3e3e 3e20 6c69 7374 285f 7061 7265    >>> list(_pare
-00015a30: 6e74 7328 2727 2929 0a20 2020 205b 5d0a  nts('')).    [].
-00015a40: 2020 2020 2222 220a 2020 2020 7265 7475      """.    retu
-00015a50: 726e 2069 7465 7274 6f6f 6c73 2e69 736c  rn itertools.isl
-00015a60: 6963 6528 5f61 6e63 6573 7472 7928 7061  ice(_ancestry(pa
-00015a70: 7468 292c 2031 2c20 4e6f 6e65 290a 0a0a  th), 1, None)...
-00015a80: 6465 6620 5f61 6e63 6573 7472 7928 7061  def _ancestry(pa
-00015a90: 7468 293a 0a20 2020 2022 2222 0a20 2020  th):.    """.   
-00015aa0: 2047 6976 656e 2061 2070 6174 6820 7769   Given a path wi
-00015ab0: 7468 2065 6c65 6d65 6e74 7320 7365 7061  th elements sepa
-00015ac0: 7261 7465 6420 6279 0a20 2020 2070 6f73  rated by.    pos
-00015ad0: 6978 7061 7468 2e73 6570 2c20 6765 6e65  ixpath.sep, gene
-00015ae0: 7261 7465 2061 6c6c 2065 6c65 6d65 6e74  rate all element
-00015af0: 7320 6f66 2074 6861 7420 7061 7468 0a0a  s of that path..
-00015b00: 2020 2020 3e3e 3e20 6c69 7374 285f 616e      >>> list(_an
-00015b10: 6365 7374 7279 2827 622f 6427 2929 0a20  cestry('b/d')). 
-00015b20: 2020 205b 2762 2f64 272c 2027 6227 5d0a     ['b/d', 'b'].
-00015b30: 2020 2020 3e3e 3e20 6c69 7374 285f 616e      >>> list(_an
-00015b40: 6365 7374 7279 2827 2f62 2f64 2f27 2929  cestry('/b/d/'))
-00015b50: 0a20 2020 205b 272f 622f 6427 2c20 272f  .    ['/b/d', '/
-00015b60: 6227 5d0a 2020 2020 3e3e 3e20 6c69 7374  b'].    >>> list
-00015b70: 285f 616e 6365 7374 7279 2827 622f 642f  (_ancestry('b/d/
-00015b80: 662f 2729 290a 2020 2020 5b27 622f 642f  f/')).    ['b/d/
-00015b90: 6627 2c20 2762 2f64 272c 2027 6227 5d0a  f', 'b/d', 'b'].
-00015ba0: 2020 2020 3e3e 3e20 6c69 7374 285f 616e      >>> list(_an
-00015bb0: 6365 7374 7279 2827 6227 2929 0a20 2020  cestry('b')).   
-00015bc0: 205b 2762 275d 0a20 2020 203e 3e3e 206c   ['b'].    >>> l
-00015bd0: 6973 7428 5f61 6e63 6573 7472 7928 2727  ist(_ancestry(''
-00015be0: 2929 0a20 2020 205b 5d0a 2020 2020 2222  )).    [].    ""
-00015bf0: 220a 2020 2020 7061 7468 203d 2070 6174  ".    path = pat
-00015c00: 682e 7273 7472 6970 2870 6f73 6978 7061  h.rstrip(posixpa
-00015c10: 7468 2e73 6570 290a 2020 2020 7768 696c  th.sep).    whil
-00015c20: 6520 7061 7468 2061 6e64 2070 6174 6820  e path and path 
-00015c30: 213d 2070 6f73 6978 7061 7468 2e73 6570  != posixpath.sep
-00015c40: 3a0a 2020 2020 2020 2020 7969 656c 6420  :.        yield 
-00015c50: 7061 7468 0a20 2020 2020 2020 2070 6174  path.        pat
-00015c60: 682c 2074 6169 6c20 3d20 706f 7369 7870  h, tail = posixp
-00015c70: 6174 682e 7370 6c69 7428 7061 7468 290a  ath.split(path).
-00015c80: 0a0a 5f64 6564 7570 6520 3d20 6469 6374  .._dedupe = dict
-00015c90: 2e66 726f 6d6b 6579 730a 2222 2244 6564  .fromkeys."""Ded
-00015ca0: 7570 6c69 6361 7465 2061 6e20 6974 6572  uplicate an iter
-00015cb0: 6162 6c65 2069 6e20 6f72 6967 696e 616c  able in original
-00015cc0: 206f 7264 6572 2222 220a 0a0a 6465 6620   order"""...def 
-00015cd0: 5f64 6966 6665 7265 6e63 6528 6d69 6e75  _difference(minu
-00015ce0: 656e 642c 2073 7562 7472 6168 656e 6429  end, subtrahend)
-00015cf0: 3a0a 2020 2020 2222 220a 2020 2020 5265  :.    """.    Re
-00015d00: 7475 726e 2069 7465 6d73 2069 6e20 6d69  turn items in mi
-00015d10: 6e75 656e 6420 6e6f 7420 696e 2073 7562  nuend not in sub
-00015d20: 7472 6168 656e 642c 2072 6574 6169 6e69  trahend, retaini
-00015d30: 6e67 206f 7264 6572 0a20 2020 2077 6974  ng order.    wit
-00015d40: 6820 4f28 3129 206c 6f6f 6b75 702e 0a20  h O(1) lookup.. 
-00015d50: 2020 2022 2222 0a20 2020 2072 6574 7572     """.    retur
-00015d60: 6e20 6974 6572 746f 6f6c 732e 6669 6c74  n itertools.filt
-00015d70: 6572 6661 6c73 6528 7365 7428 7375 6274  erfalse(set(subt
-00015d80: 7261 6865 6e64 292e 5f5f 636f 6e74 6169  rahend).__contai
-00015d90: 6e73 5f5f 2c20 6d69 6e75 656e 6429 0a0a  ns__, minuend)..
-00015da0: 0a63 6c61 7373 2043 6f6d 706c 6574 6544  .class CompleteD
-00015db0: 6972 7328 5a69 7046 696c 6529 3a0a 2020  irs(ZipFile):.  
-00015dc0: 2020 2222 220a 2020 2020 4120 5a69 7046    """.    A ZipF
-00015dd0: 696c 6520 7375 6263 6c61 7373 2074 6861  ile subclass tha
-00015de0: 7420 656e 7375 7265 7320 7468 6174 2069  t ensures that i
-00015df0: 6d70 6c69 6564 2064 6972 6563 746f 7269  mplied directori
-00015e00: 6573 0a20 2020 2061 7265 2061 6c77 6179  es.    are alway
-00015e10: 7320 696e 636c 7564 6564 2069 6e20 7468  s included in th
-00015e20: 6520 6e61 6d65 6c69 7374 2e0a 2020 2020  e namelist..    
-00015e30: 2222 220a 0a20 2020 2040 7374 6174 6963  """..    @static
-00015e40: 6d65 7468 6f64 0a20 2020 2064 6566 205f  method.    def _
-00015e50: 696d 706c 6965 645f 6469 7273 286e 616d  implied_dirs(nam
-00015e60: 6573 293a 0a20 2020 2020 2020 2070 6172  es):.        par
-00015e70: 656e 7473 203d 2069 7465 7274 6f6f 6c73  ents = itertools
-00015e80: 2e63 6861 696e 2e66 726f 6d5f 6974 6572  .chain.from_iter
-00015e90: 6162 6c65 286d 6170 285f 7061 7265 6e74  able(map(_parent
-00015ea0: 732c 206e 616d 6573 2929 0a20 2020 2020  s, names)).     
-00015eb0: 2020 2061 735f 6469 7273 203d 2028 7020     as_dirs = (p 
-00015ec0: 2b20 706f 7369 7870 6174 682e 7365 7020  + posixpath.sep 
-00015ed0: 666f 7220 7020 696e 2070 6172 656e 7473  for p in parents
-00015ee0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00015ef0: 205f 6465 6475 7065 285f 6469 6666 6572   _dedupe(_differ
-00015f00: 656e 6365 2861 735f 6469 7273 2c20 6e61  ence(as_dirs, na
-00015f10: 6d65 7329 290a 0a20 2020 2064 6566 206e  mes))..    def n
-00015f20: 616d 656c 6973 7428 7365 6c66 293a 0a20  amelist(self):. 
-00015f30: 2020 2020 2020 206e 616d 6573 203d 2073         names = s
-00015f40: 7570 6572 2843 6f6d 706c 6574 6544 6972  uper(CompleteDir
-00015f50: 732c 2073 656c 6629 2e6e 616d 656c 6973  s, self).namelis
-00015f60: 7428 290a 2020 2020 2020 2020 7265 7475  t().        retu
-00015f70: 726e 206e 616d 6573 202b 206c 6973 7428  rn names + list(
-00015f80: 7365 6c66 2e5f 696d 706c 6965 645f 6469  self._implied_di
-00015f90: 7273 286e 616d 6573 2929 0a0a 2020 2020  rs(names))..    
-00015fa0: 6465 6620 5f6e 616d 655f 7365 7428 7365  def _name_set(se
-00015fb0: 6c66 293a 0a20 2020 2020 2020 2072 6574  lf):.        ret
-00015fc0: 7572 6e20 7365 7428 7365 6c66 2e6e 616d  urn set(self.nam
-00015fd0: 656c 6973 7428 2929 0a0a 2020 2020 6465  elist())..    de
-00015fe0: 6620 7265 736f 6c76 655f 6469 7228 7365  f resolve_dir(se
-00015ff0: 6c66 2c20 6e61 6d65 293a 0a20 2020 2020  lf, name):.     
-00016000: 2020 2022 2222 0a20 2020 2020 2020 2049     """.        I
-00016010: 6620 7468 6520 6e61 6d65 2072 6570 7265  f the name repre
-00016020: 7365 6e74 7320 6120 6469 7265 6374 6f72  sents a director
-00016030: 792c 2072 6574 7572 6e20 7468 6174 206e  y, return that n
-00016040: 616d 650a 2020 2020 2020 2020 6173 2061  ame.        as a
-00016050: 2064 6972 6563 746f 7279 2028 7769 7468   directory (with
-00016060: 2074 6865 2074 7261 696c 696e 6720 736c   the trailing sl
-00016070: 6173 6829 2e0a 2020 2020 2020 2020 2222  ash)..        ""
-00016080: 220a 2020 2020 2020 2020 6e61 6d65 7320  ".        names 
-00016090: 3d20 7365 6c66 2e5f 6e61 6d65 5f73 6574  = self._name_set
-000160a0: 2829 0a20 2020 2020 2020 2064 6972 6e61  ().        dirna
-000160b0: 6d65 203d 206e 616d 6520 2b20 272f 270a  me = name + '/'.
-000160c0: 2020 2020 2020 2020 6469 725f 6d61 7463          dir_matc
-000160d0: 6820 3d20 6e61 6d65 206e 6f74 2069 6e20  h = name not in 
-000160e0: 6e61 6d65 7320 616e 6420 6469 726e 616d  names and dirnam
-000160f0: 6520 696e 206e 616d 6573 0a20 2020 2020  e in names.     
-00016100: 2020 2072 6574 7572 6e20 6469 726e 616d     return dirnam
-00016110: 6520 6966 2064 6972 5f6d 6174 6368 2065  e if dir_match e
-00016120: 6c73 6520 6e61 6d65 0a0a 2020 2020 4063  lse name..    @c
-00016130: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-00016140: 6566 206d 616b 6528 636c 732c 2073 6f75  ef make(cls, sou
-00016150: 7263 6529 3a0a 2020 2020 2020 2020 2222  rce):.        ""
-00016160: 220a 2020 2020 2020 2020 4769 7665 6e20  ".        Given 
-00016170: 6120 736f 7572 6365 2028 6669 6c65 6e61  a source (filena
-00016180: 6d65 206f 7220 7a69 7066 696c 6529 2c20  me or zipfile), 
-00016190: 7265 7475 726e 2061 6e0a 2020 2020 2020  return an.      
-000161a0: 2020 6170 7072 6f70 7269 6174 6520 436f    appropriate Co
-000161b0: 6d70 6c65 7465 4469 7273 2073 7562 636c  mpleteDirs subcl
-000161c0: 6173 732e 0a20 2020 2020 2020 2022 2222  ass..        """
-000161d0: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
-000161e0: 7374 616e 6365 2873 6f75 7263 652c 2043  stance(source, C
-000161f0: 6f6d 706c 6574 6544 6972 7329 3a0a 2020  ompleteDirs):.  
-00016200: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00016210: 2073 6f75 7263 650a 0a20 2020 2020 2020   source..       
-00016220: 2069 6620 6e6f 7420 6973 696e 7374 616e   if not isinstan
-00016230: 6365 2873 6f75 7263 652c 205a 6970 4669  ce(source, ZipFi
-00016240: 6c65 293a 0a20 2020 2020 2020 2020 2020  le):.           
-00016250: 2072 6574 7572 6e20 636c 7328 736f 7572   return cls(sour
-00016260: 6365 290a 0a20 2020 2020 2020 2023 204f  ce)..        # O
-00016270: 6e6c 7920 616c 6c6f 7720 666f 7220 4661  nly allow for Fa
-00016280: 7374 4c6f 6f6b 7570 2077 6865 6e20 7375  stLookup when su
-00016290: 7070 6c69 6564 207a 6970 6669 6c65 2069  pplied zipfile i
-000162a0: 7320 7265 6164 2d6f 6e6c 790a 2020 2020  s read-only.    
-000162b0: 2020 2020 6966 2027 7227 206e 6f74 2069      if 'r' not i
-000162c0: 6e20 736f 7572 6365 2e6d 6f64 653a 0a20  n source.mode:. 
-000162d0: 2020 2020 2020 2020 2020 2063 6c73 203d             cls =
-000162e0: 2043 6f6d 706c 6574 6544 6972 730a 0a20   CompleteDirs.. 
-000162f0: 2020 2020 2020 2073 6f75 7263 652e 5f5f         source.__
-00016300: 636c 6173 735f 5f20 3d20 636c 730a 2020  class__ = cls.  
-00016310: 2020 2020 2020 7265 7475 726e 2073 6f75        return sou
-00016320: 7263 650a 0a0a 636c 6173 7320 4661 7374  rce...class Fast
-00016330: 4c6f 6f6b 7570 2843 6f6d 706c 6574 6544  Lookup(CompleteD
-00016340: 6972 7329 3a0a 2020 2020 2222 220a 2020  irs):.    """.  
-00016350: 2020 5a69 7046 696c 6520 7375 6263 6c61    ZipFile subcla
-00016360: 7373 2074 6f20 656e 7375 7265 2069 6d70  ss to ensure imp
-00016370: 6c69 6369 740a 2020 2020 6469 7273 2065  licit.    dirs e
-00016380: 7869 7374 2061 6e64 2061 7265 2072 6573  xist and are res
-00016390: 6f6c 7665 6420 7261 7069 646c 792e 0a20  olved rapidly.. 
-000163a0: 2020 2022 2222 0a0a 2020 2020 6465 6620     """..    def 
-000163b0: 6e61 6d65 6c69 7374 2873 656c 6629 3a0a  namelist(self):.
-000163c0: 2020 2020 2020 2020 7769 7468 2073 7570          with sup
-000163d0: 7072 6573 7328 4174 7472 6962 7574 6545  press(AttributeE
-000163e0: 7272 6f72 293a 0a20 2020 2020 2020 2020  rror):.         
-000163f0: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-00016400: 5f6e 616d 6573 0a20 2020 2020 2020 2073  _names.        s
-00016410: 656c 662e 5f5f 6e61 6d65 7320 3d20 7375  elf.__names = su
-00016420: 7065 7228 4661 7374 4c6f 6f6b 7570 2c20  per(FastLookup, 
-00016430: 7365 6c66 292e 6e61 6d65 6c69 7374 2829  self).namelist()
-00016440: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00016450: 7365 6c66 2e5f 5f6e 616d 6573 0a0a 2020  self.__names..  
-00016460: 2020 6465 6620 5f6e 616d 655f 7365 7428    def _name_set(
-00016470: 7365 6c66 293a 0a20 2020 2020 2020 2077  self):.        w
-00016480: 6974 6820 7375 7070 7265 7373 2841 7474  ith suppress(Att
-00016490: 7269 6275 7465 4572 726f 7229 3a0a 2020  ributeError):.  
-000164a0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000164b0: 2073 656c 662e 5f5f 6c6f 6f6b 7570 0a20   self.__lookup. 
-000164c0: 2020 2020 2020 2073 656c 662e 5f5f 6c6f         self.__lo
-000164d0: 6f6b 7570 203d 2073 7570 6572 2846 6173  okup = super(Fas
-000164e0: 744c 6f6f 6b75 702c 2073 656c 6629 2e5f  tLookup, self)._
-000164f0: 6e61 6d65 5f73 6574 2829 0a20 2020 2020  name_set().     
-00016500: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-00016510: 5f6c 6f6f 6b75 700a 0a0a 636c 6173 7320  _lookup...class 
-00016520: 5061 7468 286f 626a 6563 7429 3a0a 2020  Path(object):.  
-00016530: 2020 2222 220a 2020 2020 4120 7061 7468    """.    A path
-00016540: 6c69 622d 636f 6d70 6174 6962 6c65 2069  lib-compatible i
-00016550: 6e74 6572 6661 6365 2066 6f72 207a 6970  nterface for zip
-00016560: 2066 696c 6573 2e0a 0a20 2020 2043 6f6e   files...    Con
-00016570: 7369 6465 7220 6120 7a69 7020 6669 6c65  sider a zip file
-00016580: 2077 6974 6820 7468 6973 2073 7472 7563   with this struc
-00016590: 7475 7265 3a3a 0a0a 2020 2020 2020 2020  ture::..        
-000165a0: 2e0a 2020 2020 2020 2020 e294 9ce2 9480  ..        ......
-000165b0: e294 8020 612e 7478 740a 2020 2020 2020  ... a.txt.      
-000165c0: 2020 e294 94e2 9480 e294 8020 620a 2020    ......... b.  
-000165d0: 2020 2020 2020 2020 2020 e294 9ce2 9480            ......
-000165e0: e294 8020 632e 7478 740a 2020 2020 2020  ... c.txt.      
-000165f0: 2020 2020 2020 e294 94e2 9480 e294 8020        ......... 
-00016600: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
-00016610: 2020 e294 94e2 9480 e294 8020 652e 7478    ......... e.tx
-00016620: 740a 0a20 2020 203e 3e3e 2064 6174 6120  t..    >>> data 
-00016630: 3d20 696f 2e42 7974 6573 494f 2829 0a20  = io.BytesIO(). 
-00016640: 2020 203e 3e3e 207a 6620 3d20 5a69 7046     >>> zf = ZipF
-00016650: 696c 6528 6461 7461 2c20 2777 2729 0a20  ile(data, 'w'). 
-00016660: 2020 203e 3e3e 207a 662e 7772 6974 6573     >>> zf.writes
-00016670: 7472 2827 612e 7478 7427 2c20 2763 6f6e  tr('a.txt', 'con
-00016680: 7465 6e74 206f 6620 6127 290a 2020 2020  tent of a').    
-00016690: 3e3e 3e20 7a66 2e77 7269 7465 7374 7228  >>> zf.writestr(
-000166a0: 2762 2f63 2e74 7874 272c 2027 636f 6e74  'b/c.txt', 'cont
-000166b0: 656e 7420 6f66 2063 2729 0a20 2020 203e  ent of c').    >
-000166c0: 3e3e 207a 662e 7772 6974 6573 7472 2827  >> zf.writestr('
-000166d0: 622f 642f 652e 7478 7427 2c20 2763 6f6e  b/d/e.txt', 'con
-000166e0: 7465 6e74 206f 6620 6527 290a 2020 2020  tent of e').    
-000166f0: 3e3e 3e20 7a66 2e66 696c 656e 616d 6520  >>> zf.filename 
-00016700: 3d20 276d 656d 2f61 6263 6465 2e7a 6970  = 'mem/abcde.zip
-00016710: 270a 0a20 2020 2050 6174 6820 6163 6365  '..    Path acce
-00016720: 7074 7320 7468 6520 7a69 7066 696c 6520  pts the zipfile 
-00016730: 6f62 6a65 6374 2069 7473 656c 6620 6f72  object itself or
-00016740: 2061 2066 696c 656e 616d 650a 0a20 2020   a filename..   
-00016750: 203e 3e3e 2072 6f6f 7420 3d20 5061 7468   >>> root = Path
-00016760: 287a 6629 0a0a 2020 2020 4672 6f6d 2074  (zf)..    From t
-00016770: 6865 7265 2c20 7365 7665 7261 6c20 7061  here, several pa
-00016780: 7468 206f 7065 7261 7469 6f6e 7320 6172  th operations ar
-00016790: 6520 6176 6169 6c61 626c 652e 0a0a 2020  e available...  
-000167a0: 2020 4469 7265 6374 6f72 7920 6974 6572    Directory iter
-000167b0: 6174 696f 6e20 2869 6e63 6c75 6469 6e67  ation (including
-000167c0: 2074 6865 207a 6970 2066 696c 6520 6974   the zip file it
-000167d0: 7365 6c66 293a 0a0a 2020 2020 3e3e 3e20  self):..    >>> 
-000167e0: 612c 2062 203d 2072 6f6f 742e 6974 6572  a, b = root.iter
-000167f0: 6469 7228 290a 2020 2020 3e3e 3e20 610a  dir().    >>> a.
-00016800: 2020 2020 5061 7468 2827 6d65 6d2f 6162      Path('mem/ab
-00016810: 6364 652e 7a69 7027 2c20 2761 2e74 7874  cde.zip', 'a.txt
-00016820: 2729 0a20 2020 203e 3e3e 2062 0a20 2020  ').    >>> b.   
-00016830: 2050 6174 6828 276d 656d 2f61 6263 6465   Path('mem/abcde
-00016840: 2e7a 6970 272c 2027 622f 2729 0a0a 2020  .zip', 'b/')..  
-00016850: 2020 6e61 6d65 2070 726f 7065 7274 793a    name property:
-00016860: 0a0a 2020 2020 3e3e 3e20 622e 6e61 6d65  ..    >>> b.name
-00016870: 0a20 2020 2027 6227 0a0a 2020 2020 6a6f  .    'b'..    jo
-00016880: 696e 2077 6974 6820 6469 7669 6465 206f  in with divide o
-00016890: 7065 7261 746f 723a 0a0a 2020 2020 3e3e  perator:..    >>
-000168a0: 3e20 6320 3d20 6220 2f20 2763 2e74 7874  > c = b / 'c.txt
-000168b0: 270a 2020 2020 3e3e 3e20 630a 2020 2020  '.    >>> c.    
-000168c0: 5061 7468 2827 6d65 6d2f 6162 6364 652e  Path('mem/abcde.
-000168d0: 7a69 7027 2c20 2762 2f63 2e74 7874 2729  zip', 'b/c.txt')
-000168e0: 0a20 2020 203e 3e3e 2063 2e6e 616d 650a  .    >>> c.name.
-000168f0: 2020 2020 2763 2e74 7874 270a 0a20 2020      'c.txt'..   
-00016900: 2052 6561 6420 7465 7874 3a0a 0a20 2020   Read text:..   
-00016910: 203e 3e3e 2063 2e72 6561 645f 7465 7874   >>> c.read_text
-00016920: 2829 0a20 2020 2027 636f 6e74 656e 7420  ().    'content 
-00016930: 6f66 2063 270a 0a20 2020 2065 7869 7374  of c'..    exist
-00016940: 656e 6365 3a0a 0a20 2020 203e 3e3e 2063  ence:..    >>> c
-00016950: 2e65 7869 7374 7328 290a 2020 2020 5472  .exists().    Tr
-00016960: 7565 0a20 2020 203e 3e3e 2028 6220 2f20  ue.    >>> (b / 
-00016970: 276d 6973 7369 6e67 2e74 7874 2729 2e65  'missing.txt').e
-00016980: 7869 7374 7328 290a 2020 2020 4661 6c73  xists().    Fals
-00016990: 650a 0a20 2020 2043 6f65 7263 696f 6e20  e..    Coercion 
-000169a0: 746f 2073 7472 696e 673a 0a0a 2020 2020  to string:..    
-000169b0: 3e3e 3e20 696d 706f 7274 206f 730a 2020  >>> import os.  
-000169c0: 2020 3e3e 3e20 7374 7228 6329 2e72 6570    >>> str(c).rep
-000169d0: 6c61 6365 286f 732e 7365 702c 2070 6f73  lace(os.sep, pos
-000169e0: 6978 7061 7468 2e73 6570 290a 2020 2020  ixpath.sep).    
-000169f0: 276d 656d 2f61 6263 6465 2e7a 6970 2f62  'mem/abcde.zip/b
-00016a00: 2f63 2e74 7874 270a 0a20 2020 2041 7420  /c.txt'..    At 
-00016a10: 7468 6520 726f 6f74 2c20 6060 6e61 6d65  the root, ``name
-00016a20: 6060 2c20 6060 6669 6c65 6e61 6d65 6060  ``, ``filename``
-00016a30: 2c20 616e 6420 6060 7061 7265 6e74 6060  , and ``parent``
-00016a40: 0a20 2020 2072 6573 6f6c 7665 2074 6f20  .    resolve to 
-00016a50: 7468 6520 7a69 7066 696c 652e 204e 6f74  the zipfile. Not
-00016a60: 6520 7468 6573 6520 6174 7472 6962 7574  e these attribut
-00016a70: 6573 2061 7265 206e 6f74 0a20 2020 2076  es are not.    v
-00016a80: 616c 6964 2061 6e64 2077 696c 6c20 7261  alid and will ra
-00016a90: 6973 6520 6120 6060 5661 6c75 6545 7272  ise a ``ValueErr
-00016aa0: 6f72 6060 2069 6620 7468 6520 7a69 7066  or`` if the zipf
-00016ab0: 696c 650a 2020 2020 6861 7320 6e6f 2066  ile.    has no f
-00016ac0: 696c 656e 616d 652e 0a0a 2020 2020 3e3e  ilename...    >>
-00016ad0: 3e20 726f 6f74 2e6e 616d 650a 2020 2020  > root.name.    
-00016ae0: 2761 6263 6465 2e7a 6970 270a 2020 2020  'abcde.zip'.    
-00016af0: 3e3e 3e20 7374 7228 726f 6f74 2e66 696c  >>> str(root.fil
-00016b00: 656e 616d 6529 2e72 6570 6c61 6365 286f  ename).replace(o
-00016b10: 732e 7365 702c 2070 6f73 6978 7061 7468  s.sep, posixpath
-00016b20: 2e73 6570 290a 2020 2020 276d 656d 2f61  .sep).    'mem/a
-00016b30: 6263 6465 2e7a 6970 270a 2020 2020 3e3e  bcde.zip'.    >>
-00016b40: 3e20 7374 7228 726f 6f74 2e70 6172 656e  > str(root.paren
-00016b50: 7429 0a20 2020 2027 6d65 6d27 0a20 2020  t).    'mem'.   
-00016b60: 2022 2222 0a0a 2020 2020 5f5f 7265 7072   """..    __repr
-00016b70: 203d 2022 7b73 656c 662e 5f5f 636c 6173   = "{self.__clas
-00016b80: 735f 5f2e 5f5f 6e61 6d65 5f5f 7d28 7b73  s__.__name__}({s
-00016b90: 656c 662e 726f 6f74 2e66 696c 656e 616d  elf.root.filenam
-00016ba0: 6521 727d 2c20 7b73 656c 662e 6174 2172  e!r}, {self.at!r
-00016bb0: 7d29 220a 0a20 2020 2064 6566 205f 5f69  })"..    def __i
-00016bc0: 6e69 745f 5f28 7365 6c66 2c20 726f 6f74  nit__(self, root
-00016bd0: 2c20 6174 3d22 2229 3a0a 2020 2020 2020  , at=""):.      
-00016be0: 2020 2222 220a 2020 2020 2020 2020 436f    """.        Co
-00016bf0: 6e73 7472 7563 7420 6120 5061 7468 2066  nstruct a Path f
-00016c00: 726f 6d20 6120 5a69 7046 696c 6520 6f72  rom a ZipFile or
-00016c10: 2066 696c 656e 616d 652e 0a0a 2020 2020   filename...    
-00016c20: 2020 2020 4e6f 7465 3a20 5768 656e 2074      Note: When t
-00016c30: 6865 2073 6f75 7263 6520 6973 2061 6e20  he source is an 
-00016c40: 6578 6973 7469 6e67 205a 6970 4669 6c65  existing ZipFile
-00016c50: 206f 626a 6563 742c 0a20 2020 2020 2020   object,.       
-00016c60: 2069 7473 2074 7970 6520 285f 5f63 6c61   its type (__cla
-00016c70: 7373 5f5f 2920 7769 6c6c 2062 6520 6d75  ss__) will be mu
-00016c80: 7461 7465 6420 746f 2061 0a20 2020 2020  tated to a.     
-00016c90: 2020 2073 7065 6369 616c 697a 6564 2074     specialized t
-00016ca0: 7970 652e 2049 6620 7468 6520 6361 6c6c  ype. If the call
-00016cb0: 6572 2077 6973 6865 7320 746f 2072 6574  er wishes to ret
-00016cc0: 6169 6e20 7468 650a 2020 2020 2020 2020  ain the.        
-00016cd0: 6f72 6967 696e 616c 2074 7970 652c 2074  original type, t
-00016ce0: 6865 2063 616c 6c65 7220 7368 6f75 6c64  he caller should
-00016cf0: 2065 6974 6865 7220 6372 6561 7465 2061   either create a
-00016d00: 0a20 2020 2020 2020 2073 6570 6172 6174  .        separat
-00016d10: 6520 5a69 7046 696c 6520 6f62 6a65 6374  e ZipFile object
-00016d20: 206f 7220 7061 7373 2061 2066 696c 656e   or pass a filen
-00016d30: 616d 652e 0a20 2020 2020 2020 2022 2222  ame..        """
-00016d40: 0a20 2020 2020 2020 2073 656c 662e 726f  .        self.ro
-00016d50: 6f74 203d 2046 6173 744c 6f6f 6b75 702e  ot = FastLookup.
-00016d60: 6d61 6b65 2872 6f6f 7429 0a20 2020 2020  make(root).     
-00016d70: 2020 2073 656c 662e 6174 203d 2061 740a     self.at = at.
-00016d80: 0a20 2020 2064 6566 206f 7065 6e28 7365  .    def open(se
-00016d90: 6c66 2c20 6d6f 6465 3d27 7227 2c20 2a61  lf, mode='r', *a
-00016da0: 7267 732c 202a 2a6b 7761 7267 7329 3a0a  rgs, **kwargs):.
-00016db0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00016dc0: 2020 2020 4f70 656e 2074 6869 7320 656e      Open this en
-00016dd0: 7472 7920 6173 2074 6578 7420 6f72 2062  try as text or b
-00016de0: 696e 6172 7920 666f 6c6c 6f77 696e 6720  inary following 
-00016df0: 7468 6520 7365 6d61 6e74 6963 730a 2020  the semantics.  
-00016e00: 2020 2020 2020 6f66 2060 6070 6174 686c        of ``pathl
-00016e10: 6962 2e50 6174 682e 6f70 656e 2829 6060  ib.Path.open()``
-00016e20: 2062 7920 7061 7373 696e 6720 6172 6775   by passing argu
-00016e30: 6d65 6e74 7320 7468 726f 7567 680a 2020  ments through.  
-00016e40: 2020 2020 2020 746f 2069 6f2e 5465 7874        to io.Text
-00016e50: 494f 5772 6170 7065 7228 292e 0a20 2020  IOWrapper()..   
-00016e60: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00016e70: 2070 7764 203d 206b 7761 7267 732e 706f   pwd = kwargs.po
-00016e80: 7028 2770 7764 272c 204e 6f6e 6529 0a20  p('pwd', None). 
-00016e90: 2020 2020 2020 2069 6620 7365 6c66 2e69         if self.i
-00016ea0: 735f 6469 7228 293a 0a20 2020 2020 2020  s_dir():.       
-00016eb0: 2020 2020 2069 6620 7379 732e 7665 7273       if sys.vers
-00016ec0: 696f 6e5f 696e 666f 5b30 5d3e 3d33 3a0a  ion_info[0]>=3:.
-00016ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016ee0: 7261 6973 6520 4973 4144 6972 6563 746f  raise IsADirecto
-00016ef0: 7279 4572 726f 7228 7365 6c66 290a 2020  ryError(self).  
-00016f00: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00016f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016f20: 7261 6973 6520 4f53 4572 726f 7228 6572  raise OSError(er
-00016f30: 726e 6f2e 4549 5344 4952 2c20 7365 6c66  rno.EISDIR, self
-00016f40: 290a 2020 2020 2020 2020 7a69 705f 6d6f  ).        zip_mo
-00016f50: 6465 203d 206d 6f64 655b 305d 0a20 2020  de = mode[0].   
-00016f60: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
-00016f70: 2e65 7869 7374 7328 2920 616e 6420 7a69  .exists() and zi
-00016f80: 705f 6d6f 6465 203d 3d20 2772 273a 0a20  p_mode == 'r':. 
-00016f90: 2020 2020 2020 2020 2020 2069 6620 7379             if sy
-00016fa0: 732e 7665 7273 696f 6e5f 696e 666f 5b30  s.version_info[0
-00016fb0: 5d3e 3d33 3a0a 2020 2020 2020 2020 2020  ]>=3:.          
-00016fc0: 2020 2020 2020 7261 6973 6520 4669 6c65        raise File
-00016fd0: 4e6f 7446 6f75 6e64 4572 726f 7228 7365  NotFoundError(se
-00016fe0: 6c66 290a 2020 2020 2020 2020 2020 2020  lf).            
-00016ff0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00017000: 2020 2020 2020 7261 6973 6520 4f53 4572        raise OSEr
-00017010: 726f 7228 6572 726e 6f2e 454e 4f45 4e54  ror(errno.ENOENT
-00017020: 2c20 7365 6c66 290a 2020 2020 2020 2020  , self).        
-00017030: 7374 7265 616d 203d 2073 656c 662e 726f  stream = self.ro
-00017040: 6f74 2e6f 7065 6e28 7365 6c66 2e61 742c  ot.open(self.at,
-00017050: 207a 6970 5f6d 6f64 652c 2070 7764 3d70   zip_mode, pwd=p
-00017060: 7764 290a 2020 2020 2020 2020 6966 2027  wd).        if '
-00017070: 6227 2069 6e20 6d6f 6465 3a0a 2020 2020  b' in mode:.    
-00017080: 2020 2020 2020 2020 6966 2061 7267 7320          if args 
-00017090: 6f72 206b 7761 7267 733a 0a20 2020 2020  or kwargs:.     
-000170a0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-000170b0: 2056 616c 7565 4572 726f 7228 2265 6e63   ValueError("enc
-000170c0: 6f64 696e 6720 6172 6773 2069 6e76 616c  oding args inval
-000170d0: 6964 2066 6f72 2062 696e 6172 7920 6f70  id for binary op
-000170e0: 6572 6174 696f 6e22 290a 2020 2020 2020  eration").      
-000170f0: 2020 2020 2020 7265 7475 726e 2073 7472        return str
-00017100: 6561 6d0a 2020 2020 2020 2020 656c 7365  eam.        else
-00017110: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00017120: 2073 7973 2e76 6572 7369 6f6e 5f69 6e66   sys.version_inf
-00017130: 6f5b 305d 3e3d 333a 0a20 2020 2020 2020  o[0]>=3:.       
-00017140: 2020 2020 2020 2020 206b 7761 7267 735b           kwargs[
-00017150: 2265 6e63 6f64 696e 6722 5d20 3d20 696f  "encoding"] = io
-00017160: 2e74 6578 745f 656e 636f 6469 6e67 286b  .text_encoding(k
-00017170: 7761 7267 732e 6765 7428 2265 6e63 6f64  wargs.get("encod
-00017180: 696e 6722 2929 0a20 2020 2020 2020 2072  ing")).        r
-00017190: 6574 7572 6e20 696f 2e54 6578 7449 4f57  eturn io.TextIOW
-000171a0: 7261 7070 6572 2873 7472 6561 6d2c 202a  rapper(stream, *
-000171b0: 6172 6773 2c20 2a2a 6b77 6172 6773 290a  args, **kwargs).
-000171c0: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
-000171d0: 2020 2064 6566 206e 616d 6528 7365 6c66     def name(self
-000171e0: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-000171f0: 6e20 5061 7468 2873 656c 662e 6174 292e  n Path(self.at).
-00017200: 6e61 6d65 206f 7220 7365 6c66 2e66 696c  name or self.fil
-00017210: 656e 616d 652e 6e61 6d65 0a0a 2020 2020  ename.name..    
-00017220: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
-00017230: 6620 6669 6c65 6e61 6d65 2873 656c 6629  f filename(self)
-00017240: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00017250: 2050 6174 6828 7365 6c66 2e72 6f6f 742e   Path(self.root.
-00017260: 6669 6c65 6e61 6d65 292e 6a6f 696e 7061  filename).joinpa
-00017270: 7468 2873 656c 662e 6174 290a 0a20 2020  th(self.at)..   
-00017280: 2064 6566 2072 6561 645f 7465 7874 2873   def read_text(s
-00017290: 656c 662c 202a 6172 6773 2c20 2a2a 6b77  elf, *args, **kw
-000172a0: 6172 6773 293a 0a20 2020 2020 2020 2069  args):.        i
-000172b0: 6620 7379 732e 7665 7273 696f 6e5f 696e  f sys.version_in
-000172c0: 666f 5b30 5d3e 3d33 3a0a 2020 2020 2020  fo[0]>=3:.      
-000172d0: 2020 2020 2020 6b77 6172 6773 5b22 656e        kwargs["en
-000172e0: 636f 6469 6e67 225d 203d 2069 6f2e 7465  coding"] = io.te
-000172f0: 7874 5f65 6e63 6f64 696e 6728 6b77 6172  xt_encoding(kwar
-00017300: 6773 2e67 6574 2822 656e 636f 6469 6e67  gs.get("encoding
-00017310: 2229 290a 2020 2020 2020 2020 7769 7468  ")).        with
-00017320: 2073 656c 662e 6f70 656e 2827 7227 2c20   self.open('r', 
-00017330: 2a61 7267 732c 202a 2a6b 7761 7267 7329  *args, **kwargs)
-00017340: 2061 7320 7374 726d 3a0a 2020 2020 2020   as strm:.      
-00017350: 2020 2020 2020 7265 7475 726e 2073 7472        return str
-00017360: 6d2e 7265 6164 2829 0a0a 2020 2020 6465  m.read()..    de
-00017370: 6620 7265 6164 5f62 7974 6573 2873 656c  f read_bytes(sel
-00017380: 6629 3a0a 2020 2020 2020 2020 7769 7468  f):.        with
-00017390: 2073 656c 662e 6f70 656e 2827 7262 2729   self.open('rb')
-000173a0: 2061 7320 7374 726d 3a0a 2020 2020 2020   as strm:.      
-000173b0: 2020 2020 2020 7265 7475 726e 2073 7472        return str
-000173c0: 6d2e 7265 6164 2829 0a0a 2020 2020 6465  m.read()..    de
-000173d0: 6620 5f69 735f 6368 696c 6428 7365 6c66  f _is_child(self
-000173e0: 2c20 7061 7468 293a 0a20 2020 2020 2020  , path):.       
-000173f0: 2072 6574 7572 6e20 706f 7369 7870 6174   return posixpat
-00017400: 682e 6469 726e 616d 6528 7061 7468 2e61  h.dirname(path.a
-00017410: 742e 7273 7472 6970 2822 2f22 2929 203d  t.rstrip("/")) =
-00017420: 3d20 7365 6c66 2e61 742e 7273 7472 6970  = self.at.rstrip
-00017430: 2822 2f22 290a 0a20 2020 2064 6566 205f  ("/")..    def _
-00017440: 6e65 7874 2873 656c 662c 2061 7429 3a0a  next(self, at):.
-00017450: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00017460: 656c 662e 5f5f 636c 6173 735f 5f28 7365  elf.__class__(se
-00017470: 6c66 2e72 6f6f 742c 2061 7429 0a0a 2020  lf.root, at)..  
-00017480: 2020 6465 6620 6973 5f64 6972 2873 656c    def is_dir(sel
-00017490: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
-000174a0: 726e 206e 6f74 2073 656c 662e 6174 206f  rn not self.at o
-000174b0: 7220 7365 6c66 2e61 742e 656e 6473 7769  r self.at.endswi
-000174c0: 7468 2822 2f22 290a 0a20 2020 2064 6566  th("/")..    def
-000174d0: 2069 735f 6669 6c65 2873 656c 6629 3a0a   is_file(self):.
-000174e0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-000174f0: 656c 662e 6578 6973 7473 2829 2061 6e64  elf.exists() and
-00017500: 206e 6f74 2073 656c 662e 6973 5f64 6972   not self.is_dir
-00017510: 2829 0a0a 2020 2020 6465 6620 6578 6973  ()..    def exis
-00017520: 7473 2873 656c 6629 3a0a 2020 2020 2020  ts(self):.      
-00017530: 2020 7265 7475 726e 2073 656c 662e 6174    return self.at
-00017540: 2069 6e20 7365 6c66 2e72 6f6f 742e 5f6e   in self.root._n
-00017550: 616d 655f 7365 7428 290a 0a20 2020 2064  ame_set()..    d
-00017560: 6566 2069 7465 7264 6972 2873 656c 6629  ef iterdir(self)
-00017570: 3a0a 2020 2020 2020 2020 6966 206e 6f74  :.        if not
-00017580: 2073 656c 662e 6973 5f64 6972 2829 3a0a   self.is_dir():.
-00017590: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-000175a0: 6520 5661 6c75 6545 7272 6f72 2822 4361  e ValueError("Ca
-000175b0: 6e27 7420 6c69 7374 6469 7220 6120 6669  n't listdir a fi
-000175c0: 6c65 2229 0a20 2020 2020 2020 2073 7562  le").        sub
-000175d0: 7320 3d20 6d61 7028 7365 6c66 2e5f 6e65  s = map(self._ne
-000175e0: 7874 2c20 7365 6c66 2e72 6f6f 742e 6e61  xt, self.root.na
-000175f0: 6d65 6c69 7374 2829 290a 2020 2020 2020  melist()).      
-00017600: 2020 7265 7475 726e 2066 696c 7465 7228    return filter(
-00017610: 7365 6c66 2e5f 6973 5f63 6869 6c64 2c20  self._is_child, 
-00017620: 7375 6273 290a 0a20 2020 2064 6566 205f  subs)..    def _
-00017630: 5f73 7472 5f5f 2873 656c 6629 3a0a 2020  _str__(self):.  
-00017640: 2020 2020 2020 7265 7475 726e 2070 6f73        return pos
-00017650: 6978 7061 7468 2e6a 6f69 6e28 7365 6c66  ixpath.join(self
-00017660: 2e72 6f6f 742e 6669 6c65 6e61 6d65 2c20  .root.filename, 
-00017670: 7365 6c66 2e61 7429 0a0a 2020 2020 6465  self.at)..    de
-00017680: 6620 5f5f 7265 7072 5f5f 2873 656c 6629  f __repr__(self)
-00017690: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-000176a0: 2073 656c 662e 5f5f 7265 7072 2e66 6f72   self.__repr.for
-000176b0: 6d61 7428 7365 6c66 3d73 656c 6629 0a0a  mat(self=self)..
-000176c0: 2020 2020 6465 6620 6a6f 696e 7061 7468      def joinpath
-000176d0: 2873 656c 662c 202a 6f74 6865 7229 3a0a  (self, *other):.
-000176e0: 2020 2020 2020 2020 6e65 7874 203d 2070          next = p
-000176f0: 6f73 6978 7061 7468 2e6a 6f69 6e28 7365  osixpath.join(se
-00017700: 6c66 2e61 742c 202a 6f74 6865 7229 0a20  lf.at, *other). 
-00017710: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00017720: 6c66 2e5f 6e65 7874 2873 656c 662e 726f  lf._next(self.ro
-00017730: 6f74 2e72 6573 6f6c 7665 5f64 6972 286e  ot.resolve_dir(n
-00017740: 6578 7429 290a 0a20 2020 2069 6620 7379  ext))..    if sy
-00017750: 732e 7665 7273 696f 6e5f 696e 666f 5b30  s.version_info[0
-00017760: 5d3e 3d33 3a0a 2020 2020 2020 2020 5f5f  ]>=3:.        __
-00017770: 7472 7565 6469 765f 5f20 3d20 6a6f 696e  truediv__ = join
-00017780: 7061 7468 0a20 2020 2065 6c73 653a 0a20  path.    else:. 
-00017790: 2020 2020 2020 205f 5f64 6976 5f5f 203d         __div__ =
-000177a0: 206a 6f69 6e70 6174 680a 0a20 2020 2040   joinpath..    @
-000177b0: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
-000177c0: 2070 6172 656e 7428 7365 6c66 293a 0a20   parent(self):. 
-000177d0: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
-000177e0: 6c66 2e61 743a 0a20 2020 2020 2020 2020  lf.at:.         
-000177f0: 2020 2072 6574 7572 6e20 7365 6c66 2e66     return self.f
-00017800: 696c 656e 616d 652e 7061 7265 6e74 0a20  ilename.parent. 
-00017810: 2020 2020 2020 2070 6172 656e 745f 6174         parent_at
-00017820: 203d 2070 6f73 6978 7061 7468 2e64 6972   = posixpath.dir
-00017830: 6e61 6d65 2873 656c 662e 6174 2e72 7374  name(self.at.rst
-00017840: 7269 7028 272f 2729 290a 2020 2020 2020  rip('/')).      
-00017850: 2020 6966 2070 6172 656e 745f 6174 3a0a    if parent_at:.
-00017860: 2020 2020 2020 2020 2020 2020 7061 7265              pare
-00017870: 6e74 5f61 7420 2b3d 2027 2f27 0a20 2020  nt_at += '/'.   
-00017880: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00017890: 2e5f 6e65 7874 2870 6172 656e 745f 6174  ._next(parent_at
-000178a0: 290a 0a0a 6465 6620 6d61 696e 2861 7267  )...def main(arg
-000178b0: 733d 4e6f 6e65 293a 0a20 2020 2069 6d70  s=None):.    imp
-000178c0: 6f72 7420 6172 6770 6172 7365 0a0a 2020  ort argparse..  
-000178d0: 2020 6465 7363 7269 7074 696f 6e20 3d20    description = 
-000178e0: 2741 2073 696d 706c 6520 636f 6d6d 616e  'A simple comman
-000178f0: 642d 6c69 6e65 2069 6e74 6572 6661 6365  d-line interface
-00017900: 2066 6f72 207a 6970 6669 6c65 206d 6f64   for zipfile mod
-00017910: 756c 652e 270a 2020 2020 7061 7273 6572  ule.'.    parser
-00017920: 203d 2061 7267 7061 7273 652e 4172 6775   = argparse.Argu
-00017930: 6d65 6e74 5061 7273 6572 2864 6573 6372  mentParser(descr
-00017940: 6970 7469 6f6e 3d64 6573 6372 6970 7469  iption=descripti
-00017950: 6f6e 290a 2020 2020 6772 6f75 7020 3d20  on).    group = 
-00017960: 7061 7273 6572 2e61 6464 5f6d 7574 7561  parser.add_mutua
-00017970: 6c6c 795f 6578 636c 7573 6976 655f 6772  lly_exclusive_gr
-00017980: 6f75 7028 7265 7175 6972 6564 3d54 7275  oup(required=Tru
-00017990: 6529 0a20 2020 2067 726f 7570 2e61 6464  e).    group.add
-000179a0: 5f61 7267 756d 656e 7428 272d 6c27 2c20  _argument('-l', 
-000179b0: 272d 2d6c 6973 7427 2c20 6d65 7461 7661  '--list', metava
-000179c0: 723d 273c 7a69 7066 696c 653e 272c 0a20  r='<zipfile>',. 
-000179d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000179e0: 2020 2020 2020 6865 6c70 3d27 5368 6f77        help='Show
-000179f0: 206c 6973 7469 6e67 206f 6620 6120 7a69   listing of a zi
-00017a00: 7066 696c 6527 290a 2020 2020 6772 6f75  pfile').    grou
-00017a10: 702e 6164 645f 6172 6775 6d65 6e74 2827  p.add_argument('
-00017a20: 2d65 272c 2027 2d2d 6578 7472 6163 7427  -e', '--extract'
-00017a30: 2c20 6e61 7267 733d 322c 0a20 2020 2020  , nargs=2,.     
-00017a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017a50: 2020 6d65 7461 7661 723d 2827 3c7a 6970    metavar=('<zip
-00017a60: 6669 6c65 3e27 2c20 273c 6f75 7470 7574  file>', '<output
-00017a70: 5f64 6972 3e27 292c 0a20 2020 2020 2020  _dir>'),.       
-00017a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017a90: 6865 6c70 3d27 4578 7472 6163 7420 7a69  help='Extract zi
-00017aa0: 7066 696c 6520 696e 746f 2074 6172 6765  pfile into targe
-00017ab0: 7420 6469 7227 290a 2020 2020 6772 6f75  t dir').    grou
-00017ac0: 702e 6164 645f 6172 6775 6d65 6e74 2827  p.add_argument('
-00017ad0: 2d63 272c 2027 2d2d 6372 6561 7465 272c  -c', '--create',
-00017ae0: 206e 6172 6773 3d27 2b27 2c0a 2020 2020   nargs='+',.    
-00017af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017b00: 2020 206d 6574 6176 6172 3d28 273c 6e61     metavar=('<na
-00017b10: 6d65 3e27 2c20 273c 6669 6c65 3e27 292c  me>', '<file>'),
-00017b20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017b30: 2020 2020 2020 2020 6865 6c70 3d27 4372          help='Cr
-00017b40: 6561 7465 207a 6970 6669 6c65 2066 726f  eate zipfile fro
-00017b50: 6d20 736f 7572 6365 7327 290a 2020 2020  m sources').    
-00017b60: 6772 6f75 702e 6164 645f 6172 6775 6d65  group.add_argume
-00017b70: 6e74 2827 2d74 272c 2027 2d2d 7465 7374  nt('-t', '--test
-00017b80: 272c 206d 6574 6176 6172 3d27 3c7a 6970  ', metavar='<zip
-00017b90: 6669 6c65 3e27 2c0a 2020 2020 2020 2020  file>',.        
-00017ba0: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-00017bb0: 656c 703d 2754 6573 7420 6966 2061 207a  elp='Test if a z
-00017bc0: 6970 6669 6c65 2069 7320 7661 6c69 6427  ipfile is valid'
-00017bd0: 290a 2020 2020 7061 7273 6572 2e61 6464  ).    parser.add
-00017be0: 5f61 7267 756d 656e 7428 272d 6d27 2c20  _argument('-m', 
-00017bf0: 272d 2d6d 6574 686f 6427 2c20 7479 7065  '--method', type
-00017c00: 3d73 7472 2c20 6d65 7461 7661 723d 273c  =str, metavar='<
-00017c10: 6d65 7468 6f64 3e27 2c20 6465 6661 756c  method>', defaul
-00017c20: 743d 2744 4546 4c41 5445 272c 0a20 2020  t='DEFLATE',.   
-00017c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017c40: 2020 2020 6865 6c70 3d27 636f 6d70 7265      help='compre
-00017c50: 7373 696f 6e20 6d65 7468 6f64 2028 6d75  ssion method (mu
-00017c60: 7374 2063 6f6d 6520 6265 666f 7265 202d  st come before -
-00017c70: 6329 2729 0a20 2020 2070 6172 7365 722e  c)').    parser.
-00017c80: 6164 645f 6172 6775 6d65 6e74 2827 2d78  add_argument('-x
-00017c90: 272c 2027 2d2d 6c65 7665 6c27 2c20 7479  ', '--level', ty
-00017ca0: 7065 3d69 6e74 2c20 6d65 7461 7661 723d  pe=int, metavar=
-00017cb0: 273c 6c65 7665 6c3e 272c 2064 6566 6175  '<level>', defau
-00017cc0: 6c74 3d4e 6f6e 652c 0a20 2020 2020 2020  lt=None,.       
-00017cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017ce0: 6865 6c70 3d27 636f 6d70 7265 7373 696f  help='compressio
-00017cf0: 6e20 6c65 7665 6c20 286d 7573 7420 636f  n level (must co
-00017d00: 6d65 2062 6566 6f72 6520 2d63 2927 290a  me before -c)').
-00017d10: 2020 2020 6172 6773 203d 2070 6172 7365      args = parse
-00017d20: 722e 7061 7273 655f 6172 6773 2861 7267  r.parse_args(arg
-00017d30: 7329 0a0a 2020 2020 6966 2061 7267 732e  s)..    if args.
-00017d40: 7465 7374 2069 7320 6e6f 7420 4e6f 6e65  test is not None
-00017d50: 3a0a 2020 2020 2020 2020 7372 6320 3d20  :.        src = 
-00017d60: 6172 6773 2e74 6573 740a 2020 2020 2020  args.test.      
-00017d70: 2020 7769 7468 205a 6970 4669 6c65 2873    with ZipFile(s
-00017d80: 7263 2c20 2772 2729 2061 7320 7a66 3a0a  rc, 'r') as zf:.
-00017d90: 2020 2020 2020 2020 2020 2020 6261 6466              badf
-00017da0: 696c 6520 3d20 7a66 2e74 6573 747a 6970  ile = zf.testzip
-00017db0: 2829 0a20 2020 2020 2020 2069 6620 6261  ().        if ba
-00017dc0: 6466 696c 653a 0a20 2020 2020 2020 2020  dfile:.         
-00017dd0: 2020 2070 7269 6e74 2822 5468 6520 666f     print("The fo
-00017de0: 6c6c 6f77 696e 6720 656e 636c 6f73 6564  llowing enclosed
-00017df0: 2066 696c 6520 6973 2063 6f72 7275 7074   file is corrupt
-00017e00: 6564 3a20 7b21 727d 222e 666f 726d 6174  ed: {!r}".format
-00017e10: 2862 6164 6669 6c65 2929 0a20 2020 2020  (badfile)).     
-00017e20: 2020 2070 7269 6e74 2822 446f 6e65 2074     print("Done t
-00017e30: 6573 7469 6e67 2229 0a0a 2020 2020 656c  esting")..    el
-00017e40: 6966 2061 7267 732e 6c69 7374 2069 7320  if args.list is 
-00017e50: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00017e60: 2020 7372 6320 3d20 6172 6773 2e6c 6973    src = args.lis
-00017e70: 740a 2020 2020 2020 2020 7769 7468 205a  t.        with Z
-00017e80: 6970 4669 6c65 2873 7263 2c20 2772 2729  ipFile(src, 'r')
-00017e90: 2061 7320 7a66 3a0a 2020 2020 2020 2020   as zf:.        
-00017ea0: 2020 2020 7a66 2e70 7269 6e74 6469 7228      zf.printdir(
-00017eb0: 290a 0a20 2020 2065 6c69 6620 6172 6773  )..    elif args
-00017ec0: 2e65 7874 7261 6374 2069 7320 6e6f 7420  .extract is not 
-00017ed0: 4e6f 6e65 3a0a 2020 2020 2020 2020 7372  None:.        sr
-00017ee0: 632c 2063 7572 6469 7220 3d20 6172 6773  c, curdir = args
-00017ef0: 2e65 7874 7261 6374 0a20 2020 2020 2020  .extract.       
-00017f00: 2077 6974 6820 5a69 7046 696c 6528 7372   with ZipFile(sr
-00017f10: 632c 2027 7227 2920 6173 207a 663a 0a20  c, 'r') as zf:. 
-00017f20: 2020 2020 2020 2020 2020 207a 662e 6578             zf.ex
-00017f30: 7472 6163 7461 6c6c 2863 7572 6469 7229  tractall(curdir)
-00017f40: 0a0a 2020 2020 656c 6966 2061 7267 732e  ..    elif args.
-00017f50: 6372 6561 7465 2069 7320 6e6f 7420 4e6f  create is not No
-00017f60: 6e65 3a0a 2020 2020 2020 2020 7a69 705f  ne:.        zip_
-00017f70: 6e61 6d65 203d 2061 7267 732e 6372 6561  name = args.crea
-00017f80: 7465 2e70 6f70 2830 290a 2020 2020 2020  te.pop(0).      
-00017f90: 2020 6669 6c65 7320 3d20 6172 6773 2e63    files = args.c
-00017fa0: 7265 6174 650a 2020 2020 2020 2020 736d  reate.        sm
-00017fb0: 6574 686f 6420 3d20 6172 6773 2e6d 6574  ethod = args.met
-00017fc0: 686f 642e 7570 7065 7228 290a 2020 2020  hod.upper().    
-00017fd0: 2020 2020 6966 2073 6d65 7468 6f64 203d      if smethod =
-00017fe0: 3d20 2744 4546 4c41 5445 273a 0a20 2020  = 'DEFLATE':.   
-00017ff0: 2020 2020 2020 2020 2073 6d65 7468 6f64           smethod
-00018000: 203d 2027 4445 464c 4154 4544 270a 2020   = 'DEFLATED'.  
-00018010: 2020 2020 2020 6966 2073 6d65 7468 6f64        if smethod
-00018020: 203d 3d20 2744 434c 494d 504c 4f44 4527   == 'DCLIMPLODE'
-00018030: 3a0a 2020 2020 2020 2020 2020 2020 736d  :.            sm
-00018040: 6574 686f 6420 3d20 2744 434c 494d 504c  ethod = 'DCLIMPL
-00018050: 4f44 4544 270a 2020 2020 2020 2020 6966  ODED'.        if
-00018060: 2073 6d65 7468 6f64 203d 3d20 2753 544f   smethod == 'STO
-00018070: 5245 273a 0a20 2020 2020 2020 2020 2020  RE':.           
-00018080: 2073 6d65 7468 6f64 203d 2027 5354 4f52   smethod = 'STOR
-00018090: 4544 270a 2020 2020 2020 2020 6d65 7468  ED'.        meth
-000180a0: 6f64 203d 2067 6c6f 6261 6c73 2829 5b27  od = globals()['
-000180b0: 5a49 505f 272b 736d 6574 686f 645d 0a0a  ZIP_'+smethod]..
-000180c0: 2020 2020 2020 2020 6465 6620 6164 6454          def addT
-000180d0: 6f5a 6970 287a 662c 2070 6174 682c 207a  oZip(zf, path, z
-000180e0: 6970 7061 7468 293a 0a20 2020 2020 2020  ippath):.       
-000180f0: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
-00018100: 6973 6669 6c65 2870 6174 6829 3a0a 2020  isfile(path):.  
-00018110: 2020 2020 2020 2020 2020 2020 2020 7a66                zf
-00018120: 2e77 7269 7465 2870 6174 682c 207a 6970  .write(path, zip
-00018130: 7061 7468 2c20 6d65 7468 6f64 290a 2020  path, method).  
-00018140: 2020 2020 2020 2020 2020 656c 6966 206f            elif o
-00018150: 732e 7061 7468 2e69 7364 6972 2870 6174  s.path.isdir(pat
-00018160: 6829 3a0a 2020 2020 2020 2020 2020 2020  h):.            
-00018170: 2020 2020 6966 207a 6970 7061 7468 3a0a      if zippath:.
-00018180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018190: 2020 2020 7a66 2e77 7269 7465 2870 6174      zf.write(pat
-000181a0: 682c 207a 6970 7061 7468 290a 2020 2020  h, zippath).    
-000181b0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-000181c0: 6e6d 2069 6e20 736f 7274 6564 286f 732e  nm in sorted(os.
-000181d0: 6c69 7374 6469 7228 7061 7468 2929 3a0a  listdir(path)):.
-000181e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000181f0: 2020 2020 6164 6454 6f5a 6970 287a 662c      addToZip(zf,
-00018200: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018210: 2020 2020 2020 2020 2020 2020 2020 6f73                os
-00018220: 2e70 6174 682e 6a6f 696e 2870 6174 682c  .path.join(path,
-00018230: 206e 6d29 2c20 6f73 2e70 6174 682e 6a6f   nm), os.path.jo
-00018240: 696e 287a 6970 7061 7468 2c20 6e6d 2929  in(zippath, nm))
-00018250: 0a20 2020 2020 2020 2020 2020 2023 2065  .            # e
-00018260: 6c73 653a 2069 676e 6f72 650a 0a20 2020  lse: ignore..   
-00018270: 2020 2020 2077 6974 6820 5a69 7046 696c       with ZipFil
-00018280: 6528 7a69 705f 6e61 6d65 2c20 2777 272c  e(zip_name, 'w',
-00018290: 2063 6f6d 7072 6573 7369 6f6e 3d6d 6574   compression=met
-000182a0: 686f 642c 2063 6f6d 7072 6573 736c 6576  hod, compresslev
-000182b0: 656c 3d61 7267 732e 6c65 7665 6c29 2061  el=args.level) a
-000182c0: 7320 7a66 3a0a 2020 2020 2020 2020 2020  s zf:.          
-000182d0: 2020 666f 7220 7061 7468 2069 6e20 6669    for path in fi
-000182e0: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
-000182f0: 2020 2020 207a 6970 7061 7468 203d 206f       zippath = o
-00018300: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
-00018310: 7061 7468 290a 2020 2020 2020 2020 2020  path).          
-00018320: 2020 2020 2020 6966 206e 6f74 207a 6970        if not zip
-00018330: 7061 7468 3a0a 2020 2020 2020 2020 2020  path:.          
-00018340: 2020 2020 2020 2020 2020 7a69 7070 6174            zippat
-00018350: 6820 3d20 6f73 2e70 6174 682e 6261 7365  h = os.path.base
-00018360: 6e61 6d65 286f 732e 7061 7468 2e64 6972  name(os.path.dir
-00018370: 6e61 6d65 2870 6174 6829 290a 2020 2020  name(path)).    
-00018380: 2020 2020 2020 2020 2020 2020 6966 207a              if z
-00018390: 6970 7061 7468 2069 6e20 2827 272c 206f  ippath in ('', o
-000183a0: 732e 6375 7264 6972 2c20 6f73 2e70 6172  s.curdir, os.par
-000183b0: 6469 7229 3a0a 2020 2020 2020 2020 2020  dir):.          
-000183c0: 2020 2020 2020 2020 2020 7a69 7070 6174            zippat
-000183d0: 6820 3d20 2727 0a20 2020 2020 2020 2020  h = ''.         
-000183e0: 2020 2020 2020 2061 6464 546f 5a69 7028         addToZip(
-000183f0: 7a66 2c20 7061 7468 2c20 7a69 7070 6174  zf, path, zippat
-00018400: 6829 0a0a 0a69 6620 5f5f 6e61 6d65 5f5f  h)...if __name__
-00018410: 203d 3d20 225f 5f6d 6169 6e5f 5f22 3a0a   == "__main__":.
-00018420: 2020 2020 6d61 696e 2829 0a                  main().
+00014730: 2072 6f6f 742c 2065 7874 203d 206f 732e   root, ext = os.
+00014740: 7061 7468 2e73 706c 6974 6578 7428 6669  path.splitext(fi
+00014750: 6c65 6e61 6d65 290a 2020 2020 2020 2020  lename).        
+00014760: 2020 2020 2020 2020 2020 2020 6966 2065              if e
+00014770: 7874 203d 3d20 222e 7079 223a 0a20 2020  xt == ".py":.   
+00014780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014790: 2020 2020 2069 6620 6669 6c74 6572 6675       if filterfu
+000147a0: 6e63 2061 6e64 206e 6f74 2066 696c 7465  nc and not filte
+000147b0: 7266 756e 6328 7061 7468 293a 0a20 2020  rfunc(path):.   
+000147c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000147d0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+000147e0: 2e64 6562 7567 3a0a 2020 2020 2020 2020  .debug:.        
+000147f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014800: 2020 2020 2020 2020 7072 696e 7428 2766          print('f
+00014810: 696c 6520 2572 2073 6b69 7070 6564 2062  ile %r skipped b
+00014820: 7920 6669 6c74 6572 6675 6e63 2720 2520  y filterfunc' % 
+00014830: 7061 7468 290a 2020 2020 2020 2020 2020  path).          
+00014840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014850: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
+00014860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014870: 2020 2066 6e61 6d65 2c20 6172 636e 616d     fname, arcnam
+00014880: 6520 3d20 7365 6c66 2e5f 6765 745f 636f  e = self._get_co
+00014890: 6465 6e61 6d65 2870 6174 685b 303a 2d33  dename(path[0:-3
+000148a0: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
+000148b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000148c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000148d0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+000148e0: 6173 656e 616d 6529 0a20 2020 2020 2020  asename).       
+000148f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014900: 2069 6620 7365 6c66 2e64 6562 7567 3a0a   if self.debug:.
+00014910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014920: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00014930: 7428 2241 6464 696e 6722 2c20 6172 636e  t("Adding", arcn
+00014940: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
+00014950: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00014960: 662e 7772 6974 6528 666e 616d 652c 2061  f.write(fname, a
+00014970: 7263 6e61 6d65 290a 2020 2020 2020 2020  rcname).        
+00014980: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00014990: 2020 6966 2070 6174 686e 616d 655b 2d33    if pathname[-3
+000149a0: 3a5d 2021 3d20 222e 7079 223a 0a20 2020  :] != ".py":.   
+000149b0: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+000149c0: 7365 2052 756e 7469 6d65 4572 726f 7228  se RuntimeError(
+000149d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000149e0: 2020 2020 2027 4669 6c65 7320 6164 6465       'Files adde
+000149f0: 6420 7769 7468 2077 7269 7465 7079 2829  d with writepy()
+00014a00: 206d 7573 7420 656e 6420 7769 7468 2022   must end with "
+00014a10: 2e70 7922 2729 0a20 2020 2020 2020 2020  .py"').         
+00014a20: 2020 2066 6e61 6d65 2c20 6172 636e 616d     fname, arcnam
+00014a30: 6520 3d20 7365 6c66 2e5f 6765 745f 636f  e = self._get_co
+00014a40: 6465 6e61 6d65 2870 6174 686e 616d 655b  dename(pathname[
+00014a50: 303a 2d33 5d2c 2062 6173 656e 616d 6529  0:-3], basename)
+00014a60: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00014a70: 7365 6c66 2e64 6562 7567 3a0a 2020 2020  self.debug:.    
+00014a80: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00014a90: 7428 2241 6464 696e 6720 6669 6c65 222c  t("Adding file",
+00014aa0: 2061 7263 6e61 6d65 290a 2020 2020 2020   arcname).      
+00014ab0: 2020 2020 2020 7365 6c66 2e77 7269 7465        self.write
+00014ac0: 2866 6e61 6d65 2c20 6172 636e 616d 6529  (fname, arcname)
+00014ad0: 0a0a 2020 2020 6465 6620 5f67 6574 5f63  ..    def _get_c
+00014ae0: 6f64 656e 616d 6528 7365 6c66 2c20 7061  odename(self, pa
+00014af0: 7468 6e61 6d65 2c20 6261 7365 6e61 6d65  thname, basename
+00014b00: 293a 0a20 2020 2020 2020 2022 2222 5265  ):.        """Re
+00014b10: 7475 726e 2028 6669 6c65 6e61 6d65 2c20  turn (filename, 
+00014b20: 6172 6368 6976 656e 616d 6529 2066 6f72  archivename) for
+00014b30: 2074 6865 2070 6174 682e 0a0a 2020 2020   the path...    
+00014b40: 2020 2020 4769 7665 6e20 6120 6d6f 6475      Given a modu
+00014b50: 6c65 206e 616d 6520 7061 7468 2c20 7265  le name path, re
+00014b60: 7475 726e 2074 6865 2063 6f72 7265 6374  turn the correct
+00014b70: 2066 696c 6520 7061 7468 2061 6e64 0a20   file path and. 
+00014b80: 2020 2020 2020 2061 7263 6869 7665 206e         archive n
+00014b90: 616d 652c 2063 6f6d 7069 6c69 6e67 2069  ame, compiling i
+00014ba0: 6620 6e65 6365 7373 6172 792e 2020 466f  f necessary.  Fo
+00014bb0: 7220 6578 616d 706c 652c 2067 6976 656e  r example, given
+00014bc0: 0a20 2020 2020 2020 202f 7079 7468 6f6e  .        /python
+00014bd0: 2f6c 6962 2f73 7472 696e 672c 2072 6574  /lib/string, ret
+00014be0: 7572 6e20 282f 7079 7468 6f6e 2f6c 6962  urn (/python/lib
+00014bf0: 2f73 7472 696e 672e 7079 632c 2073 7472  /string.pyc, str
+00014c00: 696e 6729 2e0a 2020 2020 2020 2020 2222  ing)..        ""
+00014c10: 220a 2020 2020 2020 2020 6465 6620 5f63  ".        def _c
+00014c20: 6f6d 7069 6c65 2866 696c 652c 206f 7074  ompile(file, opt
+00014c30: 696d 697a 653d 2d31 293a 0a20 2020 2020  imize=-1):.     
+00014c40: 2020 2020 2020 2069 6d70 6f72 7420 7079         import py
+00014c50: 5f63 6f6d 7069 6c65 0a20 2020 2020 2020  _compile.       
+00014c60: 2020 2020 2069 6620 7365 6c66 2e64 6562       if self.deb
+00014c70: 7567 3a0a 2020 2020 2020 2020 2020 2020  ug:.            
+00014c80: 2020 2020 7072 696e 7428 2243 6f6d 7069      print("Compi
+00014c90: 6c69 6e67 222c 2066 696c 6529 0a20 2020  ling", file).   
+00014ca0: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
+00014cb0: 2020 2020 2020 2020 2020 2020 2020 7079                py
+00014cc0: 5f63 6f6d 7069 6c65 2e63 6f6d 7069 6c65  _compile.compile
+00014cd0: 2866 696c 652c 2064 6f72 6169 7365 3d54  (file, doraise=T
+00014ce0: 7275 652c 206f 7074 696d 697a 653d 6f70  rue, optimize=op
+00014cf0: 7469 6d69 7a65 290a 2020 2020 2020 2020  timize).        
+00014d00: 2020 2020 6578 6365 7074 2070 795f 636f      except py_co
+00014d10: 6d70 696c 652e 5079 436f 6d70 696c 6545  mpile.PyCompileE
+00014d20: 7272 6f72 2061 7320 6572 723a 0a20 2020  rror as err:.   
+00014d30: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+00014d40: 6e74 2865 7272 2e6d 7367 290a 2020 2020  nt(err.msg).    
+00014d50: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00014d60: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
+00014d70: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
+00014d80: 0a0a 2020 2020 2020 2020 6669 6c65 5f70  ..        file_p
+00014d90: 7920 203d 2070 6174 686e 616d 6520 2b20  y  = pathname + 
+00014da0: 222e 7079 220a 2020 2020 2020 2020 6669  ".py".        fi
+00014db0: 6c65 5f70 7963 203d 2070 6174 686e 616d  le_pyc = pathnam
+00014dc0: 6520 2b20 222e 7079 6322 0a20 2020 2020  e + ".pyc".     
+00014dd0: 2020 2066 696c 655f 7079 6f20 3d20 7061     file_pyo = pa
+00014de0: 7468 6e61 6d65 202b 2022 2e70 796f 220a  thname + ".pyo".
+00014df0: 2020 2020 2020 2020 6966 2069 6d70 6f72          if impor
+00014e00: 746c 6962 5f75 7469 6c20 6973 206e 6f74  tlib_util is not
+00014e10: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00014e20: 2020 2070 7963 6163 6865 5f6f 7074 3020     pycache_opt0 
+00014e30: 3d20 696d 706f 7274 6c69 625f 7574 696c  = importlib_util
+00014e40: 2e63 6163 6865 5f66 726f 6d5f 736f 7572  .cache_from_sour
+00014e50: 6365 2866 696c 655f 7079 2c20 6f70 7469  ce(file_py, opti
+00014e60: 6d69 7a61 7469 6f6e 3d27 2729 0a20 2020  mization='').   
+00014e70: 2020 2020 2020 2020 2070 7963 6163 6865           pycache
+00014e80: 5f6f 7074 3120 3d20 696d 706f 7274 6c69  _opt1 = importli
+00014e90: 625f 7574 696c 2e63 6163 6865 5f66 726f  b_util.cache_fro
+00014ea0: 6d5f 736f 7572 6365 2866 696c 655f 7079  m_source(file_py
+00014eb0: 2c20 6f70 7469 6d69 7a61 7469 6f6e 3d31  , optimization=1
+00014ec0: 290a 2020 2020 2020 2020 2020 2020 7079  ).            py
+00014ed0: 6361 6368 655f 6f70 7432 203d 2069 6d70  cache_opt2 = imp
+00014ee0: 6f72 746c 6962 5f75 7469 6c2e 6361 6368  ortlib_util.cach
+00014ef0: 655f 6672 6f6d 5f73 6f75 7263 6528 6669  e_from_source(fi
+00014f00: 6c65 5f70 792c 206f 7074 696d 697a 6174  le_py, optimizat
+00014f10: 696f 6e3d 3229 0a20 2020 2020 2020 2065  ion=2).        e
+00014f20: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00014f30: 2070 7963 6163 6865 5f6f 7074 3020 3d20   pycache_opt0 = 
+00014f40: 6669 6c65 5f70 7963 0a20 2020 2020 2020  file_pyc.       
+00014f50: 2020 2020 2070 7963 6163 6865 5f6f 7074       pycache_opt
+00014f60: 3120 3d20 6669 6c65 5f70 796f 0a20 2020  1 = file_pyo.   
+00014f70: 2020 2020 2020 2020 2070 7963 6163 6865           pycache
+00014f80: 5f6f 7074 3220 3d20 6669 6c65 5f70 796f  _opt2 = file_pyo
+00014f90: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00014fa0: 2e5f 6f70 7469 6d69 7a65 203d 3d20 2d31  ._optimize == -1
+00014fb0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+00014fc0: 6c65 6761 6379 206d 6f64 653a 2075 7365  legacy mode: use
+00014fd0: 2077 6861 7465 7665 7220 6669 6c65 2069   whatever file i
+00014fe0: 7320 7072 6573 656e 740a 2020 2020 2020  s present.      
+00014ff0: 2020 2020 2020 6966 2028 6f73 2e70 6174        if (os.pat
+00015000: 682e 6973 6669 6c65 2866 696c 655f 7079  h.isfile(file_py
+00015010: 6329 2061 6e64 0a20 2020 2020 2020 2020  c) and.         
+00015020: 2020 2020 2020 2020 206f 732e 7374 6174           os.stat
+00015030: 2866 696c 655f 7079 6329 2e73 745f 6d74  (file_pyc).st_mt
+00015040: 696d 6520 3e3d 206f 732e 7374 6174 2866  ime >= os.stat(f
+00015050: 696c 655f 7079 292e 7374 5f6d 7469 6d65  ile_py).st_mtime
+00015060: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00015070: 2020 2023 2055 7365 202e 7079 6320 6669     # Use .pyc fi
+00015080: 6c65 2e0a 2020 2020 2020 2020 2020 2020  le..            
+00015090: 2020 2020 6172 636e 616d 6520 3d20 666e      arcname = fn
+000150a0: 616d 6520 3d20 6669 6c65 5f70 7963 0a20  ame = file_pyc. 
+000150b0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+000150c0: 286f 732e 7061 7468 2e69 7366 696c 6528  (os.path.isfile(
+000150d0: 7079 6361 6368 655f 6f70 7430 2920 616e  pycache_opt0) an
+000150e0: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
+000150f0: 2020 2020 6f73 2e73 7461 7428 7079 6361      os.stat(pyca
+00015100: 6368 655f 6f70 7430 292e 7374 5f6d 7469  che_opt0).st_mti
+00015110: 6d65 203e 3d20 6f73 2e73 7461 7428 6669  me >= os.stat(fi
+00015120: 6c65 5f70 7929 2e73 745f 6d74 696d 6529  le_py).st_mtime)
+00015130: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00015140: 2020 2320 5573 6520 7468 6520 5f5f 7079    # Use the __py
+00015150: 6361 6368 655f 5f2f 2a2e 7079 6320 6669  cache__/*.pyc fi
+00015160: 6c65 2c20 6275 7420 7772 6974 6520 6974  le, but write it
+00015170: 2074 6f20 7468 6520 6c65 6761 6379 2070   to the legacy p
+00015180: 7963 0a20 2020 2020 2020 2020 2020 2020  yc.             
+00015190: 2020 2023 2066 696c 6520 6e61 6d65 2069     # file name i
+000151a0: 6e20 7468 6520 6172 6368 6976 652e 0a20  n the archive.. 
+000151b0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+000151c0: 6e61 6d65 203d 2070 7963 6163 6865 5f6f  name = pycache_o
+000151d0: 7074 300a 2020 2020 2020 2020 2020 2020  pt0.            
+000151e0: 2020 2020 6172 636e 616d 6520 3d20 6669      arcname = fi
+000151f0: 6c65 5f70 7963 0a20 2020 2020 2020 2020  le_pyc.         
+00015200: 2020 2065 6c69 6620 286f 732e 7061 7468     elif (os.path
+00015210: 2e69 7366 696c 6528 7079 6361 6368 655f  .isfile(pycache_
+00015220: 6f70 7431 2920 616e 640a 2020 2020 2020  opt1) and.      
+00015230: 2020 2020 2020 2020 2020 2020 6f73 2e73              os.s
+00015240: 7461 7428 7079 6361 6368 655f 6f70 7431  tat(pycache_opt1
+00015250: 292e 7374 5f6d 7469 6d65 203e 3d20 6f73  ).st_mtime >= os
+00015260: 2e73 7461 7428 6669 6c65 5f70 7929 2e73  .stat(file_py).s
+00015270: 745f 6d74 696d 6529 3a0a 2020 2020 2020  t_mtime):.      
+00015280: 2020 2020 2020 2020 2020 2320 5573 6520            # Use 
+00015290: 7468 6520 5f5f 7079 6361 6368 655f 5f2f  the __pycache__/
+000152a0: 2a2e 7079 6320 6669 6c65 2c20 6275 7420  *.pyc file, but 
+000152b0: 7772 6974 6520 6974 2074 6f20 7468 6520  write it to the 
+000152c0: 6c65 6761 6379 2070 7963 0a20 2020 2020  legacy pyc.     
+000152d0: 2020 2020 2020 2020 2020 2023 2066 696c             # fil
+000152e0: 6520 6e61 6d65 2069 6e20 7468 6520 6172  e name in the ar
+000152f0: 6368 6976 652e 0a20 2020 2020 2020 2020  chive..         
+00015300: 2020 2020 2020 2066 6e61 6d65 203d 2070         fname = p
+00015310: 7963 6163 6865 5f6f 7074 310a 2020 2020  ycache_opt1.    
+00015320: 2020 2020 2020 2020 2020 2020 6172 636e              arcn
+00015330: 616d 6520 3d20 6669 6c65 5f70 7963 0a20  ame = file_pyc. 
+00015340: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00015350: 286f 732e 7061 7468 2e69 7366 696c 6528  (os.path.isfile(
+00015360: 7079 6361 6368 655f 6f70 7432 2920 616e  pycache_opt2) an
+00015370: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
+00015380: 2020 2020 6f73 2e73 7461 7428 7079 6361      os.stat(pyca
+00015390: 6368 655f 6f70 7432 292e 7374 5f6d 7469  che_opt2).st_mti
+000153a0: 6d65 203e 3d20 6f73 2e73 7461 7428 6669  me >= os.stat(fi
+000153b0: 6c65 5f70 7929 2e73 745f 6d74 696d 6529  le_py).st_mtime)
+000153c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000153d0: 2020 2320 5573 6520 7468 6520 5f5f 7079    # Use the __py
+000153e0: 6361 6368 655f 5f2f 2a2e 7079 6320 6669  cache__/*.pyc fi
+000153f0: 6c65 2c20 6275 7420 7772 6974 6520 6974  le, but write it
+00015400: 2074 6f20 7468 6520 6c65 6761 6379 2070   to the legacy p
+00015410: 7963 0a20 2020 2020 2020 2020 2020 2020  yc.             
+00015420: 2020 2023 2066 696c 6520 6e61 6d65 2069     # file name i
+00015430: 6e20 7468 6520 6172 6368 6976 652e 0a20  n the archive.. 
+00015440: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00015450: 6e61 6d65 203d 2070 7963 6163 6865 5f6f  name = pycache_o
+00015460: 7074 320a 2020 2020 2020 2020 2020 2020  pt2.            
+00015470: 2020 2020 6172 636e 616d 6520 3d20 6669      arcname = fi
+00015480: 6c65 5f70 7963 0a20 2020 2020 2020 2020  le_pyc.         
+00015490: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000154a0: 2020 2020 2020 2020 2023 2043 6f6d 7069           # Compi
+000154b0: 6c65 2070 7920 696e 746f 2050 4550 2033  le py into PEP 3
+000154c0: 3134 3720 7079 6320 6669 6c65 2e0a 2020  147 pyc file..  
+000154d0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000154e0: 205f 636f 6d70 696c 6528 6669 6c65 5f70   _compile(file_p
+000154f0: 7929 3a0a 2020 2020 2020 2020 2020 2020  y):.            
+00015500: 2020 2020 2020 2020 6966 2073 7973 2e66          if sys.f
+00015510: 6c61 6773 2e6f 7074 696d 697a 6520 3d3d  lags.optimize ==
+00015520: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+00015530: 2020 2020 2020 2020 2020 2020 666e 616d              fnam
+00015540: 6520 3d20 7079 6361 6368 655f 6f70 7430  e = pycache_opt0
+00015550: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015560: 2020 2020 2065 6c69 6620 7379 732e 666c       elif sys.fl
+00015570: 6167 732e 6f70 7469 6d69 7a65 203d 3d20  ags.optimize == 
+00015580: 313a 0a20 2020 2020 2020 2020 2020 2020  1:.             
+00015590: 2020 2020 2020 2020 2020 2066 6e61 6d65             fname
+000155a0: 203d 2070 7963 6163 6865 5f6f 7074 310a   = pycache_opt1.
+000155b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000155c0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000155d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000155e0: 2020 666e 616d 6520 3d20 7079 6361 6368    fname = pycach
+000155f0: 655f 6f70 7432 0a20 2020 2020 2020 2020  e_opt2.         
+00015600: 2020 2020 2020 2020 2020 2061 7263 6e61             arcna
+00015610: 6d65 203d 2066 696c 655f 7079 630a 2020  me = file_pyc.  
+00015620: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00015630: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00015640: 2020 2020 2020 2020 666e 616d 6520 3d20          fname = 
+00015650: 6172 636e 616d 6520 3d20 6669 6c65 5f70  arcname = file_p
+00015660: 790a 2020 2020 2020 2020 656c 7365 3a0a  y.        else:.
+00015670: 2020 2020 2020 2020 2020 2020 2320 6e65              # ne
+00015680: 7720 6d6f 6465 3a20 7573 6520 6769 7665  w mode: use give
+00015690: 6e20 6f70 7469 6d69 7a61 7469 6f6e 206c  n optimization l
+000156a0: 6576 656c 0a20 2020 2020 2020 2020 2020  evel.           
+000156b0: 2069 6620 7365 6c66 2e5f 6f70 7469 6d69   if self._optimi
+000156c0: 7a65 203d 3d20 303a 0a20 2020 2020 2020  ze == 0:.       
+000156d0: 2020 2020 2020 2020 2066 6e61 6d65 203d           fname =
+000156e0: 2070 7963 6163 6865 5f6f 7074 300a 2020   pycache_opt0.  
+000156f0: 2020 2020 2020 2020 2020 2020 2020 6172                ar
+00015700: 636e 616d 6520 3d20 6669 6c65 5f70 7963  cname = file_pyc
+00015710: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00015720: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00015730: 2020 2061 7263 6e61 6d65 203d 2066 696c     arcname = fil
+00015740: 655f 7079 630a 2020 2020 2020 2020 2020  e_pyc.          
+00015750: 2020 2020 2020 6966 2073 656c 662e 5f6f        if self._o
+00015760: 7074 696d 697a 6520 3d3d 2031 3a0a 2020  ptimize == 1:.  
+00015770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015780: 2020 666e 616d 6520 3d20 7079 6361 6368    fname = pycach
+00015790: 655f 6f70 7431 0a20 2020 2020 2020 2020  e_opt1.         
+000157a0: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
+000157b0: 2e5f 6f70 7469 6d69 7a65 203d 3d20 323a  ._optimize == 2:
+000157c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000157d0: 2020 2020 2066 6e61 6d65 203d 2070 7963       fname = pyc
+000157e0: 6163 6865 5f6f 7074 320a 2020 2020 2020  ache_opt2.      
+000157f0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00015800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015810: 2020 2020 6d73 6720 3d20 2269 6e76 616c      msg = "inval
+00015820: 6964 2076 616c 7565 2066 6f72 2027 6f70  id value for 'op
+00015830: 7469 6d69 7a65 273a 207b 2172 7d22 2e66  timize': {!r}".f
+00015840: 6f72 6d61 7428 7365 6c66 2e5f 6f70 7469  ormat(self._opti
+00015850: 6d69 7a65 290a 2020 2020 2020 2020 2020  mize).          
+00015860: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00015870: 5661 6c75 6545 7272 6f72 286d 7367 290a  ValueError(msg).
+00015880: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+00015890: 6f74 2028 6f73 2e70 6174 682e 6973 6669  ot (os.path.isfi
+000158a0: 6c65 2866 6e61 6d65 2920 616e 640a 2020  le(fname) and.  
+000158b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000158c0: 2020 6f73 2e73 7461 7428 666e 616d 6529    os.stat(fname)
+000158d0: 2e73 745f 6d74 696d 6520 3e3d 206f 732e  .st_mtime >= os.
+000158e0: 7374 6174 2866 696c 655f 7079 292e 7374  stat(file_py).st
+000158f0: 5f6d 7469 6d65 293a 0a20 2020 2020 2020  _mtime):.       
+00015900: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+00015910: 5f63 6f6d 7069 6c65 2866 696c 655f 7079  _compile(file_py
+00015920: 2c20 6f70 7469 6d69 7a65 3d73 656c 662e  , optimize=self.
+00015930: 5f6f 7074 696d 697a 6529 3a0a 2020 2020  _optimize):.    
+00015940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015950: 666e 616d 6520 3d20 6172 636e 616d 6520  fname = arcname 
+00015960: 3d20 6669 6c65 5f70 790a 2020 2020 2020  = file_py.      
+00015970: 2020 6172 6368 6976 656e 616d 6520 3d20    archivename = 
+00015980: 6f73 2e70 6174 682e 7370 6c69 7428 6172  os.path.split(ar
+00015990: 636e 616d 6529 5b31 5d0a 2020 2020 2020  cname)[1].      
+000159a0: 2020 6966 2062 6173 656e 616d 653a 0a20    if basename:. 
+000159b0: 2020 2020 2020 2020 2020 2061 7263 6869             archi
+000159c0: 7665 6e61 6d65 203d 2022 2573 2f25 7322  vename = "%s/%s"
+000159d0: 2025 2028 6261 7365 6e61 6d65 2c20 6172   % (basename, ar
+000159e0: 6368 6976 656e 616d 6529 0a20 2020 2020  chivename).     
+000159f0: 2020 2072 6574 7572 6e20 2866 6e61 6d65     return (fname
+00015a00: 2c20 6172 6368 6976 656e 616d 6529 0a0a  , archivename)..
+00015a10: 0a64 6566 205f 7061 7265 6e74 7328 7061  .def _parents(pa
+00015a20: 7468 293a 0a20 2020 2022 2222 0a20 2020  th):.    """.   
+00015a30: 2047 6976 656e 2061 2070 6174 6820 7769   Given a path wi
+00015a40: 7468 2065 6c65 6d65 6e74 7320 7365 7061  th elements sepa
+00015a50: 7261 7465 6420 6279 0a20 2020 2070 6f73  rated by.    pos
+00015a60: 6978 7061 7468 2e73 6570 2c20 6765 6e65  ixpath.sep, gene
+00015a70: 7261 7465 2061 6c6c 2070 6172 656e 7473  rate all parents
+00015a80: 206f 6620 7468 6174 2070 6174 682e 0a0a   of that path...
+00015a90: 2020 2020 3e3e 3e20 6c69 7374 285f 7061      >>> list(_pa
+00015aa0: 7265 6e74 7328 2762 2f64 2729 290a 2020  rents('b/d')).  
+00015ab0: 2020 5b27 6227 5d0a 2020 2020 3e3e 3e20    ['b'].    >>> 
+00015ac0: 6c69 7374 285f 7061 7265 6e74 7328 272f  list(_parents('/
+00015ad0: 622f 642f 2729 290a 2020 2020 5b27 2f62  b/d/')).    ['/b
+00015ae0: 275d 0a20 2020 203e 3e3e 206c 6973 7428  '].    >>> list(
+00015af0: 5f70 6172 656e 7473 2827 622f 642f 662f  _parents('b/d/f/
+00015b00: 2729 290a 2020 2020 5b27 622f 6427 2c20  ')).    ['b/d', 
+00015b10: 2762 275d 0a20 2020 203e 3e3e 206c 6973  'b'].    >>> lis
+00015b20: 7428 5f70 6172 656e 7473 2827 6227 2929  t(_parents('b'))
+00015b30: 0a20 2020 205b 5d0a 2020 2020 3e3e 3e20  .    [].    >>> 
+00015b40: 6c69 7374 285f 7061 7265 6e74 7328 2727  list(_parents(''
+00015b50: 2929 0a20 2020 205b 5d0a 2020 2020 2222  )).    [].    ""
+00015b60: 220a 2020 2020 7265 7475 726e 2069 7465  ".    return ite
+00015b70: 7274 6f6f 6c73 2e69 736c 6963 6528 5f61  rtools.islice(_a
+00015b80: 6e63 6573 7472 7928 7061 7468 292c 2031  ncestry(path), 1
+00015b90: 2c20 4e6f 6e65 290a 0a0a 6465 6620 5f61  , None)...def _a
+00015ba0: 6e63 6573 7472 7928 7061 7468 293a 0a20  ncestry(path):. 
+00015bb0: 2020 2022 2222 0a20 2020 2047 6976 656e     """.    Given
+00015bc0: 2061 2070 6174 6820 7769 7468 2065 6c65   a path with ele
+00015bd0: 6d65 6e74 7320 7365 7061 7261 7465 6420  ments separated 
+00015be0: 6279 0a20 2020 2070 6f73 6978 7061 7468  by.    posixpath
+00015bf0: 2e73 6570 2c20 6765 6e65 7261 7465 2061  .sep, generate a
+00015c00: 6c6c 2065 6c65 6d65 6e74 7320 6f66 2074  ll elements of t
+00015c10: 6861 7420 7061 7468 0a0a 2020 2020 3e3e  hat path..    >>
+00015c20: 3e20 6c69 7374 285f 616e 6365 7374 7279  > list(_ancestry
+00015c30: 2827 622f 6427 2929 0a20 2020 205b 2762  ('b/d')).    ['b
+00015c40: 2f64 272c 2027 6227 5d0a 2020 2020 3e3e  /d', 'b'].    >>
+00015c50: 3e20 6c69 7374 285f 616e 6365 7374 7279  > list(_ancestry
+00015c60: 2827 2f62 2f64 2f27 2929 0a20 2020 205b  ('/b/d/')).    [
+00015c70: 272f 622f 6427 2c20 272f 6227 5d0a 2020  '/b/d', '/b'].  
+00015c80: 2020 3e3e 3e20 6c69 7374 285f 616e 6365    >>> list(_ance
+00015c90: 7374 7279 2827 622f 642f 662f 2729 290a  stry('b/d/f/')).
+00015ca0: 2020 2020 5b27 622f 642f 6627 2c20 2762      ['b/d/f', 'b
+00015cb0: 2f64 272c 2027 6227 5d0a 2020 2020 3e3e  /d', 'b'].    >>
+00015cc0: 3e20 6c69 7374 285f 616e 6365 7374 7279  > list(_ancestry
+00015cd0: 2827 6227 2929 0a20 2020 205b 2762 275d  ('b')).    ['b']
+00015ce0: 0a20 2020 203e 3e3e 206c 6973 7428 5f61  .    >>> list(_a
+00015cf0: 6e63 6573 7472 7928 2727 2929 0a20 2020  ncestry('')).   
+00015d00: 205b 5d0a 2020 2020 2222 220a 2020 2020   [].    """.    
+00015d10: 7061 7468 203d 2070 6174 682e 7273 7472  path = path.rstr
+00015d20: 6970 2870 6f73 6978 7061 7468 2e73 6570  ip(posixpath.sep
+00015d30: 290a 2020 2020 7768 696c 6520 7061 7468  ).    while path
+00015d40: 2061 6e64 2070 6174 6820 213d 2070 6f73   and path != pos
+00015d50: 6978 7061 7468 2e73 6570 3a0a 2020 2020  ixpath.sep:.    
+00015d60: 2020 2020 7969 656c 6420 7061 7468 0a20      yield path. 
+00015d70: 2020 2020 2020 2070 6174 682c 2074 6169         path, tai
+00015d80: 6c20 3d20 706f 7369 7870 6174 682e 7370  l = posixpath.sp
+00015d90: 6c69 7428 7061 7468 290a 0a0a 5f64 6564  lit(path)..._ded
+00015da0: 7570 6520 3d20 6469 6374 2e66 726f 6d6b  upe = dict.fromk
+00015db0: 6579 730a 2222 2244 6564 7570 6c69 6361  eys."""Deduplica
+00015dc0: 7465 2061 6e20 6974 6572 6162 6c65 2069  te an iterable i
+00015dd0: 6e20 6f72 6967 696e 616c 206f 7264 6572  n original order
+00015de0: 2222 220a 0a0a 6465 6620 5f64 6966 6665  """...def _diffe
+00015df0: 7265 6e63 6528 6d69 6e75 656e 642c 2073  rence(minuend, s
+00015e00: 7562 7472 6168 656e 6429 3a0a 2020 2020  ubtrahend):.    
+00015e10: 2222 220a 2020 2020 5265 7475 726e 2069  """.    Return i
+00015e20: 7465 6d73 2069 6e20 6d69 6e75 656e 6420  tems in minuend 
+00015e30: 6e6f 7420 696e 2073 7562 7472 6168 656e  not in subtrahen
+00015e40: 642c 2072 6574 6169 6e69 6e67 206f 7264  d, retaining ord
+00015e50: 6572 0a20 2020 2077 6974 6820 4f28 3129  er.    with O(1)
+00015e60: 206c 6f6f 6b75 702e 0a20 2020 2022 2222   lookup..    """
+00015e70: 0a20 2020 2072 6574 7572 6e20 6974 6572  .    return iter
+00015e80: 746f 6f6c 732e 6669 6c74 6572 6661 6c73  tools.filterfals
+00015e90: 6528 7365 7428 7375 6274 7261 6865 6e64  e(set(subtrahend
+00015ea0: 292e 5f5f 636f 6e74 6169 6e73 5f5f 2c20  ).__contains__, 
+00015eb0: 6d69 6e75 656e 6429 0a0a 0a63 6c61 7373  minuend)...class
+00015ec0: 2043 6f6d 706c 6574 6544 6972 7328 5a69   CompleteDirs(Zi
+00015ed0: 7046 696c 6529 3a0a 2020 2020 2222 220a  pFile):.    """.
+00015ee0: 2020 2020 4120 5a69 7046 696c 6520 7375      A ZipFile su
+00015ef0: 6263 6c61 7373 2074 6861 7420 656e 7375  bclass that ensu
+00015f00: 7265 7320 7468 6174 2069 6d70 6c69 6564  res that implied
+00015f10: 2064 6972 6563 746f 7269 6573 0a20 2020   directories.   
+00015f20: 2061 7265 2061 6c77 6179 7320 696e 636c   are always incl
+00015f30: 7564 6564 2069 6e20 7468 6520 6e61 6d65  uded in the name
+00015f40: 6c69 7374 2e0a 2020 2020 2222 220a 0a20  list..    """.. 
+00015f50: 2020 2040 7374 6174 6963 6d65 7468 6f64     @staticmethod
+00015f60: 0a20 2020 2064 6566 205f 696d 706c 6965  .    def _implie
+00015f70: 645f 6469 7273 286e 616d 6573 293a 0a20  d_dirs(names):. 
+00015f80: 2020 2020 2020 2070 6172 656e 7473 203d         parents =
+00015f90: 2069 7465 7274 6f6f 6c73 2e63 6861 696e   itertools.chain
+00015fa0: 2e66 726f 6d5f 6974 6572 6162 6c65 286d  .from_iterable(m
+00015fb0: 6170 285f 7061 7265 6e74 732c 206e 616d  ap(_parents, nam
+00015fc0: 6573 2929 0a20 2020 2020 2020 2061 735f  es)).        as_
+00015fd0: 6469 7273 203d 2028 7020 2b20 706f 7369  dirs = (p + posi
+00015fe0: 7870 6174 682e 7365 7020 666f 7220 7020  xpath.sep for p 
+00015ff0: 696e 2070 6172 656e 7473 290a 2020 2020  in parents).    
+00016000: 2020 2020 7265 7475 726e 205f 6465 6475      return _dedu
+00016010: 7065 285f 6469 6666 6572 656e 6365 2861  pe(_difference(a
+00016020: 735f 6469 7273 2c20 6e61 6d65 7329 290a  s_dirs, names)).
+00016030: 0a20 2020 2064 6566 206e 616d 656c 6973  .    def namelis
+00016040: 7428 7365 6c66 293a 0a20 2020 2020 2020  t(self):.       
+00016050: 206e 616d 6573 203d 2073 7570 6572 2843   names = super(C
+00016060: 6f6d 706c 6574 6544 6972 732c 2073 656c  ompleteDirs, sel
+00016070: 6629 2e6e 616d 656c 6973 7428 290a 2020  f).namelist().  
+00016080: 2020 2020 2020 7265 7475 726e 206e 616d        return nam
+00016090: 6573 202b 206c 6973 7428 7365 6c66 2e5f  es + list(self._
+000160a0: 696d 706c 6965 645f 6469 7273 286e 616d  implied_dirs(nam
+000160b0: 6573 2929 0a0a 2020 2020 6465 6620 5f6e  es))..    def _n
+000160c0: 616d 655f 7365 7428 7365 6c66 293a 0a20  ame_set(self):. 
+000160d0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+000160e0: 7428 7365 6c66 2e6e 616d 656c 6973 7428  t(self.namelist(
+000160f0: 2929 0a0a 2020 2020 6465 6620 7265 736f  ))..    def reso
+00016100: 6c76 655f 6469 7228 7365 6c66 2c20 6e61  lve_dir(self, na
+00016110: 6d65 293a 0a20 2020 2020 2020 2022 2222  me):.        """
+00016120: 0a20 2020 2020 2020 2049 6620 7468 6520  .        If the 
+00016130: 6e61 6d65 2072 6570 7265 7365 6e74 7320  name represents 
+00016140: 6120 6469 7265 6374 6f72 792c 2072 6574  a directory, ret
+00016150: 7572 6e20 7468 6174 206e 616d 650a 2020  urn that name.  
+00016160: 2020 2020 2020 6173 2061 2064 6972 6563        as a direc
+00016170: 746f 7279 2028 7769 7468 2074 6865 2074  tory (with the t
+00016180: 7261 696c 696e 6720 736c 6173 6829 2e0a  railing slash)..
+00016190: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000161a0: 2020 2020 6e61 6d65 7320 3d20 7365 6c66      names = self
+000161b0: 2e5f 6e61 6d65 5f73 6574 2829 0a20 2020  ._name_set().   
+000161c0: 2020 2020 2064 6972 6e61 6d65 203d 206e       dirname = n
+000161d0: 616d 6520 2b20 272f 270a 2020 2020 2020  ame + '/'.      
+000161e0: 2020 6469 725f 6d61 7463 6820 3d20 6e61    dir_match = na
+000161f0: 6d65 206e 6f74 2069 6e20 6e61 6d65 7320  me not in names 
+00016200: 616e 6420 6469 726e 616d 6520 696e 206e  and dirname in n
+00016210: 616d 6573 0a20 2020 2020 2020 2072 6574  ames.        ret
+00016220: 7572 6e20 6469 726e 616d 6520 6966 2064  urn dirname if d
+00016230: 6972 5f6d 6174 6368 2065 6c73 6520 6e61  ir_match else na
+00016240: 6d65 0a0a 2020 2020 4063 6c61 7373 6d65  me..    @classme
+00016250: 7468 6f64 0a20 2020 2064 6566 206d 616b  thod.    def mak
+00016260: 6528 636c 732c 2073 6f75 7263 6529 3a0a  e(cls, source):.
+00016270: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00016280: 2020 2020 4769 7665 6e20 6120 736f 7572      Given a sour
+00016290: 6365 2028 6669 6c65 6e61 6d65 206f 7220  ce (filename or 
+000162a0: 7a69 7066 696c 6529 2c20 7265 7475 726e  zipfile), return
+000162b0: 2061 6e0a 2020 2020 2020 2020 6170 7072   an.        appr
+000162c0: 6f70 7269 6174 6520 436f 6d70 6c65 7465  opriate Complete
+000162d0: 4469 7273 2073 7562 636c 6173 732e 0a20  Dirs subclass.. 
+000162e0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+000162f0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+00016300: 2873 6f75 7263 652c 2043 6f6d 706c 6574  (source, Complet
+00016310: 6544 6972 7329 3a0a 2020 2020 2020 2020  eDirs):.        
+00016320: 2020 2020 7265 7475 726e 2073 6f75 7263      return sourc
+00016330: 650a 0a20 2020 2020 2020 2069 6620 6e6f  e..        if no
+00016340: 7420 6973 696e 7374 616e 6365 2873 6f75  t isinstance(sou
+00016350: 7263 652c 205a 6970 4669 6c65 293a 0a20  rce, ZipFile):. 
+00016360: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00016370: 6e20 636c 7328 736f 7572 6365 290a 0a20  n cls(source).. 
+00016380: 2020 2020 2020 2023 204f 6e6c 7920 616c         # Only al
+00016390: 6c6f 7720 666f 7220 4661 7374 4c6f 6f6b  low for FastLook
+000163a0: 7570 2077 6865 6e20 7375 7070 6c69 6564  up when supplied
+000163b0: 207a 6970 6669 6c65 2069 7320 7265 6164   zipfile is read
+000163c0: 2d6f 6e6c 790a 2020 2020 2020 2020 6966  -only.        if
+000163d0: 2027 7227 206e 6f74 2069 6e20 736f 7572   'r' not in sour
+000163e0: 6365 2e6d 6f64 653a 0a20 2020 2020 2020  ce.mode:.       
+000163f0: 2020 2020 2063 6c73 203d 2043 6f6d 706c       cls = Compl
+00016400: 6574 6544 6972 730a 0a20 2020 2020 2020  eteDirs..       
+00016410: 2073 6f75 7263 652e 5f5f 636c 6173 735f   source.__class_
+00016420: 5f20 3d20 636c 730a 2020 2020 2020 2020  _ = cls.        
+00016430: 7265 7475 726e 2073 6f75 7263 650a 0a0a  return source...
+00016440: 636c 6173 7320 4661 7374 4c6f 6f6b 7570  class FastLookup
+00016450: 2843 6f6d 706c 6574 6544 6972 7329 3a0a  (CompleteDirs):.
+00016460: 2020 2020 2222 220a 2020 2020 5a69 7046      """.    ZipF
+00016470: 696c 6520 7375 6263 6c61 7373 2074 6f20  ile subclass to 
+00016480: 656e 7375 7265 2069 6d70 6c69 6369 740a  ensure implicit.
+00016490: 2020 2020 6469 7273 2065 7869 7374 2061      dirs exist a
+000164a0: 6e64 2061 7265 2072 6573 6f6c 7665 6420  nd are resolved 
+000164b0: 7261 7069 646c 792e 0a20 2020 2022 2222  rapidly..    """
+000164c0: 0a0a 2020 2020 6465 6620 6e61 6d65 6c69  ..    def nameli
+000164d0: 7374 2873 656c 6629 3a0a 2020 2020 2020  st(self):.      
+000164e0: 2020 7769 7468 2073 7570 7072 6573 7328    with suppress(
+000164f0: 4174 7472 6962 7574 6545 7272 6f72 293a  AttributeError):
+00016500: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00016510: 7572 6e20 7365 6c66 2e5f 5f6e 616d 6573  urn self.__names
+00016520: 0a20 2020 2020 2020 2073 656c 662e 5f5f  .        self.__
+00016530: 6e61 6d65 7320 3d20 7375 7065 7228 4661  names = super(Fa
+00016540: 7374 4c6f 6f6b 7570 2c20 7365 6c66 292e  stLookup, self).
+00016550: 6e61 6d65 6c69 7374 2829 0a20 2020 2020  namelist().     
+00016560: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+00016570: 5f6e 616d 6573 0a0a 2020 2020 6465 6620  _names..    def 
+00016580: 5f6e 616d 655f 7365 7428 7365 6c66 293a  _name_set(self):
+00016590: 0a20 2020 2020 2020 2077 6974 6820 7375  .        with su
+000165a0: 7070 7265 7373 2841 7474 7269 6275 7465  ppress(Attribute
+000165b0: 4572 726f 7229 3a0a 2020 2020 2020 2020  Error):.        
+000165c0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+000165d0: 5f5f 6c6f 6f6b 7570 0a20 2020 2020 2020  __lookup.       
+000165e0: 2073 656c 662e 5f5f 6c6f 6f6b 7570 203d   self.__lookup =
+000165f0: 2073 7570 6572 2846 6173 744c 6f6f 6b75   super(FastLooku
+00016600: 702c 2073 656c 6629 2e5f 6e61 6d65 5f73  p, self)._name_s
+00016610: 6574 2829 0a20 2020 2020 2020 2072 6574  et().        ret
+00016620: 7572 6e20 7365 6c66 2e5f 5f6c 6f6f 6b75  urn self.__looku
+00016630: 700a 0a0a 636c 6173 7320 5061 7468 286f  p...class Path(o
+00016640: 626a 6563 7429 3a0a 2020 2020 2222 220a  bject):.    """.
+00016650: 2020 2020 4120 7061 7468 6c69 622d 636f      A pathlib-co
+00016660: 6d70 6174 6962 6c65 2069 6e74 6572 6661  mpatible interfa
+00016670: 6365 2066 6f72 207a 6970 2066 696c 6573  ce for zip files
+00016680: 2e0a 0a20 2020 2043 6f6e 7369 6465 7220  ...    Consider 
+00016690: 6120 7a69 7020 6669 6c65 2077 6974 6820  a zip file with 
+000166a0: 7468 6973 2073 7472 7563 7475 7265 3a3a  this structure::
+000166b0: 0a0a 2020 2020 2020 2020 2e0a 2020 2020  ..        ..    
+000166c0: 2020 2020 e294 9ce2 9480 e294 8020 612e      ......... a.
+000166d0: 7478 740a 2020 2020 2020 2020 e294 94e2  txt.        ....
+000166e0: 9480 e294 8020 620a 2020 2020 2020 2020  ..... b.        
+000166f0: 2020 2020 e294 9ce2 9480 e294 8020 632e      ......... c.
+00016700: 7478 740a 2020 2020 2020 2020 2020 2020  txt.            
+00016710: e294 94e2 9480 e294 8020 640a 2020 2020  ......... d.    
+00016720: 2020 2020 2020 2020 2020 2020 e294 94e2              ....
+00016730: 9480 e294 8020 652e 7478 740a 0a20 2020  ..... e.txt..   
+00016740: 203e 3e3e 2064 6174 6120 3d20 696f 2e42   >>> data = io.B
+00016750: 7974 6573 494f 2829 0a20 2020 203e 3e3e  ytesIO().    >>>
+00016760: 207a 6620 3d20 5a69 7046 696c 6528 6461   zf = ZipFile(da
+00016770: 7461 2c20 2777 2729 0a20 2020 203e 3e3e  ta, 'w').    >>>
+00016780: 207a 662e 7772 6974 6573 7472 2827 612e   zf.writestr('a.
+00016790: 7478 7427 2c20 2763 6f6e 7465 6e74 206f  txt', 'content o
+000167a0: 6620 6127 290a 2020 2020 3e3e 3e20 7a66  f a').    >>> zf
+000167b0: 2e77 7269 7465 7374 7228 2762 2f63 2e74  .writestr('b/c.t
+000167c0: 7874 272c 2027 636f 6e74 656e 7420 6f66  xt', 'content of
+000167d0: 2063 2729 0a20 2020 203e 3e3e 207a 662e   c').    >>> zf.
+000167e0: 7772 6974 6573 7472 2827 622f 642f 652e  writestr('b/d/e.
+000167f0: 7478 7427 2c20 2763 6f6e 7465 6e74 206f  txt', 'content o
+00016800: 6620 6527 290a 2020 2020 3e3e 3e20 7a66  f e').    >>> zf
+00016810: 2e66 696c 656e 616d 6520 3d20 276d 656d  .filename = 'mem
+00016820: 2f61 6263 6465 2e7a 6970 270a 0a20 2020  /abcde.zip'..   
+00016830: 2050 6174 6820 6163 6365 7074 7320 7468   Path accepts th
+00016840: 6520 7a69 7066 696c 6520 6f62 6a65 6374  e zipfile object
+00016850: 2069 7473 656c 6620 6f72 2061 2066 696c   itself or a fil
+00016860: 656e 616d 650a 0a20 2020 203e 3e3e 2072  ename..    >>> r
+00016870: 6f6f 7420 3d20 5061 7468 287a 6629 0a0a  oot = Path(zf)..
+00016880: 2020 2020 4672 6f6d 2074 6865 7265 2c20      From there, 
+00016890: 7365 7665 7261 6c20 7061 7468 206f 7065  several path ope
+000168a0: 7261 7469 6f6e 7320 6172 6520 6176 6169  rations are avai
+000168b0: 6c61 626c 652e 0a0a 2020 2020 4469 7265  lable...    Dire
+000168c0: 6374 6f72 7920 6974 6572 6174 696f 6e20  ctory iteration 
+000168d0: 2869 6e63 6c75 6469 6e67 2074 6865 207a  (including the z
+000168e0: 6970 2066 696c 6520 6974 7365 6c66 293a  ip file itself):
+000168f0: 0a0a 2020 2020 3e3e 3e20 612c 2062 203d  ..    >>> a, b =
+00016900: 2072 6f6f 742e 6974 6572 6469 7228 290a   root.iterdir().
+00016910: 2020 2020 3e3e 3e20 610a 2020 2020 5061      >>> a.    Pa
+00016920: 7468 2827 6d65 6d2f 6162 6364 652e 7a69  th('mem/abcde.zi
+00016930: 7027 2c20 2761 2e74 7874 2729 0a20 2020  p', 'a.txt').   
+00016940: 203e 3e3e 2062 0a20 2020 2050 6174 6828   >>> b.    Path(
+00016950: 276d 656d 2f61 6263 6465 2e7a 6970 272c  'mem/abcde.zip',
+00016960: 2027 622f 2729 0a0a 2020 2020 6e61 6d65   'b/')..    name
+00016970: 2070 726f 7065 7274 793a 0a0a 2020 2020   property:..    
+00016980: 3e3e 3e20 622e 6e61 6d65 0a20 2020 2027  >>> b.name.    '
+00016990: 6227 0a0a 2020 2020 6a6f 696e 2077 6974  b'..    join wit
+000169a0: 6820 6469 7669 6465 206f 7065 7261 746f  h divide operato
+000169b0: 723a 0a0a 2020 2020 3e3e 3e20 6320 3d20  r:..    >>> c = 
+000169c0: 6220 2f20 2763 2e74 7874 270a 2020 2020  b / 'c.txt'.    
+000169d0: 3e3e 3e20 630a 2020 2020 5061 7468 2827  >>> c.    Path('
+000169e0: 6d65 6d2f 6162 6364 652e 7a69 7027 2c20  mem/abcde.zip', 
+000169f0: 2762 2f63 2e74 7874 2729 0a20 2020 203e  'b/c.txt').    >
+00016a00: 3e3e 2063 2e6e 616d 650a 2020 2020 2763  >> c.name.    'c
+00016a10: 2e74 7874 270a 0a20 2020 2052 6561 6420  .txt'..    Read 
+00016a20: 7465 7874 3a0a 0a20 2020 203e 3e3e 2063  text:..    >>> c
+00016a30: 2e72 6561 645f 7465 7874 2829 0a20 2020  .read_text().   
+00016a40: 2027 636f 6e74 656e 7420 6f66 2063 270a   'content of c'.
+00016a50: 0a20 2020 2065 7869 7374 656e 6365 3a0a  .    existence:.
+00016a60: 0a20 2020 203e 3e3e 2063 2e65 7869 7374  .    >>> c.exist
+00016a70: 7328 290a 2020 2020 5472 7565 0a20 2020  s().    True.   
+00016a80: 203e 3e3e 2028 6220 2f20 276d 6973 7369   >>> (b / 'missi
+00016a90: 6e67 2e74 7874 2729 2e65 7869 7374 7328  ng.txt').exists(
+00016aa0: 290a 2020 2020 4661 6c73 650a 0a20 2020  ).    False..   
+00016ab0: 2043 6f65 7263 696f 6e20 746f 2073 7472   Coercion to str
+00016ac0: 696e 673a 0a0a 2020 2020 3e3e 3e20 696d  ing:..    >>> im
+00016ad0: 706f 7274 206f 730a 2020 2020 3e3e 3e20  port os.    >>> 
+00016ae0: 7374 7228 6329 2e72 6570 6c61 6365 286f  str(c).replace(o
+00016af0: 732e 7365 702c 2070 6f73 6978 7061 7468  s.sep, posixpath
+00016b00: 2e73 6570 290a 2020 2020 276d 656d 2f61  .sep).    'mem/a
+00016b10: 6263 6465 2e7a 6970 2f62 2f63 2e74 7874  bcde.zip/b/c.txt
+00016b20: 270a 0a20 2020 2041 7420 7468 6520 726f  '..    At the ro
+00016b30: 6f74 2c20 6060 6e61 6d65 6060 2c20 6060  ot, ``name``, ``
+00016b40: 6669 6c65 6e61 6d65 6060 2c20 616e 6420  filename``, and 
+00016b50: 6060 7061 7265 6e74 6060 0a20 2020 2072  ``parent``.    r
+00016b60: 6573 6f6c 7665 2074 6f20 7468 6520 7a69  esolve to the zi
+00016b70: 7066 696c 652e 204e 6f74 6520 7468 6573  pfile. Note thes
+00016b80: 6520 6174 7472 6962 7574 6573 2061 7265  e attributes are
+00016b90: 206e 6f74 0a20 2020 2076 616c 6964 2061   not.    valid a
+00016ba0: 6e64 2077 696c 6c20 7261 6973 6520 6120  nd will raise a 
+00016bb0: 6060 5661 6c75 6545 7272 6f72 6060 2069  ``ValueError`` i
+00016bc0: 6620 7468 6520 7a69 7066 696c 650a 2020  f the zipfile.  
+00016bd0: 2020 6861 7320 6e6f 2066 696c 656e 616d    has no filenam
+00016be0: 652e 0a0a 2020 2020 3e3e 3e20 726f 6f74  e...    >>> root
+00016bf0: 2e6e 616d 650a 2020 2020 2761 6263 6465  .name.    'abcde
+00016c00: 2e7a 6970 270a 2020 2020 3e3e 3e20 7374  .zip'.    >>> st
+00016c10: 7228 726f 6f74 2e66 696c 656e 616d 6529  r(root.filename)
+00016c20: 2e72 6570 6c61 6365 286f 732e 7365 702c  .replace(os.sep,
+00016c30: 2070 6f73 6978 7061 7468 2e73 6570 290a   posixpath.sep).
+00016c40: 2020 2020 276d 656d 2f61 6263 6465 2e7a      'mem/abcde.z
+00016c50: 6970 270a 2020 2020 3e3e 3e20 7374 7228  ip'.    >>> str(
+00016c60: 726f 6f74 2e70 6172 656e 7429 0a20 2020  root.parent).   
+00016c70: 2027 6d65 6d27 0a20 2020 2022 2222 0a0a   'mem'.    """..
+00016c80: 2020 2020 5f5f 7265 7072 203d 2022 7b73      __repr = "{s
+00016c90: 656c 662e 5f5f 636c 6173 735f 5f2e 5f5f  elf.__class__.__
+00016ca0: 6e61 6d65 5f5f 7d28 7b73 656c 662e 726f  name__}({self.ro
+00016cb0: 6f74 2e66 696c 656e 616d 6521 727d 2c20  ot.filename!r}, 
+00016cc0: 7b73 656c 662e 6174 2172 7d29 220a 0a20  {self.at!r})".. 
+00016cd0: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
+00016ce0: 7365 6c66 2c20 726f 6f74 2c20 6174 3d22  self, root, at="
+00016cf0: 2229 3a0a 2020 2020 2020 2020 2222 220a  "):.        """.
+00016d00: 2020 2020 2020 2020 436f 6e73 7472 7563          Construc
+00016d10: 7420 6120 5061 7468 2066 726f 6d20 6120  t a Path from a 
+00016d20: 5a69 7046 696c 6520 6f72 2066 696c 656e  ZipFile or filen
+00016d30: 616d 652e 0a0a 2020 2020 2020 2020 4e6f  ame...        No
+00016d40: 7465 3a20 5768 656e 2074 6865 2073 6f75  te: When the sou
+00016d50: 7263 6520 6973 2061 6e20 6578 6973 7469  rce is an existi
+00016d60: 6e67 205a 6970 4669 6c65 206f 626a 6563  ng ZipFile objec
+00016d70: 742c 0a20 2020 2020 2020 2069 7473 2074  t,.        its t
+00016d80: 7970 6520 285f 5f63 6c61 7373 5f5f 2920  ype (__class__) 
+00016d90: 7769 6c6c 2062 6520 6d75 7461 7465 6420  will be mutated 
+00016da0: 746f 2061 0a20 2020 2020 2020 2073 7065  to a.        spe
+00016db0: 6369 616c 697a 6564 2074 7970 652e 2049  cialized type. I
+00016dc0: 6620 7468 6520 6361 6c6c 6572 2077 6973  f the caller wis
+00016dd0: 6865 7320 746f 2072 6574 6169 6e20 7468  hes to retain th
+00016de0: 650a 2020 2020 2020 2020 6f72 6967 696e  e.        origin
+00016df0: 616c 2074 7970 652c 2074 6865 2063 616c  al type, the cal
+00016e00: 6c65 7220 7368 6f75 6c64 2065 6974 6865  ler should eithe
+00016e10: 7220 6372 6561 7465 2061 0a20 2020 2020  r create a.     
+00016e20: 2020 2073 6570 6172 6174 6520 5a69 7046     separate ZipF
+00016e30: 696c 6520 6f62 6a65 6374 206f 7220 7061  ile object or pa
+00016e40: 7373 2061 2066 696c 656e 616d 652e 0a20  ss a filename.. 
+00016e50: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00016e60: 2020 2073 656c 662e 726f 6f74 203d 2046     self.root = F
+00016e70: 6173 744c 6f6f 6b75 702e 6d61 6b65 2872  astLookup.make(r
+00016e80: 6f6f 7429 0a20 2020 2020 2020 2073 656c  oot).        sel
+00016e90: 662e 6174 203d 2061 740a 0a20 2020 2064  f.at = at..    d
+00016ea0: 6566 206f 7065 6e28 7365 6c66 2c20 6d6f  ef open(self, mo
+00016eb0: 6465 3d27 7227 2c20 2a61 7267 732c 202a  de='r', *args, *
+00016ec0: 2a6b 7761 7267 7329 3a0a 2020 2020 2020  *kwargs):.      
+00016ed0: 2020 2222 220a 2020 2020 2020 2020 4f70    """.        Op
+00016ee0: 656e 2074 6869 7320 656e 7472 7920 6173  en this entry as
+00016ef0: 2074 6578 7420 6f72 2062 696e 6172 7920   text or binary 
+00016f00: 666f 6c6c 6f77 696e 6720 7468 6520 7365  following the se
+00016f10: 6d61 6e74 6963 730a 2020 2020 2020 2020  mantics.        
+00016f20: 6f66 2060 6070 6174 686c 6962 2e50 6174  of ``pathlib.Pat
+00016f30: 682e 6f70 656e 2829 6060 2062 7920 7061  h.open()`` by pa
+00016f40: 7373 696e 6720 6172 6775 6d65 6e74 7320  ssing arguments 
+00016f50: 7468 726f 7567 680a 2020 2020 2020 2020  through.        
+00016f60: 746f 2069 6f2e 5465 7874 494f 5772 6170  to io.TextIOWrap
+00016f70: 7065 7228 292e 0a20 2020 2020 2020 2022  per()..        "
+00016f80: 2222 0a20 2020 2020 2020 2070 7764 203d  "".        pwd =
+00016f90: 206b 7761 7267 732e 706f 7028 2770 7764   kwargs.pop('pwd
+00016fa0: 272c 204e 6f6e 6529 0a20 2020 2020 2020  ', None).       
+00016fb0: 2069 6620 7365 6c66 2e69 735f 6469 7228   if self.is_dir(
+00016fc0: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
+00016fd0: 6620 7379 732e 7665 7273 696f 6e5f 696e  f sys.version_in
+00016fe0: 666f 5b30 5d3e 3d33 3a0a 2020 2020 2020  fo[0]>=3:.      
+00016ff0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00017000: 4973 4144 6972 6563 746f 7279 4572 726f  IsADirectoryErro
+00017010: 7228 7365 6c66 290a 2020 2020 2020 2020  r(self).        
+00017020: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00017030: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00017040: 4f53 4572 726f 7228 6572 726e 6f2e 4549  OSError(errno.EI
+00017050: 5344 4952 2c20 7365 6c66 290a 2020 2020  SDIR, self).    
+00017060: 2020 2020 7a69 705f 6d6f 6465 203d 206d      zip_mode = m
+00017070: 6f64 655b 305d 0a20 2020 2020 2020 2069  ode[0].        i
+00017080: 6620 6e6f 7420 7365 6c66 2e65 7869 7374  f not self.exist
+00017090: 7328 2920 616e 6420 7a69 705f 6d6f 6465  s() and zip_mode
+000170a0: 203d 3d20 2772 273a 0a20 2020 2020 2020   == 'r':.       
+000170b0: 2020 2020 2069 6620 7379 732e 7665 7273       if sys.vers
+000170c0: 696f 6e5f 696e 666f 5b30 5d3e 3d33 3a0a  ion_info[0]>=3:.
+000170d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000170e0: 7261 6973 6520 4669 6c65 4e6f 7446 6f75  raise FileNotFou
+000170f0: 6e64 4572 726f 7228 7365 6c66 290a 2020  ndError(self).  
+00017100: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00017110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017120: 7261 6973 6520 4f53 4572 726f 7228 6572  raise OSError(er
+00017130: 726e 6f2e 454e 4f45 4e54 2c20 7365 6c66  rno.ENOENT, self
+00017140: 290a 2020 2020 2020 2020 7374 7265 616d  ).        stream
+00017150: 203d 2073 656c 662e 726f 6f74 2e6f 7065   = self.root.ope
+00017160: 6e28 7365 6c66 2e61 742c 207a 6970 5f6d  n(self.at, zip_m
+00017170: 6f64 652c 2070 7764 3d70 7764 290a 2020  ode, pwd=pwd).  
+00017180: 2020 2020 2020 6966 2027 6227 2069 6e20        if 'b' in 
+00017190: 6d6f 6465 3a0a 2020 2020 2020 2020 2020  mode:.          
+000171a0: 2020 6966 2061 7267 7320 6f72 206b 7761    if args or kwa
+000171b0: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
+000171c0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+000171d0: 4572 726f 7228 2265 6e63 6f64 696e 6720  Error("encoding 
+000171e0: 6172 6773 2069 6e76 616c 6964 2066 6f72  args invalid for
+000171f0: 2062 696e 6172 7920 6f70 6572 6174 696f   binary operatio
+00017200: 6e22 290a 2020 2020 2020 2020 2020 2020  n").            
+00017210: 7265 7475 726e 2073 7472 6561 6d0a 2020  return stream.  
+00017220: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00017230: 2020 2020 2020 2020 6966 2073 7973 2e76          if sys.v
+00017240: 6572 7369 6f6e 5f69 6e66 6f5b 305d 3e3d  ersion_info[0]>=
+00017250: 333a 0a20 2020 2020 2020 2020 2020 2020  3:.             
+00017260: 2020 206b 7761 7267 735b 2265 6e63 6f64     kwargs["encod
+00017270: 696e 6722 5d20 3d20 7465 7874 5f65 6e63  ing"] = text_enc
+00017280: 6f64 696e 6728 6b77 6172 6773 2e67 6574  oding(kwargs.get
+00017290: 2822 656e 636f 6469 6e67 2229 290a 2020  ("encoding")).  
+000172a0: 2020 2020 2020 7265 7475 726e 2069 6f2e        return io.
+000172b0: 5465 7874 494f 5772 6170 7065 7228 7374  TextIOWrapper(st
+000172c0: 7265 616d 2c20 2a61 7267 732c 202a 2a6b  ream, *args, **k
+000172d0: 7761 7267 7329 0a0a 2020 2020 4070 726f  wargs)..    @pro
+000172e0: 7065 7274 790a 2020 2020 6465 6620 6e61  perty.    def na
+000172f0: 6d65 2873 656c 6629 3a0a 2020 2020 2020  me(self):.      
+00017300: 2020 7265 7475 726e 2050 6174 6828 7365    return Path(se
+00017310: 6c66 2e61 7429 2e6e 616d 6520 6f72 2073  lf.at).name or s
+00017320: 656c 662e 6669 6c65 6e61 6d65 2e6e 616d  elf.filename.nam
+00017330: 650a 0a20 2020 2040 7072 6f70 6572 7479  e..    @property
+00017340: 0a20 2020 2064 6566 2066 696c 656e 616d  .    def filenam
+00017350: 6528 7365 6c66 293a 0a20 2020 2020 2020  e(self):.       
+00017360: 2072 6574 7572 6e20 5061 7468 2873 656c   return Path(sel
+00017370: 662e 726f 6f74 2e66 696c 656e 616d 6529  f.root.filename)
+00017380: 2e6a 6f69 6e70 6174 6828 7365 6c66 2e61  .joinpath(self.a
+00017390: 7429 0a0a 2020 2020 6465 6620 7265 6164  t)..    def read
+000173a0: 5f74 6578 7428 7365 6c66 2c20 2a61 7267  _text(self, *arg
+000173b0: 732c 202a 2a6b 7761 7267 7329 3a0a 2020  s, **kwargs):.  
+000173c0: 2020 2020 2020 6966 2073 7973 2e76 6572        if sys.ver
+000173d0: 7369 6f6e 5f69 6e66 6f5b 305d 3e3d 333a  sion_info[0]>=3:
+000173e0: 0a20 2020 2020 2020 2020 2020 206b 7761  .            kwa
+000173f0: 7267 735b 2265 6e63 6f64 696e 6722 5d20  rgs["encoding"] 
+00017400: 3d20 7465 7874 5f65 6e63 6f64 696e 6728  = text_encoding(
+00017410: 6b77 6172 6773 2e67 6574 2822 656e 636f  kwargs.get("enco
+00017420: 6469 6e67 2229 290a 2020 2020 2020 2020  ding")).        
+00017430: 7769 7468 2073 656c 662e 6f70 656e 2827  with self.open('
+00017440: 7227 2c20 2a61 7267 732c 202a 2a6b 7761  r', *args, **kwa
+00017450: 7267 7329 2061 7320 7374 726d 3a0a 2020  rgs) as strm:.  
+00017460: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00017470: 2073 7472 6d2e 7265 6164 2829 0a0a 2020   strm.read()..  
+00017480: 2020 6465 6620 7265 6164 5f62 7974 6573    def read_bytes
+00017490: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+000174a0: 7769 7468 2073 656c 662e 6f70 656e 2827  with self.open('
+000174b0: 7262 2729 2061 7320 7374 726d 3a0a 2020  rb') as strm:.  
+000174c0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+000174d0: 2073 7472 6d2e 7265 6164 2829 0a0a 2020   strm.read()..  
+000174e0: 2020 6465 6620 5f69 735f 6368 696c 6428    def _is_child(
+000174f0: 7365 6c66 2c20 7061 7468 293a 0a20 2020  self, path):.   
+00017500: 2020 2020 2072 6574 7572 6e20 706f 7369       return posi
+00017510: 7870 6174 682e 6469 726e 616d 6528 7061  xpath.dirname(pa
+00017520: 7468 2e61 742e 7273 7472 6970 2822 2f22  th.at.rstrip("/"
+00017530: 2929 203d 3d20 7365 6c66 2e61 742e 7273  )) == self.at.rs
+00017540: 7472 6970 2822 2f22 290a 0a20 2020 2064  trip("/")..    d
+00017550: 6566 205f 6e65 7874 2873 656c 662c 2061  ef _next(self, a
+00017560: 7429 3a0a 2020 2020 2020 2020 7265 7475  t):.        retu
+00017570: 726e 2073 656c 662e 5f5f 636c 6173 735f  rn self.__class_
+00017580: 5f28 7365 6c66 2e72 6f6f 742c 2061 7429  _(self.root, at)
+00017590: 0a0a 2020 2020 6465 6620 6973 5f64 6972  ..    def is_dir
+000175a0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+000175b0: 7265 7475 726e 206e 6f74 2073 656c 662e  return not self.
+000175c0: 6174 206f 7220 7365 6c66 2e61 742e 656e  at or self.at.en
+000175d0: 6473 7769 7468 2822 2f22 290a 0a20 2020  dswith("/")..   
+000175e0: 2064 6566 2069 735f 6669 6c65 2873 656c   def is_file(sel
+000175f0: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
+00017600: 726e 2073 656c 662e 6578 6973 7473 2829  rn self.exists()
+00017610: 2061 6e64 206e 6f74 2073 656c 662e 6973   and not self.is
+00017620: 5f64 6972 2829 0a0a 2020 2020 6465 6620  _dir()..    def 
+00017630: 6578 6973 7473 2873 656c 6629 3a0a 2020  exists(self):.  
+00017640: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00017650: 662e 6174 2069 6e20 7365 6c66 2e72 6f6f  f.at in self.roo
+00017660: 742e 5f6e 616d 655f 7365 7428 290a 0a20  t._name_set().. 
+00017670: 2020 2064 6566 2069 7465 7264 6972 2873     def iterdir(s
+00017680: 656c 6629 3a0a 2020 2020 2020 2020 6966  elf):.        if
+00017690: 206e 6f74 2073 656c 662e 6973 5f64 6972   not self.is_dir
+000176a0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+000176b0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+000176c0: 2822 4361 6e27 7420 6c69 7374 6469 7220  ("Can't listdir 
+000176d0: 6120 6669 6c65 2229 0a20 2020 2020 2020  a file").       
+000176e0: 2073 7562 7320 3d20 6d61 7028 7365 6c66   subs = map(self
+000176f0: 2e5f 6e65 7874 2c20 7365 6c66 2e72 6f6f  ._next, self.roo
+00017700: 742e 6e61 6d65 6c69 7374 2829 290a 2020  t.namelist()).  
+00017710: 2020 2020 2020 7265 7475 726e 2066 696c        return fil
+00017720: 7465 7228 7365 6c66 2e5f 6973 5f63 6869  ter(self._is_chi
+00017730: 6c64 2c20 7375 6273 290a 0a20 2020 2064  ld, subs)..    d
+00017740: 6566 205f 5f73 7472 5f5f 2873 656c 6629  ef __str__(self)
+00017750: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+00017760: 2070 6f73 6978 7061 7468 2e6a 6f69 6e28   posixpath.join(
+00017770: 7365 6c66 2e72 6f6f 742e 6669 6c65 6e61  self.root.filena
+00017780: 6d65 2c20 7365 6c66 2e61 7429 0a0a 2020  me, self.at)..  
+00017790: 2020 6465 6620 5f5f 7265 7072 5f5f 2873    def __repr__(s
+000177a0: 656c 6629 3a0a 2020 2020 2020 2020 7265  elf):.        re
+000177b0: 7475 726e 2073 656c 662e 5f5f 7265 7072  turn self.__repr
+000177c0: 2e66 6f72 6d61 7428 7365 6c66 3d73 656c  .format(self=sel
+000177d0: 6629 0a0a 2020 2020 6465 6620 6a6f 696e  f)..    def join
+000177e0: 7061 7468 2873 656c 662c 202a 6f74 6865  path(self, *othe
+000177f0: 7229 3a0a 2020 2020 2020 2020 6e65 7874  r):.        next
+00017800: 203d 2070 6f73 6978 7061 7468 2e6a 6f69   = posixpath.joi
+00017810: 6e28 7365 6c66 2e61 742c 202a 6f74 6865  n(self.at, *othe
+00017820: 7229 0a20 2020 2020 2020 2072 6574 7572  r).        retur
+00017830: 6e20 7365 6c66 2e5f 6e65 7874 2873 656c  n self._next(sel
+00017840: 662e 726f 6f74 2e72 6573 6f6c 7665 5f64  f.root.resolve_d
+00017850: 6972 286e 6578 7429 290a 0a20 2020 2069  ir(next))..    i
+00017860: 6620 7379 732e 7665 7273 696f 6e5f 696e  f sys.version_in
+00017870: 666f 5b30 5d3e 3d33 3a0a 2020 2020 2020  fo[0]>=3:.      
+00017880: 2020 5f5f 7472 7565 6469 765f 5f20 3d20    __truediv__ = 
+00017890: 6a6f 696e 7061 7468 0a20 2020 2065 6c73  joinpath.    els
+000178a0: 653a 0a20 2020 2020 2020 205f 5f64 6976  e:.        __div
+000178b0: 5f5f 203d 206a 6f69 6e70 6174 680a 0a20  __ = joinpath.. 
+000178c0: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
+000178d0: 2064 6566 2070 6172 656e 7428 7365 6c66   def parent(self
+000178e0: 293a 0a20 2020 2020 2020 2069 6620 6e6f  ):.        if no
+000178f0: 7420 7365 6c66 2e61 743a 0a20 2020 2020  t self.at:.     
+00017900: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00017910: 6c66 2e66 696c 656e 616d 652e 7061 7265  lf.filename.pare
+00017920: 6e74 0a20 2020 2020 2020 2070 6172 656e  nt.        paren
+00017930: 745f 6174 203d 2070 6f73 6978 7061 7468  t_at = posixpath
+00017940: 2e64 6972 6e61 6d65 2873 656c 662e 6174  .dirname(self.at
+00017950: 2e72 7374 7269 7028 272f 2729 290a 2020  .rstrip('/')).  
+00017960: 2020 2020 2020 6966 2070 6172 656e 745f        if parent_
+00017970: 6174 3a0a 2020 2020 2020 2020 2020 2020  at:.            
+00017980: 7061 7265 6e74 5f61 7420 2b3d 2027 2f27  parent_at += '/'
+00017990: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000179a0: 7365 6c66 2e5f 6e65 7874 2870 6172 656e  self._next(paren
+000179b0: 745f 6174 290a 0a0a 6465 6620 6d61 696e  t_at)...def main
+000179c0: 2861 7267 733d 4e6f 6e65 293a 0a20 2020  (args=None):.   
+000179d0: 2069 6d70 6f72 7420 6172 6770 6172 7365   import argparse
+000179e0: 0a0a 2020 2020 6465 7363 7269 7074 696f  ..    descriptio
+000179f0: 6e20 3d20 2741 2073 696d 706c 6520 636f  n = 'A simple co
+00017a00: 6d6d 616e 642d 6c69 6e65 2069 6e74 6572  mmand-line inter
+00017a10: 6661 6365 2066 6f72 207a 6970 6669 6c65  face for zipfile
+00017a20: 206d 6f64 756c 652e 270a 2020 2020 7061   module.'.    pa
+00017a30: 7273 6572 203d 2061 7267 7061 7273 652e  rser = argparse.
+00017a40: 4172 6775 6d65 6e74 5061 7273 6572 2864  ArgumentParser(d
+00017a50: 6573 6372 6970 7469 6f6e 3d64 6573 6372  escription=descr
+00017a60: 6970 7469 6f6e 290a 2020 2020 6772 6f75  iption).    grou
+00017a70: 7020 3d20 7061 7273 6572 2e61 6464 5f6d  p = parser.add_m
+00017a80: 7574 7561 6c6c 795f 6578 636c 7573 6976  utually_exclusiv
+00017a90: 655f 6772 6f75 7028 7265 7175 6972 6564  e_group(required
+00017aa0: 3d54 7275 6529 0a20 2020 2067 726f 7570  =True).    group
+00017ab0: 2e61 6464 5f61 7267 756d 656e 7428 272d  .add_argument('-
+00017ac0: 6c27 2c20 272d 2d6c 6973 7427 2c20 6d65  l', '--list', me
+00017ad0: 7461 7661 723d 273c 7a69 7066 696c 653e  tavar='<zipfile>
+00017ae0: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
+00017af0: 2020 2020 2020 2020 2020 6865 6c70 3d27            help='
+00017b00: 5368 6f77 206c 6973 7469 6e67 206f 6620  Show listing of 
+00017b10: 6120 7a69 7066 696c 6527 290a 2020 2020  a zipfile').    
+00017b20: 6772 6f75 702e 6164 645f 6172 6775 6d65  group.add_argume
+00017b30: 6e74 2827 2d65 272c 2027 2d2d 6578 7472  nt('-e', '--extr
+00017b40: 6163 7427 2c20 6e61 7267 733d 322c 0a20  act', nargs=2,. 
+00017b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017b60: 2020 2020 2020 6d65 7461 7661 723d 2827        metavar=('
+00017b70: 3c7a 6970 6669 6c65 3e27 2c20 273c 6f75  <zipfile>', '<ou
+00017b80: 7470 7574 5f64 6972 3e27 292c 0a20 2020  tput_dir>'),.   
+00017b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017ba0: 2020 2020 6865 6c70 3d27 4578 7472 6163      help='Extrac
+00017bb0: 7420 7a69 7066 696c 6520 696e 746f 2074  t zipfile into t
+00017bc0: 6172 6765 7420 6469 7227 290a 2020 2020  arget dir').    
+00017bd0: 6772 6f75 702e 6164 645f 6172 6775 6d65  group.add_argume
+00017be0: 6e74 2827 2d63 272c 2027 2d2d 6372 6561  nt('-c', '--crea
+00017bf0: 7465 272c 206e 6172 6773 3d27 2b27 2c0a  te', nargs='+',.
+00017c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017c10: 2020 2020 2020 206d 6574 6176 6172 3d28         metavar=(
+00017c20: 273c 6e61 6d65 3e27 2c20 273c 6669 6c65  '<name>', '<file
+00017c30: 3e27 292c 0a20 2020 2020 2020 2020 2020  >'),.           
+00017c40: 2020 2020 2020 2020 2020 2020 6865 6c70              help
+00017c50: 3d27 4372 6561 7465 207a 6970 6669 6c65  ='Create zipfile
+00017c60: 2066 726f 6d20 736f 7572 6365 7327 290a   from sources').
+00017c70: 2020 2020 6772 6f75 702e 6164 645f 6172      group.add_ar
+00017c80: 6775 6d65 6e74 2827 2d74 272c 2027 2d2d  gument('-t', '--
+00017c90: 7465 7374 272c 206d 6574 6176 6172 3d27  test', metavar='
+00017ca0: 3c7a 6970 6669 6c65 3e27 2c0a 2020 2020  <zipfile>',.    
+00017cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017cc0: 2020 2068 656c 703d 2754 6573 7420 6966     help='Test if
+00017cd0: 2061 207a 6970 6669 6c65 2069 7320 7661   a zipfile is va
+00017ce0: 6c69 6427 290a 2020 2020 7061 7273 6572  lid').    parser
+00017cf0: 2e61 6464 5f61 7267 756d 656e 7428 272d  .add_argument('-
+00017d00: 6d27 2c20 272d 2d6d 6574 686f 6427 2c20  m', '--method', 
+00017d10: 7479 7065 3d73 7472 2c20 6d65 7461 7661  type=str, metava
+00017d20: 723d 273c 6d65 7468 6f64 3e27 2c20 6465  r='<method>', de
+00017d30: 6661 756c 743d 2744 4546 4c41 5445 272c  fault='DEFLATE',
+00017d40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017d50: 2020 2020 2020 2020 6865 6c70 3d27 636f          help='co
+00017d60: 6d70 7265 7373 696f 6e20 6d65 7468 6f64  mpression method
+00017d70: 2028 6d75 7374 2063 6f6d 6520 6265 666f   (must come befo
+00017d80: 7265 202d 6329 2729 0a20 2020 2070 6172  re -c)').    par
+00017d90: 7365 722e 6164 645f 6172 6775 6d65 6e74  ser.add_argument
+00017da0: 2827 2d78 272c 2027 2d2d 6c65 7665 6c27  ('-x', '--level'
+00017db0: 2c20 7479 7065 3d69 6e74 2c20 6d65 7461  , type=int, meta
+00017dc0: 7661 723d 273c 6c65 7665 6c3e 272c 2064  var='<level>', d
+00017dd0: 6566 6175 6c74 3d4e 6f6e 652c 0a20 2020  efault=None,.   
+00017de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017df0: 2020 2020 6865 6c70 3d27 636f 6d70 7265      help='compre
+00017e00: 7373 696f 6e20 6c65 7665 6c20 286d 7573  ssion level (mus
+00017e10: 7420 636f 6d65 2062 6566 6f72 6520 2d63  t come before -c
+00017e20: 2927 290a 2020 2020 6172 6773 203d 2070  )').    args = p
+00017e30: 6172 7365 722e 7061 7273 655f 6172 6773  arser.parse_args
+00017e40: 2861 7267 7329 0a0a 2020 2020 6966 2061  (args)..    if a
+00017e50: 7267 732e 7465 7374 2069 7320 6e6f 7420  rgs.test is not 
+00017e60: 4e6f 6e65 3a0a 2020 2020 2020 2020 7372  None:.        sr
+00017e70: 6320 3d20 6172 6773 2e74 6573 740a 2020  c = args.test.  
+00017e80: 2020 2020 2020 7769 7468 205a 6970 4669        with ZipFi
+00017e90: 6c65 2873 7263 2c20 2772 2729 2061 7320  le(src, 'r') as 
+00017ea0: 7a66 3a0a 2020 2020 2020 2020 2020 2020  zf:.            
+00017eb0: 6261 6466 696c 6520 3d20 7a66 2e74 6573  badfile = zf.tes
+00017ec0: 747a 6970 2829 0a20 2020 2020 2020 2069  tzip().        i
+00017ed0: 6620 6261 6466 696c 653a 0a20 2020 2020  f badfile:.     
+00017ee0: 2020 2020 2020 2070 7269 6e74 2822 5468         print("Th
+00017ef0: 6520 666f 6c6c 6f77 696e 6720 656e 636c  e following encl
+00017f00: 6f73 6564 2066 696c 6520 6973 2063 6f72  osed file is cor
+00017f10: 7275 7074 6564 3a20 7b21 727d 222e 666f  rupted: {!r}".fo
+00017f20: 726d 6174 2862 6164 6669 6c65 2929 0a20  rmat(badfile)). 
+00017f30: 2020 2020 2020 2070 7269 6e74 2822 446f         print("Do
+00017f40: 6e65 2074 6573 7469 6e67 2229 0a0a 2020  ne testing")..  
+00017f50: 2020 656c 6966 2061 7267 732e 6c69 7374    elif args.list
+00017f60: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00017f70: 2020 2020 2020 7372 6320 3d20 6172 6773        src = args
+00017f80: 2e6c 6973 740a 2020 2020 2020 2020 7769  .list.        wi
+00017f90: 7468 205a 6970 4669 6c65 2873 7263 2c20  th ZipFile(src, 
+00017fa0: 2772 2729 2061 7320 7a66 3a0a 2020 2020  'r') as zf:.    
+00017fb0: 2020 2020 2020 2020 7a66 2e70 7269 6e74          zf.print
+00017fc0: 6469 7228 290a 0a20 2020 2065 6c69 6620  dir()..    elif 
+00017fd0: 6172 6773 2e65 7874 7261 6374 2069 7320  args.extract is 
+00017fe0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00017ff0: 2020 7372 632c 2063 7572 6469 7220 3d20    src, curdir = 
+00018000: 6172 6773 2e65 7874 7261 6374 0a20 2020  args.extract.   
+00018010: 2020 2020 2077 6974 6820 5a69 7046 696c       with ZipFil
+00018020: 6528 7372 632c 2027 7227 2920 6173 207a  e(src, 'r') as z
+00018030: 663a 0a20 2020 2020 2020 2020 2020 207a  f:.            z
+00018040: 662e 6578 7472 6163 7461 6c6c 2863 7572  f.extractall(cur
+00018050: 6469 7229 0a0a 2020 2020 656c 6966 2061  dir)..    elif a
+00018060: 7267 732e 6372 6561 7465 2069 7320 6e6f  rgs.create is no
+00018070: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00018080: 7a69 705f 6e61 6d65 203d 2061 7267 732e  zip_name = args.
+00018090: 6372 6561 7465 2e70 6f70 2830 290a 2020  create.pop(0).  
+000180a0: 2020 2020 2020 6669 6c65 7320 3d20 6172        files = ar
+000180b0: 6773 2e63 7265 6174 650a 2020 2020 2020  gs.create.      
+000180c0: 2020 736d 6574 686f 6420 3d20 6172 6773    smethod = args
+000180d0: 2e6d 6574 686f 642e 7570 7065 7228 290a  .method.upper().
+000180e0: 2020 2020 2020 2020 6966 2073 6d65 7468          if smeth
+000180f0: 6f64 203d 3d20 2744 4546 4c41 5445 273a  od == 'DEFLATE':
+00018100: 0a20 2020 2020 2020 2020 2020 2073 6d65  .            sme
+00018110: 7468 6f64 203d 2027 4445 464c 4154 4544  thod = 'DEFLATED
+00018120: 270a 2020 2020 2020 2020 6966 2073 6d65  '.        if sme
+00018130: 7468 6f64 203d 3d20 2744 434c 494d 504c  thod == 'DCLIMPL
+00018140: 4f44 4527 3a0a 2020 2020 2020 2020 2020  ODE':.          
+00018150: 2020 736d 6574 686f 6420 3d20 2744 434c    smethod = 'DCL
+00018160: 494d 504c 4f44 4544 270a 2020 2020 2020  IMPLODED'.      
+00018170: 2020 6966 2073 6d65 7468 6f64 203d 3d20    if smethod == 
+00018180: 2753 544f 5245 273a 0a20 2020 2020 2020  'STORE':.       
+00018190: 2020 2020 2073 6d65 7468 6f64 203d 2027       smethod = '
+000181a0: 5354 4f52 4544 270a 2020 2020 2020 2020  STORED'.        
+000181b0: 6d65 7468 6f64 203d 2067 6c6f 6261 6c73  method = globals
+000181c0: 2829 5b27 5a49 505f 272b 736d 6574 686f  ()['ZIP_'+smetho
+000181d0: 645d 0a0a 2020 2020 2020 2020 6465 6620  d]..        def 
+000181e0: 6164 6454 6f5a 6970 287a 662c 2070 6174  addToZip(zf, pat
+000181f0: 682c 207a 6970 7061 7468 293a 0a20 2020  h, zippath):.   
+00018200: 2020 2020 2020 2020 2069 6620 6f73 2e70           if os.p
+00018210: 6174 682e 6973 6669 6c65 2870 6174 6829  ath.isfile(path)
+00018220: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00018230: 2020 7a66 2e77 7269 7465 2870 6174 682c    zf.write(path,
+00018240: 207a 6970 7061 7468 2c20 6d65 7468 6f64   zippath, method
+00018250: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+00018260: 6966 206f 732e 7061 7468 2e69 7364 6972  if os.path.isdir
+00018270: 2870 6174 6829 3a0a 2020 2020 2020 2020  (path):.        
+00018280: 2020 2020 2020 2020 6966 207a 6970 7061          if zippa
+00018290: 7468 3a0a 2020 2020 2020 2020 2020 2020  th:.            
+000182a0: 2020 2020 2020 2020 7a66 2e77 7269 7465          zf.write
+000182b0: 2870 6174 682c 207a 6970 7061 7468 290a  (path, zippath).
+000182c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000182d0: 666f 7220 6e6d 2069 6e20 736f 7274 6564  for nm in sorted
+000182e0: 286f 732e 6c69 7374 6469 7228 7061 7468  (os.listdir(path
+000182f0: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+00018300: 2020 2020 2020 2020 6164 6454 6f5a 6970          addToZip
+00018310: 287a 662c 0a20 2020 2020 2020 2020 2020  (zf,.           
+00018320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018330: 2020 6f73 2e70 6174 682e 6a6f 696e 2870    os.path.join(p
+00018340: 6174 682c 206e 6d29 2c20 6f73 2e70 6174  ath, nm), os.pat
+00018350: 682e 6a6f 696e 287a 6970 7061 7468 2c20  h.join(zippath, 
+00018360: 6e6d 2929 0a20 2020 2020 2020 2020 2020  nm)).           
+00018370: 2023 2065 6c73 653a 2069 676e 6f72 650a   # else: ignore.
+00018380: 0a20 2020 2020 2020 2077 6974 6820 5a69  .        with Zi
+00018390: 7046 696c 6528 7a69 705f 6e61 6d65 2c20  pFile(zip_name, 
+000183a0: 2777 272c 2063 6f6d 7072 6573 7369 6f6e  'w', compression
+000183b0: 3d6d 6574 686f 642c 2063 6f6d 7072 6573  =method, compres
+000183c0: 736c 6576 656c 3d61 7267 732e 6c65 7665  slevel=args.leve
+000183d0: 6c29 2061 7320 7a66 3a0a 2020 2020 2020  l) as zf:.      
+000183e0: 2020 2020 2020 666f 7220 7061 7468 2069        for path i
+000183f0: 6e20 6669 6c65 733a 0a20 2020 2020 2020  n files:.       
+00018400: 2020 2020 2020 2020 207a 6970 7061 7468           zippath
+00018410: 203d 206f 732e 7061 7468 2e62 6173 656e   = os.path.basen
+00018420: 616d 6528 7061 7468 290a 2020 2020 2020  ame(path).      
+00018430: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+00018440: 207a 6970 7061 7468 3a0a 2020 2020 2020   zippath:.      
+00018450: 2020 2020 2020 2020 2020 2020 2020 7a69                zi
+00018460: 7070 6174 6820 3d20 6f73 2e70 6174 682e  ppath = os.path.
+00018470: 6261 7365 6e61 6d65 286f 732e 7061 7468  basename(os.path
+00018480: 2e64 6972 6e61 6d65 2870 6174 6829 290a  .dirname(path)).
+00018490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000184a0: 6966 207a 6970 7061 7468 2069 6e20 2827  if zippath in ('
+000184b0: 272c 206f 732e 6375 7264 6972 2c20 6f73  ', os.curdir, os
+000184c0: 2e70 6172 6469 7229 3a0a 2020 2020 2020  .pardir):.      
+000184d0: 2020 2020 2020 2020 2020 2020 2020 7a69                zi
+000184e0: 7070 6174 6820 3d20 2727 0a20 2020 2020  ppath = ''.     
+000184f0: 2020 2020 2020 2020 2020 2061 6464 546f             addTo
+00018500: 5a69 7028 7a66 2c20 7061 7468 2c20 7a69  Zip(zf, path, zi
+00018510: 7070 6174 6829 0a0a 0a69 6620 5f5f 6e61  ppath)...if __na
+00018520: 6d65 5f5f 203d 3d20 225f 5f6d 6169 6e5f  me__ == "__main_
+00018530: 5f22 3a0a 2020 2020 6d61 696e 2829 0a    _":.    main().
```

### Comparing `zipfile39-0.0.7.0/test/test_zipfile.py` & `zipfile39-0.0.8.0/test/test_zipfile.py`

 * *Files 13% similar despite different names*

```diff
@@ -124,14 +124,44 @@
                     hashobj.update(dec0)
                     if len(dec0) < chunksiz:
                         break
                     assert len(dec0) == chunksiz
             assert decsiz == st.st_size
             assert hashobj.hexdigest() == sha256
 
+@pytest.mark.parametrize('method,level',methods)
+def test_zipfile_pathopen(method,level):
+    fname = 'data/10000SalesRecords.csv'
+    chunksiz = 512
+    st = os.stat(fname)
+    cnt = (st.st_size+chunksiz-1)//chunksiz
+
+    with open(fname, 'rb') as f:
+        body = f.read()
+        sha256 = hashlib.sha256(body).hexdigest()
+
+    with TemporaryDirectory() as tmpdir:
+        kwargs = {'compression': method}
+        if True:  # 'compresslevel' in signature(zipfile._get_compressor).parameters:
+            kwargs['compresslevel'] = level
+        with zipfile.ZipFile(os.path.join(tmpdir, 'test.zip'), 'w', **kwargs) as zip:
+            with zip.open(fname, 'w') as zf:
+                for i in range(cnt):
+                    zf.write(body[chunksiz*i:chunksiz*(i+1)])
+        if avail7z[method]:
+            subprocess.check_call(['7z', 't', os.path.join(tmpdir, 'test.zip')], shell=False)
+        with zipfile.ZipFile(os.path.join(tmpdir, 'test.zip'), 'r') as zip:
+            # zipfile.Path(filename) does not close the file with context
+            path = zipfile.Path(zip)
+            with (path/fname).open() as f:
+                try:
+                    assert f.readline().strip() == 'Region,Country,Item Type,Sales Channel,Order Priority,Order Date,Order ID,Ship Date,Units Sold,Unit Price,Unit Cost,Total Revenue,Total Cost,Total Profit'
+                finally:
+                    f.read()
+
 @pytest.mark.parametrize('fname,level',[
     e for e in itertools.product(fnames, [5])  # list(range(1,10)))
 ])
 def test_zipfile_read_deflate64(fname,level):
     #if sys.version_info[0]<3:
     #    pytest.skip('py2 does not support deflate64')
     chunksiz = 512
```

### Comparing `zipfile39-0.0.7.0/test/data/10000SalesRecords.csv` & `zipfile39-0.0.8.0/test/data/10000SalesRecords.csv`

 * *Files identical despite different names*

### Comparing `zipfile39-0.0.7.0/LICENSE2` & `zipfile39-0.0.8.0/LICENSE2`

 * *Files identical despite different names*

### Comparing `zipfile39-0.0.7.0/CHANGELOG.md` & `zipfile39-0.0.8.0/CHANGELOG.md`

 * *Files 4% similar despite different names*

```diff
@@ -1,7 +1,15 @@
+## 0.0.8.0
+
+- Fixed zipfile.Path.open encoding
+
+## 0.0.7.0
+
+- Introduced \_\_version\_\_
+
 ## 0.0.6.0
 
 - Support inflate64/pyzstd modules (they are fallbacks, the feature does not change)
 
 ## 0.0.5.3
 
 - Fixed pypi desc display
```

### Comparing `zipfile39-0.0.7.0/README.md` & `zipfile39-0.0.8.0/README.md`

 * *Files identical despite different names*

### Comparing `zipfile39-0.0.7.0/.github/workflows/altmodule.yaml` & `zipfile39-0.0.8.0/.github/workflows/altmodule.yaml`

 * *Files 8% similar despite different names*

```diff
@@ -9,25 +9,25 @@
     strategy:
       matrix:
         python-version: ['3.9', '3.10']
         os: [ubuntu-20.04]
         architecture: ["x64"]
 
     steps:
-    - uses: actions/checkout@v2
+    - uses: actions/checkout@v3
     - name: Checkout submodule
       run: |
         git submodule init
         git submodule update
     - name: Check 7z
       run: |
         7z i
     - name: Set up Python ${{ matrix.python-version }}
       if: ${{ matrix.python-version != 'pyston' }}
-      uses: actions/setup-python@v2
+      uses: actions/setup-python@v4
       with:
         python-version: ${{ matrix.python-version }}
         architecture: ${{ matrix.architecture }}
     - name: Install dependencies
       run: |
         python -m pip install --upgrade pip
         python -m pip install pytest wheel
```

### Comparing `zipfile39-0.0.7.0/.github/workflows/ci.yaml` & `zipfile39-0.0.8.0/.github/workflows/ci.yaml`

 * *Files 1% similar despite different names*

```diff
@@ -49,25 +49,25 @@
             os: windows-latest
             architecture: "x64"
           - python-version: '2.7'
             os: windows-latest
             architecture: "x86"
 
     steps:
-    - uses: actions/checkout@v2
+    - uses: actions/checkout@v3
     - name: Checkout submodule
       run: |
         git submodule init
         git submodule update
     - name: Check 7z
       run: |
         7z i
     - name: Set up Python ${{ matrix.python-version }}
       if: ${{ matrix.python-version != 'pyston' }}
-      uses: actions/setup-python@v2
+      uses: actions/setup-python@v4
       with:
         python-version: ${{ matrix.python-version }}
         architecture: ${{ matrix.architecture }}
     - name: Set up Pyston
       if: ${{ matrix.python-version == 'pyston' }}
       run: |
         wget -O pyston.deb https://github.com/pyston/pyston/releases/download/pyston_2.3.2/pyston_2.3.2_20.04.deb
@@ -79,15 +79,17 @@
       run: |
         curl -L -O https://github.com/reider-roque/sulley-win-installer/raw/master/VCForPython27.msi
         msiexec /i VCForPython27.msi /qn
     #     choco install vcpython27 -f -y
     - name: "Install Visual C++ for Python 3.4"
       if: ${{ matrix.os == 'windows-latest' && matrix.python-version == '3.4' }}
       run: |
-        choco install windows-sdk-7.1 -f -y
+        MsiExec.exe /passive '/X{F0C3E5D1-1ADE-321E-8167-68EF0DE699A5}'
+        MsiExec.exe /passive '/X{1D8E6291-B0D5-35EC-8441-6616F567A0F7}'
+        choco install windows-sdk-7.1 -f -y --version 7.1.7600.20220204
         choco install KB2519277 -f -y
     - name: Upgrade pip
       if: ${{ matrix.python-version != '2.7' && matrix.python-version != '3.4' }}
       run: |
         python -m pip install --upgrade pip
     - name: Upgrade pip (2.7)
       if: ${{ matrix.python-version == '2.7' }}
@@ -146,15 +148,15 @@
         python -m pip install zstandard==0.11.1
     - name: Install isal for pypy-3.7
       if: ${{ matrix.python-version == 'pypy-3.7' }}
       run: |
         python -m pip install isal==0.11.1
     - name: Upload wheel
       if: ${{ matrix.os == 'windows-latest' }}
-      uses: actions/upload-artifact@v2
+      uses: actions/upload-artifact@v3
       with:
         name: windows_wheel
         path: dist
     - name: Patch directory owner (for Pyston)
       if: ${{ matrix.python-version == 'pyston' }}
       run: |
         sudo chown -RH $(whoami) $(python -c 'import os,inspect;print(os.path.dirname(inspect.getfile(inspect)))')
```

### Comparing `zipfile39-0.0.7.0/LICENSE` & `zipfile39-0.0.8.0/LICENSE`

 * *Files identical despite different names*

### Comparing `zipfile39-0.0.7.0/PKG-INFO` & `zipfile39-0.0.8.0/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: zipfile39
-Version: 0.0.7.0
+Version: 0.0.8.0
 Summary: Backport of zipfile Python 3.9 to Python 2.7 with some enhancements
 Home-page: https://github.com/cielavenir/zipfile39
 Author: cielavenir
 Author-email: cielartisan@gmail.com
 License: PSF
 Description: [![PyPI](https://img.shields.io/pypi/v/zipfile39)](https://pypi.org/project/zipfile39/)
```

### Comparing `zipfile39-0.0.7.0/setup.py` & `zipfile39-0.0.8.0/setup.py`

 * *Files identical despite different names*

